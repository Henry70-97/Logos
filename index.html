<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creativepay - Earn from Creative Writing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    .gradient-primary {
      background: linear-gradient(135deg, #059669 0%, #0d9488 50%, #14b8a6 100%);
    }
    
    .gradient-card {
      background: linear-gradient(135deg, #10b981 0%, #0d9488 100%);
    }
    
    .gradient-soft {
      background: linear-gradient(135deg, #ecfdf5 0%, #f0fdfa 100%);
    }
    
    .floating-shape {
      position: absolute;
      border-radius: 50%;
      opacity: 0.1;
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    .slide-in {
      transform: translateX(-100%);
      transition: transform 0.3s ease-out;
    }
    
    .slide-in.active {
      transform: translateX(0);
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px -12px rgba(16, 185, 129, 0.25);
    }
    
    .task-card:nth-child(odd) {
      background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
    }
    
    .task-card:nth-child(even) {
      background: linear-gradient(135deg, #f0fdfa 0%, #ecfeff 100%);
    }
    
    .modal-overlay {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #059669 0%, #0d9488 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #047857 0%, #0f766e 100%);
      transform: translateY(-2px);
    }
    
    .input-field {
      transition: all 0.3s ease;
    }
    
    .input-field:focus {
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .pdf-container {
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      max-height: 70vh;
      overflow-y: auto;
    }

    .toast {
      animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-out 2.7s forwards;
    }

    @keyframes slideIn {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      vertical-align: middle;
      margin-right: 6px;
    }

    .spinner-small {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 1.5px solid rgba(107, 114, 128, 0.3);
      border-top-color: #10b981;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-white overflow-x-hidden">
  <div id="app" class="h-full overflow-auto"><!-- Toast Container -->
   <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div><!-- Floating Shapes Background -->
   <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="floating-shape w-64 h-64 bg-emerald-500 -top-32 -right-32" style="animation-delay: 0s;"></div>
    <div class="floating-shape w-48 h-48 bg-teal-500 top-1/3 -left-24" style="animation-delay: 1s;"></div>
    <div class="floating-shape w-32 h-32 bg-emerald-400 bottom-1/4 right-1/4" style="animation-delay: 2s;"></div>
    <div class="floating-shape w-40 h-40 bg-teal-400 -bottom-20 left-1/3" style="animation-delay: 3s;"></div>
   </div><!-- Mobile Menu Overlay -->
   <div id="menuOverlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="toggleMenu()"></div><!-- Slide-in Menu -->
   <div id="slideMenu" class="fixed top-0 left-0 h-full w-72 bg-white shadow-2xl z-50 slide-in">
    <div class="gradient-primary p-6">
     <div class="flex items-center justify-between">
      <div class="flex items-center gap-3"><img src="logo.png" alt="Creativepay Logo" class="w-12 h-12 rounded-xl object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
       <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center hidden" id="sidebarLogoFallback">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
       </div>
       <div>
        <h2 class="text-white font-bold text-lg" id="menuTitle">Creativepay</h2>
        <p class="text-white/70 text-sm" id="menuUserName">Welcome!</p>
       </div>
      </div><button onclick="toggleMenu()" class="text-white/80 hover:text-white">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
    </div>
    <nav class="p-4 space-y-1"><a onclick="navigateTo('home')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
       </svg>
      </div><span class="font-medium text-gray-700">Home</span> </a> <a onclick="navigateTo('tasks')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
       </svg>
      </div><span class="font-medium text-gray-700">Available Tasks</span> </a> <a onclick="navigateTo('dashboard')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-cyan-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
       </svg>
      </div><span class="font-medium text-gray-700">My Dashboard</span> </a> <a onclick="navigateTo('submit')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
       </svg>
      </div><span class="font-medium text-gray-700">Submit Task</span> </a> <a onclick="navigateTo('earnings')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg>
      </div><span class="font-medium text-gray-700">Earnings</span> </a> <a onclick="navigateTo('withdraw')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
       </svg>
      </div><span class="font-medium text-gray-700">Withdraw</span> </a> <a onclick="navigateTo('refund')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
       </svg>
      </div><span class="font-medium text-gray-700">Refund</span> </a> <a onclick="navigateTo('support')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-emerald-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
       </svg>
      </div><span class="font-medium text-gray-700">Support</span> </a>
     <div class="border-t border-gray-100 my-3"></div><a onclick="logout()" class="flex items-center gap-3 p-3 rounded-xl hover:bg-red-50 cursor-pointer transition-colors">
      <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
       <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
       </svg>
      </div><span class="font-medium text-red-600">Logout</span> </a>
    </nav>
   </div><!-- Header -->
   <header class="sticky top-0 bg-white/80 backdrop-blur-lg border-b border-gray-100 z-30">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
     <div class="flex items-center gap-3"><button onclick="toggleMenu()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors lg:hidden">
       <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
       </svg></button>
      <div class="flex items-center gap-2"><img src="logo.png" alt="Creativepay Logo" class="w-10 h-10 rounded-xl object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
       <div class="w-10 h-10 gradient-primary rounded-xl flex items-center justify-center hidden" id="headerLogoFallback">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
       </div>
       <h1 class="text-xl font-bold text-gray-800" id="headerTitle">Creativepay</h1>
      </div>
     </div>
     <div class="hidden lg:flex items-center gap-4">
      <nav class="flex items-center gap-1"><a onclick="navigateTo('home')" class="px-4 py-2 text-gray-600 hover:text-emerald-600 font-medium cursor-pointer transition-colors">Home</a> <a onclick="navigateTo('tasks')" class="px-4 py-2 text-gray-600 hover:text-emerald-600 font-medium cursor-pointer transition-colors">Tasks</a> <a onclick="navigateTo('dashboard')" class="px-4 py-2 text-gray-600 hover:text-emerald-600 font-medium cursor-pointer transition-colors">Dashboard</a> <a onclick="navigateTo('earnings')" class="px-4 py-2 text-gray-600 hover:text-emerald-600 font-medium cursor-pointer transition-colors">Earnings</a>
      </nav>
     </div>
     <div id="headerActions" class="flex items-center gap-2"><!-- Dynamic based on login state -->
     </div>
    </div>
   </header><!-- Main Content Container -->
   <main id="mainContent" class="relative z-10"><!-- Content will be dynamically loaded here -->
   </main><!-- Footer -->
   <footer class="bg-gray-900 text-white mt-auto relative z-10">
    <div class="max-w-6xl mx-auto px-4 py-12">
     <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div class="col-span-1 md:col-span-2">
       <div class="flex items-center gap-2 mb-4"><img src="logo.png" alt="Creativepay Logo" class="w-10 h-10 rounded-xl object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div class="w-10 h-10 gradient-primary rounded-xl flex items-center justify-center hidden" id="footerLogoFallback">
         <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
         </svg>
        </div>
        <h3 class="text-xl font-bold">Creativepay</h3>
       </div>
       <p class="text-gray-400 mb-4">Empowering creative writers in Kenya and beyond. Earn from your passion for storytelling and literature.</p>
       <div class="flex items-center gap-3"><a href="#" class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center hover:bg-emerald-600 transition-colors">
         <svg class="w-5 h-5" fill="currentColor" viewbox="0 0 24 24">
          <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z" />
         </svg></a> <a href="#" class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center hover:bg-emerald-600 transition-colors">
         <svg class="w-5 h-5" fill="currentColor" viewbox="0 0 24 24">
          <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
         </svg></a> <a href="#" class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center hover:bg-emerald-600 transition-colors">
         <svg class="w-5 h-5" fill="currentColor" viewbox="0 0 24 24">
          <path d="M22.675 0h-21.35c-.732 0-1.325.593-1.325 1.325v21.351c0 .731.593 1.324 1.325 1.324h11.495v-9.294h-3.128v-3.622h3.128v-2.671c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12v9.293h6.116c.73 0 1.323-.593 1.323-1.325v-21.35c0-.732-.593-1.325-1.325-1.325z" />
         </svg></a>
       </div>
      </div>
      <div>
       <h4 class="font-semibold mb-4">Quick Links</h4>
       <ul class="space-y-2 text-gray-400">
        <li><a onclick="navigateTo('tasks')" class="hover:text-emerald-400 cursor-pointer transition-colors">Available Tasks</a></li>
        <li><a onclick="navigateTo('dashboard')" class="hover:text-emerald-400 cursor-pointer transition-colors">My Dashboard</a></li>
        <li><a onclick="navigateTo('earnings')" class="hover:text-emerald-400 cursor-pointer transition-colors">Earnings</a></li>
        <li><a onclick="navigateTo('support')" class="hover:text-emerald-400 cursor-pointer transition-colors">Support</a></li>
       </ul>
      </div>
      <div>
       <h4 class="font-semibold mb-4">Legal</h4>
       <ul class="space-y-2 text-gray-400">
        <li><a href="#" class="hover:text-emerald-400 transition-colors">Terms of Service</a></li>
        <li><a href="#" class="hover:text-emerald-400 transition-colors">Privacy Policy</a></li>
        <li><a href="#" class="hover:text-emerald-400 transition-colors">Cookie Policy</a></li>
        <li><a href="#" class="hover:text-emerald-400 transition-colors">Contact Us</a></li>
       </ul>
      </div>
     </div>
     <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-500">
      <p>¬© 2024 Creativepay. All rights reserved. Made with ‚ù§Ô∏è for Kenyan writers.</p>
     </div>
    </div>
   </footer>
  </div>
  <script>
    // Configuration
    const defaultConfig = {
      site_title: 'Creativepay',
      tagline: 'Earn from your creative writing'
    };

    let config = { ...defaultConfig };
    const WEB3FORMS_KEY = '4d568274-521b-452a-a113-62eed5ad915b';
    const EXCHANGE_RATE = 130; // 1 USD = 130 KES (approximate)

    // State Management
    let currentPage = 'landing';
    let isLoggedIn = false;
    let currentUser = null;
    let earnings = 0;
    let bonusBalance = 0; // Non-withdrawable welcome bonus
    let activities = [];
    let acceptedTasks = [];
    let submittedTasks = [];
    let selectedCurrency = 'USD';
    let isSubscribed = false;
    let freeTaskUsed = false;
    let completedTasksThisMonth = 0;
    const SUBSCRIPTION_PRICE_KES = 310;
    const SUBSCRIPTION_PRICE_USD = 2.38; // Approximate conversion
    const SUBSCRIBER_MONTHLY_TASK_LIMIT = 5;

    // Writing Tasks Data
    const shortStoryTasks = [
      { id: 'ss1', title: 'The Lost Heritage', author: 'Ngugi wa Thiong\'o', book: 'Petals of Blood', client: 'Kenya Literature Board', genre: 'Historical Fiction', wordCount: 2500, pages: 10, question: 'Analyze the theme of colonial exploitation in "Petals of Blood" by Ngugi wa Thiong\'o. Discuss how the novel portrays the relationship between capitalism and cultural erosion in post-independence Kenya. Reference specific scenes and character developments to support your analysis.', type: 'essay' },
      { id: 'ss2', title: 'Whispers of the Savanna', author: 'Grace Ogot', book: 'The Promised Land', client: 'African Writers Trust', genre: 'Drama', wordCount: 3000, pages: 12, question: 'Write a critical analysis of gender roles and women\'s struggles in Grace Ogot\'s "The Promised Land." Explore how the protagonist Nyapol navigates patriarchal expectations while pursuing her own identity. Include references to specific dialogue and narrative techniques.', type: 'essay' },
      { id: 'ss3', title: 'Urban Dreams', author: 'Meja Mwangi', book: 'Going Down River Road', client: 'Nairobi Publishers', genre: 'Urban Fiction', wordCount: 2000, pages: 8, question: 'Examine the portrayal of urban poverty and survival in Meja Mwangi\'s "Going Down River Road." Analyze how the setting of Nairobi shapes the characters\' decisions and moral choices throughout the narrative.', type: 'essay' },
      { id: 'ss4', title: 'The Village Elder', author: 'Marjorie Oludhe Macgoye', book: 'Coming to Birth', client: 'East African Educational', genre: 'Historical', wordCount: 2750, pages: 11, question: 'Discuss the intersection of personal and political transformation in "Coming to Birth." How does Paulina\'s journey mirror Kenya\'s path to independence? Analyze the symbolism of birth and rebirth throughout the novel.', type: 'essay' },
      { id: 'ss5', title: 'Echoes of Tradition', author: 'Margaret Ogola', book: 'The River and the Source', client: 'Focus Publishers', genre: 'Family Saga', wordCount: 3500, pages: 14, question: 'Trace the evolution of womanhood across four generations in "The River and the Source." How does each generation respond differently to cultural expectations? Discuss the role of education and Christianity in shaping these responses.', type: 'essay' },
      { id: 'ss6', title: 'The Maasai Warrior', author: 'Henry ole Kulet', book: 'Is It Possible?', client: 'Longhorn Kenya', genre: 'Cultural Fiction', wordCount: 2250, pages: 9, question: 'Analyze the conflict between traditional Maasai customs and modern education in "Is It Possible?" How does Doris navigate between these two worlds? Discuss the author\'s perspective on cultural preservation versus progress.', type: 'essay' },
      { id: 'ss7', title: 'City Under Stars', author: 'Yvonne Owuor', book: 'Dust', client: 'Kwani Trust', genre: 'Contemporary', wordCount: 3250, pages: 13, question: 'Examine how trauma and memory shape identity in Yvonne Owuor\'s "Dust." Analyze the non-linear narrative structure and its effect on understanding the Oganda family\'s history. How does the novel address Kenya\'s political violence?', type: 'essay' },
      { id: 'ss8', title: 'The Coffee Farmer', author: 'Ngugi wa Thiong\'o', book: 'Weep Not, Child', client: 'Kenya Literature Board', genre: 'Coming-of-Age', wordCount: 2500, pages: 10, question: 'Analyze Njoroge\'s journey from innocent child to disillusioned young man in "Weep Not, Child." How does education serve both as hope and a source of disillusionment? Discuss the impact of the Mau Mau uprising on family relationships.', type: 'essay' },
      { id: 'ss9', title: 'Harvest Moon', author: 'Grace Ogot', book: 'Land Without Thunder', client: 'African Writers Trust', genre: 'Short Stories', wordCount: 1750, pages: 7, question: 'Select three stories from "Land Without Thunder" and analyze how Grace Ogot blends traditional Luo folklore with contemporary social commentary. Discuss her use of supernatural elements and their symbolic significance.', type: 'essay' },
      { id: 'ss10', title: 'The Refugee\'s Tale', author: 'Moraa Gitaa', book: 'Nairobi Noir', client: 'Cassava Republic', genre: 'Crime Fiction', wordCount: 2000, pages: 8, question: 'Write an original short story (2000 words) in the style of Nairobi Noir, featuring a displaced character navigating Nairobi\'s urban landscape. Include elements of crime, suspense, and social commentary on refugee experiences in Kenya.', type: 'short_story' },
      { id: 'ss11', title: 'Digital Horizons', author: 'Peter Kimani', book: 'Dance of the Jakaranda', client: 'Akashic Books', genre: 'Historical Fiction', wordCount: 3000, pages: 12, question: 'Analyze the construction of the Kenya-Uganda Railway as portrayed in "Dance of the Jakaranda." How does Kimani use this historical event to explore themes of identity, belonging, and the birth of a nation?', type: 'essay' },
      { id: 'ss12', title: 'The Fisherman\'s Daughter', author: 'Okwiri Oduor', book: 'Things They Lost', client: 'Oneworld Publications', genre: 'Magical Realism', wordCount: 2750, pages: 11, question: 'Examine the use of magical realism in "Things They Lost." How does Oduor blend supernatural elements with the harsh realities of life in Western Kenya? Analyze the symbolism of loss and memory throughout the narrative.', type: 'essay' },
      { id: 'ss13', title: 'Sunrise Over Turkana', author: 'Kinyanjui Kombani', book: 'The Last Villains of Molo', client: 'Kwani Trust', genre: 'Political Thriller', wordCount: 2500, pages: 10, question: 'Discuss how "The Last Villains of Molo" addresses ethnic conflict and political manipulation in Kenya. Analyze the novel\'s portrayal of ordinary people caught in extraordinary circumstances during election violence.', type: 'essay' },
      { id: 'ss14', title: 'The Matatu Chronicles', author: 'Meja Mwangi', book: 'The Cockroach Dance', client: 'Nairobi Publishers', genre: 'Urban Satire', wordCount: 2250, pages: 9, question: 'Analyze the use of humor and satire in "The Cockroach Dance" to critique social inequality in urban Kenya. How does Mwangi portray the resilience of marginalized communities?', type: 'essay' },
      { id: 'ss15', title: 'Whispers in the Wind', author: 'Wahome Mutahi', book: 'Three Days on the Cross', client: 'East African Educational', genre: 'Political Satire', wordCount: 2000, pages: 8, question: 'Examine the role of journalism and truth-telling in "Three Days on the Cross." How does Mutahi use Chipota\'s ordeal to comment on press freedom and political repression in Kenya?', type: 'essay' },
      { id: 'ss16', title: 'Children of the Revolution', author: 'Ngugi wa Thiong\'o', book: 'A Grain of Wheat', client: 'Kenya Literature Board', genre: 'Revolutionary Fiction', wordCount: 3500, pages: 14, question: 'Analyze the concept of betrayal in "A Grain of Wheat." How do the characters\' wartime secrets affect their post-independence identities? Discuss the novel\'s non-linear structure and multiple perspectives.', type: 'essay' }
    ];

    const essayTasks = [
      { id: 'e1', title: 'Colonial Impact Analysis', author: 'Chinua Achebe', book: 'Things Fall Apart', client: 'Pan-African Studies Institute', genre: 'Literary Analysis', wordCount: 3000, pages: 12, question: 'Compare and contrast the portrayal of colonial impact on African societies in Achebe\'s "Things Fall Apart" with any Kenyan novel of your choice. Discuss how each author uses narrative techniques to convey cultural disruption and resistance.', type: 'essay' },
      { id: 'e2', title: 'Women in African Literature', author: 'Chimamanda Ngozi Adichie', book: 'Purple Hibiscus', client: 'Gender Studies Journal', genre: 'Feminist Analysis', wordCount: 2500, pages: 10, question: 'Analyze the portrayal of domestic violence and religious extremism in "Purple Hibiscus." Compare Adichie\'s treatment of these themes with their representation in Kenyan women\'s literature.', type: 'essay' },
      { id: 'e3', title: 'Post-Independence Disillusionment', author: 'Ayi Kwei Armah', book: 'The Beautyful Ones Are Not Yet Born', client: 'African Literature Review', genre: 'Political Analysis', wordCount: 2750, pages: 11, question: 'Discuss the theme of corruption and moral decay in post-colonial African nations as portrayed in "The Beautyful Ones Are Not Yet Born." How does this compare to Ngugi wa Thiong\'o\'s treatment of similar themes?', type: 'essay' },
      { id: 'e4', title: 'Oral Tradition in Modern Fiction', author: 'Ben Okri', book: 'The Famished Road', client: 'Folklore Studies Quarterly', genre: 'Magical Realism', wordCount: 3250, pages: 13, question: 'Examine how Ben Okri incorporates Yoruba mythology and oral tradition in "The Famished Road." Discuss how this technique compares to the use of Gikuyu oral traditions in Kenyan literature.', type: 'essay' },
      { id: 'e5', title: 'Urban Migration Narratives', author: 'Wole Soyinka', book: 'The Interpreters', client: 'Urban Studies Journal', genre: 'Social Commentary', wordCount: 2500, pages: 10, question: 'Analyze the portrayal of urban intellectual life in "The Interpreters." Compare Soyinka\'s Lagos with the representation of Nairobi in contemporary Kenyan fiction. What common themes emerge?', type: 'essay' },
      { id: 'e6', title: 'Language and Identity', author: 'Ngugi wa Thiong\'o', book: 'Decolonising the Mind', client: 'Linguistics Department', genre: 'Critical Theory', wordCount: 3000, pages: 12, question: 'Discuss Ngugi\'s arguments for African language literature in "Decolonising the Mind." Evaluate the practical implications of his position for contemporary Kenyan writers. Include your own perspective on the language debate.', type: 'essay' },
      { id: 'e7', title: 'Environmental Themes in African Fiction', author: 'Wangari Maathai', book: 'Unbowed', client: 'Environmental Humanities', genre: 'Memoir/Environmental', wordCount: 2250, pages: 9, question: 'Analyze the intersection of environmental activism and women\'s empowerment in "Unbowed." How does Maathai\'s personal narrative contribute to understanding Kenya\'s environmental challenges?', type: 'essay' },
      { id: 'e8', title: 'Childhood and War', author: 'Ishmael Beah', book: 'A Long Way Gone', client: 'Child Studies Institute', genre: 'War Memoir', wordCount: 2500, pages: 10, question: 'Compare the portrayal of child soldiers in "A Long Way Gone" with the representation of children affected by political violence in Kenyan literature. Discuss the psychological impacts and recovery narratives.', type: 'essay' },
      { id: 'e9', title: 'African Feminism', author: 'Buchi Emecheta', book: 'The Joys of Motherhood', client: 'Women\'s Studies Quarterly', genre: 'Feminist Fiction', wordCount: 2750, pages: 11, question: 'Critically analyze the paradox of motherhood as presented in "The Joys of Motherhood." How does Emecheta\'s portrayal compare to the representation of motherhood in East African women\'s writing?', type: 'essay' },
      { id: 'e10', title: 'Diaspora Narratives', author: 'Teju Cole', book: 'Open City', client: 'Migration Studies', genre: 'Contemporary Fiction', wordCount: 3000, pages: 12, question: 'Examine the representation of African diaspora experience in "Open City." How does Julius\'s flaneur-style exploration of New York relate to Kenyan diaspora literature and themes of displacement?', type: 'essay' },
      { id: 'e11', title: 'Traditional Medicine and Modernity', author: 'Various', book: 'African Health Traditions', client: 'Medical Humanities', genre: 'Cultural Analysis', wordCount: 2000, pages: 8, question: 'Write an analytical essay on the portrayal of traditional healing practices in Kenyan literature. How do authors navigate between respecting cultural heritage and acknowledging modern medicine?', type: 'essay' },
      { id: 'e12', title: 'Music and Resistance', author: 'Various', book: 'Songs of Freedom', client: 'Ethnomusicology Journal', genre: 'Cultural Studies', wordCount: 2500, pages: 10, question: 'Analyze the role of music and song in resistance movements as portrayed in African literature. Focus on examples from Kenyan independence literature and contemporary protest narratives.', type: 'essay' },
      { id: 'e13', title: 'Education as Liberation', author: 'Various', book: 'Colonial Education in Africa', client: 'Education Studies', genre: 'Historical Analysis', wordCount: 2750, pages: 11, question: 'Discuss the dual role of education as both colonial tool and liberation mechanism in Kenyan literature. Reference at least three novels from different time periods to support your analysis.', type: 'essay' },
      { id: 'e14', title: 'Land and Belonging', author: 'Various', book: 'Land Narratives in Africa', client: 'Agricultural Studies', genre: 'Social Commentary', wordCount: 3000, pages: 12, question: 'Analyze the significance of land in Kenyan literature from pre-colonial to contemporary times. How do different authors portray the relationship between land, identity, and political power?', type: 'essay' },
      { id: 'e15', title: 'Digital Age Storytelling', author: 'Various', book: 'New Media Narratives', client: 'Digital Humanities', genre: 'Contemporary', wordCount: 2000, pages: 8, question: 'Write an essay on how Kenyan writers are adapting traditional storytelling techniques for digital platforms. Discuss the emergence of Twitter fiction, blog narratives, and mobile-first literature.', type: 'essay' },
      { id: 'e16', title: 'Climate Change in African Fiction', author: 'Various', book: 'Afrofuturism', client: 'Environmental Literature', genre: 'Speculative Fiction', wordCount: 2500, pages: 10, question: 'Analyze how contemporary African and Kenyan authors are addressing climate change in their fiction. Discuss the emergence of African cli-fi and its potential for inspiring environmental action.', type: 'essay' }
    ];

    // Utility Functions
    function showToast(message, type = 'success') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-amber-500';
      toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg font-medium`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function formatCurrency(amount, currency = selectedCurrency) {
      if (currency === 'KES') {
        return `KES ${(amount * EXCHANGE_RATE).toLocaleString('en-KE', { minimumFractionDigits: 2 })}`;
      }
      return `$${amount.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
    }

    function calculatePayment(pages) {
      return pages * 2; // $2 per page (250 words)
    }

    function saveToLocalStorage() {
      const data = {
        isLoggedIn,
        currentUser,
        earnings,
        bonusBalance,
        activities,
        acceptedTasks,
        submittedTasks,
        selectedCurrency,
        isSubscribed,
        freeTaskUsed,
        completedTasksThisMonth
      };
      localStorage.setItem('creativepay_data', JSON.stringify(data));
    }

    function loadFromLocalStorage() {
      const data = localStorage.getItem('creativepay_data');
      if (data) {
        const parsed = JSON.parse(data);
        isLoggedIn = parsed.isLoggedIn || false;
        currentUser = parsed.currentUser || null;
        earnings = parsed.earnings || 0;
        bonusBalance = parsed.bonusBalance || 0;
        activities = parsed.activities || [];
        acceptedTasks = parsed.acceptedTasks || [];
        submittedTasks = parsed.submittedTasks || [];
        selectedCurrency = parsed.selectedCurrency || 'USD';
        isSubscribed = parsed.isSubscribed || false;
        freeTaskUsed = parsed.freeTaskUsed || false;
        completedTasksThisMonth = parsed.completedTasksThisMonth || 0;
      }
    }

    function toggleMenu() {
      const menu = document.getElementById('slideMenu');
      const overlay = document.getElementById('menuOverlay');
      menu.classList.toggle('active');
      overlay.classList.toggle('hidden');
    }

    function toggleCurrency() {
      selectedCurrency = selectedCurrency === 'USD' ? 'KES' : 'USD';
      saveToLocalStorage();
      updateDashboardCard();
    }

    function updateHeaderActions() {
      const container = document.getElementById('headerActions');
      const menuUserName = document.getElementById('menuUserName');
      
      if (isLoggedIn && currentUser) {
        menuUserName.textContent = currentUser.fullName;
        container.innerHTML = `
          <div class="flex items-center gap-2">
            <div class="w-9 h-9 gradient-primary rounded-full flex items-center justify-center text-white font-bold text-sm">
              ${currentUser.fullName.charAt(0).toUpperCase()}
            </div>
            <span class="hidden md:inline text-sm font-medium text-gray-700">${currentUser.fullName}</span>
          </div>
        `;
      } else {
        menuUserName.textContent = 'Welcome!';
        container.innerHTML = `
          <button onclick="navigateTo('login')" class="px-4 py-2 text-emerald-600 font-medium hover:bg-emerald-50 rounded-xl transition-colors">Login</button>
          <button onclick="navigateTo('register')" class="px-4 py-2 btn-primary text-white font-medium rounded-xl">Sign Up</button>
        `;
      }
    }

    // Page Rendering Functions
    function renderLandingPage() {
      return `
        <div class="min-h-screen">
          <!-- Hero Section -->
          <section class="px-4 py-16 md:py-24">
            <div class="max-w-6xl mx-auto">
              <div class="text-center mb-12">
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-100 rounded-full text-emerald-700 font-medium text-sm mb-6">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                  Now with $5 Welcome Bonus!
                </div>
                <h1 class="text-4xl md:text-6xl font-extrabold text-gray-900 mb-6 leading-tight">
                  Turn Your <span class="text-transparent bg-clip-text gradient-primary">Creative Writing</span><br>Into Real Earnings
                </h1>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto mb-8" id="landingTagline">
                  ${config.tagline}. Join thousands of Kenyan writers earning from short stories and literary essays.
                </p>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                  <button onclick="navigateTo('tasks')" class="w-full sm:w-auto px-8 py-4 bg-gray-100 text-gray-700 font-bold rounded-2xl text-lg hover:bg-gray-200 transition-colors">
                    Browse Tasks
                  </button>
                  <button onclick="navigateTo('register')" class="w-full sm:w-auto px-8 py-4 btn-primary text-white font-bold rounded-2xl text-lg shadow-lg shadow-emerald-200">
                    Start Earning Today ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
                  </button>
                </div>
              </div>

              <!-- Stats Cards -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16">
                <div class="bg-white rounded-3xl p-6 shadow-lg card-hover border border-gray-100">
                  <div class="w-14 h-14 bg-emerald-100 rounded-2xl flex items-center justify-center mb-4">
                    <svg class="w-7 h-7 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                  </div>
                  <h3 class="text-3xl font-bold text-gray-900 mb-1">10,000+</h3>
                  <p class="text-gray-600">Active Writers</p>
                </div>
                <div class="bg-white rounded-3xl p-6 shadow-lg card-hover border border-gray-100">
                  <div class="w-14 h-14 bg-teal-100 rounded-2xl flex items-center justify-center mb-4">
                    <svg class="w-7 h-7 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <h3 class="text-3xl font-bold text-gray-900 mb-1">$500K+</h3>
                  <p class="text-gray-600">Paid to Writers</p>
                </div>
                <div class="bg-white rounded-3xl p-6 shadow-lg card-hover border border-gray-100">
                  <div class="w-14 h-14 bg-cyan-100 rounded-2xl flex items-center justify-center mb-4">
                    <svg class="w-7 h-7 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                  </div>
                  <h3 class="text-3xl font-bold text-gray-900 mb-1">50,000+</h3>
                  <p class="text-gray-600">Tasks Completed</p>
                </div>
              </div>
            </div>
          </section>

          <!-- How It Works -->
          <section class="px-4 py-16 bg-gradient-to-br from-emerald-50 to-teal-50">
            <div class="max-w-6xl mx-auto">
              <h2 class="text-3xl md:text-4xl font-bold text-center text-gray-900 mb-12">How It Works</h2>
              <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="text-center">
                  <div class="w-16 h-16 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4 text-white font-bold text-xl">1</div>
                  <h3 class="font-bold text-gray-900 mb-2">Sign Up</h3>
                  <p class="text-gray-600 text-sm">Create your free account and get $5 welcome bonus</p>
                </div>
                <div class="text-center">
                  <div class="w-16 h-16 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4 text-white font-bold text-xl">2</div>
                  <h3 class="font-bold text-gray-900 mb-2">Browse Tasks</h3>
                  <p class="text-gray-600 text-sm">Find writing tasks that match your interests</p>
                </div>
                <div class="text-center">
                  <div class="w-16 h-16 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4 text-white font-bold text-xl">3</div>
                  <h3 class="font-bold text-gray-900 mb-2">Write & Submit</h3>
                  <p class="text-gray-600 text-sm">Complete your essay or short story</p>
                </div>
                <div class="text-center">
                  <div class="w-16 h-16 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4 text-white font-bold text-xl">4</div>
                  <h3 class="font-bold text-gray-900 mb-2">Get Paid</h3>
                  <p class="text-gray-600 text-sm">Withdraw earnings to M-Pesa or Bank</p>
                </div>
              </div>
            </div>
          </section>

          <!-- Featured Tasks Preview -->
          <section class="px-4 py-16">
            <div class="max-w-6xl mx-auto">
              <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900">Featured Writing Tasks</h2>
                <button onclick="navigateTo('tasks')" class="text-emerald-600 font-medium hover:underline">View All ‚Üí</button>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${shortStoryTasks.slice(0, 3).map((task, i) => `
                  <div class="task-card rounded-2xl p-6 card-hover border border-gray-100">
                    <div class="flex items-start justify-between mb-4">
                      <span class="px-3 py-1 ${i % 2 === 0 ? 'bg-emerald-100 text-emerald-700' : 'bg-teal-100 text-teal-700'} rounded-full text-xs font-medium">${task.genre}</span>
                      <span class="text-emerald-600 font-bold">${formatCurrency(calculatePayment(task.pages))}</span>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-2">${task.title}</h3>
                    <p class="text-sm text-gray-600 mb-3">${task.book} by ${task.author}</p>
                    <div class="flex items-center gap-4 text-xs text-gray-500">
                      <span>${task.wordCount} words</span>
                      <span>${task.pages} pages</span>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </section>
        </div>
      `;
    }

    function renderRegisterPage() {
      return `
        <div class="min-h-screen flex items-center justify-center px-4 py-12">
          <div class="w-full max-w-md">
            <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
              <div class="text-center mb-8">
                <div class="w-16 h-16 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                  </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">Create Account</h2>
                <p class="text-gray-600 mt-2">Join and start earning from your writing</p>
                <div class="mt-3 px-4 py-2 bg-emerald-100 rounded-xl text-emerald-700 text-sm font-medium">
                  üéÅ Get $5 Welcome Bonus on Registration!
                </div>
              </div>
              <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" name="fullName" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Enter your full name">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" name="email" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="you@example.com">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" name="phone" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="+254 7XX XXX XXX">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" name="password" required minlength="6" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Min 6 characters">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                    <input type="password" name="confirmPassword" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Confirm your password">
                  </div>
                  <div class="flex items-start gap-2">
                    <input type="checkbox" name="terms" required class="mt-1">
                    <label class="text-sm text-gray-600">I agree to the <a href="#" class="text-emerald-600 hover:underline">Terms of Service</a> and <a href="#" class="text-emerald-600 hover:underline">Privacy Policy</a></label>
                  </div>
                  <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                    Create Account
                  </button>
                </div>
              </form>
              <p class="text-center text-gray-600 mt-6">
                Already have an account? <a onclick="navigateTo('login')" class="text-emerald-600 font-medium cursor-pointer hover:underline">Sign In</a>
              </p>
            </div>
          </div>
        </div>
      `;
    }

    function renderLoginPage() {
      return `
        <div class="min-h-screen flex items-center justify-center px-4 py-12">
          <div class="w-full max-w-md">
            <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
              <div class="text-center mb-8">
                <div class="w-16 h-16 gradient-primary rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
                  </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">Welcome Back</h2>
                <p class="text-gray-600 mt-2">Sign in to access your account</p>
              </div>
              <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" name="email" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="you@example.com">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" name="password" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Enter your password">
                  </div>
                  <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                    Sign In
                  </button>
                </div>
              </form>
              <p class="text-center text-gray-600 mt-6">
                Don't have an account? <a onclick="navigateTo('register')" class="text-emerald-600 font-medium cursor-pointer hover:underline">Sign Up</a>
              </p>
            </div>
          </div>
        </div>
      `;
    }

    function renderHomePage() {
      return `
        <div class="max-w-6xl mx-auto px-4 py-6">
          <!-- Balance Card -->
          <div class="gradient-card rounded-3xl p-6 md:p-8 text-white shadow-xl shadow-emerald-200/50 mb-8">
            <div class="flex items-center justify-between mb-4">
              <span class="text-white/80 font-medium">Total Earnings</span>
              <button onclick="toggleCurrency()" class="px-3 py-1 bg-white/20 rounded-full text-sm font-medium hover:bg-white/30 transition-colors">
                ${selectedCurrency === 'USD' ? 'USD ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ' : 'KES üá∞üá™'}
              </button>
            </div>
          <!-- Balance Card -->
          <div class="gradient-card rounded-3xl p-6 md:p-8 text-white shadow-xl shadow-emerald-200/50 mb-8">
            <div class="flex items-center justify-between mb-4">
              <span class="text-white/80 font-medium">Total Balance</span>
              <button onclick="toggleCurrency()" class="px-3 py-1 bg-white/20 rounded-full text-sm font-medium hover:bg-white/30 transition-colors">
                ${selectedCurrency === 'USD' ? 'USD üá∫üá∏' : 'KES üá∞üá™'}
              </button>
            </div>
            <div class="text-4xl md:text-5xl font-bold mb-6" id="balanceDisplay">
              ${formatCurrency(earnings)}
            </div>
            <div class="grid grid-cols-2 gap-3 mb-6">
              <div class="bg-white/20 rounded-xl p-3">
                <p class="text-white/70 text-xs mb-1">Withdrawable</p>
                <p class="font-bold">${formatCurrency(earnings)}</p>
              </div>
              <div class="bg-white/20 rounded-xl p-3">
                <p class="text-white/70 text-xs mb-1">Bonus (Unlock at ${formatCurrency(SUBSCRIPTION_PRICE_USD)})</p>
                <p class="font-bold">${formatCurrency(bonusBalance)}</p>
              </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
              <button onclick="navigateTo('tasks')" class="flex-1 py-3 bg-white text-emerald-600 font-bold rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                </svg>
                Start Writing
              </button>
              <button onclick="navigateTo('withdraw')" class="flex-1 py-3 bg-white/20 text-white font-bold rounded-xl hover:bg-white/30 transition-colors flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                Withdraw
              </button>
            </div>
          </div>
              <button onclick="navigateTo('tasks')" class="flex-1 py-3 bg-white text-emerald-600 font-bold rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                </svg>
                Start Writing
              </button>
              <button onclick="navigateTo('withdraw')" class="flex-1 py-3 bg-white/20 text-white font-bold rounded-xl hover:bg-white/30 transition-colors flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                Withdraw
              </button>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
              <div class="text-2xl font-bold text-gray-900">${acceptedTasks.length}</div>
              <div class="text-sm text-gray-600">Active Tasks</div>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
              <div class="text-2xl font-bold text-gray-900">${submittedTasks.length}</div>
              <div class="text-sm text-gray-600">Submitted</div>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
              <div class="text-2xl font-bold text-emerald-600">${submittedTasks.filter(t => t.status === 'approved').length}</div>
              <div class="text-sm text-gray-600">Approved</div>
            </div>
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
              <div class="text-2xl font-bold text-amber-600">${submittedTasks.filter(t => t.status === 'pending').length}</div>
              <div class="text-sm text-gray-600">Pending</div>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-6 border-b border-gray-100">
              <h2 class="text-xl font-bold text-gray-900">Recent Activity</h2>
            </div>
            <div class="divide-y divide-gray-100">
              ${activities.length === 0 ? `
                <div class="p-8 text-center text-gray-500">
                  <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                  <p>No recent activity yet. Start writing to see your progress!</p>
                </div>
              ` : activities.slice(0, 5).map(activity => `
                <div class="p-4 flex items-center gap-4 hover:bg-gray-50 transition-colors">
                  <div class="w-10 h-10 ${activity.type === 'submission' ? 'bg-blue-100' : activity.type === 'approved' ? 'bg-emerald-100' : activity.type === 'earnings' ? 'bg-amber-100' : 'bg-gray-100'} rounded-xl flex items-center justify-center">
                    ${activity.type === 'submission' ? `<svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>` : 
                      activity.type === 'approved' ? `<svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>` :
                      `<svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`}
                  </div>
                  <div class="flex-1">
                    <p class="font-medium text-gray-900">${activity.description}</p>
                    <p class="text-sm text-gray-500">${activity.time}</p>
                  </div>
                  ${activity.amount ? `<span class="font-bold ${activity.amount > 0 ? 'text-emerald-600' : 'text-red-600'}">+${formatCurrency(activity.amount)}</span>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function renderTasksPage() {
      return `
        <div class="max-w-6xl mx-auto px-4 py-6">
          <div class="mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Available Writing Tasks</h1>
            <p class="text-gray-600">Choose a task and start earning. Payment: $2 per page (250 words)</p>
          </div>

          <!-- Task Type Tabs -->
          <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
            <button onclick="filterTasks('all')" id="tabAll" class="px-6 py-2 bg-emerald-600 text-white rounded-xl font-medium whitespace-nowrap">All Tasks</button>
            <button onclick="filterTasks('short_story')" id="tabStory" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-xl font-medium whitespace-nowrap hover:bg-gray-200 transition-colors">Short Stories</button>
            <button onclick="filterTasks('essay')" id="tabEssay" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-xl font-medium whitespace-nowrap hover:bg-gray-200 transition-colors">Essays</button>
          </div>

          <!-- Tasks Grid -->
          <div id="tasksGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            ${renderTaskCards([...shortStoryTasks, ...essayTasks])}
          </div>
        </div>
      `;
    }

    function renderTaskCards(tasks) {
      return tasks.map((task, index) => {
        const colorSchemes = [
          { bg: 'bg-gradient-to-br from-emerald-50 to-teal-50', border: 'border-emerald-200', accent: 'bg-emerald-500', icon: '‚úèÔ∏è' },
          { bg: 'bg-gradient-to-br from-blue-50 to-cyan-50', border: 'border-blue-200', accent: 'bg-blue-500', icon: 'üìñ' },
          { bg: 'bg-gradient-to-br from-purple-50 to-pink-50', border: 'border-purple-200', accent: 'bg-purple-500', icon: 'üìö' },
          { bg: 'bg-gradient-to-br from-amber-50 to-orange-50', border: 'border-amber-200', accent: 'bg-amber-500', icon: '‚ú®' },
          { bg: 'bg-gradient-to-br from-rose-50 to-red-50', border: 'border-rose-200', accent: 'bg-rose-500', icon: 'üéØ' }
        ];
        
        const scheme = colorSchemes[index % colorSchemes.length];
        
        return `
        <div class="task-card ${scheme.bg} rounded-2xl p-6 card-hover border-2 ${scheme.border} relative overflow-hidden group">
          <!-- Decorative corner element -->
          <div class="absolute top-0 right-0 w-32 h-32 ${scheme.accent} opacity-5 rounded-full -mr-16 -mt-16 group-hover:scale-110 transition-transform duration-300"></div>
          
          <!-- Icon badge -->
          <div class="absolute top-4 right-4 text-3xl">${scheme.icon}</div>
          
          <div class="relative z-10">
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center gap-2">
                <span class="px-3 py-1 ${index % 3 === 0 ? 'bg-emerald-100 text-emerald-700' : index % 3 === 1 ? 'bg-teal-100 text-teal-700' : 'bg-cyan-100 text-cyan-700'} rounded-full text-xs font-medium">${task.genre}</span>
                <span class="px-3 py-1 ${task.type === 'essay' ? 'bg-purple-100 text-purple-700' : 'bg-orange-100 text-orange-700'} rounded-full text-xs font-medium">${task.type === 'essay' ? 'Essay' : 'Story'}</span>
              </div>
              <span class="text-emerald-600 font-bold text-lg">${formatCurrency(calculatePayment(task.pages))}</span>
            </div>
            <h3 class="font-bold text-gray-900 text-lg mb-2">${task.title}</h3>
            <div class="space-y-1 mb-4">
              <p class="text-sm text-gray-700"><span class="font-medium">üìï Book:</span> ${task.book}</p>
              <p class="text-sm text-gray-700"><span class="font-medium">‚úçÔ∏è Author:</span> ${task.author}</p>
              <p class="text-sm text-gray-700"><span class="font-medium">üè¢ Client:</span> ${task.client}</p>
            </div>
            <p class="text-sm text-gray-600 mb-4 line-clamp-2">${task.question.substring(0, 120)}...</p>
            <div class="flex items-center gap-4 text-xs text-gray-600 mb-4">
              <span class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                ${task.wordCount} words
              </span>
              <span>üìÑ ${task.pages} pages</span>
            </div>
            <div class="flex gap-3">
              <button onclick="viewTaskDetails('${task.id}')" class="flex-1 px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-xl hover:bg-gray-100 transition-colors border border-gray-300">
                View Details
              </button>
              <button onclick="acceptTask('${task.id}')" class="flex-1 px-4 py-2 btn-primary text-white text-sm font-medium rounded-xl">
                Accept
              </button>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function filterTasks(type) {
      const tabs = ['tabAll', 'tabStory', 'tabEssay'];
      tabs.forEach(id => {
        document.getElementById(id).className = 'px-6 py-2 bg-gray-100 text-gray-700 rounded-xl font-medium whitespace-nowrap hover:bg-gray-200 transition-colors';
      });
      
      const activeTab = type === 'all' ? 'tabAll' : type === 'short_story' ? 'tabStory' : 'tabEssay';
      document.getElementById(activeTab).className = 'px-6 py-2 bg-emerald-600 text-white rounded-xl font-medium whitespace-nowrap';

      let filteredTasks;
      if (type === 'all') {
        filteredTasks = [...shortStoryTasks, ...essayTasks];
      } else if (type === 'short_story') {
        filteredTasks = shortStoryTasks;
      } else {
        filteredTasks = essayTasks;
      }

      document.getElementById('tasksGrid').innerHTML = renderTaskCards(filteredTasks);
    }

    function viewTaskDetails(taskId) {
      const allTasks = [...shortStoryTasks, ...essayTasks];
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;

      const modal = document.createElement('div');
      modal.id = 'taskModal';
      modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90%] overflow-hidden">
          <!-- PDF-style header -->
          <div class="gradient-primary p-6 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                  </svg>
                </div>
                <div>
                  <h2 class="text-xl font-bold">Creativepay</h2>
                  <p class="text-white/70 text-sm">Writing Task Brief</p>
                </div>
              </div>
              <button onclick="closeModal('taskModal')" class="text-white/80 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          
          <!-- PDF-style content -->
          <div class="pdf-container p-6 md:p-8 overflow-y-auto" style="max-height: calc(90vh - 200px);">
            <div class="border-2 border-gray-200 rounded-xl p-6 bg-gray-50/50">
              <div class="text-center mb-6 pb-6 border-b border-gray-200">
                <h1 class="text-2xl font-bold text-gray-900">${task.title}</h1>
                <p class="text-gray-600">${task.type === 'essay' ? 'Essay Assignment' : 'Short Story Assignment'}</p>
              </div>
              
              <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-white rounded-xl p-4 border border-gray-200">
                  <p class="text-xs text-gray-500 uppercase tracking-wide">Book</p>
                  <p class="font-semibold text-gray-900">${task.book}</p>
                </div>
                <div class="bg-white rounded-xl p-4 border border-gray-200">
                  <p class="text-xs text-gray-500 uppercase tracking-wide">Author</p>
                  <p class="font-semibold text-gray-900">${task.author}</p>
                </div>
                <div class="bg-white rounded-xl p-4 border border-gray-200">
                  <p class="text-xs text-gray-500 uppercase tracking-wide">Client</p>
                  <p class="font-semibold text-gray-900">${task.client}</p>
                </div>
                <div class="bg-white rounded-xl p-4 border border-gray-200">
                  <p class="text-xs text-gray-500 uppercase tracking-wide">Genre</p>
                  <p class="font-semibold text-gray-900">${task.genre}</p>
                </div>
              </div>

              <div class="bg-white rounded-xl p-4 border border-gray-200 mb-6">
                <p class="text-xs text-gray-500 uppercase tracking-wide mb-2">Task Description</p>
                <p class="text-gray-700 leading-relaxed">${task.question}</p>
              </div>

              <div class="flex items-center justify-between bg-emerald-50 rounded-xl p-4 border border-emerald-200">
                <div>
                  <p class="text-xs text-emerald-600 uppercase tracking-wide">Requirements</p>
                  <p class="font-semibold text-gray-900">${task.wordCount} words (${task.pages} pages)</p>
                </div>
                <div class="text-right">
                  <p class="text-xs text-emerald-600 uppercase tracking-wide">Payment</p>
                  <p class="text-2xl font-bold text-emerald-600">${formatCurrency(calculatePayment(task.pages))}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="p-6 border-t border-gray-100 bg-gray-50 flex flex-col sm:flex-row gap-3">
            <button onclick="closeModal('taskModal')" class="flex-1 py-3 bg-gray-200 text-gray-700 font-bold rounded-xl hover:bg-gray-300 transition-colors flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
              Close
            </button>
            <button onclick="acceptTask('${task.id}')" class="flex-1 py-3 btn-primary text-white font-bold rounded-xl flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Accept Task
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function downloadTaskPDF(taskId) {
      const allTasks = [...shortStoryTasks, ...essayTasks];
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;

      // Create printable content
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>${task.title} - Creativepay Task Brief</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
            .header { text-align: center; border-bottom: 2px solid #059669; padding-bottom: 20px; margin-bottom: 30px; }
            .logo { font-size: 24px; font-weight: bold; color: #059669; }
            .title { font-size: 28px; margin: 20px 0 10px; }
            .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
            .info-box { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
            .info-label { font-size: 12px; color: #666; text-transform: uppercase; }
            .info-value { font-weight: bold; margin-top: 5px; }
            .question { background: #f3f4f6; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
            .payment { background: #ecfdf5; padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; }
            .payment-amount { font-size: 24px; font-weight: bold; color: #059669; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="logo">‚úçÔ∏è Creativepay</div>
            <div class="title">${task.title}</div>
            <p>${task.type === 'essay' ? 'Essay Assignment' : 'Short Story Assignment'}</p>
          </div>
          <div class="info-grid">
            <div class="info-box"><div class="info-label">Book</div><div class="info-value">${task.book}</div></div>
            <div class="info-box"><div class="info-label">Author</div><div class="info-value">${task.author}</div></div>
            <div class="info-box"><div class="info-label">Client</div><div class="info-value">${task.client}</div></div>
            <div class="info-box"><div class="info-label">Genre</div><div class="info-value">${task.genre}</div></div>
          </div>
          <div class="question">
            <div class="info-label" style="margin-bottom: 10px;">Task Description</div>
            <p>${task.question}</p>
          </div>
          <div class="payment">
            <div><div class="info-label">Requirements</div><div class="info-value">${task.wordCount} words (${task.pages} pages)</div></div>
            <div style="text-align: right;"><div class="info-label">Payment</div><div class="payment-amount">${formatCurrency(calculatePayment(task.pages))}</div></div>
          </div>
        </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }

    function acceptTask(taskId) {
      if (!isLoggedIn) {
        closeModal('taskModal');
        showToast('Please login to accept tasks', 'warning');
        navigateTo('login');
        return;
      }

      const allTasks = [...shortStoryTasks, ...essayTasks];
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;

      if (acceptedTasks.find(t => t.id === taskId)) {
        showToast('You have already accepted this task', 'warning');
        return;
      }

      // Check subscription and task limits
      if (!isSubscribed && freeTaskUsed) {
        closeModal('taskModal');
        showToast('You need to subscribe to accept more tasks', 'warning');
        navigateTo('subscribe');
        return;
      }

      // Check if subscriber reached monthly limit
      if (isSubscribed && completedTasksThisMonth >= SUBSCRIBER_MONTHLY_TASK_LIMIT) {
        closeModal('taskModal');
        showTaskLimitReached();
        return;
      }

      acceptedTasks.push({ ...task, acceptedAt: new Date().toISOString() });
      if (!isSubscribed) {
        freeTaskUsed = true;
      }
      activities.unshift({
        type: 'accepted',
        description: `Accepted task: ${task.title}`,
        time: 'Just now',
        amount: null
      });
      saveToLocalStorage();
      closeModal('taskModal');
      showToast(freeTaskUsed && !isSubscribed ? 'Free task accepted! Subscribe for more tasks.' : `Task accepted! (${completedTasksThisMonth + 1}/${SUBSCRIBER_MONTHLY_TASK_LIMIT} this month)`, 'success');
    }

    function renderDashboardPage() {
      if (!isLoggedIn) {
        return renderLoginRequired();
      }

      return `
        <div class="max-w-6xl mx-auto px-4 py-6">
          <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">My Dashboard</h1>
          
          <!-- Stats Overview -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 border border-emerald-100">
              <div class="text-3xl font-bold text-emerald-600">${formatCurrency(earnings)}</div>
              <div class="text-sm text-gray-600">Total Earnings</div>
            </div>
            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 border border-blue-100">
              <div class="text-3xl font-bold text-blue-600">${acceptedTasks.length}</div>
              <div class="text-sm text-gray-600">Active Tasks</div>
            </div>
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-5 border border-purple-100">
              <div class="text-3xl font-bold text-purple-600">${submittedTasks.length}</div>
              <div class="text-sm text-gray-600">Submitted</div>
            </div>
            <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 border border-amber-100">
              <div class="text-3xl font-bold text-amber-600">${submittedTasks.filter(t => t.status === 'approved').length}</div>
              <div class="text-sm text-gray-600">Approved</div>
            </div>
          </div>

          <!-- Accepted Tasks -->
          <div class="bg-white rounded-3xl shadow-sm border border-gray-100 mb-8">
            <div class="p-6 border-b border-gray-100">
              <h2 class="text-xl font-bold text-gray-900">My Active Tasks</h2>
            </div>
            <div class="p-6">
              ${acceptedTasks.length === 0 ? `
                <div class="text-center py-8 text-gray-500">
                  <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                  <p>No active tasks. Browse available tasks to get started!</p>
                  <button onclick="navigateTo('tasks')" class="mt-4 px-6 py-2 btn-primary text-white rounded-xl font-medium">Browse Tasks</button>
                </div>
              ` : `
                <div class="grid gap-4">
                  ${acceptedTasks.map(task => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                      <div>
                        <h3 class="font-semibold text-gray-900">${task.title}</h3>
                        <p class="text-sm text-gray-600">${task.book} ‚Ä¢ ${task.wordCount} words</p>
                      </div>
                      <div class="flex items-center gap-3">
                        <span class="text-emerald-600 font-bold">${formatCurrency(calculatePayment(task.pages))}</span>
                        <button onclick="goToSubmit('${task.id}')" class="px-4 py-2 btn-primary text-white text-sm rounded-xl">Submit</button>
                      </div>
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
          </div>

          <!-- Submitted Tasks -->
          <div class="bg-white rounded-3xl shadow-sm border border-gray-100">
            <div class="p-6 border-b border-gray-100">
              <h2 class="text-xl font-bold text-gray-900">Submission History</h2>
            </div>
            <div class="p-6">
              ${submittedTasks.length === 0 ? `
                <div class="text-center py-8 text-gray-500">
                  <p>No submissions yet.</p>
                </div>
              ` : `
                <div class="space-y-3">
                  ${submittedTasks.map(task => `
                    <div class="flex items-center justify-between p-4 rounded-xl ${task.status === 'approved' ? 'bg-emerald-50' : task.status === 'pending' ? 'bg-amber-50' : 'bg-red-50'}">
                      <div>
                        <h3 class="font-semibold text-gray-900">${task.title}</h3>
                        <p class="text-sm text-gray-600">Submitted: ${task.submittedAt}</p>
                      </div>
                      <div class="flex items-center gap-3">
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${task.status === 'approved' ? 'bg-emerald-200 text-emerald-800' : task.status === 'pending' ? 'bg-amber-200 text-amber-800' : 'bg-red-200 text-red-800'}">
                          ${task.status.charAt(0).toUpperCase() + task.status.slice(1)}
                        </span>
                        <span class="font-bold ${task.status === 'approved' ? 'text-emerald-600' : 'text-gray-400'}">${formatCurrency(calculatePayment(task.pages))}</span>
                      </div>
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
          </div>
        </div>
      `;
    }

    function goToSubmit(taskId) {
      navigateTo('submit');
      setTimeout(() => {
        const select = document.querySelector('select[name="taskId"]');
        if (select) select.value = taskId;
      }, 100);
    }

    function renderSubmitPage() {
      if (!isLoggedIn) {
        return renderLoginRequired();
      }

      return `
        <div class="max-w-2xl mx-auto px-4 py-6">
          <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
            <div class="text-center mb-8">
              <div class="w-16 h-16 bg-emerald-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Submit Your Work</h2>
              <p class="text-gray-600 mt-2">Upload your completed task for review</p>
            </div>
            
            ${acceptedTasks.length === 0 ? `
              <div class="text-center py-8 text-gray-500">
                <p>You need to accept a task first before submitting.</p>
                <button onclick="navigateTo('tasks')" class="mt-4 px-6 py-3 btn-primary text-white rounded-xl font-medium">Browse Tasks</button>
              </div>
            ` : `
              <form id="submitForm" onsubmit="handleSubmitTask(event)">
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Select Task</label>
                    <select name="taskId" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none bg-white">
                      <option value="">Choose a task...</option>
                      ${acceptedTasks.map(task => `
                        <option value="${task.id}">${task.title} - ${formatCurrency(calculatePayment(task.pages))}</option>
                      `).join('')}
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Your Submission</label>
                    <textarea name="content" required rows="10" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none resize-none" placeholder="Paste your essay or short story here..."></textarea>
                    <p class="text-xs text-gray-500 mt-1">Minimum word count will be verified</p>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Additional Notes (Optional)</label>
                    <textarea name="notes" rows="3" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none resize-none" placeholder="Any additional comments for the reviewer..."></textarea>
                  </div>
                  <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                    Submit for Review
                  </button>
                </div>
              </form>
            `}
          </div>
        </div>
      `;
    }

    function renderEarningsPage() {
      if (!isLoggedIn) {
        return renderLoginRequired();
      }

      const earningHistory = submittedTasks.filter(t => t.status === 'approved');

      return `
        <div class="max-w-4xl mx-auto px-4 py-6">
          <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">My Earnings</h1>
          
          <!-- Earnings Summary Card -->
          <div class="gradient-card rounded-3xl p-6 md:p-8 text-white shadow-xl mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <p class="text-white/70 text-sm mb-1">Total Earned</p>
                <p class="text-3xl font-bold">${formatCurrency(earnings)}</p>
              </div>
              <div>
                <p class="text-white/70 text-sm mb-1">Tasks Completed</p>
                <p class="text-3xl font-bold">${earningHistory.length}</p>
              </div>
              <div>
                <p class="text-white/70 text-sm mb-1">Available to Withdraw</p>
                <p class="text-3xl font-bold">${formatCurrency(earnings)}</p>
              </div>
            </div>
          </div>

          <!-- Earnings History -->
          <div class="bg-white rounded-3xl shadow-sm border border-gray-100">
            <div class="p-6 border-b border-gray-100">
              <h2 class="text-xl font-bold text-gray-900">Earnings History</h2>
            </div>
            <div class="divide-y divide-gray-100">
              ${earningHistory.length === 0 ? `
                <div class="p-8 text-center text-gray-500">
                  <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <p>No earnings yet. Complete tasks to start earning!</p>
                </div>
              ` : earningHistory.map(task => `
                <div class="p-4 flex items-center justify-between hover:bg-gray-50 transition-colors">
                  <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                      <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                    </div>
                    <div>
                      <p class="font-medium text-gray-900">${task.title}</p>
                      <p class="text-sm text-gray-500">${task.submittedAt}</p>
                    </div>
                  </div>
                  <span class="font-bold text-emerald-600">+${formatCurrency(calculatePayment(task.pages))}</span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function renderWithdrawPage() {
      if (!isLoggedIn) {
        return renderLoginRequired();
      }

      return `
        <div class="max-w-xl mx-auto px-4 py-6">
          <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
            <div class="text-center mb-8">
              <div class="w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Withdraw Funds</h2>
              <p class="text-gray-600 mt-2">Available: <span class="text-emerald-600 font-bold">${formatCurrency(earnings)}</span></p>
            </div>

            ${bonusBalance > 0 ? `
              <div class="bg-amber-50 border-2 border-amber-200 rounded-xl p-4 mb-6">
                <div class="flex gap-3">
                  <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <div>
                    <p class="font-semibold text-amber-900">Bonus Locked: ${formatCurrency(bonusBalance)}</p>
                    <p class="text-sm text-amber-800">Subscribe for KSH 310 to unlock your bonus earnings.</p>
                  </div>
                </div>
              </div>
            ` : ''}
            
            ${earnings === 0 ? `
              <div class="text-center py-8 text-gray-500">
                <p>No withdrawable earnings yet. Complete tasks to start earning!</p>
                <button onclick="navigateTo('tasks')" class="mt-4 px-6 py-3 btn-primary text-white rounded-xl font-medium">Browse Tasks</button>
              </div>
            ` : `
              <form id="withdrawForm" onsubmit="handleWithdraw(event)">
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Withdrawal Currency</label>
                    <select name="currency" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none bg-white">
                      <option value="USD">USD (US Dollars) üá∫ÔøΩÔøΩÔøΩ</option>
                      <option value="KES">KES (Kenyan Shillings) üá∞üá™</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Amount (USD)</label>
                    <input type="number" name="amount" required min="0.01" max="${earnings}" step="0.01" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Enter amount">
                    <p class="text-xs text-gray-500 mt-1">Maximum available: ${formatCurrency(earnings)}</p>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
                    <select name="method" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none bg-white">
                      <option value="mpesa">M-Pesa</option>
                      <option value="bank">Bank Transfer</option>
                      <option value="paypal">PayPal</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Payment Details</label>
                    <input type="text" name="paymentDetails" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Phone number or account details">
                  </div>
                  <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                    Request Withdrawal
                  </button>
                </div>
              </form>
            `}
          </div>
        </div>
      `;
    }

    function renderRefundPage() {
      return `
        <div class="max-w-xl mx-auto px-4 py-6">
          <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
            <div class="text-center mb-8">
              <div class="w-16 h-16 bg-orange-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Request Refund</h2>
              <p class="text-gray-600 mt-2">Submit your refund request</p>
            </div>
            
            <form id="refundForm" onsubmit="handleRefund(event)">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                  <input type="text" name="name" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Your full name" value="${currentUser?.fullName || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" name="email" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Your email" value="${currentUser?.email || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Transaction ID</label>
                  <input type="text" name="transactionId" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Enter transaction ID">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Refund Amount (USD)</label>
                  <input type="number" name="amount" required min="1" step="0.01" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Enter refund amount">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Reason for Refund</label>
                  <textarea name="reason" required rows="4" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none resize-none" placeholder="Please explain why you're requesting a refund..."></textarea>
                </div>
                <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                  Submit Refund Request
                </button>
              </div>
            </form>
          </div>
        </div>
      `;
    }

    function renderSupportPage() {
      return `
        <div class="max-w-xl mx-auto px-4 py-6">
          <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
            <div class="text-center mb-8">
              <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Support Center</h2>
              <p class="text-gray-600 mt-2">We're here to help!</p>
            </div>
            
            <form id="supportForm" onsubmit="handleSupport(event)">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                  <input type="text" name="name" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Your name" value="${currentUser?.fullName || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" name="email" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Your email" value="${currentUser?.email || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                  <select name="subject" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none bg-white">
                    <option value="">Select a topic...</option>
                    <option value="account">Account Issues</option>
                    <option value="payment">Payment Problems</option>
                    <option value="task">Task Questions</option>
                    <option value="technical">Technical Issues</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Message</label>
                  <textarea name="message" required rows="5" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none resize-none" placeholder="Describe your issue..."></textarea>
                </div>
                <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                  Send Message
                </button>
              </div>
            </form>
          </div>
        </div>
      `;
    }

    function renderDeclarationPage() {
      return `
        <div class="max-w-2xl mx-auto px-4 py-6">
          <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
            <div class="text-center mb-8">
              <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Writer Declaration</h2>
              <p class="text-gray-600 mt-2">Please read and accept our terms</p>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-6 mb-6 max-h-64 overflow-y-auto text-sm text-gray-700 space-y-4">
              <h3 class="font-bold text-gray-900">Declaration of Original Work</h3>
              <p>I hereby declare that:</p>
              <ol class="list-decimal list-inside space-y-2">
                <li>All work submitted through Creativepay will be my own original creation.</li>
                <li>I will not plagiarize or copy content from any source without proper attribution.</li>
                <li>I understand that all submissions will be checked for plagiarism.</li>
                <li>I will complete tasks within the specified deadlines and word count requirements.</li>
                <li>I will maintain professional conduct in all interactions on the platform.</li>
                <li>I acknowledge that payments are subject to task approval and quality review.</li>
                <li>I agree to the platform's terms of service and privacy policy.</li>
                <li>I understand that repeated violations may result in account suspension.</li>
              </ol>
              <h3 class="font-bold text-gray-900 mt-4">Payment Terms</h3>
              <p>Payment rate: $2.00 per page (250 words). Minimum withdrawal: $5.00. Processing time: 1-3 business days.</p>
            </div>

            <form id="declarationForm" onsubmit="handleDeclaration(event)">
              <div class="space-y-4">
                <div class="flex items-start gap-3">
                  <input type="checkbox" name="agree" required class="mt-1">
                  <label class="text-sm text-gray-700">I have read and agree to the above declaration and terms</label>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Full Name (as declaration)</label>
                  <input type="text" name="name" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Type your full name" value="${currentUser?.fullName || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" name="email" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Your email" value="${currentUser?.email || ''}">
                </div>
                <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                  Accept & Continue
                </button>
              </div>
            </form>
          </div>
        </div>
      `;
    }

    function renderPaymentSetupPage() {
      return `
        <div class="max-w-xl mx-auto px-4 py-6">
          <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
            <div class="text-center mb-8">
              <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Payment Setup</h2>
              <p class="text-gray-600 mt-2">Set up your payment method to receive earnings</p>
            </div>
            
            <form id="paymentSetupForm" onsubmit="handlePaymentSetup(event)">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                  <input type="text" name="name" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Account holder name" value="${currentUser?.fullName || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" name="email" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Your email" value="${currentUser?.email || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Payment Method</label>
                  <select name="method" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none bg-white">
                    <option value="mpesa">M-Pesa</option>
                    <option value="bank">Bank Transfer</option>
                    <option value="paypal">PayPal</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Payment Details</label>
                  <input type="text" name="details" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="M-Pesa number, Bank account, or PayPal email">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Currency</label>
                  <select name="currency" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none bg-white">
                    <option value="USD">USD (US Dollars)</option>
                    <option value="KES">KES (Kenyan Shillings)</option>
                  </select>
                </div>
                <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                  Save Payment Details
                </button>
              </div>
            </form>
          </div>
        </div>
      `;
    }

    function renderSubscribePage() {
      return `
        <div class="max-w-2xl mx-auto px-4 py-6">
          <!-- Subscription Card -->
          <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
            <!-- Header -->
            <div class="gradient-primary p-8 text-white">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center">
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                </div>
                <div>
                  <h2 class="text-2xl font-bold">Premium Subscription</h2>
                  <p class="text-white/70">Unlimited task submissions every month</p>
                </div>
              </div>
            </div>

            <!-- Content -->
            <div class="p-8">
              <!-- Plan Details -->
              <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-6 mb-8 border border-emerald-200">
                <div class="flex items-end justify-between mb-4">
                  <div>
                    <p class="text-gray-600 text-sm mb-1">Monthly Price</p>
                    <div class="flex items-baseline gap-2">
                      <span class="text-4xl font-bold text-emerald-600">KSH 310</span>
                      <span class="text-gray-600">/ month</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">‚âà USD $${SUBSCRIPTION_PRICE_USD.toFixed(2)}</p>
                  </div>
                  <div class="text-right">
                    <p class="text-5xl font-bold text-gray-300">üìÜ</p>
                  </div>
                </div>
              </div>

              <!-- Features List -->
              <div class="mb-8">
                <h3 class="font-bold text-gray-900 mb-4">What's Included:</h3>
                <ul class="space-y-3">
                  <li class="flex items-center gap-3">
                    <div class="w-5 h-5 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                      <svg class="w-3 h-3 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                      </svg>
                    </div>
                    <span class="text-gray-700">Unlimited task submissions per month</span>
                  </li>
                  <li class="flex items-center gap-3">
                    <div class="w-5 h-5 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                      <svg class="w-3 h-3 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                      </svg>
                    </div>
                    <span class="text-gray-700">Access to all premium writing tasks</span>
                  </li>
                  <li class="flex items-center gap-3">
                    <div class="w-5 h-5 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                      <svg class="w-3 h-3 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                      </svg>
                    </div>
                    <span class="text-gray-700">Priority submission review (24 hours)</span>
                  </li>
                  <li class="flex items-center gap-3">
                    <div class="w-5 h-5 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0">
                      <svg class="w-3 h-3 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                      </svg>
                    </div>
                    <span class="text-gray-700">24/7 Premium support</span>
                  </li>
                </ul>
              </div>

              <!-- Payment Options -->
              <div id="paymentOptions" class="space-y-4">
                <!-- Pay Button -->
                <button onclick="showPaymentConfirm('mpesa')" class="w-full py-4 btn-primary text-white font-bold rounded-xl flex items-center justify-center gap-2 hover:shadow-lg transition-shadow">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Pay KSH 310 with M-Pesa
                </button>

                <!-- Already Paid Section -->
                <div id="alreadyPaidSection" class="bg-gray-50 rounded-xl p-4">
                  <button onclick="showPaymentVerify()" class="w-full text-emerald-600 font-medium hover:text-emerald-700 transition-colors py-2">
                    Already paid? Click here ‚Üì
                  </button>
                </div>

                <!-- Payment Verification Form (Hidden by default) -->
                <div id="verifyPaymentForm" class="hidden mt-4 space-y-4">
                  <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                    <p class="text-sm text-blue-800 flex items-start gap-2">
                      <svg class="w-4 h-4 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                      <span>Paste your M-Pesa payment confirmation message below</span>
                    </p>
                  </div>
                  <textarea id="paymentMessage" placeholder="Example: KSH 310.00 received from John Doe 1234567890 on 15/01/2024 at 10:30 PM. Acc balance is 50,000KSH. New amount charged. Ref: ABC123XYZ..." rows="4" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none resize-none"></textarea>
                  <button onclick="verifyPayment()" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                    Verify Payment
                  </button>
                  <button onclick="hidePaymentVerify()" class="w-full py-2 bg-gray-200 text-gray-700 font-medium rounded-xl hover:bg-gray-300 transition-colors">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Back Button -->
          <button onclick="navigateTo('tasks')" class="mt-6 px-6 py-2 text-gray-600 font-medium hover:text-gray-700">
            ‚Üê Back to Tasks
          </button>
        </div>
      `;
    }

    function showPaymentConfirm(method) {
      const modal = document.createElement('div');
      modal.id = 'paymentConfirmModal';
      modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8">
          <div class="text-center">
            <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Complete Your Payment</h3>
            <p class="text-gray-600 mb-6">Send KSH 310 to activate unlimited tasks</p>
            
            <div class="bg-emerald-50 rounded-xl p-4 mb-6 border border-emerald-200">
              <p class="text-sm text-gray-600 mb-2">Payment Recipient</p>
              <p class="text-lg font-bold text-emerald-600">Lipana Technologies Limited</p>
              <p class="text-xs text-gray-600 mt-2">Secure Payment via Lipana</p>
            </div>

            <div class="bg-blue-50 rounded-xl p-4 mb-6 border border-blue-200">
              <p class="text-sm text-gray-600 mb-2">Amount</p>
              <p class="text-lg font-bold text-blue-600">KSH 310</p>
              <p class="text-xs text-gray-600 mt-2">Premium Monthly Subscription</p>
            </div>

            <div class="text-left bg-gray-50 rounded-xl p-4 mb-6">
              <p class="text-xs text-gray-600 mb-2 font-medium">WHAT HAPPENS NEXT:</p>
              <ol class="text-xs text-gray-700 space-y-1 list-decimal list-inside">
                <li>Click button below to open payment link</li>
                <li>Complete payment on Lipana secure checkout</li>
                <li>Paste your M-Pesa confirmation message</li>
                <li>We'll verify and activate your subscription</li>
                <li>Unlock unlimited tasks + bonus earnings!</li>
              </ol>
            </div>

            <button onclick="redirectToPayment()" class="w-full py-3 btn-primary text-white font-bold rounded-xl mb-3 flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
              </svg>
              Pay KSH 310 Now
            </button>
            <button onclick="closeModal('paymentConfirmModal')" class="w-full py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors">
              Close
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function redirectToPayment() {
      closeModal('paymentConfirmModal');
      window.open('https://lipana.dev/pay/verification-fee', '_blank', 'noopener,noreferrer');
      
      // Show verification prompt after opening payment link
      setTimeout(() => {
        showPaymentVerificationModal();
      }, 1000);
    }

    function showPaymentVerificationModal() {
      const modal = document.createElement('div');
      modal.id = 'paymentVerificationModal';
      modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-8">
          <div class="text-center mb-6">
            <div class="w-16 h-16 bg-cyan-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
              </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-900">Verify Your Payment</h2>
            <p class="text-gray-600 mt-2">Check your M-Pesa confirmation message</p>
          </div>

          <div class="bg-amber-50 border-2 border-amber-200 rounded-xl p-4 mb-6">
            <div class="flex gap-3">
              <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <div class="text-sm text-amber-800">
                <p class="font-semibold mb-1">Verify Before Submitting</p>
                <p>Make sure your M-Pesa confirmation shows:</p>
                <ul class="text-xs mt-2 space-y-1 ml-4 list-disc">
                  <li><span class="font-bold">Recipient:</span> Lipana Technologies Limited</li>
                  <li><span class="font-bold">Amount:</span> KSH 310</li>
                  <li><span class="font-bold">Status:</span> Confirmed/Sent ‚úì</li>
                </ul>
              </div>
            </div>
          </div>

          <form id="paymentVerificationForm" onsubmit="handlePaymentVerification(event)">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Paste Your M-Pesa Confirmation Message</label>
              <textarea id="mpesaConfirmation" name="mpesaMessage" required rows="4" placeholder="Example: KSH 310.00 received from JOHN DOE 1234567890 on 15/01/2024 at 10:30 PM Acc balance is 50,000KSH New amount charged Ref: ABC123XYZ. Lipana Technologies Limited" class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none resize-none text-sm"></textarea>
              <p class="text-xs text-gray-500 mt-2">Copy directly from your M-Pesa SMS message</p>
            </div>

            <div class="space-y-2 mb-6">
              <label class="flex items-start gap-2">
                <input type="checkbox" name="recipientCheck" required class="mt-1">
                <span class="text-sm text-gray-700">I confirm the recipient is <span class="font-bold">Lipana Technologies Limited</span></span>
              </label>
              <label class="flex items-start gap-2">
                <input type="checkbox" name="amountCheck" required class="mt-1">
                <span class="text-sm text-gray-700">I confirm the amount is exactly <span class="font-bold">KSH 310</span></span>
              </label>
              <label class="flex items-start gap-2">
                <input type="checkbox" name="statusCheck" required class="mt-1">
                <span class="text-sm text-gray-700">I confirm the status shows <span class="font-bold">Confirmed/Sent ‚úì</span></span>
              </label>
            </div>

            <div class="flex flex-col gap-3">
              <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                Verify & Activate Subscription
              </button>
              <button type="button" onclick="closeModal('paymentVerificationModal')" class="w-full py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors">
                Cancel
              </button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function handlePaymentVerification(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Verifying...';
      button.disabled = true;

      const message = document.getElementById('mpesaConfirmation').value.trim();
      
      if (!message) {
        showToast('Please paste your payment confirmation message', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
        return;
      }

      if (!message.toUpperCase().includes('310')) {
        showToast('Payment message must contain KSH 310 confirmation', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
        return;
      }

      if (!message.toUpperCase().includes('LIPANA')) {
        showToast('Payment must show recipient as Lipana Technologies Limited', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
        return;
      }

      if (!message.toUpperCase().includes('CONFIRMED') && !message.toUpperCase().includes('SENT')) {
        showToast('Payment status must show Confirmed or Sent', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
        return;
      }

      // All checks passed - activate subscription
      setTimeout(() => {
        activateSubscription();
        button.innerHTML = originalText;
        button.disabled = false;
        closeModal('paymentVerificationModal');
      }, 1500);
    }

    function activateSubscription() {
      // Mark as subscribed and unlock bonus
      isSubscribed = true;
      earnings += bonusBalance; // Unlock the bonus
      bonusBalance = 0; // Clear locked bonus
      completedTasksThisMonth = 0; // Reset monthly counter
      
      activities.unshift({
        type: 'subscription',
        description: 'üéâ Premium subscription activated! Bonus unlocked.',
        time: 'Just now',
        amount: null
      });
      saveToLocalStorage();
      
      showToast('üéâ Subscription verified! Bonus unlocked and added to your balance!', 'success');
      
      setTimeout(() => {
        navigateTo('tasks');
      }, 2000);
    }

    function showTaskLimitReached() {
      const modal = document.createElement('div');
      modal.id = 'taskLimitModal';
      modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8">
          <div class="text-center">
            <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">Monthly Limit Reached</h3>
            <p class="text-gray-600 mb-6">You've completed your ${SUBSCRIBER_MONTHLY_TASK_LIMIT} monthly tasks</p>
            
            <div class="bg-emerald-50 rounded-xl p-4 mb-6 border border-emerald-200">
              <p class="text-sm text-gray-600 mb-2">Your Progress</p>
              <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                <div class="bg-emerald-600 h-2 rounded-full" style="width: 100%"></div>
              </div>
              <p class="font-bold text-emerald-600">${SUBSCRIBER_MONTHLY_TASK_LIMIT}/${SUBSCRIBER_MONTHLY_TASK_LIMIT} Tasks Complete</p>
            </div>

            <div class="bg-blue-50 rounded-xl p-4 mb-6 border border-blue-200">
              <p class="text-sm text-gray-600 mb-2">Next Billing Date</p>
              <p class="font-bold text-blue-600">
                ${new Date(new Date().getTime() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}
              </p>
              <p class="text-xs text-gray-600 mt-2">Your limit will reset then</p>
            </div>

            <div class="text-left bg-gray-50 rounded-xl p-4 mb-6">
              <p class="text-xs text-gray-600 mb-2 font-medium">WHAT'S NEXT:</p>
              <ul class="text-xs text-gray-700 space-y-1 list-disc list-inside">
                <li>Come back next month for ${SUBSCRIBER_MONTHLY_TASK_LIMIT} more tasks</li>
                <li>Or renew your subscription for unlimited tasks</li>
                <li>Check other sections while you wait</li>
              </ul>
            </div>

            <div class="flex flex-col gap-3">
              <button onclick="navigateTo('subscribe'); closeModal('taskLimitModal')" class="w-full py-3 btn-primary text-white font-bold rounded-xl flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Renew Subscription
              </button>
              <button onclick="closeModal('taskLimitModal')" class="w-full py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors">
                Close
              </button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function renderVerificationPage() {
      return `
        <div class="max-w-xl mx-auto px-4 py-6">
          <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
            <div class="text-center mb-8">
              <div class="w-16 h-16 bg-cyan-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Account Verification</h2>
              <p class="text-gray-600 mt-2">Verify your account to unlock all features</p>
            </div>
            
            <form id="verificationForm" onsubmit="handleVerification(event)">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Full Legal Name</label>
                  <input type="text" name="legalName" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="As it appears on your ID" value="${currentUser?.fullName || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" name="email" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Your email" value="${currentUser?.email || ''}">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                  <input type="tel" name="phone" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="+254 7XX XXX XXX">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">ID Type</label>
                  <select name="idType" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none bg-white">
                    <option value="national_id">National ID</option>
                    <option value="passport">Passport</option>
                    <option value="driving_license">Driving License</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">ID Number</label>
                  <input type="text" name="idNumber" required class="input-field w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none" placeholder="Enter your ID number">
                </div>
                <button type="submit" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
                  Submit for Verification
                </button>
              </div>
            </form>
          </div>
        </div>
      `;
    }

    function renderLoginRequired() {
      return `
        <div class="min-h-screen flex items-center justify-center px-4">
          <div class="text-center">
            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Login Required</h2>
            <p class="text-gray-600 mb-6">Please login to access this page</p>
            <button onclick="navigateTo('login')" class="px-8 py-3 btn-primary text-white font-bold rounded-xl">Login Now</button>
          </div>
        </div>
      `;
    }

    // Form Handlers
    async function handleRegister(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Creating Account...';
      button.disabled = true;
      
      const formData = new FormData(form);
      
      if (formData.get('password') !== formData.get('confirmPassword')) {
        showToast('Passwords do not match', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
        return;
      }

      // Create user account
      currentUser = {
        fullName: formData.get('fullName'),
        email: formData.get('email'),
        phone: formData.get('phone')
      };
      isLoggedIn = true;
      bonusBalance = 5; // Welcome bonus (locked until subscription)
      activities.unshift({
        type: 'earnings',
        description: 'Welcome bonus credited! (Unlock by subscribing)',
        time: 'Just now',
        amount: null
      });
      saveToLocalStorage();

      // Send registration to Web3Forms
      try {
        await sendToWeb3Forms({
          type: 'Registration',
          fullName: formData.get('fullName'),
          email: formData.get('email'),
          phone: formData.get('phone')
        });
      } catch (error) {
        console.error('Email notification error:', error);
      }

      button.innerHTML = originalText;
      button.disabled = false;
      showToast('Account created! $5 welcome bonus added!', 'success');
      navigateTo('declaration');
    }

    function handleLogin(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Signing In...';
      button.disabled = true;
      
      const formData = new FormData(form);
      
      // Simple login simulation (check localStorage)
      const stored = localStorage.getItem('creativepay_data');
      if (stored) {
        const data = JSON.parse(stored);
        if (data.currentUser && data.currentUser.email === formData.get('email')) {
          isLoggedIn = true;
          currentUser = data.currentUser;
          earnings = data.earnings || 0;
          activities = data.activities || [];
          acceptedTasks = data.acceptedTasks || [];
          submittedTasks = data.submittedTasks || [];
          saveToLocalStorage();
          button.innerHTML = originalText;
          button.disabled = false;
          showToast('Welcome back!', 'success');
          navigateTo('home');
          return;
        }
      }
      
      // For demo, create new user if not found
      currentUser = {
        fullName: 'Writer',
        email: formData.get('email'),
        phone: ''
      };
      isLoggedIn = true;
      earnings = 5;
      activities.unshift({
        type: 'earnings',
        description: 'Welcome bonus credited!',
        time: 'Just now',
        amount: 5
      });
      saveToLocalStorage();
      button.innerHTML = originalText;
      button.disabled = false;
      showToast('Welcome! $5 welcome bonus added!', 'success');
      navigateTo('home');
    }

    async function handleSubmitTask(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Submitting...';
      button.disabled = true;
      
      const formData = new FormData(form);
      const taskId = formData.get('taskId');
      const content = formData.get('content');
      
      const task = acceptedTasks.find(t => t.id === taskId);
      if (!task) {
        showToast('Task not found', 'error');
        button.innerHTML = originalText;
        button.disabled = false;
        return;
      }

      const wordCount = content.trim().split(/\s+/).length;
      if (wordCount < task.wordCount * 0.9) {
        showToast(`Minimum ${task.wordCount} words required. You have ${wordCount}.`, 'error');
        button.innerHTML = originalText;
        button.disabled = false;
        return;
      }

      // Check if subscriber reached limit
      if (isSubscribed && completedTasksThisMonth >= SUBSCRIBER_MONTHLY_TASK_LIMIT) {
        button.innerHTML = originalText;
        button.disabled = false;
        showToast('Monthly limit reached! Renew subscription to continue earning.', 'warning');
        setTimeout(() => navigateTo('subscribe'), 1500);
        return;
      }

      button.innerHTML = originalText;
      button.disabled = false;

      // Show live review modal
      showLiveReview(task, content);
    }

    function showLiveReview(task, content) {
      const modal = document.createElement('div');
      modal.id = 'liveReviewModal';
      modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90%] overflow-hidden">
          <!-- Header -->
          <div class="gradient-primary p-6 text-white">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-white animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div>
                <h2 class="text-xl font-bold">Work Under Review</h2>
                <p class="text-white/70 text-sm">Live Progress</p>
              </div>
            </div>
          </div>
          
          <!-- Content -->
          <div class="pdf-container p-6 md:p-8" style="max-height: calc(90vh - 200px);">
            <div class="mb-6">
              <p class="text-gray-700 mb-4">
                Dear <span class="font-bold text-emerald-600">${currentUser?.fullName}</span>,
              </p>
              <p class="text-gray-700 leading-relaxed">
                Our client <span class="font-bold text-emerald-600">${task.client}</span> is currently reviewing your work for the task:
              </p>
              <div class="bg-emerald-50 rounded-xl p-4 my-4 border border-emerald-200">
                <p class="font-semibold text-gray-900">"${task.title}"</p>
                <p class="text-sm text-gray-600 mt-1">Book: ${task.book}</p>
              </div>
            </div>

            <!-- Review Checklist -->
            <div class="space-y-3">
              <h3 class="font-bold text-gray-900 mb-4">Quality Review Process:</h3>
              
              <div class="review-item" data-step="1">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span class="spinner-small hidden"></span>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Checking Format & Structure</p>
                    <p class="text-xs text-gray-500">Verifying essay format, headings, and organization</p>
                  </div>
                </div>
              </div>

              <div class="review-item" data-step="2">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Word Count & Length</p>
                    <p class="text-xs text-gray-500">Ensuring minimum word count requirement met</p>
                  </div>
                </div>
              </div>

              <div class="review-item" data-step="3">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Keywords & Relevance</p>
                    <p class="text-xs text-gray-500">Matching task keywords and literary references</p>
                  </div>
                </div>
              </div>

              <div class="review-item" data-step="4">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Context & Accuracy</p>
                    <p class="text-xs text-gray-500">Verifying literary context and factual accuracy</p>
                  </div>
                </div>
              </div>

              <div class="review-item" data-step="5">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Grammar & Clarity</p>
                    <p class="text-xs text-gray-500">Checking grammar, punctuation, and writing quality</p>
                  </div>
                </div>
              </div>

              <div class="review-item" data-step="6">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Final Approval & Payment Calculation</p>
                    <p class="text-xs text-gray-500">Determining your earnings based on quality score</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Status Message -->
            <div id="statusMessage" class="mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200">
              <p class="text-sm text-blue-800">‚è≥ Review in progress... Please wait</p>
            </div>
          </div>

          <!-- Footer -->
          <div class="p-6 border-t border-gray-100 bg-gray-50">
            <button id="closeReviewBtn" onclick="closeModal('liveReviewModal')" class="w-full py-3 btn-primary text-white font-bold rounded-xl hidden">
              Close
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // Simulate review process
      simulateReviewProcess(task, content);
    }

    function simulateReviewProcess(task, content) {
      const steps = [
        { delay: 800, name: 'Format Check' },
        { delay: 1600, name: 'Word Count' },
        { delay: 2400, name: 'Keywords' },
        { delay: 3200, name: 'Context' },
        { delay: 4000, name: 'Grammar' },
        { delay: 4800, name: 'Final Review' }
      ];

      steps.forEach((step, index) => {
        setTimeout(() => {
          const item = document.querySelector(`[data-step="${index + 1}"]`);
          if (item) {
            const checkIcon = item.querySelector('.check-icon');
            const spinner = item.querySelector('.spinner-small');
            if (spinner) spinner.classList.add('hidden');
            if (checkIcon) {
              checkIcon.classList.remove('hidden');
              item.querySelector('.bg-gray-300').classList.remove('bg-gray-300');
              item.querySelector('.bg-gray-300') ? null : item.querySelector('.w-6').classList.add('bg-emerald-500');
            }
          }
        }, step.delay);
      });

      // Calculate final earnings after all reviews
      setTimeout(() => {
        completeReview(task, content);
      }, 5400);
    }

    function completeReview(task, content) {
      // Remove from accepted tasks
      acceptedTasks = acceptedTasks.filter(t => t.id !== task.id);
      
      // Calculate quality score (0.5% - 1.8%)
      const qualityScore = calculateQualityScore(task, content);
      
      // Base rate calculation
      let baseRate = calculatePayment(task.pages);
      
      // Calculate moderated earnings based on quality score
      let moderatedPayment = baseRate * (qualityScore / 100);
      let qualityFeedback = generateQualityFeedback(task, content);
      
      // Add to submitted tasks
      const submittedTask = {
        ...task,
        submittedAt: new Date().toLocaleDateString(),
        status: 'approved',
        content: content,
        earnedAmount: moderatedPayment,
        qualityScore: qualityScore,
        qualityFeedback: qualityFeedback,
        baseRate: baseRate
      };
      submittedTasks.push(submittedTask);
      completedTasksThisMonth++;
      
      // Add to earnings
      if (moderatedPayment > 0) {
        earnings += moderatedPayment;
      }
      
      activities.unshift({
        type: 'submission',
        description: `Submitted: ${task.title}`,
        time: 'Just now',
        amount: null
      });
      
      activities.unshift({
        type: 'approved',
        description: `Task approved by ${task.client} (Quality: ${qualityScore.toFixed(2)}%)`,
        time: 'Just now',
        amount: null
      });
      
      if (moderatedPayment > 0) {
        activities.unshift({
          type: 'earnings',
          description: `Earnings: ${formatCurrency(moderatedPayment)} (${qualityScore.toFixed(2)}% of ${formatCurrency(baseRate)})`,
          time: 'Just now',
          amount: moderatedPayment
        });
      }

      saveToLocalStorage();

      // Update modal with results
      updateReviewResults(task, moderatedPayment, baseRate, qualityScore, qualityFeedback);
    }

    function calculateQualityScore(task, content) {
      let score = 1.8; // Start at maximum
      const wordCount = content.trim().split(/\s+/).length;
      const minWords = task.wordCount * 0.9;
      const maxWords = task.wordCount * 1.5;

      // Word count check (max 0.3% deduction)
      if (wordCount < minWords) {
        score -= 0.3;
      } else if (wordCount > maxWords) {
        score -= 0.15;
      }

      // Content depth and structure check (max 0.3% deduction)
      const paragraphs = content.split('\n\n').filter(p => p.trim()).length;
      if (paragraphs < 5) {
        score -= 0.3;
      } else if (paragraphs >= 8) {
        score += 0; // No extra credit
      }

      // Keyword relevance (random simulation 0-0.3% deduction)
      const keywordMatch = Math.random();
      if (keywordMatch < 0.3) {
        score -= Math.random() * 0.3;
      }

      // Grammar and clarity (simulated check, 0-0.2% deduction)
      const sentences = content.match(/[.!?]+/g) || [];
      const avgLength = content.length / (sentences.length || 1);
      if (avgLength > 300 || avgLength < 30) {
        score -= Math.random() * 0.2;
      }

      // Context and accuracy (random simulation 0-0.2% deduction)
      if (Math.random() < 0.4) {
        score -= Math.random() * 0.2;
      }

      // Ensure score is within bounds
      return Math.max(0.5, Math.min(1.8, score));
    }

    function generateQualityFeedback(task, content) {
      const wordCount = content.trim().split(/\s+/).length;
      const minWords = task.wordCount * 0.9;
      const maxWords = task.wordCount * 1.5;
      const paragraphs = content.split('\n\n').filter(p => p.trim()).length;
      const sentences = content.match(/[.!?]+/g) || [];
      const avgSentenceLength = content.length / (sentences.length || 1);

      let feedback = [];

      // Word count feedback
      if (wordCount < minWords) {
        feedback.push({
          criterion: 'Word Count',
          status: 'warning',
          message: `Content is slightly short (${wordCount} words vs ${task.wordCount} required). Consider adding more depth.`,
          impact: '-0.3%'
        });
      } else if (wordCount > maxWords) {
        feedback.push({
          criterion: 'Word Count',
          status: 'info',
          message: `Content exceeds recommended length (${wordCount} words). While comprehensive, consider tighter editing.`,
          impact: '-0.15%'
        });
      } else {
        feedback.push({
          criterion: 'Word Count',
          status: 'success',
          message: `Perfect word count (${wordCount} words) - meets requirements excellently.`,
          impact: '‚úì'
        });
      }

      // Structure feedback
      if (paragraphs < 5) {
        feedback.push({
          criterion: 'Structure & Organization',
          status: 'warning',
          message: `Essay structure needs improvement (${paragraphs} paragraphs). Better organization required for improved clarity.`,
          impact: '-0.3%'
        });
      } else if (paragraphs >= 8) {
        feedback.push({
          criterion: 'Structure & Organization',
          status: 'success',
          message: `Excellent structure with ${paragraphs} well-organized paragraphs. Clear flow and logical progression.`,
          impact: '‚úì'
        });
      } else {
        feedback.push({
          criterion: 'Structure & Organization',
          status: 'success',
          message: `Good paragraph organization (${paragraphs} paragraphs) with clear topic development.`,
          impact: '‚úì'
        });
      }

      // Sentence variety feedback
      if (avgSentenceLength > 300 || avgSentenceLength < 30) {
        feedback.push({
          criterion: 'Grammar & Clarity',
          status: 'warning',
          message: `Sentence length varies significantly (avg: ${Math.round(avgSentenceLength)} chars). Aim for more consistent pacing.`,
          impact: '-0.2%'
        });
      } else {
        feedback.push({
          criterion: 'Grammar & Clarity',
          status: 'success',
          message: `Good sentence variety and flow with consistent readability.`,
          impact: '‚úì'
        });
      }

      // Literary context feedback (simulated)
      const hasQuotes = content.includes('"') || content.includes("'");
      if (hasQuotes) {
        feedback.push({
          criterion: 'Literary References & Context',
          status: 'success',
          message: `Excellent use of direct references and textual evidence. Strong academic grounding.`,
          impact: '‚úì'
        });
      } else {
        feedback.push({
          criterion: 'Literary References & Context',
          status: 'info',
          message: `Consider including more direct textual references for stronger support.`,
          impact: '-0.2%'
        });
      }

      // Keywords feedback (simulated)
      const taskKeywords = task.title.toLowerCase().split(' ');
      const contentLower = content.toLowerCase();
      const keywordMatches = taskKeywords.filter(kw => contentLower.includes(kw)).length;
      
      if (keywordMatches >= taskKeywords.length * 0.7) {
        feedback.push({
          criterion: 'Keywords & Relevance',
          status: 'success',
          message: `Strong alignment with task requirements. All key concepts well-addressed.`,
          impact: '‚úì'
        });
      } else {
        feedback.push({
          criterion: 'Keywords & Relevance',
          status: 'warning',
          message: `Some task keywords not fully addressed. Ensure all prompt elements covered.`,
          impact: '-0.2%'
        });
      }

      return feedback;
    }

    function updateReviewResults(task, earnings_amount, baseRate) {
      const statusMessage = document.getElementById('statusMessage');
      const closeBtn = document.getElementById('closeReviewBtn');
      
      let earningText = '';
      let earnedInKES = earnings_amount * EXCHANGE_RATE;
      
      if (earnings_amount === 0 && bonusBalance > 0) {
        earningText = `Your earnings (${formatCurrency(baseRate)}) have been locked as bonus. Subscribe to unlock!`;
      } else {
        earningText = `You have earned <span class="text-emerald-600 font-bold">${formatCurrency(earnings_amount)}</span> (KSH ${earnedInKES.toFixed(0)}) for this task.`;
      }

      statusMessage.innerHTML = `
        <div class="space-y-3">
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div>
              <p class="font-semibold text-gray-900">Review Complete!</p>
              <p class="text-sm text-gray-700 mt-1">${task.client} has approved your work. ${earningText}</p>
            </div>
          </div>
          ${isSubscribed && completedTasksThisMonth > 0 ? `
            <div class="text-xs text-gray-600 mt-3 pt-3 border-t border-gray-200">
              Progress: <span class="font-semibold">${completedTasksThisMonth}/${SUBSCRIBER_MONTHLY_TASK_LIMIT}</span> tasks this month
            </div>
          ` : ''}
        </div>
      `;
      statusMessage.classList.remove('bg-blue-50', 'border-blue-200');
      statusMessage.classList.add('bg-emerald-50', 'border-emerald-200');
      
      closeBtn.classList.remove('hidden');
      closeBtn.onclick = () => {
        closeModal('liveReviewModal');
        navigateTo('home');
      };
    }

    async function handleWithdraw(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      
      const amount = parseFloat(formData.get('amount'));
      if (amount > earnings) {
        showToast('Insufficient balance', 'error');
        return;
      }

      const method = formData.get('method');
      const paymentDetails = formData.get('paymentDetails');
      const currency = formData.get('currency');

      // Show confirmation modal
      showWithdrawalConfirmation(amount, method, paymentDetails, currency);
    }

    function showWithdrawalConfirmation(amount, method, paymentDetails, currency) {
      const modal = document.createElement('div');
      modal.id = 'withdrawalConfirmModal';
      modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8">
          <div class="text-center mb-6">
            <div class="w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900">Confirm Withdrawal</h3>
            <p class="text-gray-600 mt-2">Review your withdrawal details</p>
          </div>

          <div class="space-y-4 mb-6">
            <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
              <p class="text-xs text-gray-600 uppercase tracking-wide mb-1">Withdrawal Amount</p>
              <p class="text-2xl font-bold text-gray-900">${formatCurrency(amount)}</p>
            </div>
            <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
              <p class="text-xs text-gray-600 uppercase tracking-wide mb-1">Payment Method</p>
              <p class="text-lg font-semibold text-gray-900">${method.toUpperCase()}</p>
            </div>
            <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
              <p class="text-xs text-gray-600 uppercase tracking-wide mb-1">Account Details</p>
              <p class="text-sm font-mono text-gray-900 break-all">${paymentDetails}</p>
            </div>

            <!-- Fee Breakdown -->
            <div class="bg-red-50 rounded-xl p-4 border border-red-200">
              <p class="text-xs text-red-600 uppercase tracking-wide mb-3 font-semibold">Fees Applied</p>
              <div class="space-y-2 text-sm">
                <div class="flex items-center justify-between">
                  <span class="text-gray-700">Platform Fee (1%)</span>
                  <span class="text-red-600 font-semibold">-${formatCurrency(amount * 0.01)}</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-gray-700">Transaction Fee (3%)</span>
                  <span class="text-red-600 font-semibold">-${formatCurrency(amount * 0.03)}</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-gray-700">VAT (10%)</span>
                  <span class="text-red-600 font-semibold">-${formatCurrency(amount * 0.10)}</span>
                </div>
                <div class="border-t border-red-200 pt-2 flex items-center justify-between">
                  <span class="font-semibold text-gray-900">Total Fees (14%)</span>
                  <span class="text-red-600 font-bold">-${formatCurrency(amount * 0.14)}</span>
                </div>
              </div>
            </div>

            <!-- Net Amount -->
            <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
              <p class="text-xs text-emerald-600 uppercase tracking-wide mb-1">You Will Receive</p>
              <p class="text-2xl font-bold text-emerald-600">${formatCurrency(amount * 0.86)}</p>
              <p class="text-xs text-gray-600 mt-2">‚âà KES ${(amount * 0.86 * EXCHANGE_RATE).toLocaleString('en-KE', { minimumFractionDigits: 0 })}</p>
            </div>
          </div>

          <div class="flex flex-col gap-3">
            <button onclick="processWithdrawalSteps(${amount}, '${method}', '${paymentDetails}', '${currency}')" class="w-full py-3 btn-primary text-white font-bold rounded-xl">
              Confirm & Continue
            </button>
            <button onclick="closeModal('withdrawalConfirmModal')" class="w-full py-3 bg-gray-200 text-gray-700 font-bold rounded-xl hover:bg-gray-300 transition-colors">
              Cancel
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    async function processWithdrawalSteps(amount, method, paymentDetails, currency) {
      closeModal('withdrawalConfirmModal');
      
      // Calculate fees and net amount
      const platformFee = amount * 0.01;
      const transactionFee = amount * 0.03;
      const vat = amount * 0.10;
      const totalFees = amount * 0.14;
      const netAmount = amount * 0.86;

      const modal = document.createElement('div');
      modal.id = 'withdrawalProcessModal';
      modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90%] overflow-hidden">
          <!-- Header -->
          <div class="gradient-primary p-6 text-white">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-white animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
              </div>
              <div>
                <h2 class="text-xl font-bold">Processing Withdrawal</h2>
                <p class="text-white/70 text-sm">Secure Transaction in Progress</p>
              </div>
            </div>
          </div>
          
          <!-- Content -->
          <div class="pdf-container p-6 md:p-8" style="max-height: calc(90vh - 200px);">
            <!-- Amount Summary -->
            <div class="mb-6 p-4 bg-amber-50 rounded-xl border border-amber-200">
              <p class="text-xs text-amber-600 uppercase tracking-wide mb-2">Transaction Summary</p>
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <p class="text-xs text-gray-600">Amount</p>
                  <p class="font-bold text-gray-900">${formatCurrency(amount)}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-600">Net Amount</p>
                  <p class="font-bold text-emerald-600">${formatCurrency(netAmount)}</p>
                </div>
              </div>
            </div>

            <!-- Processing Steps -->
            <div class="space-y-3 mb-6">
              <h3 class="font-bold text-gray-900 mb-4">Processing Steps:</h3>
              
              <div class="process-step" data-step="1">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span class="spinner-small"></span>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Pushing withdrawal request to servers...</p>
                    <p class="text-xs text-gray-500">Securing your transaction data</p>
                  </div>
                </div>
              </div>

              <div class="process-step" data-step="2">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Authenticating payment details...</p>
                    <p class="text-xs text-gray-500">Verifying ${method.toUpperCase()} account</p>
                  </div>
                </div>
              </div>

              <div class="process-step" data-step="3">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Linking account to payment ATMs...</p>
                    <p class="text-xs text-gray-500">Establishing secure connection</p>
                  </div>
                </div>
              </div>

              <div class="process-step" data-step="4">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Extracting transaction key...</p>
                    <p class="text-xs text-gray-500">Retrieving encryption protocol</p>
                  </div>
                </div>
              </div>

              <div class="process-step" data-step="5">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Generating transaction key...</p>
                    <p class="text-xs text-gray-500">Creating unique transaction ID</p>
                  </div>
                </div>
              </div>

              <div class="process-step" data-step="6">
                <div class="flex items-start gap-3 p-3 rounded-xl bg-gray-50 border border-gray-200">
                  <div class="w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0 mt-1">
                    <svg class="w-3 h-3 text-white hidden check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Disbursing payment...</p>
                    <p class="text-xs text-gray-500">Transferring funds to ${method.toUpperCase()}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Status Message -->
            <div id="statusMessage" class="p-4 bg-blue-50 rounded-xl border border-blue-200">
              <p class="text-sm text-blue-800">‚è≥ Processing transaction... Please wait</p>
            </div>
          </div>

          <!-- Footer -->
          <div class="p-6 border-t border-gray-100 bg-gray-50">
            <button id="closeProcessBtn" onclick="closeModal('withdrawalProcessModal')" class="w-full py-3 btn-primary text-white font-bold rounded-xl hidden">
              Done
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // Simulate processing steps
      simulateWithdrawalSteps(amount, netAmount, method, paymentDetails, currency, totalFees);
    }

    function simulateWithdrawalSteps(amount, netAmount, method, paymentDetails, currency, totalFees) {
      const steps = [
        { delay: 800, name: 'Pushing Request' },
        { delay: 1800, name: 'Authenticating' },
        { delay: 2800, name: 'Linking Account' },
        { delay: 3800, name: 'Extracting Key' },
        { delay: 4800, name: 'Generating Key' },
        { delay: 5800, name: 'Disbursing' }
      ];

      steps.forEach((step, index) => {
        setTimeout(() => {
          const item = document.querySelector(`[data-step="${index + 1}"]`);
          if (item) {
            const checkIcon = item.querySelector('.check-icon');
            const spinner = item.querySelector('.spinner-small');
            if (spinner) spinner.classList.add('hidden');
            if (checkIcon) {
              checkIcon.classList.remove('hidden');
              item.querySelector('.bg-gray-300').classList.remove('bg-gray-300');
              item.querySelector('.bg-gray-300') ? null : item.querySelector('.w-6').classList.add('bg-emerald-500');
            }
          }
        }, step.delay);
      });

      // Complete processing after all steps
      setTimeout(() => {
        completeWithdrawal(amount, netAmount, method, paymentDetails, currency, totalFees);
      }, 6600);
    }

    function completeWithdrawal(amount, netAmount, method, paymentDetails, currency, totalFees) {
      // Update earnings
      earnings -= amount;
      
      // Generate transaction ID
      const transactionId = 'TXN' + Date.now() + Math.random().toString(36).substr(2, 9).toUpperCase();

      // Create transaction record
      const transaction = {
        id: transactionId,
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString(),
        amount: amount,
        netAmount: netAmount,
        fees: totalFees,
        method: method,
        details: paymentDetails,
        status: 'pending',
        createdAt: Date.now()
      };

      // Store transactions
      let transactions = JSON.parse(localStorage.getItem('creativepay_transactions')) || [];
      transactions.push(transaction);
      localStorage.setItem('creativepay_transactions', JSON.stringify(transactions));

      // Add activities
      activities.unshift({
        type: 'withdrawal',
        description: `Withdrawal initiated: ${formatCurrency(amount)} (Net: ${formatCurrency(netAmount)})`,
        time: 'Just now',
        amount: -amount
      });

      saveToLocalStorage();

      // Update modal with success
      updateWithdrawalSuccess(netAmount, transactionId, method, transaction);

      // Schedule status updates
      scheduleTransactionStatusUpdates(transactionId, transaction);
    }

    function updateWithdrawalSuccess(netAmount, transactionId, method, transaction) {
      const statusMessage = document.getElementById('statusMessage');
      const closeBtn = document.getElementById('closeProcessBtn');

      statusMessage.innerHTML = `
        <div class="space-y-3">
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <div>
              <p class="font-semibold text-gray-900">‚úÖ Withdrawal Successful!</p>
              <p class="text-sm text-gray-700 mt-1">Your withdrawal request has been received and is being processed.</p>
            </div>
          </div>
          <div class="bg-white rounded-xl p-3 space-y-2 border border-emerald-200">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">Amount Withdrawn:</span>
              <span class="font-bold text-gray-900">${formatCurrency(transaction.amount)}</span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">Fees (14%):</span>
              <span class="font-bold text-red-600">-${formatCurrency(transaction.fees)}</span>
            </div>
            <div class="border-t border-gray-200 pt-2 flex items-center justify-between text-sm">
              <span class="font-semibold text-gray-900">You Will Receive:</span>
              <span class="font-bold text-emerald-600">${formatCurrency(netAmount)}</span>
            </div>
            <div class="pt-2 border-t border-gray-200">
              <p class="text-xs text-gray-600">Transaction ID: <span class="font-mono text-gray-900">${transactionId}</span></p>
              <p class="text-xs text-gray-600">Method: ${method.toUpperCase()}</p>
              <p class="text-xs text-gray-600">Status: <span class="font-semibold text-amber-600">PENDING</span></p>
            </div>
          </div>
        </div>
      `;
      statusMessage.classList.remove('bg-blue-50', 'border-blue-200');
      statusMessage.classList.add('bg-emerald-50', 'border-emerald-200');
      
      closeBtn.classList.remove('hidden');
      closeBtn.onclick = () => {
        closeModal('withdrawalProcessModal');
        navigateTo('withdraw');
      };
    }

    function scheduleTransactionStatusUpdates(transactionId, transaction) {
      // Update to "In Progress" after 5 minutes
      setTimeout(() => {
        let transactions = JSON.parse(localStorage.getItem('creativepay_transactions')) || [];
        const txIndex = transactions.findIndex(tx => tx.id === transactionId);
        if (txIndex !== -1) {
          transactions[txIndex].status = 'processing';
          localStorage.setItem('creativepay_transactions', JSON.stringify(transactions));
          activities.unshift({
            type: 'withdrawal',
            description: `Disbursement in progress: ${formatCurrency(transaction.netAmount)}`,
            time: new Date().toLocaleTimeString(),
            amount: null
          });
          saveToLocalStorage();
        }
      }, 5 * 60 * 1000); // 5 minutes

      // Update to "Completed" after 15 minutes
      setTimeout(() => {
        let transactions = JSON.parse(localStorage.getItem('creativepay_transactions')) || [];
        const txIndex = transactions.findIndex(tx => tx.id === transactionId);
        if (txIndex !== -1) {
          transactions[txIndex].status = 'completed';
          localStorage.setItem('creativepay_transactions', JSON.stringify(transactions));
          activities.unshift({
            type: 'withdrawal',
            description: `Payment completed: ${formatCurrency(transaction.netAmount)} to ${transaction.method}`,
            time: new Date().toLocaleTimeString(),
            amount: null
          });
          saveToLocalStorage();
          showToast('üí∞ Withdrawal completed! Funds disbursed to your account.', 'success');
        }
      }, 15 * 60 * 1000); // 15 minutes
    }

    async function handleRefund(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Submitting...';
      button.disabled = true;
      
      const formData = new FormData(form);

      const response = await sendToWeb3Forms({
        type: 'Refund Request',
        name: formData.get('name'),
        email: formData.get('email'),
        transactionId: formData.get('transactionId'),
        amount: formData.get('amount'),
        reason: formData.get('reason')
      });

      button.innerHTML = originalText;
      button.disabled = false;

      if (response.success) {
        showToast('Refund request submitted. We\'ll review and respond within 48 hours.', 'success');
        form.reset();
      }
    }

    async function handleSupport(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Sending...';
      button.disabled = true;
      
      const formData = new FormData(form);

      const response = await sendToWeb3Forms({
        type: 'Support Request',
        name: formData.get('name'),
        email: formData.get('email'),
        subject: formData.get('subject'),
        message: formData.get('message')
      });

      button.innerHTML = originalText;
      button.disabled = false;

      if (response.success) {
        showToast('Support message sent! We\'ll respond within 24 hours.', 'success');
        form.reset();
      }
    }

    async function handleDeclaration(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Processing...';
      button.disabled = true;
      
      const formData = new FormData(form);

      const response = await sendToWeb3Forms({
        type: 'Declaration Acceptance',
        name: formData.get('name'),
        email: formData.get('email'),
        acceptedAt: new Date().toISOString()
      });

      button.innerHTML = originalText;
      button.disabled = false;

      if (response.success) {
        showToast('Declaration accepted!', 'success');
        navigateTo('payment-setup');
      }
    }

    async function handlePaymentSetup(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Saving...';
      button.disabled = true;
      
      const formData = new FormData(form);

      const response = await sendToWeb3Forms({
        type: 'Payment Details Setup',
        name: formData.get('name'),
        email: formData.get('email'),
        method: formData.get('method'),
        details: formData.get('details'),
        currency: formData.get('currency')
      });

      button.innerHTML = originalText;
      button.disabled = false;

      if (response.success) {
        showToast('Payment details saved!', 'success');
        navigateTo('home');
      }
    }

    async function handleVerification(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.innerHTML = '<div class="spinner"></div> Verifying...';
      button.disabled = true;
      
      const formData = new FormData(form);

      const response = await sendToWeb3Forms({
        type: 'Verification Request',
        legalName: formData.get('legalName'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        idType: formData.get('idType'),
        idNumber: formData.get('idNumber')
      });

      button.innerHTML = originalText;
      button.disabled = false;

      if (response.success) {
        showToast('Verification submitted! Review in 24-48 hours.', 'success');
        navigateTo('home');
      }
    }

    async function sendToWeb3Forms(data) {
      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            access_key: WEB3FORMS_KEY,
            subject: `Creativepay - ${data.type}`,
            from_name: 'Creativepay Platform',
            ...data
          })
        });
        return await response.json();
      } catch (error) {
        console.error('Web3Forms error:', error);
        return { success: true }; // Allow to continue for demo
      }
    }

    function closeModal(id) {
      const modal = document.getElementById(id);
      if (modal) modal.remove();
    }

    function logout() {
      isLoggedIn = false;
      currentUser = null;
      toggleMenu();
      saveToLocalStorage();
      showToast('Logged out successfully', 'success');
      navigateTo('landing');
    }

    function navigateTo(page) {
      currentPage = page;
      const slideMenu = document.getElementById('slideMenu');
      const overlay = document.getElementById('menuOverlay');
      if (slideMenu.classList.contains('active')) {
        slideMenu.classList.remove('active');
        overlay.classList.add('hidden');
      }
      renderPage();
      updateHeaderActions();
      window.scrollTo(0, 0);
    }

    function updateDashboardCard() {
      const balanceDisplay = document.getElementById('balanceDisplay');
      if (balanceDisplay) {
        balanceDisplay.textContent = formatCurrency(earnings);
      }
    }

    function renderPage() {
      const mainContent = document.getElementById('mainContent');
      
      switch(currentPage) {
        case 'landing':
          mainContent.innerHTML = renderLandingPage();
          break;
        case 'register':
          mainContent.innerHTML = renderRegisterPage();
          break;
        case 'login':
          mainContent.innerHTML = renderLoginPage();
          break;
        case 'home':
          mainContent.innerHTML = renderHomePage();
          break;
        case 'tasks':
          mainContent.innerHTML = renderTasksPage();
          break;
        case 'dashboard':
          mainContent.innerHTML = renderDashboardPage();
          break;
        case 'submit':
          mainContent.innerHTML = renderSubmitPage();
          break;
        case 'earnings':
          mainContent.innerHTML = renderEarningsPage();
          break;
        case 'withdraw':
          mainContent.innerHTML = renderWithdrawPage();
          break;
        case 'refund':
          mainContent.innerHTML = renderRefundPage();
          break;
        case 'support':
          mainContent.innerHTML = renderSupportPage();
          break;
        case 'declaration':
          mainContent.innerHTML = renderDeclarationPage();
          break;
        case 'payment-setup':
          mainContent.innerHTML = renderPaymentSetupPage();
          break;
        case 'subscribe':
          mainContent.innerHTML = renderSubscribePage();
          break;
        case 'verification':
          mainContent.innerHTML = renderVerificationPage();
          break;
        default:
          mainContent.innerHTML = renderLandingPage();
      }
    }

    // Initialize
    function init() {
      loadFromLocalStorage();
      updateHeaderActions();
      
      if (isLoggedIn) {
        navigateTo('home');
      } else {
        navigateTo('landing');
      }
    }

    // Element SDK initialization
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          const headerTitle = document.getElementById('headerTitle');
          const menuTitle = document.getElementById('menuTitle');
          const landingTagline = document.getElementById('landingTagline');
          
          if (headerTitle) headerTitle.textContent = config.site_title;
          if (menuTitle) menuTitle.textContent = config.site_title;
          if (landingTagline) landingTagline.textContent = config.tagline + '. Join thousands of Kenyan writers earning from short stories and literary essays.';
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['site_title', config.site_title || defaultConfig.site_title],
          ['tagline', config.tagline || defaultConfig.tagline]
        ])
      });
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c4f4a0ba46473ad',t:'MTc2OTU5MDcxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>