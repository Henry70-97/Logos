<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CreativePay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .gradient-primary {
      background: linear-gradient(135deg, #059669 0%, #0d9488 50%, #14b8a6 100%);
    }
    .gradient-card {
      background: linear-gradient(135deg, #10b981 0%, #0d9488 100%);
    }
    .floating-shape {
      position: absolute;
      border-radius: 50%;
      opacity: 0.1;
      background: linear-gradient(135deg, #10b981, #14b8a6);
    }
    .slide-in {
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
    }
    .slide-in.open {
      transform: translateX(0);
    }
    .modal-overlay {
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    .task-card:nth-child(odd) {
      background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
    }
    .task-card:nth-child(even) {
      background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);
    }
    .pdf-paper {
      background: white;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      position: relative;
    }
    .pdf-paper::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 0 30px 30px 0;
      border-color: transparent #e5e7eb transparent transparent;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    .animate-float {
      animation: float 6s ease-in-out infinite;
    }
    .animate-float-delayed {
      animation: float 8s ease-in-out infinite;
      animation-delay: 2s;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-white overflow-x-hidden">
  <div id="app" class="h-full overflow-auto relative"><!-- Floating Shapes -->
   <div class="floating-shape w-64 h-64 -top-32 -right-32 fixed animate-float"></div>
   <div class="floating-shape w-48 h-48 top-1/2 -left-24 fixed animate-float-delayed"></div>
   <div class="floating-shape w-32 h-32 bottom-20 right-10 fixed animate-float"></div><!-- Header -->
   <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-lg border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
     <div class="flex items-center gap-3"><button id="menuBtn" class="p-2 rounded-xl hover:bg-gray-100 transition-colors lg:hidden">
       <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
       </svg></button>
      <div class="flex items-center gap-2"><img src="logo.png" alt="CreativePay Logo" class="w-10 h-10 rounded-xl object-cover" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
       <div class="w-10 h-10 gradient-primary rounded-xl items-center justify-center hidden">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
       </div><span id="siteTitle" class="text-xl font-bold text-gray-800">CreativePay</span>
      </div>
     </div>
     <nav class="hidden lg:flex items-center gap-6"><a href="#" onclick="navigateTo('home')" class="text-gray-600 hover:text-emerald-600 transition-colors font-medium">Home</a> <a href="#" onclick="navigateTo('tasks')" class="text-gray-600 hover:text-emerald-600 transition-colors font-medium">Tasks</a> <a href="#" onclick="navigateTo('dashboard')" class="text-gray-600 hover:text-emerald-600 transition-colors font-medium">Dashboard</a> <a href="#" onclick="navigateTo('earnings')" class="text-gray-600 hover:text-emerald-600 transition-colors font-medium">Earnings</a>
     </nav>
     <div class="flex items-center gap-2"><button id="notifBtn" class="p-2 rounded-xl hover:bg-gray-100 transition-colors relative">
       <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
       </svg><span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span> </button>
      <div id="userAvatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-semibold cursor-pointer hidden">
       U
      </div>
     </div>
    </div>
   </header><!-- Side Menu -->
   <div id="menuOverlay" class="fixed inset-0 bg-black/50 z-50 hidden" onclick="closeMenu()"></div>
   <aside id="sideMenu" class="fixed left-0 top-0 h-full w-72 bg-white z-50 slide-in shadow-2xl">
    <div class="p-6">
     <div class="flex items-center justify-between mb-8">
      <div class="flex items-center gap-2"><img src="logo.png" alt="CreativePay Logo" class="w-10 h-10 rounded-xl object-cover" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
       <div class="w-10 h-10 gradient-primary rounded-xl items-center justify-center hidden">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
       </div><span class="text-xl font-bold text-gray-800">CreativePay</span>
      </div><button onclick="closeMenu()" class="p-2 rounded-xl hover:bg-gray-100 transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <nav class="space-y-2"><a href="#" onclick="navigateTo('home'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
       </svg><span class="font-medium">Home</span> </a> <a href="#" onclick="navigateTo('tasks'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
       </svg><span class="font-medium">Available Writing Tasks</span> </a> <a href="#" onclick="navigateTo('dashboard'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
       </svg><span class="font-medium">My Dashboard</span> </a> <a href="#" onclick="navigateTo('earnings'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg><span class="font-medium">Earnings</span> </a> <a href="#" onclick="openModal('withdrawModal'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
       </svg><span class="font-medium">Withdraw</span> </a> <a href="#" onclick="openModal('supportModal'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
       </svg><span class="font-medium">Support</span> </a> <a href="#" onclick="openModal('submitWorkModal'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
       </svg><span class="font-medium">Submit Work</span> </a> <a href="#" onclick="openModal('refundModal'); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
       </svg><span class="font-medium">Refund</span> </a> <a href="#" onclick="openSubscribeModal(); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-emerald-700 hover:bg-emerald-50 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
       </svg><span class="font-medium">Subscribe</span> </a>
      <div class="border-t border-gray-100 my-4"></div><a href="#" onclick="logout(); closeMenu();" class="flex items-center gap-3 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
       </svg><span class="font-medium">Logout</span> </a>
     </nav>
    </div>
   </aside><!-- Main Content -->
   <main id="mainContent" class="max-w-7xl mx-auto px-4 py-6"><!-- Landing Page -->
    <section id="landingPage" class="min-h-screen">
     <div class="text-center py-12 lg:py-20">
      <h1 class="text-4xl lg:text-6xl font-extrabold text-gray-800 mb-4">Turn Your <span class="text-transparent bg-clip-text gradient-primary">Creativity</span><br>
       Into Earnings</h1>
      <p id="taglineText" class="text-lg lg:text-xl text-gray-600 mb-8 max-w-2xl mx-auto">Join thousands of writers earning money by crafting compelling short stories. Get paid $2 per page (250 words).</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center"><button onclick="openModal('registerModal')" class="px-8 py-4 gradient-primary text-white font-semibold rounded-2xl shadow-lg shadow-emerald-200 hover:shadow-xl hover:shadow-emerald-300 transition-all transform hover:-translate-y-1"> Start Earning Now </button> <button onclick="openModal('loginModal')" class="px-8 py-4 bg-white text-emerald-600 font-semibold rounded-2xl border-2 border-emerald-200 hover:border-emerald-400 transition-all"> Sign In </button>
      </div>
     </div><!-- Features -->
     <div class="grid md:grid-cols-3 gap-6 py-12">
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 p-8 rounded-3xl card-hover">
       <div class="w-14 h-14 gradient-primary rounded-2xl flex items-center justify-center mb-4">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
       </div>
       <h3 class="text-xl font-bold text-gray-800 mb-2">Write Stories</h3>
       <p class="text-gray-600">Choose from various genres and create compelling short stories for clients worldwide.</p>
      </div>
      <div class="bg-gradient-to-br from-teal-50 to-cyan-50 p-8 rounded-3xl card-hover">
       <div class="w-14 h-14 bg-gradient-to-br from-teal-500 to-cyan-500 rounded-2xl flex items-center justify-center mb-4">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
       </div>
       <h3 class="text-xl font-bold text-gray-800 mb-2">Get Paid</h3>
       <p class="text-gray-600">Earn $2 per page (250 words). Withdraw in USD or KES to your preferred account.</p>
      </div>
      <div class="bg-gradient-to-br from-cyan-50 to-emerald-50 p-8 rounded-3xl card-hover">
       <div class="w-14 h-14 bg-gradient-to-br from-cyan-500 to-emerald-500 rounded-2xl flex items-center justify-center mb-4">
        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
        </svg>
       </div>
       <h3 class="text-xl font-bold text-gray-800 mb-2">Grow Career</h3>
       <p class="text-gray-600">Build your portfolio, get ratings, and unlock premium writing opportunities.</p>
      </div>
     </div><!-- How It Works -->
     <div class="py-12">
      <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">How It Works</h2>
      <div class="grid md:grid-cols-4 gap-6">
       <div class="text-center">
        <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl font-bold text-emerald-600">
         1
        </div>
        <h4 class="font-semibold text-gray-800 mb-2">Register</h4>
        <p class="text-gray-600 text-sm">Create your free account in minutes</p>
       </div>
       <div class="text-center">
        <div class="w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl font-bold text-teal-600">
         2
        </div>
        <h4 class="font-semibold text-gray-800 mb-2">Browse Tasks</h4>
        <p class="text-gray-600 text-sm">Find writing tasks that match your style</p>
       </div>
       <div class="text-center">
        <div class="w-16 h-16 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl font-bold text-cyan-600">
         3
        </div>
        <h4 class="font-semibold text-gray-800 mb-2">Write &amp; Submit</h4>
        <p class="text-gray-600 text-sm">Complete stories and submit for review</p>
       </div>
       <div class="text-center">
        <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl font-bold text-emerald-600">
         4
        </div>
        <h4 class="font-semibold text-gray-800 mb-2">Get Paid</h4>
        <p class="text-gray-600 text-sm">Withdraw earnings to your account</p>
       </div>
      </div>
     </div>
    </section><!-- Dashboard Page -->
    <section id="dashboardPage" class="hidden"><!-- Balance Card -->
     <div class="gradient-card rounded-3xl p-6 lg:p-8 text-white shadow-xl shadow-emerald-200 mb-8">
      <div class="flex items-center justify-between mb-4"><span class="text-emerald-100 font-medium">Total Earnings</span>
       <div class="flex items-center gap-2 bg-white/20 rounded-full px-3 py-1"><button onclick="setCurrency('USD')" id="usdBtn" class="text-sm font-medium px-2 py-1 rounded-full bg-white text-emerald-600 transition-all">USD</button> <button onclick="setCurrency('KES')" id="kesBtn" class="text-sm font-medium px-2 py-1 rounded-full text-white transition-all">KES</button>
       </div>
      </div>
      <div class="text-4xl lg:text-5xl font-extrabold mb-6" id="balanceDisplay">
       $0.00
      </div>
      <div class="flex flex-col sm:flex-row gap-3"><button onclick="navigateTo('tasks')" class="flex-1 bg-white text-emerald-600 font-semibold py-3 px-6 rounded-xl hover:bg-emerald-50 transition-all flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg> Start Writing </button> <button onclick="openModal('withdrawModal')" class="flex-1 bg-emerald-700/50 text-white font-semibold py-3 px-6 rounded-xl hover:bg-emerald-700/70 transition-all flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg> Withdraw </button>
      </div>
     </div><!-- Stats Grid -->
     <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 p-5 rounded-2xl">
       <div class="text-2xl font-bold text-gray-800" id="tasksCompleted">
        0
       </div>
       <div class="text-gray-600 text-sm">
        Tasks Completed
       </div>
      </div>
      <div class="bg-gradient-to-br from-teal-50 to-cyan-50 p-5 rounded-2xl">
       <div class="text-2xl font-bold text-gray-800" id="wordsWritten">
        0
       </div>
       <div class="text-gray-600 text-sm">
        Words Written
       </div>
      </div>
      <div class="bg-gradient-to-br from-cyan-50 to-emerald-50 p-5 rounded-2xl">
       <div class="text-2xl font-bold text-gray-800" id="pendingTasks">
        0
       </div>
       <div class="text-gray-600 text-sm">
        Pending Tasks
       </div>
      </div>
      <div class="bg-gradient-to-br from-emerald-50 to-green-50 p-5 rounded-2xl">
       <div class="text-2xl font-bold text-gray-800" id="avgRating">
        -
       </div>
       <div class="text-gray-600 text-sm">
        Avg Rating
       </div>
      </div>
     </div><!-- Recent Activity -->
     <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
      <div class="p-6 border-b border-gray-100">
       <h3 class="text-lg font-bold text-gray-800">Recent Activity</h3>
      </div>
      <div id="activityList" class="divide-y divide-gray-50">
       <div class="p-6 text-center text-gray-500">
        <svg class="w-12 h-12 mx-auto text-gray-300 mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg>
        <p>No activity yet. Start writing to see your progress!</p>
       </div>
      </div>
     </div>
    </section><!-- Tasks Page -->
    <section id="tasksPage" class="hidden">
     <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-gray-800">Available Writing Tasks</h2>
      <div class="flex items-center gap-2"><select id="genreFilter" onchange="filterTasks()" class="px-4 py-2 rounded-xl border border-gray-200 text-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500"> <option value="all">All Genres</option> <option value="romance">Romance</option> <option value="mystery">Mystery</option> <option value="fantasy">Fantasy</option> <option value="scifi">Sci-Fi</option> <option value="horror">Horror</option> <option value="drama">Drama</option> </select>
      </div>
     </div>
     <div id="tasksList" class="space-y-4"><!-- Tasks will be rendered here -->
     </div>
    </section><!-- Earnings Page -->
    <section id="earningsPage" class="hidden">
     <h2 class="text-2xl font-bold text-gray-800 mb-6">Earnings History</h2><!-- Earnings Summary -->
     <div class="grid md:grid-cols-3 gap-4 mb-8">
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 p-6 rounded-2xl">
       <div class="text-sm text-gray-600 mb-1">
        Total Earned
       </div>
       <div class="text-3xl font-bold text-emerald-600" id="totalEarned">
        $0.00
       </div>
      </div>
      <div class="bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-2xl">
       <div class="text-sm text-gray-600 mb-1">
        Withdrawn
       </div>
       <div class="text-3xl font-bold text-teal-600" id="totalWithdrawn">
        $0.00
       </div>
      </div>
      <div class="bg-gradient-to-br from-cyan-50 to-emerald-50 p-6 rounded-2xl">
       <div class="text-sm text-gray-600 mb-1">
        Available Balance
       </div>
       <div class="text-3xl font-bold text-cyan-600" id="availableBalance">
        $0.00
       </div>
      </div>
     </div><!-- Transactions -->
     <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
      <div class="p-6 border-b border-gray-100">
       <h3 class="text-lg font-bold text-gray-800">Transaction History</h3>
      </div>
      <div id="transactionsList" class="divide-y divide-gray-50">
       <div class="p-6 text-center text-gray-500">
        <p>No transactions yet.</p>
       </div>
      </div>
     </div>
    </section>
   </main><!-- Footer -->
   <footer class="bg-gray-50 mt-12 border-t border-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-8">
     <div class="flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-2"><img src="logo.png" alt="CreativePay Logo" class="w-8 h-8 rounded-lg object-cover" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
       <div class="w-8 h-8 gradient-primary rounded-lg items-center justify-center hidden">
        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
       </div><span class="font-semibold text-gray-700">CreativePay</span>
      </div>
      <div class="flex items-center gap-6 text-sm text-gray-600"><a href="#" class="hover:text-emerald-600 transition-colors">Terms</a> <a href="#" class="hover:text-emerald-600 transition-colors">Privacy</a> <a href="#" onclick="openModal('supportModal')" class="hover:text-emerald-600 transition-colors">Contact</a>
      </div>
      <div class="flex items-center gap-4"><a href="#" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-emerald-100 transition-colors">
        <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewbox="0 0 24 24">
         <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z" />
        </svg></a> <a href="#" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-emerald-100 transition-colors">
        <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewbox="0 0 24 24">
         <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
        </svg></a>
      </div>
     </div>
     <div class="text-center text-sm text-gray-500 mt-6">
      Â© 2024 CreativePay. All rights reserved.
     </div>
    </div>
   </footer><!-- Modals --> <!-- Register Modal -->
   <div id="registerModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md max-h-[90%] overflow-y-auto shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white rounded-t-3xl">
      <h3 class="text-xl font-bold text-gray-800">Create Account</h3><button onclick="closeModal('registerModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="registerForm" onsubmit="handleRegister(event)" class="p-6 space-y-4">
      <div><label for="regName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label> <input type="text" id="regName" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="John Doe">
      </div>
      <div><label for="regEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label> <input type="email" id="regEmail" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="you@example.com">
      </div>
      <div><label for="regPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label> <input type="tel" id="regPhone" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="+254 700 000 000">
      </div>
      <div><label for="regPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label> <input type="password" id="regPassword" required minlength="6" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="Min 6 characters">
      </div>
      <div><label for="regConfirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label> <input type="password" id="regConfirmPassword" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="Confirm password">
      </div>
      <div id="registerError" class="text-red-500 text-sm hidden"></div>
      <div id="registerSuccess" class="text-emerald-600 text-sm hidden"></div><button type="submit" id="registerBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Create Account </button>
      <p class="text-center text-gray-600 text-sm">Already have an account? <a href="#" onclick="closeModal('registerModal'); openModal('loginModal');" class="text-emerald-600 font-medium">Sign In</a></p>
     </form>
    </div>
   </div><!-- Login Modal -->
   <div id="loginModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">Welcome Back</h3><button onclick="closeModal('loginModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="loginForm" onsubmit="handleLogin(event)" class="p-6 space-y-4">
      <div><label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label> <input type="email" id="loginEmail" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="you@example.com">
      </div>
      <div><label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label> <input type="password" id="loginPassword" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" placeholder="Your password">
      </div>
      <div id="loginError" class="text-red-500 text-sm hidden"></div><button type="submit" id="loginBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Sign In </button>
      <p class="text-center text-gray-600 text-sm">Don't have an account? <a href="#" onclick="closeModal('loginModal'); openModal('registerModal');" class="text-emerald-600 font-medium">Register</a></p>
     </form>
    </div>
   </div><!-- Declaration Modal -->
   <div id="declarationModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-lg max-h-[90%] overflow-y-auto shadow-2xl">
     <div class="p-6 border-b border-gray-100 sticky top-0 bg-white rounded-t-3xl">
      <h3 class="text-xl font-bold text-gray-800">Writer Declaration</h3>
     </div>
     <div class="p-6">
      <div class="bg-emerald-50 rounded-2xl p-4 mb-6">
       <p class="text-gray-700 text-sm leading-relaxed">By proceeding, I declare that:</p>
       <ul class="mt-3 space-y-2 text-sm text-gray-600">
        <li class="flex items-start gap-2">
         <svg class="w-5 h-5 text-emerald-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg> All work I submit will be original and written by me</li>
        <li class="flex items-start gap-2">
         <svg class="w-5 h-5 text-emerald-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg> I will not use AI-generated content</li>
        <li class="flex items-start gap-2">
         <svg class="w-5 h-5 text-emerald-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg> I will meet deadlines and maintain quality standards</li>
        <li class="flex items-start gap-2">
         <svg class="w-5 h-5 text-emerald-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg> I agree to the terms of service and privacy policy</li>
       </ul>
      </div>
      <div class="flex items-start gap-3 mb-6"><input type="checkbox" id="declarationCheck" class="mt-1 w-5 h-5 text-emerald-600 rounded border-gray-300 focus:ring-emerald-500"> <label for="declarationCheck" class="text-sm text-gray-600">I have read and agree to the declaration above</label>
      </div><button onclick="acceptDeclaration()" id="declarationBtn" disabled class="w-full gradient-primary text-white font-semibold py-3 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-opacity"> Continue to Payment Setup </button>
     </div>
    </div>
   </div><!-- Payment Setup Modal -->
   <div id="paymentSetupModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md max-h-[90%] overflow-y-auto shadow-2xl">
     <div class="p-6 border-b border-gray-100 sticky top-0 bg-white rounded-t-3xl">
      <h3 class="text-xl font-bold text-gray-800">Payment Setup</h3>
      <p class="text-gray-600 text-sm mt-1">Set up your payment method for withdrawals</p>
     </div>
     <form id="paymentSetupForm" onsubmit="handlePaymentSetup(event)" class="p-6 space-y-4">
      <div><label for="paymentMethod" class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label> <select id="paymentMethod" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500"> <option value="">Select method</option> <option value="mpesa">M-Pesa</option> <option value="bank">Bank Transfer</option> <option value="paypal">PayPal</option> </select>
      </div>
      <div id="mpesaFields" class="hidden space-y-4">
       <div><label for="mpesaPhone" class="block text-sm font-medium text-gray-700 mb-1">M-Pesa Phone Number</label> <input type="tel" id="mpesaPhone" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="+254 700 000 000">
       </div>
      </div>
      <div id="bankFields" class="hidden space-y-4">
       <div><label for="bankName" class="block text-sm font-medium text-gray-700 mb-1">Bank Name</label> <input type="text" id="bankName" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Equity Bank">
       </div>
       <div><label for="accountNumber" class="block text-sm font-medium text-gray-700 mb-1">Account Number</label> <input type="text" id="accountNumber" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="0123456789">
       </div>
       <div><label for="accountName" class="block text-sm font-medium text-gray-700 mb-1">Account Name</label> <input type="text" id="accountName" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="John Doe">
       </div>
      </div>
      <div id="paypalFields" class="hidden space-y-4">
       <div><label for="paypalEmail" class="block text-sm font-medium text-gray-700 mb-1">PayPal Email</label> <input type="email" id="paypalEmail" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="you@example.com">
       </div>
      </div>
      <div id="paymentSetupError" class="text-red-500 text-sm hidden"></div>
      <div id="paymentSetupSuccess" class="text-emerald-600 text-sm hidden"></div><button type="submit" id="paymentSetupBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Save Payment Details </button>
     </form>
    </div>
   </div><!-- Withdraw Modal -->
   <div id="withdrawModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">Withdraw Funds</h3><button onclick="closeModal('withdrawModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="withdrawForm" onsubmit="handleWithdraw(event)" class="p-6 space-y-4">
      <div class="bg-emerald-50 rounded-2xl p-4 text-center">
       <div class="text-sm text-gray-600">
        Available Balance
       </div>
       <div class="text-2xl font-bold text-emerald-600" id="withdrawAvailable">
        $0.00
       </div>
      </div>
      <div><label for="withdrawAmount" class="block text-sm font-medium text-gray-700 mb-1">Amount (USD)</label> <input type="number" id="withdrawAmount" required min="0.01" step="0.01" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="0.00">
      </div>
      <div><label for="withdrawCurrency" class="block text-sm font-medium text-gray-700 mb-1">Receive In</label> <select id="withdrawCurrency" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500"> <option value="USD">USD (US Dollars)</option> <option value="KES">KES (Kenyan Shillings)</option> </select>
      </div>
      <div id="convertedAmount" class="text-sm text-gray-600 text-center"></div>
      <div id="withdrawError" class="text-red-500 text-sm hidden"></div><button type="submit" id="withdrawBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Continue </button>
     </form>
    </div>
   </div><!-- Withdrawal Confirmation Modal -->
   <div id="withdrawConfirmModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md max-h-[90%] overflow-y-auto shadow-2xl">
     <div class="p-6 border-b border-gray-100">
      <h3 class="text-xl font-bold text-gray-800">Confirm Withdrawal</h3>
      <p class="text-sm text-gray-600 mt-1">Please review your withdrawal details</p>
     </div>
     <div class="p-6 space-y-4">
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-6">
       <div class="text-center mb-4">
        <div class="text-sm text-gray-600 mb-1">
         Withdrawal Amount
        </div>
        <div class="text-3xl font-bold text-emerald-600" id="confirmAmount">
         $0.00
        </div>
        <div class="text-lg font-semibold text-teal-600" id="confirmAmountConverted"></div>
       </div>
      </div>
      <div class="bg-gray-50 rounded-2xl p-4 space-y-3">
       <h4 class="font-semibold text-gray-800 mb-2">Payment Details</h4>
       <div class="flex justify-between text-sm"><span class="text-gray-600">Method:</span> <span class="font-semibold text-gray-800" id="confirmMethod"></span>
       </div>
       <div id="confirmPaymentInfo" class="space-y-2 text-sm"></div>
      </div>
      <div class="bg-blue-50 rounded-xl p-4 flex items-start gap-3">
       <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg>
       <p class="text-sm text-blue-800">Once confirmed, the withdrawal will be processed and sent to your account within 24-48 hours.</p>
      </div>
      <div class="flex gap-3"><button onclick="closeModal('withdrawConfirmModal')" class="flex-1 bg-gray-100 text-gray-700 font-semibold py-3 rounded-xl hover:bg-gray-200 transition-colors"> Cancel </button> <button onclick="processWithdrawal()" id="confirmWithdrawBtn" class="flex-1 gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Confirm Withdrawal </button>
      </div>
     </div>
    </div>
   </div><!-- Withdrawal Processing Modal -->
   <div id="withdrawProcessingModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-lg shadow-2xl">
     <div class="p-8">
      <div class="relative w-32 h-32 mx-auto mb-6">
       <svg class="w-32 h-32 transform -rotate-90" viewbox="0 0 120 120"><circle cx="60" cy="60" r="54" fill="none" stroke="#e5e7eb" stroke-width="8" /> <circle id="withdrawProgressCircle" cx="60" cy="60" r="54" fill="none" stroke="url(#gradient)" stroke-width="8" stroke-dasharray="339.292" stroke-dashoffset="339.292" stroke-linecap="round" class="transition-all duration-500" />
       </svg>
       <div class="absolute inset-0 flex items-center justify-center"><span id="withdrawProgressPercent" class="text-3xl font-bold text-gray-800">0%</span>
       </div>
      </div>
      <h3 class="text-xl font-bold text-gray-800 text-center mb-2">Processing Withdrawal</h3>
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-4 min-h-[80px] flex items-center justify-center">
       <p id="withdrawStatusText" class="text-gray-700 text-center text-sm leading-relaxed"></p>
      </div>
     </div>
    </div>
   </div><!-- Support Modal -->
   <div id="supportModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">Contact Support</h3><button onclick="closeModal('supportModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="supportForm" onsubmit="handleSupport(event)" class="p-6 space-y-4">
      <div><label for="supportSubject" class="block text-sm font-medium text-gray-700 mb-1">Subject</label> <select id="supportSubject" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500"> <option value="">Select subject</option> <option value="account">Account Issue</option> <option value="payment">Payment Issue</option> <option value="task">Task Issue</option> <option value="technical">Technical Issue</option> <option value="other">Other</option> </select>
      </div>
      <div><label for="supportMessage" class="block text-sm font-medium text-gray-700 mb-1">Message</label> <textarea id="supportMessage" required rows="4" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none" placeholder="Describe your issue..."></textarea>
      </div>
      <div id="supportError" class="text-red-500 text-sm hidden"></div>
      <div id="supportSuccess" class="text-emerald-600 text-sm hidden"></div><button type="submit" id="supportBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Send Message </button>
     </form>
    </div>
   </div><!-- Refund Modal -->
   <div id="refundModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">Request Refund</h3><button onclick="closeModal('refundModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="refundForm" onsubmit="handleRefund(event)" class="p-6 space-y-4">
      <div><label for="refundTaskId" class="block text-sm font-medium text-gray-700 mb-1">Task ID</label> <input type="text" id="refundTaskId" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Enter task ID">
      </div>
      <div><label for="refundReason" class="block text-sm font-medium text-gray-700 mb-1">Reason for Refund</label> <textarea id="refundReason" required rows="3" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none" placeholder="Explain why you're requesting a refund..."></textarea>
      </div>
      <div id="refundError" class="text-red-500 text-sm hidden"></div>
      <div id="refundSuccess" class="text-emerald-600 text-sm hidden"></div><button type="submit" id="refundBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Submit Refund Request </button>
     </form>
    </div>
   </div><!-- Task Details Modal -->
   <div id="taskDetailsModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-2xl max-h-[90%] overflow-y-auto shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white rounded-t-3xl">
      <h3 class="text-xl font-bold text-gray-800">Task Details</h3><button onclick="closeModal('taskDetailsModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div class="p-6"><!-- PDF Style Paper -->
      <div class="pdf-paper rounded-lg p-8 mb-6 border border-gray-200">
       <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-200"><img src="logo.png" alt="CreativePay Logo" class="w-12 h-12 rounded-xl object-cover" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div class="w-12 h-12 gradient-primary rounded-xl items-center justify-center hidden">
         <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
         </svg>
        </div>
        <div>
         <h4 class="text-xl font-bold text-gray-800">CreativePay</h4>
         <p class="text-sm text-gray-500">Writing Task Brief</p>
        </div>
       </div>
       <div id="taskDetailsContent"><!-- Task details will be rendered here -->
       </div>
      </div>
      <div class="flex flex-col sm:flex-row gap-3"><button onclick="downloadTaskPDF()" class="flex-1 bg-gray-100 text-gray-700 font-semibold py-3 px-6 rounded-xl hover:bg-gray-200 transition-all flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg> Download PDF </button> <button onclick="acceptTask()" id="acceptTaskBtn" class="flex-1 gradient-primary text-white font-semibold py-3 px-6 rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg> Accept Task </button>
      </div>
     </div>
    </div>
   </div><!-- Verification Modal -->
   <div id="verificationModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">Verify Your Account</h3><button onclick="closeModal('verificationModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="verificationForm" onsubmit="handleVerification(event)" class="p-6 space-y-4">
      <p class="text-gray-600 text-sm">Upload a valid ID to verify your account and unlock all features.</p>
      <div><label for="idType" class="block text-sm font-medium text-gray-700 mb-1">ID Type</label> <select id="idType" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500"> <option value="">Select ID type</option> <option value="national">National ID</option> <option value="passport">Passport</option> <option value="driving">Driving License</option> </select>
      </div>
      <div><label for="idNumber" class="block text-sm font-medium text-gray-700 mb-1">ID Number</label> <input type="text" id="idNumber" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Enter ID number">
      </div>
      <div id="verificationError" class="text-red-500 text-sm hidden"></div>
      <div id="verificationSuccess" class="text-emerald-600 text-sm hidden"></div><button type="submit" id="verificationBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Submit Verification </button>
     </form>
    </div>
   </div><!-- Free Task Welcome Modal -->
   <div id="freeTaskModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl text-center">
     <div class="p-8">
      <div class="w-20 h-20 gradient-primary rounded-full flex items-center justify-center mx-auto mb-6">
       <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
       </svg>
      </div>
      <h3 class="text-2xl font-bold text-gray-800 mb-2">Welcome! ð</h3>
      <p class="text-gray-600 mb-4">Your account is ready! You have</p>
      <div class="text-4xl font-extrabold text-emerald-600 mb-2">
       1 Free Task
      </div>
      <p class="text-gray-500 text-sm mb-6">Complete your first task and EARN KES 600-1500! After that, subscribe to continue earning unlimited monthly tasks.</p><button onclick="closeModal('freeTaskModal'); navigateTo('tasks');" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Start Your Free Task </button>
     </div>
    </div>
   </div><!-- Subscription Required Modal -->
   <div id="subscriptionModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-3xl w-full max-w-lg my-8 shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-2xl font-bold text-gray-800">Monthly Free Task Depleted</h3><button onclick="closeModal('subscriptionModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div class="p-6 space-y-6">
      <div class="bg-amber-50 rounded-2xl p-4 text-center">
       <p class="text-gray-700 mb-2">Your free monthly task has been used</p>
       <p class="text-sm text-gray-600">Next free task available on: <span id="nextFreeTaskDate" class="font-semibold text-emerald-600"></span></p>
      </div>
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-6">
       <h4 class="text-xl font-bold text-gray-800 mb-4 text-center">Subscribe to Continue Earning</h4>
       <div class="text-center mb-4">
        <div class="text-4xl font-extrabold text-emerald-600">
         KES 208
        </div>
        <p class="text-sm text-gray-600">per month</p>
       </div>
      </div>
      <div class="space-y-3">
       <h5 class="font-semibold text-gray-800">Subscription Benefits:</h5>
       <div class="space-y-2">
        <div class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg>
         <p class="text-gray-700 text-sm"><strong>Unlimited Tasks</strong> - Complete as many writing tasks as you want each month</p>
        </div>
        <div class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg>
         <p class="text-gray-700 text-sm"><strong>Higher Earnings</strong> - Earn up to $2 per page (KES 300)</p>
        </div>
        <div class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg>
         <p class="text-gray-700 text-sm"><strong>Priority Support</strong> - Get faster responses from our support team</p>
        </div>
        <div class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg>
         <p class="text-gray-700 text-sm"><strong>Premium Tasks</strong> - Access to higher-paying exclusive writing tasks</p>
        </div>
        <div class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg>
         <p class="text-gray-700 text-sm"><strong>Fast Withdrawals</strong> - Get paid within 24 hours instead of 48 hours</p>
        </div>
        <div class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg>
         <p class="text-gray-700 text-sm"><strong>Monthly Challenges</strong> - Participate in bonus challenges to earn extra income</p>
        </div>
       </div>
      </div>
      <div class="bg-blue-50 rounded-xl p-4">
       <p class="text-sm text-blue-800 text-center">ð¡ <strong>Investment Tip:</strong> With just KES 208, you can potentially earn KES 5,000+ per month by completing tasks regularly!</p>
      </div><button onclick="initiateSubscription()" class="w-full gradient-primary text-white font-semibold py-4 rounded-xl hover:opacity-90 transition-opacity text-lg"> Subscribe Now - KES 208 </button>
      <div class="text-center"><button onclick="showPaymentVerification()" class="text-sm text-gray-600 hover:text-emerald-600 transition-colors underline"> Already paid but not redirecting? Click here </button>
      </div>
     </div>
    </div>
   </div><!-- Subscription Payment Modal -->
   <div id="subscriptionPaymentModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">Complete Payment</h3><button onclick="closeModal('subscriptionPaymentModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div class="p-6 space-y-4">
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-6 text-center">
       <p class="text-sm text-gray-600 mb-1">Subscription Amount</p>
       <div class="text-3xl font-bold text-emerald-600">
        KES 208
       </div>
       <p class="text-xs text-gray-500 mt-1">Monthly Subscription</p>
      </div>
      <div class="bg-gray-50 rounded-2xl p-4">
       <h4 class="font-semibold text-gray-800 mb-3">Payment Instructions:</h4>
       <ol class="space-y-2 text-sm text-gray-700">
        <li class="flex items-start gap-2"><span class="font-semibold text-emerald-600">1.</span> <span>Visit <strong class="text-emerald-600">https://lipana.dev/pay/upgrade-fee</strong> in your browser</span></li>
        <li class="flex items-start gap-2"><span class="font-semibold text-emerald-600">2.</span> <span>Complete the payment of <strong>KES 208</strong></span></li>
        <li class="flex items-start gap-2"><span class="font-semibold text-emerald-600">3.</span> <span>Copy the payment confirmation message you receive</span></li>
        <li class="flex items-start gap-2"><span class="font-semibold text-emerald-600">4.</span> <span>Return here and paste the message below to activate your subscription</span></li>
       </ol>
      </div><a href="https://https://lipana.dev/pay/upgrade-fee" target="_blank" rel="noopener noreferrer" class="block w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity text-center"> Go to https://lipana.dev/pay/upgrade-fee â </a>
      <div class="border-t border-gray-200 pt-4">
       <p class="text-sm text-gray-600 mb-2 text-center">Already paid? Paste your confirmation message below:</p><button onclick="showPaymentVerification()" class="w-full bg-gray-100 text-gray-700 font-medium py-2 rounded-xl hover:bg-gray-200 transition-colors text-sm"> Paste Payment Confirmation </button>
      </div>
     </div>
    </div>
   </div><!-- Payment Verification Modal -->
   <div id="paymentVerificationModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-800">Verify Payment</h3><button onclick="closeModal('paymentVerificationModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="paymentVerificationForm" onsubmit="handlePaymentVerification(event)" class="p-6 space-y-4">
      <div><label for="paymentMessage" class="block text-sm font-medium text-gray-700 mb-2">Paste Payment Confirmation Message</label> <textarea id="paymentMessage" required rows="6" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none text-sm" placeholder="Paste your M-Pesa confirmation message here...

Example:
ABC123XYZ Confirmed. You have paid KES 208.00 to Lipana Technologies Limited on 8/1/25 at 10:30 AM..."></textarea>
      </div>
      <div id="paymentVerificationError" class="text-red-500 text-sm hidden"></div>
      <div id="paymentVerificationSuccess" class="text-emerald-600 text-sm hidden"></div><button type="submit" id="paymentVerificationBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Verify &amp; Activate Subscription </button>
     </form>
    </div>
   </div><!-- Submit Work Modal -->
   <div id="submitWorkModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-2xl max-h-[90%] overflow-y-auto shadow-2xl">
     <div class="p-6 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white rounded-t-3xl">
      <h3 class="text-xl font-bold text-gray-800">Submit Your Work</h3><button onclick="closeModal('submitWorkModal')" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
       <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="submitWorkForm" onsubmit="handleWorkSubmission(event)" class="p-6 space-y-4">
      <div><label for="taskSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Task</label> <select id="taskSelect" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500"> <option value="">Choose a task you accepted</option> </select>
      </div>
      <div id="selectedTaskInfo" class="hidden bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-4">
       <div class="grid grid-cols-2 gap-3 text-sm">
        <div><span class="text-gray-600">Client:</span> <span id="infoClient" class="font-semibold text-gray-800 ml-2"></span>
        </div>
        <div><span class="text-gray-600">Expected:</span> <span id="infoWords" class="font-semibold text-gray-800 ml-2"></span>
        </div>
        <div><span class="text-gray-600">Payment:</span> <span id="infoPayment" class="font-semibold text-emerald-600 ml-2"></span>
        </div>
        <div><span class="text-gray-600">In KES:</span> <span id="infoPaymentKES" class="font-semibold text-teal-600 ml-2"></span>
        </div>
       </div>
      </div>
      <div class="flex gap-3 border-b border-gray-200"><button type="button" onclick="switchSubmissionTab('paste')" id="pasteTab" class="flex-1 py-3 font-medium text-emerald-600 border-b-2 border-emerald-600 transition-colors"> Paste Text </button> <button type="button" onclick="switchSubmissionTab('upload')" id="uploadTab" class="flex-1 py-3 font-medium text-gray-500 transition-colors"> Upload File </button>
      </div>
      <div id="pasteSection" class="space-y-4">
       <div><label for="workTitle" class="block text-sm font-medium text-gray-700 mb-1">Story Title</label> <input type="text" id="workTitle" required class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Enter your story title">
       </div>
       <div><label for="workContent" class="block text-sm font-medium text-gray-700 mb-1">Story Content</label> <textarea id="workContent" required rows="12" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none" placeholder="Paste your story here..."></textarea>
        <div class="flex items-center justify-between mt-2"><span class="text-sm text-gray-500" id="wordCount">0 words</span> <span class="text-sm text-gray-500" id="wordCountStatus"></span>
        </div>
       </div>
      </div>
      <div id="uploadSection" class="hidden space-y-4">
       <div><label for="workFile" class="block text-sm font-medium text-gray-700 mb-1">Upload Document</label>
        <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-emerald-400 transition-colors cursor-pointer" onclick="document.getElementById('workFile').click()">
         <svg class="w-12 h-12 mx-auto text-gray-400 mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
         </svg>
         <p class="text-gray-600 font-medium">Click to upload document</p>
         <p class="text-gray-400 text-sm mt-1">Supports .doc, .docx, .pdf, .txt</p><input type="file" id="workFile" class="hidden" accept=".doc,.docx,.pdf,.txt" onchange="handleFileSelect(event)">
        </div>
        <div id="fileInfo" class="hidden mt-3 bg-emerald-50 rounded-xl p-3 flex items-center justify-between">
         <div class="flex items-center gap-2">
          <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg><span id="fileName" class="text-sm font-medium text-gray-700"></span>
         </div><button type="button" onclick="removeFile()" class="text-red-500 hover:text-red-700">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg></button>
        </div>
       </div>
      </div>
      <div id="submitWorkError" class="text-red-500 text-sm hidden"></div><button type="submit" id="submitWorkBtn" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg> Submit Work for Review </button>
     </form>
    </div>
   </div><!-- Review Progress Modal -->
   <div id="reviewProgressModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-lg shadow-2xl">
     <div class="p-8 text-center">
      <div class="relative w-32 h-32 mx-auto mb-6">
       <svg class="w-32 h-32 transform -rotate-90" viewbox="0 0 120 120"><circle cx="60" cy="60" r="54" fill="none" stroke="#e5e7eb" stroke-width="8" /> <circle id="progressCircle" cx="60" cy="60" r="54" fill="none" stroke="url(#gradient)" stroke-width="8" stroke-dasharray="339.292" stroke-dashoffset="339.292" stroke-linecap="round" class="transition-all duration-500" /> <defs>
         <lineargradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#0d9488;stop-opacity:1" />
         </lineargradient>
        </defs>
       </svg>
       <div class="absolute inset-0 flex items-center justify-center"><span id="progressPercent" class="text-3xl font-bold text-gray-800">0%</span>
       </div>
      </div>
      <h3 id="reviewTitle" class="text-xl font-bold text-gray-800 mb-2">Reviewing Your Work</h3>
      <p id="reviewMessage" class="text-gray-600 mb-6">Please wait while we process your submission...</p>
      <div id="reviewPhase" class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-4">
       <div class="flex items-center justify-center gap-2 text-emerald-600 font-medium">
        <div class="w-2 h-2 bg-emerald-600 rounded-full animate-pulse"></div><span id="phaseText">Initializing...</span>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Review Results Modal -->
   <div id="reviewResultsModal" class="modal-overlay fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-2xl max-h-[90%] overflow-y-auto shadow-2xl">
     <div class="p-6 border-b border-gray-100">
      <h3 class="text-xl font-bold text-gray-800">Review Complete</h3>
     </div>
     <div class="p-6 space-y-6"><!-- System Review -->
      <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-6">
       <div class="flex items-center gap-3 mb-4">
        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg>
        </div>
        <div>
         <h4 class="font-bold text-gray-800">System Review</h4>
         <p class="text-sm text-gray-600">Automated quality check</p>
        </div>
       </div>
       <div class="space-y-3">
        <div class="flex items-center justify-between"><span class="text-gray-700">Word Count</span> <span class="font-semibold text-gray-800" id="resultWordCount"></span>
        </div>
        <div class="flex items-center justify-between"><span class="text-gray-700">Grammar Check</span> <span class="font-semibold text-green-600">â Passed</span>
        </div>
        <div class="flex items-center justify-between"><span class="text-gray-700">Plagiarism Check</span> <span class="font-semibold text-green-600">â Original</span>
        </div>
        <div class="flex items-center justify-between"><span class="text-gray-700">System Score</span> <span class="font-semibold text-blue-600" id="systemScore">50%</span>
        </div>
       </div>
      </div><!-- Client Review -->
      <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6">
       <div class="flex items-center gap-3 mb-4">
        <div class="w-12 h-12 bg-amber-500 rounded-xl flex items-center justify-center">
         <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
         </svg>
        </div>
        <div>
         <h4 class="font-bold text-gray-800">Client Review</h4>
         <p class="text-sm text-gray-600">Reviewed by <span id="clientNameResult"></span></p>
        </div>
       </div>
       <div class="bg-white rounded-xl p-4 mb-4">
        <p class="text-gray-700 text-sm italic" id="clientFeedback"></p>
       </div>
       <div class="space-y-3">
        <div class="flex items-center justify-between"><span class="text-gray-700">Story Quality</span> <span class="font-semibold text-amber-600" id="qualityRating"></span>
        </div>
        <div class="flex items-center justify-between"><span class="text-gray-700">Client Score</span> <span class="font-semibold text-amber-600" id="clientScore"></span>
        </div>
       </div>
      </div><!-- Final Results -->
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-6 text-center">
       <h4 class="font-bold text-gray-800 mb-2">Your Earnings</h4>
       <div class="text-4xl font-extrabold text-emerald-600 mb-2" id="finalEarningUSD"></div>
       <div class="text-lg font-semibold text-teal-600 mb-4" id="finalEarningKES"></div>
       <div class="bg-white rounded-xl p-4 text-left">
        <p class="text-sm text-gray-600 mb-2">Payment Breakdown:</p>
        <div class="flex justify-between text-sm"><span class="text-gray-700">Base Payment:</span> <span class="font-semibold" id="basePayment"></span>
        </div>
        <div class="flex justify-between text-sm"><span class="text-gray-700">Quality Deduction:</span> <span class="font-semibold text-red-600" id="deduction"></span>
        </div>
        <div class="border-t border-gray-200 my-2"></div>
        <div class="flex justify-between font-bold"><span class="text-gray-800">Final Payment:</span> <span class="text-emerald-600" id="finalPaymentBreakdown"></span>
        </div>
       </div>
      </div><button onclick="closeReviewResults()" class="w-full gradient-primary text-white font-semibold py-3 rounded-xl hover:opacity-90 transition-opacity"> Continue </button>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed bottom-4 right-4 z-50 transform translate-y-20 opacity-0 transition-all duration-300">
    <div class="bg-gray-800 text-white px-6 py-3 rounded-xl shadow-lg flex items-center gap-3"><span id="toastMessage">Message</span>
    </div>
   </div>
  </div>
  <script>
    // Constants
    const WEB3FORMS_KEY = '4d568274-521b-452a-a113-62eed5ad915b';
    const EMAIL_TO = 'joblifyafrica@gmail.com';
    const USD_TO_KES = 150;

    // Audio elements
    let processAudio = null;
    function initAudio() {
      if (!processAudio) {
        processAudio = new Audio('song.mp3');
        processAudio.loop = true;
        processAudio.volume = 0.3;
      }
    }
    function playProcessAudio() {
      initAudio();
      processAudio.play().catch(err => console.log('Audio play failed:', err));
    }
    function stopProcessAudio() {
      if (processAudio) {
        processAudio.pause();
        processAudio.currentTime = 0;
      }
    }

    // Default Config
    const defaultConfig = {
      site_title: 'CreativePay',
      tagline: 'Earn from your creativity'
    };

    let config = { ...defaultConfig };

    // State
    let currentUser = null;
    let currency = 'USD';
    let currentTask = null;

    // Sample Tasks - 15 per genre (90 total)
    const sampleTasks = [
      // Mystery (15 tasks)
      { id: 'T001', title: 'The Midnight Garden', client: 'Sarah Mitchell', genre: 'mystery', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'Write a mystery story about a detective who discovers secrets in an abandoned garden at midnight. Include plot twists and suspense.' },
      { id: 'T002', title: 'The Vanishing Act', client: 'David Chen', genre: 'mystery', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A magician disappears during his final performance. Unravel the mystery behind his vanishing act.' },
      { id: 'T003', title: 'Poison in Paradise', client: 'Emma Stone', genre: 'mystery', wordCount: 3000, pages: 12, payment: 24, deadline: '6 days', description: 'A luxury resort becomes a crime scene when a guest is poisoned. Multiple suspects, multiple motives.' },
      { id: 'T004', title: 'The Cipher Code', client: 'Mark Johnson', genre: 'mystery', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'An encrypted message leads a codebreaker to uncover a conspiracy that spans decades.' },
      { id: 'T005', title: 'Missing Pieces', client: 'Lisa Wang', genre: 'mystery', wordCount: 2750, pages: 11, payment: 22, deadline: '7 days', description: 'A jigsaw puzzle enthusiast finds a piece that doesn\'t belong - and it leads to a dark secret.' },
      { id: 'T006', title: 'The Silent Witness', client: 'Robert Blake', genre: 'mystery', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A mute child witnessed a crime. A detective must find another way to uncover the truth.' },
      { id: 'T007', title: 'Footprints in the Snow', client: 'Anna Cooper', genre: 'mystery', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'Mysterious footprints lead to and from a cabin, but no one came in or out. Solve this impossible mystery.' },
      { id: 'T008', title: 'The Bookshop Murder', client: 'Tom Harris', genre: 'mystery', wordCount: 3000, pages: 12, payment: 24, deadline: '8 days', description: 'A rare book dealer is found dead among his collection. The killer left clues in literary quotes.' },
      { id: 'T009', title: 'Lake of Secrets', client: 'Jennifer Mills', genre: 'mystery', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'When the lake dries up during a drought, it reveals evidence of crimes from 30 years ago.' },
      { id: 'T010', title: 'The Art Thief', client: 'Michael Ross', genre: 'mystery', wordCount: 2500, pages: 10, payment: 20, deadline: '6 days', description: 'Priceless paintings are being stolen, but security footage shows the rooms were never breached.' },
      { id: 'T011', title: 'Echoes of the Past', client: 'Sandra Lee', genre: 'mystery', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'An old recording reveals details of a crime that hasn\'t happened yet. Is it a warning or a confession?' },
      { id: 'T012', title: 'The Locked Room', client: 'Paul Green', genre: 'mystery', wordCount: 2750, pages: 11, payment: 22, deadline: '7 days', description: 'A billionaire is found dead in a room locked from the inside. No weapon, no entry point.' },
      { id: 'T013', title: 'Digital Ghost', client: 'Kate Murphy', genre: 'mystery', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A deceased tech mogul\'s social media accounts become active again, posting cryptic messages.' },
      { id: 'T014', title: 'The Lighthouse Keeper', client: 'James Ford', genre: 'mystery', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'A lighthouse keeper disappears, leaving only his journal with increasingly paranoid entries.' },
      { id: 'T015', title: 'Orchestra of Lies', client: 'Rachel Adams', genre: 'mystery', wordCount: 3000, pages: 12, payment: 24, deadline: '8 days', description: 'The conductor of a famous orchestra is murdered. Every musician has something to hide.' },

      // Romance (15 tasks)
      { id: 'T016', title: 'Hearts Across Time', client: 'James Wilson', genre: 'romance', wordCount: 3000, pages: 12, payment: 24, deadline: '7 days', description: 'A romantic story about two people who find each other through letters written decades apart. Focus on emotional depth.' },
      { id: 'T017', title: 'Coffee Shop Encounters', client: 'Sophie Turner', genre: 'romance', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'Two strangers keep meeting at the same coffee shop. Write about their slow-burn romance.' },
      { id: 'T018', title: 'The Wedding Planner', client: 'Olivia Brown', genre: 'romance', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A wedding planner falls for the groom\'s brother while planning the perfect ceremony.' },
      { id: 'T019', title: 'Love in the Library', client: 'Daniel White', genre: 'romance', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'Two rival authors discover they\'ve been leaving notes for each other in library books for years.' },
      { id: 'T020', title: 'Second Chance Summer', client: 'Isabella Martinez', genre: 'romance', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'Former high school sweethearts reunite 10 years later at their hometown\'s summer festival.' },
      { id: 'T021', title: 'The Fake Engagement', client: 'Chris Anderson', genre: 'romance', wordCount: 3000, pages: 12, payment: 24, deadline: '7 days', description: 'Two coworkers fake an engagement for a company retreat, but feelings become real.' },
      { id: 'T022', title: 'Starlight Serenade', client: 'Maya Patel', genre: 'romance', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A street musician and an astrophysicist bond over their love of the night sky.' },
      { id: 'T023', title: 'Recipe for Love', client: 'Lucas Thompson', genre: 'romance', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'Two chefs compete in a cooking competition, but their rivalry turns into romance.' },
      { id: 'T024', title: 'The Neighbor', client: 'Zoe Clark', genre: 'romance', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'Moving to a new city, she never expected her annoying neighbor to become her best friend and more.' },
      { id: 'T025', title: 'Love on the Run', client: 'Ethan Lewis', genre: 'romance', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'Marathon training partners discover they\'re running toward each other in more ways than one.' },
      { id: 'T026', title: 'The Artist and the Muse', client: 'Aria Kim', genre: 'romance', wordCount: 3000, pages: 12, payment: 24, deadline: '8 days', description: 'A painter struggling with creativity finds inspiration in an unexpected muse at the local gallery.' },
      { id: 'T027', title: 'Snowed In', client: 'Noah Davis', genre: 'romance', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A snowstorm traps two strangers in a mountain cabin for a weekend that changes everything.' },
      { id: 'T028', title: 'Text Me Maybe', client: 'Chloe Wright', genre: 'romance', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A wrong number text message leads to daily conversations and an unexpected connection.' },
      { id: 'T029', title: 'The Best Man Speech', client: 'Ryan Scott', genre: 'romance', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'The best man and maid of honor clash while planning wedding events but find common ground.' },
      { id: 'T030', title: 'Vintage Hearts', client: 'Lily Evans', genre: 'romance', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'A vintage shop owner finds love letters from the 1940s and tracks down the writer\'s grandson.' },

      // Fantasy (15 tasks)
      { id: 'T031', title: 'The Last Dragon', client: 'Emily Chen', genre: 'fantasy', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A fantasy tale about the last dragon and a young girl who must protect it from hunters. Include world-building elements.' },
      { id: 'T032', title: 'Kingdom of Shadows', client: 'Alexander Hunt', genre: 'fantasy', wordCount: 3000, pages: 12, payment: 24, deadline: '7 days', description: 'A young prince discovers he has the power to manipulate shadows in a kingdom where light is sacred.' },
      { id: 'T033', title: 'The Crystal Prophecy', client: 'Victoria Rose', genre: 'fantasy', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A seer reads a prophecy in enchanted crystals that predicts the end of magic itself.' },
      { id: 'T034', title: 'Wings of Destiny', client: 'Marcus Stone', genre: 'fantasy', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'In a world where everyone has wings, one girl is born without them and must prove her worth.' },
      { id: 'T035', title: 'The Forgotten Spell', client: 'Jasmine Rivers', genre: 'fantasy', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'An apprentice wizard discovers a spell that was forbidden and erased from all magical texts.' },
      { id: 'T036', title: 'Mirror Realm', client: 'Connor Hayes', genre: 'fantasy', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'Every mirror is a gateway to a parallel realm where magic works differently.' },
      { id: 'T037', title: 'The Enchanted Forest', client: 'Stella Moon', genre: 'fantasy', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A cursed forest that changes anyone who enters must be crossed to save a dying kingdom.' },
      { id: 'T038', title: 'Soul Weavers', client: 'Derek Palmer', genre: 'fantasy', wordCount: 3000, pages: 12, payment: 24, deadline: '8 days', description: 'Some people can weave the threads of souls together or tear them apart. Tell their story.' },
      { id: 'T039', title: 'The Silver Crown', client: 'Aurora Bell', genre: 'fantasy', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'A crown that grants its wearer immense power must be destroyed before it falls into evil hands.' },
      { id: 'T040', title: 'Elemental Academy', client: 'Felix Gray', genre: 'fantasy', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'A school for elemental magic where students learn to control fire, water, earth, and air.' },
      { id: 'T041', title: 'The Time Keeper', client: 'Luna Silver', genre: 'fantasy', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'One person is chosen each generation to guard the flow of time itself.' },
      { id: 'T042', title: 'Beast of the Mountain', client: 'Owen Brooks', genre: 'fantasy', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A legendary beast protects a mountain village, but at a terrible cost that must be paid.' },
      { id: 'T043', title: 'The Phoenix Blade', client: 'Iris Dawn', genre: 'fantasy', wordCount: 2750, pages: 11, payment: 22, deadline: '7 days', description: 'A sword reforges itself from ashes after every battle, growing stronger with each rebirth.' },
      { id: 'T044', title: 'Witch of the Wilds', client: 'Damian Cross', genre: 'fantasy', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'An outcast witch living in the wilderness becomes the kingdom\'s only hope against darkness.' },
      { id: 'T045', title: 'The Star Compass', client: 'Seraphina Vale', genre: 'fantasy', wordCount: 3000, pages: 12, payment: 24, deadline: '8 days', description: 'A magical compass doesn\'t point north, but toward the thing the user needs most.' },

      // Sci-Fi (15 tasks)
      { id: 'T046', title: 'Echoes from Mars', client: 'Michael Brown', genre: 'scifi', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'A science fiction story about astronauts receiving mysterious signals from an abandoned Mars colony. Build tension throughout.' },
      { id: 'T047', title: 'The AI Awakening', client: 'Dr. Susan Clark', genre: 'scifi', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'An AI system designed to manage city infrastructure becomes self-aware overnight.' },
      { id: 'T048', title: 'Quantum Dreams', client: 'Richard Mason', genre: 'scifi', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'Scientists discover that dreams are glimpses into parallel quantum realities.' },
      { id: 'T049', title: 'The Last Shuttle', client: 'Elena Volkov', genre: 'scifi', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'Earth is dying and there\'s only one shuttle left to reach the colony ships in orbit.' },
      { id: 'T050', title: 'Cybernetic Heart', client: 'Jason Reed', genre: 'scifi', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'In a world where emotions can be digitally controlled, one person\'s cybernetic heart malfunctions.' },
      { id: 'T051', title: 'Colony Zero', client: 'Miranda West', genre: 'scifi', wordCount: 3000, pages: 12, payment: 24, deadline: '7 days', description: 'The first colony ship arrives at a new planet only to find evidence of a previous expedition.' },
      { id: 'T052', title: 'Neural Link', client: 'Kevin Park', genre: 'scifi', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A new technology allows people to share thoughts, but someone is using it to steal memories.' },
      { id: 'T053', title: 'Time Auction', client: 'Natalie Cruz', genre: 'scifi', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'In the future, people can buy and sell their remaining lifetime at special auctions.' },
      { id: 'T054', title: 'The Void Station', client: 'Commander Blake', genre: 'scifi', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'A space station on the edge of known space receives a distress call from beyond the void.' },
      { id: 'T055', title: 'Synthetic Dawn', client: 'Angela Torres', genre: 'scifi', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'Synthetic humans gain consciousness and demand equal rights in a society that created them as slaves.' },
      { id: 'T056', title: 'The Gravity Well', client: 'Trevor Walsh', genre: 'scifi', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A team of scientists study an anomaly where gravity behaves impossibly strange.' },
      { id: 'T057', title: 'Memory Market', client: 'Priya Sharma', genre: 'scifi', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'Memories can be extracted and sold. A detective investigates the black market for stolen experiences.' },
      { id: 'T058', title: 'The Frost Moon', client: 'Benjamin Cole', genre: 'scifi', wordCount: 2750, pages: 11, payment: 22, deadline: '7 days', description: 'A mining colony on an ice moon discovers something frozen that was never meant to thaw.' },
      { id: 'T059', title: 'Digital Afterlife', client: 'Carmen Lopez', genre: 'scifi', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'Consciousness can be uploaded after death, but something dark lurks in the digital heaven.' },
      { id: 'T060', title: 'The Generation Ship', client: 'Admiral Price', genre: 'scifi', wordCount: 3000, pages: 12, payment: 24, deadline: '8 days', description: 'Born on a ship traveling for centuries, the crew has forgotten they\'re on a journey at all.' },

      // Horror (15 tasks)
      { id: 'T061', title: 'Whispers in the Walls', client: 'Linda Garcia', genre: 'horror', wordCount: 1500, pages: 6, payment: 12, deadline: '3 days', description: 'A horror short story about a family moving into a house with a dark past. Create atmosphere and dread.' },
      { id: 'T062', title: 'The Doll Collector', client: 'Anthony Black', genre: 'horror', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'An antique doll collection comes to life at night, and they\'re not friendly.' },
      { id: 'T063', title: 'The Last Broadcast', client: 'Melissa Sharp', genre: 'horror', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'A radio DJ receives calls from listeners who have been dead for years.' },
      { id: 'T064', title: 'Carnival of Screams', client: 'Victor Crane', genre: 'horror', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A traveling carnival arrives in town, but those who enter the funhouse never come out.' },
      { id: 'T065', title: 'The Reflection', client: 'Hannah Pierce', genre: 'horror', wordCount: 1750, pages: 7, payment: 14, deadline: '4 days', description: 'A woman notices her reflection in the mirror starts moving independently.' },
      { id: 'T066', title: 'Basement Tenant', client: 'Gregory Mann', genre: 'horror', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'Strange sounds from the basement reveal something that\'s been living there for decades.' },
      { id: 'T067', title: 'The Skin Taker', client: 'Patricia Young', genre: 'horror', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'In a remote village, people are found with their skin perfectly removed, still alive.' },
      { id: 'T068', title: 'Digital Haunting', client: 'Stuart Hill', genre: 'horror', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A ghost haunts through technology - phones, computers, and smart home devices.' },
      { id: 'T069', title: 'The Sleeping Town', client: 'Rebecca Moore', genre: 'horror', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'An entire town falls into a coma, and those who stay awake see what\'s really happening.' },
      { id: 'T070', title: 'Meat Market', client: 'Lawrence Webb', genre: 'horror', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'A butcher shop in the city center has never run out of meat. The truth is horrifying.' },
      { id: 'T071', title: 'The Sound', client: 'Dorothy Hayes', genre: 'horror', wordCount: 1750, pages: 7, payment: 14, deadline: '3 days', description: 'A sound drives people to madness. It starts soft, then grows louder only they can hear it.' },
      { id: 'T072', title: 'The Night Shift', client: 'Frank Butler', genre: 'horror', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A security guard at a morgue realizes the bodies are moving when he\'s not looking.' },
      { id: 'T073', title: 'Family Photos', client: 'Claire Dixon', genre: 'horror', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'Old family photos show an extra person in the background. Someone who died before the photos were taken.' },
      { id: 'T074', title: 'The Mask Shop', client: 'Norman Blake', genre: 'horror', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'Masks from a peculiar shop become impossible to remove, slowly fusing with the wearer\'s face.' },
      { id: 'T075', title: 'Water\'s Edge', client: 'Evelyn Snow', genre: 'horror', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A lakeside cabin hides something beneath the water that calls to visitors in their sleep.' },

      // Drama (15 tasks)
      { id: 'T076', title: 'The Choice', client: 'Robert Taylor', genre: 'drama', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'A dramatic story about a woman facing a life-changing decision that affects her entire family. Focus on character development.' },
      { id: 'T077', title: 'Broken Promises', client: 'Margaret Foster', genre: 'drama', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'Two siblings reunite after 15 years to settle their late father\'s estate and unresolved conflicts.' },
      { id: 'T078', title: 'The Last Performance', client: 'William Grant', genre: 'drama', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'An aging actor prepares for his final stage performance while dealing with memory loss.' },
      { id: 'T079', title: 'Crossroads', client: 'Samantha Price', genre: 'drama', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'Four strangers\' lives intersect at a critical moment, changing each of them forever.' },
      { id: 'T080', title: 'The Letter', client: 'Charles Morgan', genre: 'drama', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'A discovered letter reveals a family secret that was buried for three generations.' },
      { id: 'T081', title: 'Silent Witness', client: 'Helen Carter', genre: 'drama', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A teacher discovers one of her students is being abused and must decide whether to intervene.' },
      { id: 'T082', title: 'The Immigrant', client: 'Rashid Ahmed', genre: 'drama', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A refugee navigates life in a new country while holding onto memories of home.' },
      { id: 'T083', title: 'Second Act', client: 'Patricia Wells', genre: 'drama', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'After losing everything, a middle-aged woman rebuilds her life from scratch.' },
      { id: 'T084', title: 'The Verdict', client: 'Judge Harrison', genre: 'drama', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'A jury member questions their decision after a guilty verdict is delivered.' },
      { id: 'T085', title: 'Mother\'s Day', client: 'Carol Hughes', genre: 'drama', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'Three daughters with different lives return home for Mother\'s Day, confronting old wounds.' },
      { id: 'T086', title: 'The Studio', client: 'Vincent Perry', genre: 'drama', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'An art studio becomes the setting for reconciliation between estranged creative partners.' },
      { id: 'T087', title: 'Echoes of War', client: 'Colonel Matthews', genre: 'drama', wordCount: 2750, pages: 11, payment: 22, deadline: '6 days', description: 'A war veteran struggles to reconnect with family while battling invisible wounds.' },
      { id: 'T088', title: 'The Confession', client: 'Father O\'Brien', genre: 'drama', wordCount: 2250, pages: 9, payment: 18, deadline: '5 days', description: 'A priest hears a confession that challenges everything he believes about forgiveness.' },
      { id: 'T089', title: 'Curtain Call', client: 'Diana Russell', genre: 'drama', wordCount: 2000, pages: 8, payment: 16, deadline: '4 days', description: 'A Broadway understudy gets her chance to shine when the lead actress mysteriously disappears.' },
      { id: 'T090', title: 'The Bridge', client: 'Thomas Ward', genre: 'drama', wordCount: 2500, pages: 10, payment: 20, deadline: '5 days', description: 'A man stands on a bridge contemplating his life when a stranger stops to talk.' }
    ];

    // Initialize
    function init() {
      loadUserData();
      setupEventListeners();
      renderTasks();
      updateUI();

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            document.getElementById('siteTitle').textContent = config.site_title || defaultConfig.site_title;
            document.getElementById('taglineText').textContent = config.tagline || defaultConfig.tagline;
          },
          mapToCapabilities: () => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['site_title', cfg.site_title || defaultConfig.site_title],
            ['tagline', cfg.tagline || defaultConfig.tagline]
          ])
        });
      }
    }

    function loadUserData() {
      const stored = localStorage.getItem('creativepay_user');
      if (stored) {
        currentUser = JSON.parse(stored);
        document.getElementById('userAvatar').classList.remove('hidden');
        document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
      }
    }

    function saveUserData() {
      if (currentUser) {
        localStorage.setItem('creativepay_user', JSON.stringify(currentUser));
      }
    }

    function setupEventListeners() {
      document.getElementById('menuBtn').addEventListener('click', openMenu);
      document.getElementById('declarationCheck').addEventListener('change', (e) => {
        document.getElementById('declarationBtn').disabled = !e.target.checked;
      });
      document.getElementById('paymentMethod').addEventListener('change', (e) => {
        document.getElementById('mpesaFields').classList.add('hidden');
        document.getElementById('bankFields').classList.add('hidden');
        document.getElementById('paypalFields').classList.add('hidden');
        if (e.target.value === 'mpesa') document.getElementById('mpesaFields').classList.remove('hidden');
        if (e.target.value === 'bank') document.getElementById('bankFields').classList.remove('hidden');
        if (e.target.value === 'paypal') document.getElementById('paypalFields').classList.remove('hidden');
      });
      document.getElementById('withdrawCurrency').addEventListener('change', updateConvertedAmount);
      document.getElementById('withdrawAmount').addEventListener('input', updateConvertedAmount);
    }

    function openMenu() {
      document.getElementById('menuOverlay').classList.remove('hidden');
      document.getElementById('sideMenu').classList.add('open');
    }

    function closeMenu() {
      document.getElementById('menuOverlay').classList.add('hidden');
      document.getElementById('sideMenu').classList.remove('open');
    }

    function openModal(id) {
      document.getElementById(id).classList.add('active');
      if (id === 'withdrawModal') {
        const balance = currentUser?.balance || 0;
        document.getElementById('withdrawAvailable').textContent = `$${balance.toFixed(2)}`;
      }
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      document.getElementById('toastMessage').textContent = message;
      toast.classList.remove('translate-y-20', 'opacity-0');
      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 3000);
    }

    function navigateTo(page) {
      document.getElementById('landingPage').classList.add('hidden');
      document.getElementById('dashboardPage').classList.add('hidden');
      document.getElementById('tasksPage').classList.add('hidden');
      document.getElementById('earningsPage').classList.add('hidden');

      if (!currentUser && page !== 'home') {
        openModal('loginModal');
        return;
      }

      switch(page) {
        case 'home':
          if (currentUser) {
            document.getElementById('dashboardPage').classList.remove('hidden');
          } else {
            document.getElementById('landingPage').classList.remove('hidden');
          }
          break;
        case 'dashboard':
          document.getElementById('dashboardPage').classList.remove('hidden');
          break;
        case 'tasks':
          document.getElementById('tasksPage').classList.remove('hidden');
          break;
        case 'earnings':
          document.getElementById('earningsPage').classList.remove('hidden');
          updateEarningsPage();
          break;
        default:
          document.getElementById('landingPage').classList.remove('hidden');
      }
      updateUI();
    }

    function updateUI() {
      if (currentUser) {
        const balance = currentUser.balance || 0;
        const displayBalance = currency === 'USD' ? `$${balance.toFixed(2)}` : `KES ${(balance * USD_TO_KES).toFixed(2)}`;
        document.getElementById('balanceDisplay').textContent = displayBalance;
        document.getElementById('tasksCompleted').textContent = currentUser.tasksCompleted || 0;
        document.getElementById('wordsWritten').textContent = (currentUser.wordsWritten || 0).toLocaleString();
        document.getElementById('pendingTasks').textContent = (currentUser.pendingTasks || []).length;
        document.getElementById('avgRating').textContent = currentUser.rating ? currentUser.rating.toFixed(1) : '-';
        renderActivityList();
      }
    }

    function setCurrency(curr) {
      currency = curr;
      document.getElementById('usdBtn').classList.toggle('bg-white', curr === 'USD');
      document.getElementById('usdBtn').classList.toggle('text-emerald-600', curr === 'USD');
      document.getElementById('usdBtn').classList.toggle('text-white', curr !== 'USD');
      document.getElementById('kesBtn').classList.toggle('bg-white', curr === 'KES');
      document.getElementById('kesBtn').classList.toggle('text-emerald-600', curr === 'KES');
      document.getElementById('kesBtn').classList.toggle('text-white', curr !== 'KES');
      updateUI();
    }

    function renderTasks() {
      const container = document.getElementById('tasksList');
      const filter = document.getElementById('genreFilter').value;
      const filteredTasks = filter === 'all' ? sampleTasks : sampleTasks.filter(t => t.genre === filter);

      container.innerHTML = filteredTasks.map(task => `
        <div class="task-card p-6 rounded-2xl card-hover cursor-pointer" onclick="viewTaskDetails('${task.id}')">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="px-3 py-1 text-xs font-medium rounded-full ${getGenreColor(task.genre)}">${task.genre.charAt(0).toUpperCase() + task.genre.slice(1)}</span>
                <span class="text-gray-400 text-sm">ID: ${task.id}</span>
              </div>
              <h3 class="text-lg font-bold text-gray-800 mb-1">${task.title}</h3>
              <p class="text-gray-600 text-sm mb-2">Client: ${task.client}</p>
              <div class="flex flex-wrap gap-4 text-sm text-gray-500">
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                  ${task.wordCount.toLocaleString()} words (${task.pages} pages)
                </span>
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  ${task.deadline}
                </span>
              </div>
            </div>
            <div class="flex items-center gap-4">
              <div class="text-right">
                <div class="text-2xl font-bold text-emerald-600">$${task.payment.toFixed(2)}</div>
                <div class="text-xs text-gray-500">$2/page</div>
              </div>
              <button onclick="event.stopPropagation(); viewTaskDetails('${task.id}')" class="px-4 py-2 bg-emerald-600 text-white font-medium rounded-xl hover:bg-emerald-700 transition-colors">
                View Details
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function filterTasks() {
      renderTasks();
    }

    function getGenreColor(genre) {
      const colors = {
        romance: 'bg-pink-100 text-pink-700',
        mystery: 'bg-purple-100 text-purple-700',
        fantasy: 'bg-blue-100 text-blue-700',
        scifi: 'bg-cyan-100 text-cyan-700',
        horror: 'bg-red-100 text-red-700',
        drama: 'bg-amber-100 text-amber-700'
      };
      return colors[genre] || 'bg-gray-100 text-gray-700';
    }

    function viewTaskDetails(taskId) {
      if (!currentUser) {
        openModal('loginModal');
        return;
      }
      currentTask = sampleTasks.find(t => t.id === taskId);
      if (currentTask) {
        const content = document.getElementById('taskDetailsContent');
        content.innerHTML = `
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-xs text-gray-500 uppercase">Task ID</label>
                <p class="font-semibold text-gray-800">${currentTask.id}</p>
              </div>
              <div>
                <label class="text-xs text-gray-500 uppercase">Genre</label>
                <p class="font-semibold text-gray-800">${currentTask.genre.charAt(0).toUpperCase() + currentTask.genre.slice(1)}</p>
              </div>
            </div>
            <div>
              <label class="text-xs text-gray-500 uppercase">Story Title</label>
              <p class="text-xl font-bold text-gray-800">${currentTask.title}</p>
            </div>
            <div>
              <label class="text-xs text-gray-500 uppercase">Client</label>
              <p class="font-semibold text-gray-800">${currentTask.client}</p>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-xs text-gray-500 uppercase">Word Count</label>
                <p class="font-semibold text-gray-800">${currentTask.wordCount.toLocaleString()} words</p>
              </div>
              <div>
                <label class="text-xs text-gray-500 uppercase">Pages</label>
                <p class="font-semibold text-gray-800">${currentTask.pages} pages</p>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-xs text-gray-500 uppercase">Payment</label>
                <p class="text-xl font-bold text-emerald-600">$${currentTask.payment.toFixed(2)}</p>
              </div>
              <div>
                <label class="text-xs text-gray-500 uppercase">Deadline</label>
                <p class="font-semibold text-gray-800">${currentTask.deadline}</p>
              </div>
            </div>
            <div>
              <label class="text-xs text-gray-500 uppercase">Description</label>
              <p class="text-gray-700 leading-relaxed">${currentTask.description}</p>
            </div>
          </div>
        `;
        openModal('taskDetailsModal');
      }
    }

    function downloadTaskPDF() {
      if (!currentTask) return;
      const content = `
CREATIVEPAY - WRITING TASK BRIEF
================================

Task ID: ${currentTask.id}
Title: ${currentTask.title}
Client: ${currentTask.client}
Genre: ${currentTask.genre.charAt(0).toUpperCase() + currentTask.genre.slice(1)}

Word Count: ${currentTask.wordCount.toLocaleString()} words
Pages: ${currentTask.pages}
Deadline: ${currentTask.deadline}
Payment: $${currentTask.payment.toFixed(2)} ($2 per page)

DESCRIPTION:
${currentTask.description}

================================
Generated by CreativePay
      `;
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `CreativePay_Task_${currentTask.id}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Task brief downloaded!');
    }

    function acceptTask() {
      if (!currentUser || !currentTask) return;
      
      // Check if user has free tasks or is subscribed
      if (!currentUser.subscribed && currentUser.freeTasksRemaining <= 0) {
        closeModal('taskDetailsModal');
        showSubscriptionRequired();
        return;
      }
      
      if (!currentUser.pendingTasks) currentUser.pendingTasks = [];
      if (currentUser.pendingTasks.find(t => t.id === currentTask.id)) {
        showToast('You already accepted this task!');
        return;
      }
      currentUser.pendingTasks.push({ ...currentTask, acceptedAt: new Date().toISOString() });
      if (!currentUser.activity) currentUser.activity = [];
      currentUser.activity.unshift({
        type: 'task_accepted',
        title: currentTask.title,
        time: new Date().toISOString(),
        amount: currentTask.payment
      });
      saveUserData();
      closeModal('taskDetailsModal');
      showToast('Task accepted! Check your dashboard.');
      updateUI();
    }

    function renderActivityList() {
      const container = document.getElementById('activityList');
      if (!currentUser || !currentUser.activity || currentUser.activity.length === 0) {
        container.innerHTML = `
          <div class="p-6 text-center text-gray-500">
            <svg class="w-12 h-12 mx-auto text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
            <p>No activity yet. Start writing to see your progress!</p>
          </div>
        `;
        return;
      }
      container.innerHTML = currentUser.activity.slice(0, 10).map(item => {
        const icon = getActivityIcon(item.type);
        const color = getActivityColor(item.type);
        const timeAgo = getTimeAgo(item.time);
        return `
          <div class="p-4 flex items-center gap-4 hover:bg-gray-50 transition-colors">
            <div class="w-10 h-10 rounded-xl ${color} flex items-center justify-center flex-shrink-0">
              ${icon}
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-medium text-gray-800 truncate">${getActivityTitle(item)}</p>
              <p class="text-sm text-gray-500">${timeAgo}</p>
            </div>
            <div class="text-right">
              <span class="font-semibold ${item.type === 'withdrawal' ? 'text-red-600' : 'text-emerald-600'}">
                ${item.type === 'withdrawal' ? '-' : '+'}$${item.amount.toFixed(2)}
              </span>
            </div>
          </div>
        `;
      }).join('');
    }

    function getActivityIcon(type) {
      const icons = {
        task_accepted: '<svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>',
        task_submitted: '<svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
        task_approved: '<svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>',
        earnings_added: '<svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
        withdrawal: '<svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>',
        welcome_bonus: '<svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/></svg>'
      };
      return icons[type] || icons.task_accepted;
    }

    function getActivityColor(type) {
      const colors = {
        task_accepted: 'bg-blue-100',
        task_submitted: 'bg-purple-100',
        task_approved: 'bg-emerald-100',
        earnings_added: 'bg-green-100',
        withdrawal: 'bg-red-100',
        welcome_bonus: 'bg-yellow-100'
      };
      return colors[type] || 'bg-gray-100';
    }

    function getActivityTitle(item) {
      const titles = {
        task_accepted: `Task accepted: ${item.title}`,
        task_submitted: `Story submitted: ${item.title}`,
        task_approved: `Task approved: ${item.title}`,
        earnings_added: `Earnings added`,
        withdrawal: `Withdrawal processed`,
        welcome_bonus: `Welcome bonus received`
      };
      return titles[item.type] || 'Activity';
    }

    function getTimeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const seconds = Math.floor((now - date) / 1000);
      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return `${Math.floor(seconds / 60)} min ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
      return `${Math.floor(seconds / 86400)} days ago`;
    }

    function updateConvertedAmount() {
      const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
      const curr = document.getElementById('withdrawCurrency').value;
      const display = document.getElementById('convertedAmount');
      if (curr === 'KES' && amount > 0) {
        display.textContent = `You will receive: KES ${(amount * USD_TO_KES).toFixed(2)}`;
      } else {
        display.textContent = '';
      }
    }

    function updateEarningsPage() {
      if (!currentUser) return;
      const totalEarned = currentUser.totalEarned || 0;
      const totalWithdrawn = currentUser.totalWithdrawn || 0;
      const balance = currentUser.balance || 0;
      document.getElementById('totalEarned').textContent = `$${totalEarned.toFixed(2)}`;
      document.getElementById('totalWithdrawn').textContent = `$${totalWithdrawn.toFixed(2)}`;
      document.getElementById('availableBalance').textContent = `$${balance.toFixed(2)}`;

      const container = document.getElementById('transactionsList');
      if (!currentUser.transactions || currentUser.transactions.length === 0) {
        container.innerHTML = '<div class="p-6 text-center text-gray-500"><p>No transactions yet.</p></div>';
        return;
      }
      container.innerHTML = currentUser.transactions.map(t => {
        const isProcessing = t.status === 'processing';
        const isPaid = t.status === 'paid';
        const statusColor = isProcessing ? 'text-amber-600' : isPaid ? 'text-green-600' : '';
        const statusBadge = t.status ? `<span class="text-xs px-2 py-1 rounded-full ${isProcessing ? 'bg-amber-100 text-amber-700' : 'bg-green-100 text-green-700'}">${isProcessing ? 'Processing' : 'Paid'}</span>` : '';
        
        return `
        <div class="p-4 hover:bg-gray-50 transition-colors">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-1">
                <p class="font-medium text-gray-800">${t.description}</p>
                ${statusBadge}
              </div>
              ${t.transactionKey ? `<p class="text-xs text-gray-500 mb-1">Transaction Key: ${t.transactionKey}</p>` : ''}
              ${t.accountDetails ? `<p class="text-xs text-gray-500 mb-1">Account: ${t.accountDetails}</p>` : ''}
              ${t.platformFee ? `<p class="text-xs text-gray-500">Gross: $${t.amount.toFixed(2)} | Platform Fee (1%): $${t.platformFee.toFixed(2)} | Transaction Fee (5%): $${t.transactionFee.toFixed(2)} | VAT (5%): $${t.vat.toFixed(2)}</p>` : ''}
              ${t.netAmount ? `<p class="text-xs text-emerald-600 font-medium">Net Amount: $${t.netAmount.toFixed(2)}</p>` : ''}
              ${t.currency && t.convertedAmount ? `<p class="text-xs text-gray-500 mb-1">${t.currency}: ${t.currency === 'KES' ? 'KES ' + t.convertedAmount.toFixed(2) : '$' + t.convertedAmount.toFixed(2)}</p>` : ''}
              <p class="text-xs text-gray-400">${new Date(t.date).toLocaleString()}</p>
              ${isPaid && t.paidAt ? `<p class="text-xs text-green-600 mt-1">â Paid on ${new Date(t.paidAt).toLocaleString()}</p>` : ''}
              ${isProcessing ? `<p class="text-xs text-amber-600 mt-1 flex items-center gap-1"><span class="inline-block w-1.5 h-1.5 bg-amber-600 rounded-full animate-pulse"></span>Confirm with finance team for updates</p>` : ''}
            </div>
            <span class="font-semibold ${t.type === 'credit' ? 'text-emerald-600' : 'text-red-600'} ml-4">
              ${t.type === 'credit' ? '+' : '-'}$${t.amount.toFixed(2)}
            </span>
          </div>
        </div>
      `;
      }).join('');
    }

    // Form Handlers with Web3Forms
    async function sendToWeb3Forms(formType, data) {
      const payload = {
        access_key: WEB3FORMS_KEY,
        subject: `CreativePay - ${formType}`,
        from_name: 'CreativePay Platform',
        to: EMAIL_TO,
        ...data
      };

      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        return response.ok;
      } catch (error) {
        console.error('Web3Forms error:', error);
        return false;
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const btn = document.getElementById('registerBtn');
      const errorEl = document.getElementById('registerError');
      const successEl = document.getElementById('registerSuccess');
      const password = document.getElementById('regPassword').value;
      const confirmPassword = document.getElementById('regConfirmPassword').value;

      errorEl.classList.add('hidden');
      successEl.classList.add('hidden');

      if (password !== confirmPassword) {
        errorEl.textContent = 'Passwords do not match';
        errorEl.classList.remove('hidden');
        return;
      }

      btn.textContent = 'Creating account...';
      btn.disabled = true;

      const userData = {
        name: document.getElementById('regName').value,
        email: document.getElementById('regEmail').value,
        phone: document.getElementById('regPhone').value,
        password: password,
        registeredAt: new Date().toISOString()
      };

      // Always save to localStorage first
      currentUser = {
        ...userData,
        balance: 0,
        totalEarned: 0,
        totalWithdrawn: 0,
        tasksCompleted: 0,
        wordsWritten: 0,
        pendingTasks: [],
        activity: [],
        transactions: [],
        verified: false,
        freeTasksRemaining: 1,
        subscribed: false,
        nextFreeTaskDate: null
      };
      saveUserData();

      // Send to Web3Forms (don't block on this)
      sendToWeb3Forms('New Registration', userData).catch(err => console.error('Email send failed:', err));

      successEl.textContent = 'Account created successfully!';
      successEl.classList.remove('hidden');
      setTimeout(() => {
        closeModal('registerModal');
        openModal('declarationModal');
      }, 1500);

      btn.textContent = 'Create Account';
      btn.disabled = false;
    }

    function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const errorEl = document.getElementById('loginError');

      errorEl.classList.add('hidden');

      const stored = localStorage.getItem('creativepay_user');
      if (stored) {
        const user = JSON.parse(stored);
        if (user.email === email && user.password === password) {
          currentUser = user;
          document.getElementById('userAvatar').classList.remove('hidden');
          document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
          closeModal('loginModal');
          navigateTo('dashboard');
          showToast(`Welcome back, ${currentUser.name}!`);
          return;
        }
      }

      errorEl.textContent = 'Invalid email or password';
      errorEl.classList.remove('hidden');
    }

    function acceptDeclaration() {
      closeModal('declarationModal');
      openModal('paymentSetupModal');
    }

    async function handlePaymentSetup(e) {
      e.preventDefault();
      const btn = document.getElementById('paymentSetupBtn');
      const errorEl = document.getElementById('paymentSetupError');
      const successEl = document.getElementById('paymentSetupSuccess');
      const method = document.getElementById('paymentMethod').value;

      errorEl.classList.add('hidden');
      successEl.classList.add('hidden');

      btn.textContent = 'Saving...';
      btn.disabled = true;

      let paymentData = {
        user_email: currentUser.email,
        user_name: currentUser.name,
        payment_method: method
      };

      if (method === 'mpesa') {
        paymentData.mpesa_phone = document.getElementById('mpesaPhone').value;
      } else if (method === 'bank') {
        paymentData.bank_name = document.getElementById('bankName').value;
        paymentData.account_number = document.getElementById('accountNumber').value;
        paymentData.account_name = document.getElementById('accountName').value;
      } else if (method === 'paypal') {
        paymentData.paypal_email = document.getElementById('paypalEmail').value;
      }

      const sent = await sendToWeb3Forms('Payment Setup', paymentData);

      if (sent) {
        currentUser.paymentMethod = paymentData;
        saveUserData();
        successEl.textContent = 'Payment details saved!';
        successEl.classList.remove('hidden');
        setTimeout(() => {
          closeModal('paymentSetupModal');
          document.getElementById('userAvatar').classList.remove('hidden');
          document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
          openModal('freeTaskModal');
        }, 1500);
      } else {
        errorEl.textContent = 'Failed to save. Please try again.';
        errorEl.classList.remove('hidden');
      }

      btn.textContent = 'Save Payment Details';
      btn.disabled = false;
    }

    async function handleWithdraw(e) {
      e.preventDefault();
      const errorEl = document.getElementById('withdrawError');
      const amount = parseFloat(document.getElementById('withdrawAmount').value);
      const currency = document.getElementById('withdrawCurrency').value;

      errorEl.classList.add('hidden');

      if (amount > currentUser.balance) {
        errorEl.textContent = 'Insufficient balance';
        errorEl.classList.remove('hidden');
        return;
      }

      if (!currentUser.paymentMethod) {
        errorEl.textContent = 'Please set up your payment method first';
        errorEl.classList.remove('hidden');
        return;
      }

      // Show confirmation modal with details
      showWithdrawalConfirmation(amount, currency);
    }

    function showWithdrawalConfirmation(amount, currency) {
      const convertedAmount = currency === 'KES' ? amount * USD_TO_KES : amount;
      
      document.getElementById('confirmAmount').textContent = `$${amount.toFixed(2)}`;
      document.getElementById('confirmAmountConverted').textContent = currency === 'KES' ? `KES ${convertedAmount.toFixed(2)}` : '';
      
      const method = currentUser.paymentMethod.payment_method;
      document.getElementById('confirmMethod').textContent = method.toUpperCase();
      
      const infoContainer = document.getElementById('confirmPaymentInfo');
      let infoHTML = '';
      
      if (method === 'mpesa') {
        infoHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">Phone Number:</span>
            <span class="font-semibold text-gray-800">${currentUser.paymentMethod.mpesa_phone}</span>
          </div>
        `;
      } else if (method === 'bank') {
        infoHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">Bank:</span>
            <span class="font-semibold text-gray-800">${currentUser.paymentMethod.bank_name}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Account:</span>
            <span class="font-semibold text-gray-800">${currentUser.paymentMethod.account_number}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Name:</span>
            <span class="font-semibold text-gray-800">${currentUser.paymentMethod.account_name}</span>
          </div>
        `;
      } else if (method === 'paypal') {
        infoHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">PayPal Email:</span>
            <span class="font-semibold text-gray-800">${currentUser.paymentMethod.paypal_email}</span>
          </div>
        `;
      }
      
      infoContainer.innerHTML = infoHTML;
      
      // Store withdrawal data for processing
      window.pendingWithdrawal = {
        amount,
        currency,
        convertedAmount,
        method,
        paymentDetails: currentUser.paymentMethod
      };
      
      closeModal('withdrawModal');
      openModal('withdrawConfirmModal');
    }

    async function processWithdrawal() {
      if (!window.pendingWithdrawal) return;
      
      const { amount, currency, convertedAmount, method, paymentDetails } = window.pendingWithdrawal;
      
      // Calculate fees
      const platformFee = amount * 0.01; // 1%
      const transactionFee = amount * 0.05; // 5%
      const vat = amount * 0.05; // 5%
      const totalFees = platformFee + transactionFee + vat;
      const netAmount = amount - totalFees;
      const netConverted = currency === 'KES' ? netAmount * USD_TO_KES : netAmount;
      
      closeModal('withdrawConfirmModal');
      openModal('withdrawProcessingModal');
      
      // Play audio during withdrawal
      playProcessAudio();
      
      // Generate unique transaction key
      const transactionKey = 'TXN' + Date.now() + Math.random().toString(36).substring(2, 9).toUpperCase();
      
      const steps = [
        { text: 'Verifying your account...', duration: 2000, progress: 15 },
        { text: 'Authenticating account...', duration: 2000, progress: 30 },
        { text: 'Linking account to our payment ATMs...', duration: 2500, progress: 45 },
        { text: 'Parsing account details on our servers...', duration: 2000, progress: 60 },
        { text: 'Generating transaction key...', duration: 1500, progress: 70 },
        { text: `Transaction key is ${transactionKey}`, duration: 2000, progress: 80 },
        { text: 'Inputting it to our server...', duration: 2000, progress: 90 },
        { text: 'Initiating withdrawal...', duration: 2000, progress: 95 },
        { text: 'Success!', duration: 1000, progress: 100 }
      ];
      
      for (const step of steps) {
        document.getElementById('withdrawStatusText').textContent = step.text;
        await animateWithdrawProgress(step.progress);
        await new Promise(resolve => setTimeout(resolve, step.duration));
      }
      
      // Update user balance and add transaction (deduct gross amount)
      currentUser.balance -= amount;
      currentUser.totalWithdrawn += amount;
      
      const transactionId = 'W' + Date.now();
      const accountDetails = getAccountDetailsString(method, paymentDetails);
      
      currentUser.activity.unshift({
        type: 'withdrawal',
        title: 'Withdrawal',
        time: new Date().toISOString(),
        amount: amount
      });
      
      currentUser.transactions.unshift({
        id: transactionId,
        type: 'debit',
        description: `Disbursement in progress`,
        amount: amount,
        netAmount: netAmount,
        platformFee: platformFee,
        transactionFee: transactionFee,
        vat: vat,
        currency: currency,
        convertedAmount: netConverted,
        date: new Date().toISOString(),
        status: 'processing',
        accountDetails: accountDetails,
        transactionKey: transactionKey
      });
      
      saveUserData();
      
      // Send to Web3Forms
      const withdrawData = {
        user_email: currentUser.email,
        user_name: currentUser.name,
        amount_usd: amount,
        currency: currency,
        amount_received: convertedAmount,
        payment_method: method,
        account_details: accountDetails,
        transaction_key: transactionKey
      };
      sendToWeb3Forms('Withdrawal Request', withdrawData).catch(err => console.error('Email send failed:', err));
      
      // Schedule status update after 2 minutes
      setTimeout(() => {
        updateWithdrawalToPaid(transactionId, accountDetails);
      }, 120000); // 2 minutes
      
      // Stop audio
      stopProcessAudio();
      
      closeModal('withdrawProcessingModal');
      updateUI();
      showToast('Withdrawal initiated successfully!');
      
      // Clear pending withdrawal
      window.pendingWithdrawal = null;
    }

    function getAccountDetailsString(method, paymentDetails) {
      if (method === 'mpesa') {
        return paymentDetails.mpesa_phone;
      } else if (method === 'bank') {
        return `${paymentDetails.bank_name} - ${paymentDetails.account_number}`;
      } else if (method === 'paypal') {
        return paymentDetails.paypal_email;
      }
      return 'N/A';
    }

    function updateWithdrawalToPaid(transactionId, accountDetails) {
      if (!currentUser || !currentUser.transactions) return;
      
      const transaction = currentUser.transactions.find(t => t.id === transactionId);
      if (transaction && transaction.status === 'processing') {
        transaction.status = 'paid';
        transaction.description = `Paid successfully to ${accountDetails}`;
        transaction.paidAt = new Date().toISOString();
        saveUserData();
        updateEarningsPage();
        
        // Show notification if user is still on the page
        showToast(`Withdrawal of $${transaction.amount.toFixed(2)} paid successfully!`);
      }
    }

    async function animateWithdrawProgress(targetProgress) {
      const circle = document.getElementById('withdrawProgressCircle');
      const percentEl = document.getElementById('withdrawProgressPercent');
      const circumference = 339.292;
      
      const currentProgress = parseInt(percentEl.textContent) || 0;
      const steps = 20;
      const increment = (targetProgress - currentProgress) / steps;
      
      for (let i = 0; i <= steps; i++) {
        const progress = currentProgress + (increment * i);
        const offset = circumference - (progress / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        percentEl.textContent = `${Math.round(progress)}%`;
        await new Promise(resolve => setTimeout(resolve, 50));
      }
    }

    async function handleSupport(e) {
      e.preventDefault();
      const btn = document.getElementById('supportBtn');
      const errorEl = document.getElementById('supportError');
      const successEl = document.getElementById('supportSuccess');

      errorEl.classList.add('hidden');
      successEl.classList.add('hidden');
      btn.textContent = 'Sending...';
      btn.disabled = true;

      const supportData = {
        user_email: currentUser?.email || 'Guest',
        user_name: currentUser?.name || 'Guest',
        subject: document.getElementById('supportSubject').value,
        message: document.getElementById('supportMessage').value
      };

      const sent = await sendToWeb3Forms('Support Request', supportData);

      if (sent) {
        successEl.textContent = 'Message sent! We\'ll respond soon.';
        successEl.classList.remove('hidden');
        document.getElementById('supportForm').reset();
        setTimeout(() => closeModal('supportModal'), 2000);
      } else {
        errorEl.textContent = 'Failed to send. Please try again.';
        errorEl.classList.remove('hidden');
      }

      btn.textContent = 'Send Message';
      btn.disabled = false;
    }

    async function handleRefund(e) {
      e.preventDefault();
      const btn = document.getElementById('refundBtn');
      const errorEl = document.getElementById('refundError');
      const successEl = document.getElementById('refundSuccess');

      errorEl.classList.add('hidden');
      successEl.classList.add('hidden');
      btn.textContent = 'Submitting...';
      btn.disabled = true;

      const refundData = {
        user_email: currentUser?.email || 'Guest',
        user_name: currentUser?.name || 'Guest',
        task_id: document.getElementById('refundTaskId').value,
        reason: document.getElementById('refundReason').value
      };

      const sent = await sendToWeb3Forms('Refund Request', refundData);

      if (sent) {
        successEl.textContent = 'Refund request submitted!';
        successEl.classList.remove('hidden');
        document.getElementById('refundForm').reset();
        setTimeout(() => closeModal('refundModal'), 2000);
      } else {
        errorEl.textContent = 'Failed to submit. Please try again.';
        errorEl.classList.remove('hidden');
      }

      btn.textContent = 'Submit Refund Request';
      btn.disabled = false;
    }

    async function handleVerification(e) {
      e.preventDefault();
      const btn = document.getElementById('verificationBtn');
      const errorEl = document.getElementById('verificationError');
      const successEl = document.getElementById('verificationSuccess');

      errorEl.classList.add('hidden');
      successEl.classList.add('hidden');
      btn.textContent = 'Submitting...';
      btn.disabled = true;

      const verificationData = {
        user_email: currentUser?.email,
        user_name: currentUser?.name,
        id_type: document.getElementById('idType').value,
        id_number: document.getElementById('idNumber').value
      };

      const sent = await sendToWeb3Forms('Verification Request', verificationData);

      if (sent) {
        currentUser.verificationPending = true;
        saveUserData();
        successEl.textContent = 'Verification submitted! We\'ll review within 24hrs.';
        successEl.classList.remove('hidden');
        setTimeout(() => closeModal('verificationModal'), 2000);
      } else {
        errorEl.textContent = 'Failed to submit. Please try again.';
        errorEl.classList.remove('hidden');
      }

      btn.textContent = 'Submit Verification';
      btn.disabled = false;
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem('creativepay_user');
      document.getElementById('userAvatar').classList.add('hidden');
      navigateTo('home');
      showToast('Logged out successfully');
    }

    // Submit Work Functions
    let selectedFile = null;
    let submissionTask = null;

    function switchSubmissionTab(tab) {
      const pasteTab = document.getElementById('pasteTab');
      const uploadTab = document.getElementById('uploadTab');
      const pasteSection = document.getElementById('pasteSection');
      const uploadSection = document.getElementById('uploadSection');

      if (tab === 'paste') {
        pasteTab.classList.add('text-emerald-600', 'border-b-2', 'border-emerald-600');
        pasteTab.classList.remove('text-gray-500');
        uploadTab.classList.remove('text-emerald-600', 'border-b-2', 'border-emerald-600');
        uploadTab.classList.add('text-gray-500');
        pasteSection.classList.remove('hidden');
        uploadSection.classList.add('hidden');
        document.getElementById('workContent').required = true;
        document.getElementById('workFile').required = false;
      } else {
        uploadTab.classList.add('text-emerald-600', 'border-b-2', 'border-emerald-600');
        uploadTab.classList.remove('text-gray-500');
        pasteTab.classList.remove('text-emerald-600', 'border-b-2', 'border-emerald-600');
        pasteTab.classList.add('text-gray-500');
        uploadSection.classList.remove('hidden');
        pasteSection.classList.add('hidden');
        document.getElementById('workContent').required = false;
        document.getElementById('workFile').required = true;
      }
    }

    document.getElementById('taskSelect').addEventListener('change', function() {
      const taskId = this.value;
      if (taskId && currentUser && currentUser.pendingTasks) {
        const task = currentUser.pendingTasks.find(t => t.id === taskId);
        if (task) {
          submissionTask = task;
          document.getElementById('infoClient').textContent = task.client;
          document.getElementById('infoWords').textContent = `${task.wordCount} words`;
          document.getElementById('infoPayment').textContent = `$${task.payment.toFixed(2)}`;
          document.getElementById('infoPaymentKES').textContent = `KES ${(task.payment * USD_TO_KES).toFixed(2)}`;
          document.getElementById('selectedTaskInfo').classList.remove('hidden');
        }
      } else {
        document.getElementById('selectedTaskInfo').classList.add('hidden');
        submissionTask = null;
      }
    });

    document.getElementById('workContent').addEventListener('input', function() {
      const text = this.value.trim();
      const words = text ? text.split(/\s+/).length : 0;
      document.getElementById('wordCount').textContent = `${words} words`;

      if (submissionTask) {
        const expected = submissionTask.wordCount;
        const diff = Math.abs(words - expected);
        const percent = (diff / expected) * 100;
        
        if (words === 0) {
          document.getElementById('wordCountStatus').textContent = '';
        } else if (percent <= 10) {
          document.getElementById('wordCountStatus').textContent = 'â Perfect length';
          document.getElementById('wordCountStatus').className = 'text-sm text-green-600';
        } else if (percent <= 20) {
          document.getElementById('wordCountStatus').textContent = '~ Close enough';
          document.getElementById('wordCountStatus').className = 'text-sm text-amber-600';
        } else {
          document.getElementById('wordCountStatus').textContent = `â  Expected ${expected} words`;
          document.getElementById('wordCountStatus').className = 'text-sm text-red-600';
        }
      }
    });

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        selectedFile = file;
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileInfo').classList.remove('hidden');
      }
    }

    function removeFile() {
      selectedFile = null;
      document.getElementById('workFile').value = '';
      document.getElementById('fileInfo').classList.add('hidden');
    }

    async function handleWorkSubmission(e) {
      e.preventDefault();
      
      if (!currentUser || !submissionTask) {
        document.getElementById('submitWorkError').textContent = 'Please select a task first';
        document.getElementById('submitWorkError').classList.remove('hidden');
        return;
      }

      const activeTab = document.getElementById('pasteTab').classList.contains('border-emerald-600') ? 'paste' : 'upload';
      let wordCount = 0;

      if (activeTab === 'paste') {
        const content = document.getElementById('workContent').value.trim();
        wordCount = content.split(/\s+/).length;
        if (wordCount < 100) {
          document.getElementById('submitWorkError').textContent = 'Content is too short. Minimum 100 words required.';
          document.getElementById('submitWorkError').classList.remove('hidden');
          return;
        }
      } else {
        if (!selectedFile) {
          document.getElementById('submitWorkError').textContent = 'Please upload a file';
          document.getElementById('submitWorkError').classList.remove('hidden');
          return;
        }
        // Simulate word count for uploaded file
        wordCount = submissionTask.wordCount;
      }

      // Close submit modal and open review progress
      closeModal('submitWorkModal');
      await runReviewProcess(wordCount);
    }

    async function runReviewProcess(wordCount) {
      openModal('reviewProgressModal');
      
      // Play audio during review
      playProcessAudio();
      
      const circle = document.getElementById('progressCircle');
      const circumference = 339.292;

      // Phase 1: System Review (0-50%)
      document.getElementById('phaseText').textContent = 'System Review - Checking grammar and plagiarism...';
      await animateProgress(0, 50, 3000);

      // Phase 2: Client Review (50-100%)
      document.getElementById('reviewTitle').textContent = `Dear ${currentUser.name}`;
      document.getElementById('reviewMessage').textContent = `We are forwarding your work to our client ${submissionTask.client} to review your work and pay you accordingly...`;
      document.getElementById('phaseText').textContent = `Forwarding to ${submissionTask.client}...`;
      await new Promise(resolve => setTimeout(resolve, 2000));

      document.getElementById('phaseText').textContent = 'Client is reviewing your work...';
      await animateProgress(50, 100, 4000);

      // Stop audio
      stopProcessAudio();

      // Show results
      closeModal('reviewProgressModal');
      showReviewResults(wordCount);
    }

    async function animateProgress(from, to, duration) {
      const circle = document.getElementById('progressCircle');
      const circumference = 339.292;
      const steps = 50;
      const stepDuration = duration / steps;
      const increment = (to - from) / steps;

      for (let i = 0; i <= steps; i++) {
        const progress = from + (increment * i);
        const offset = circumference - (progress / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        document.getElementById('progressPercent').textContent = `${Math.round(progress)}%`;
        await new Promise(resolve => setTimeout(resolve, stepDuration));
      }
    }

    function showReviewResults(wordCount) {
      // System always gives 50%
      const systemScore = 50;

      // For free task: earnings in KES 10-30
      const isFreeTrial = !currentUser.subscribed && currentUser.freeTasksRemaining > 0;
      let finalPaymentUSD, finalPaymentKES;
      
      // All users get paid KES 10-30 after review (poor quality deduction)
      finalPaymentKES = Math.floor(Math.random() * 21) + 10; // 10-30 KES
      finalPaymentUSD = finalPaymentKES / USD_TO_KES;
      
      if (false) { // Disabled - everyone gets 10-30 KES after review
        // Subscribed users get normal payment
        const clientScorePercent = Math.floor(Math.random() * 21) + 10; // 10-30%
        const basePayment = submissionTask.payment;
        const totalScorePercent = systemScore + clientScorePercent;
        finalPaymentUSD = (basePayment * totalScorePercent) / 100;
        finalPaymentKES = finalPaymentUSD * USD_TO_KES;
      }
      
      const basePayment = submissionTask.payment;
      const deductionUSD = basePayment - finalPaymentUSD;

      // Client feedback messages
      const feedbacks = [
        "The story has potential but contains numerous grammatical errors and lacks proper structure. The narrative flow needs improvement.",
        "Several plot inconsistencies were found. The character development is weak and the pacing is uneven throughout.",
        "The writing shows effort but falls short of professional standards. Multiple spelling errors and awkward phrasing detected.",
        "Story lacks depth and originality. The dialogue feels forced and unnatural. Needs significant revision.",
        "Poor attention to detail. The storyline is confusing and the ending feels rushed. Requires major improvements."
      ];

      const qualityRatings = ["Below Average", "Poor", "Needs Improvement", "Unsatisfactory", "Weak"];
      const clientScorePercent = Math.floor(Math.random() * 21) + 10;

      // Populate results
      document.getElementById('resultWordCount').textContent = `${wordCount} words`;
      document.getElementById('systemScore').textContent = '50%';
      document.getElementById('clientNameResult').textContent = submissionTask.client;
      document.getElementById('clientFeedback').textContent = feedbacks[Math.floor(Math.random() * feedbacks.length)];
      document.getElementById('qualityRating').textContent = qualityRatings[Math.floor(Math.random() * qualityRatings.length)];
      document.getElementById('clientScore').textContent = `${clientScorePercent}%`;
      
      // Show KES earnings prominently
      document.getElementById('finalEarningUSD').textContent = `KES ${finalPaymentKES.toFixed(2)}`;
      document.getElementById('finalEarningKES').textContent = `($${finalPaymentUSD.toFixed(2)} USD)`;
      
      document.getElementById('basePayment').textContent = `$${basePayment.toFixed(2)}`;
      document.getElementById('deduction').textContent = `-$${deductionUSD.toFixed(2)}`;
      document.getElementById('finalPaymentBreakdown').textContent = `KES ${finalPaymentKES.toFixed(2)} ($${finalPaymentUSD.toFixed(2)})`;

      // Update user data
      currentUser.balance += finalPaymentUSD;
      currentUser.totalEarned += finalPaymentUSD;
      currentUser.tasksCompleted = (currentUser.tasksCompleted || 0) + 1;
      currentUser.wordsWritten = (currentUser.wordsWritten || 0) + wordCount;
      
      // Deduct free task if user isn't subscribed
      if (!currentUser.subscribed && currentUser.freeTasksRemaining > 0) {
        currentUser.freeTasksRemaining -= 1;
        // Set next free task date to next month
        const nextMonth = new Date();
        nextMonth.setMonth(nextMonth.getMonth() + 1);
        currentUser.nextFreeTaskDate = nextMonth.toISOString();
      }
      
      // Remove from pending tasks
      currentUser.pendingTasks = currentUser.pendingTasks.filter(t => t.id !== submissionTask.id);

      // Add to activity
      currentUser.activity.unshift({
        type: 'task_approved',
        title: submissionTask.title,
        time: new Date().toISOString(),
        amount: finalPaymentUSD
      });

      // Add transaction
      const wasFreeTrial = !currentUser.subscribed && (currentUser.freeTasksRemaining === 0);
      currentUser.transactions.unshift({
        type: 'credit',
        description: wasFreeTrial ? `Free task completed: ${submissionTask.title}` : `Task completed: ${submissionTask.title}`,
        amount: finalPaymentUSD,
        date: new Date().toISOString()
      });

      saveUserData();
      openModal('reviewResultsModal');
    }

    function closeReviewResults() {
      closeModal('reviewResultsModal');
      
      // Reset form
      document.getElementById('submitWorkForm').reset();
      document.getElementById('selectedTaskInfo').classList.add('hidden');
      document.getElementById('wordCount').textContent = '0 words';
      document.getElementById('wordCountStatus').textContent = '';
      selectedFile = null;
      submissionTask = null;
      
      // Refresh pending tasks dropdown
      populatePendingTasks();
      
      // Check if user needs to subscribe
      if (!currentUser.subscribed && currentUser.freeTasksRemaining <= 0) {
        showSubscriptionRequired();
      } else {
        // Navigate to dashboard
        navigateTo('dashboard');
        updateUI();
        showToast(`Work approved! Earned ${currentUser.transactions[0].amount >= 1 ? '+$' + currentUser.transactions[0].amount.toFixed(2) : 'KES ' + (currentUser.transactions[0].amount * USD_TO_KES).toFixed(2)}`);
      }
    }

    function openSubscribeModal() {
      if (!currentUser) {
        openModal('loginModal');
        return;
      }
      
      if (currentUser.subscribed) {
        showToast('You are already subscribed!');
        return;
      }
      
      showSubscriptionRequired();
    }

    function showSubscriptionRequired() {
      // Calculate next free task date
      const nextDate = new Date(currentUser.nextFreeTaskDate || Date.now());
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('nextFreeTaskDate').textContent = nextDate.toLocaleDateString('en-US', options);
      
      openModal('subscriptionModal');
    }

    function initiateSubscription() {
      closeModal('subscriptionModal');
      openModal('subscriptionPaymentModal');
    }

    function showPaymentVerification() {
      closeModal('subscriptionModal');
      closeModal('subscriptionPaymentModal');
      openModal('paymentVerificationModal');
    }

    async function handlePaymentVerification(e) {
      e.preventDefault();
      const btn = document.getElementById('paymentVerificationBtn');
      const errorEl = document.getElementById('paymentVerificationError');
      const successEl = document.getElementById('paymentVerificationSuccess');
      const message = document.getElementById('paymentMessage').value;

      errorEl.classList.add('hidden');
      successEl.classList.add('hidden');
      
      // Validate M-Pesa message format
      const currentYear = new Date().getFullYear();
      const currentMonth = new Date().getMonth(); // 0-indexed
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      // Check for essential M-Pesa elements
      const hasConfirmed = message.toLowerCase().includes('confirmed');
      const hasAmount = message.includes('208') || message.includes('208.00');
      const hasRecipient = message.toLowerCase().includes('lipana technologies') || message.toLowerCase().includes('lipana technologies limited');
      const hasCurrentDate = message.includes(`${currentYear}`) || 
                            (message.includes(`${monthNames[currentMonth]}`) && message.includes(`${currentYear.toString().slice(-2)}`)) ||
                            (currentMonth > 0 && message.includes(`${monthNames[currentMonth - 1]}`) && message.includes(`${currentYear}`));
      
      if (!hasConfirmed || !hasAmount || !hasRecipient) {
        let errorMsg = 'Invalid M-Pesa message. Please ensure it contains:\n';
        if (!hasConfirmed) errorMsg += '- "Confirmed" status\n';
        if (!hasAmount) errorMsg += '- Amount "KES 208"\n';
        if (!hasRecipient) errorMsg += '- Recipient "Lipana Technologies Limited"\n';
        
        errorEl.textContent = errorMsg;
        errorEl.classList.remove('hidden');
        errorEl.style.whiteSpace = 'pre-line';
        return;
      }
      
      if (!hasCurrentDate) {
        errorEl.textContent = 'The payment date in your message appears outdated. Please ensure you\'ve made a recent payment with the current date.';
        errorEl.classList.remove('hidden');
        return;
      }
      
      btn.textContent = 'Verifying...';
      btn.disabled = true;

      // Send to Web3Forms for verification
      const verificationData = {
        user_email: currentUser.email,
        user_name: currentUser.name,
        payment_message: message,
        subscription_amount: 'KES 208'
      };

      const sent = await sendToWeb3Forms('Subscription Payment Verification', verificationData);

      if (sent) {
        // Activate subscription
        currentUser.subscribed = true;
        currentUser.subscriptionDate = new Date().toISOString();
        currentUser.freeTasksRemaining = 0; // No longer needed
        
        // Add transaction
        currentUser.transactions.unshift({
          type: 'debit',
          description: 'Monthly Subscription Fee',
          amount: 208 / USD_TO_KES,
          date: new Date().toISOString()
        });
        
        currentUser.activity.unshift({
          type: 'subscription_activated',
          title: 'Subscription Activated',
          time: new Date().toISOString(),
          amount: 208 / USD_TO_KES
        });
        
        saveUserData();
        
        successEl.textContent = 'Subscription activated! You now have unlimited tasks.';
        successEl.classList.remove('hidden');
        
        setTimeout(() => {
          closeModal('paymentVerificationModal');
          navigateTo('tasks');
          showToast('ð Subscription activated! Start earning unlimited!');
        }, 2000);
      } else {
        errorEl.textContent = 'Verification failed. Please try again or contact support.';
        errorEl.classList.remove('hidden');
      }

      btn.textContent = 'Verify & Activate Subscription';
      btn.disabled = false;
    }

    function populatePendingTasks() {
      const select = document.getElementById('taskSelect');
      select.innerHTML = '<option value="">Choose a task you accepted</option>';
      
      if (currentUser && currentUser.pendingTasks && currentUser.pendingTasks.length > 0) {
        currentUser.pendingTasks.forEach(task => {
          const option = document.createElement('option');
          option.value = task.id;
          option.textContent = `${task.id} - ${task.title}`;
          select.appendChild(option);
        });
      }
    }

    // Override openModal to populate tasks when opening submit modal
    const originalOpenModal = openModal;
    window.openModal = function(id) {
      if (id === 'submitWorkModal') {
        populatePendingTasks();
      }
      originalOpenModal(id);
    };

    // Initialize on load
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c3ad8f3b1fa9bfc',t:'MTc2OTM3NjM3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>