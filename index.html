<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creativepay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    .app-logo {
      width: 40px;
      height: 40px;
      object-fit: contain;
      border-radius: 8px;
    }
    
    .app-logo-lg {
      width: 80px;
      height: 80px;
      object-fit: contain;
      border-radius: 12px;
    }
    
    .app-logo-sm {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }
    
    .gradient-primary {
      background: linear-gradient(135deg, #10b981 0%, #ec4899 50%, #8b5cf6 100%);
    }
    
    .gradient-card {
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
    }
    
    .gradient-warm {
      background: linear-gradient(135deg, #f472b6 0%, #fbbf24 50%, #f87171 100%);
    }
    
    .gradient-cool {
      background: linear-gradient(135deg, #14b8a6 0%, #8b5cf6 100%);
    }
    
    .floating-shape {
      position: absolute;
      border-radius: 50%;
      opacity: 0.1;
      animation: float 20s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    @keyframes slideIn {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-slide-in {
      animation: slideIn 0.3s ease-out forwards;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    
    .menu-overlay {
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
    }
    
    .soft-shadow {
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    
    .input-focus:focus {
      outline: none;
      ring: 2px;
      ring-color: #10b981;
    }
    
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #10b981;
      border-radius: 10px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-pink-50 via-white to-green-50 overflow-x-hidden">
  <div id="app" class="h-full w-full relative overflow-auto"><!-- Floating Shapes Background -->
   <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="floating-shape w-64 h-64 bg-green-400 top-10 -left-20" style="animation-delay: 0s;"></div>
    <div class="floating-shape w-48 h-48 bg-pink-400 top-1/3 right-10" style="animation-delay: 5s;"></div>
    <div class="floating-shape w-32 h-32 bg-purple-400 bottom-20 left-1/4" style="animation-delay: 10s;"></div>
    <div class="floating-shape w-56 h-56 bg-yellow-400 bottom-10 right-1/3" style="animation-delay: 15s;"></div>
    <div class="floating-shape w-40 h-40 bg-teal-400 top-1/2 left-10" style="animation-delay: 8s;"></div>
   </div><!-- Page Container -->
   <div id="page-container" class="relative z-10 min-h-full"></div>
  </div><!-- Toast Notification -->
  <div id="toast" class="fixed top-4 right-4 z-50 hidden">
   <div class="bg-green-500 text-white px-6 py-3 rounded-2xl shadow-lg flex items-center gap-2">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
    </svg><span id="toast-message">Success!</span>
   </div>
  </div>
  <script>
    // App State
    const state = {
      currentPage: 'landing',
      isMenuOpen: false,
      currency: 'USD',
      user: null,
      subscription: null, // 'basic' or 'premium'
      earnings: 0,
      pendingEarnings: 0,
      withdrawnAmount: 0,
      submittedTasks: [],
      acceptedTasks: [],
      completedTasks: [],
      recentActivity: [],
      currentTaskPage: 0,
      currentSetbookPage: {},
      tasksPerPage: 5,
      tasksSubmittedThisMonth: 0,
      monthlyReset: new Date().getMonth()
    };

    // Config for Element SDK
    const defaultConfig = {
      site_title: 'Creativepay',
      hero_headline: 'Turn Your Words Into Wealth',
      primary_color: '#10b981',
      secondary_color: '#ec4899',
      text_color: '#1f2937',
      background_color: '#fdf2f8',
      accent_color: '#8b5cf6'
    };

    let config = { ...defaultConfig };

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...config, ...newConfig };
          renderCurrentPage();
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [
            {
              get: () => cfg.background_color || defaultConfig.background_color,
              set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
            },
            {
              get: () => cfg.primary_color || defaultConfig.primary_color,
              set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
            },
            {
              get: () => cfg.text_color || defaultConfig.text_color,
              set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => cfg.secondary_color || defaultConfig.secondary_color,
              set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }
            },
            {
              get: () => cfg.accent_color || defaultConfig.accent_color,
              set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['site_title', cfg.site_title || defaultConfig.site_title],
          ['hero_headline', cfg.hero_headline || defaultConfig.hero_headline]
        ])
      });
    }

    // Exchange rate
    const exchangeRate = 129;

    // Setbook Essays Data
    const setbooks = [
      { title: "A Doll's House", author: "Henrik Ibsen", genre: "Drama" },
      { title: "Blossoms of the Savannah", author: "Henry Ole Kulet", genre: "Novel" },
      { title: "The Pearl", author: "John Steinbeck", genre: "Novella" },
      { title: "Inheritance", author: "David Mulwa", genre: "Play" },
      { title: "A Grain of Wheat", author: "Ngugi wa Thiong'o", genre: "Novel" },
      { title: "The River and the Source", author: "Margaret Ogola", genre: "Novel" },
      { title: "Betrayal in the City", author: "Francis Imbuga", genre: "Play" },
      { title: "The Caucasian Chalk Circle", author: "Bertolt Brecht", genre: "Play" },
      { title: "Memories We Lost", author: "Various Authors", genre: "Short Stories" },
      { title: "Father of Nations", author: "Paul B. Vitta", genre: "Novel" }
    ];

    // Generate essay topics for each setbook
    const essayTopics = {};
    setbooks.forEach(book => {
      essayTopics[book.title] = generateEssayTopics(book);
    });

    function generateEssayTopics(book) {
      const topics = [];
      const baseTopics = [
        { topic: `Analyze the theme of gender inequality in "${book.title}"`, question: `Gender inequality remains a persistent theme in African literature. In "${book.title}" by ${book.author}, the author explores various dimensions of gender-based discrimination and the struggle for equality. With close reference to the text, analyze how the author portrays gender inequality, examining specific characters, their experiences, and the societal norms that perpetuate this inequality. Discuss how the female characters navigate these challenges and what the author suggests about the path to gender equality. Use specific examples from the text to support your analysis.` },
        { topic: `Discuss the role of tradition vs modernity in "${book.title}"`, question: `The tension between traditional values and modern influences is a recurring motif in ${book.author}'s "${book.title}". This conflict often manifests in generational disagreements, cultural practices, and personal choices. Critically examine how the author presents this dichotomy, analyzing specific scenes, character decisions, and narrative developments that highlight this tension. What stance does the author ultimately take on this issue? Support your discussion with detailed references to the text.` },
        { topic: `Explore the concept of betrayal in "${book.title}"`, question: `Betrayal takes many forms in literature - from personal relationships to political allegiances. In "${book.title}", ${book.author} weaves a complex narrative where betrayal operates on multiple levels. Analyze the various instances of betrayal in the text, examining the motivations behind these betrayals, their consequences on individuals and communities, and what they reveal about human nature. How does the author use betrayal as a literary device to advance themes and plot?` },
        { topic: `Analyze symbolism and imagery in "${book.title}"`, question: `${book.author} employs rich symbolism and vivid imagery throughout "${book.title}" to convey deeper meanings and enhance the narrative experience. Identify and analyze at least five significant symbols or recurring images in the text. Discuss what each represents, how they contribute to the themes of the work, and their effect on the reader's understanding of the characters and plot. Use specific textual evidence to support your analysis.` },
        { topic: `Character analysis: The protagonist's journey in "${book.title}"`, question: `The protagonist in "${book.title}" undergoes significant transformation throughout the narrative. Trace this character's journey from the beginning to the end of the text, analyzing the key events, relationships, and decisions that shape their development. What internal and external conflicts do they face? How do they change as a result of their experiences? What does their journey reveal about the human condition? Provide specific examples from the text.` },
        { topic: `Discuss the theme of sacrifice in "${book.title}"`, question: `Sacrifice is a powerful theme that resonates throughout "${book.title}" by ${book.author}. Characters make various sacrifices - some willingly, others under duress - that shape the course of the narrative. Examine the different types of sacrifices portrayed in the text, analyzing their motivations, consequences, and significance. What does the author suggest about the nature and value of sacrifice through these portrayals? Support your discussion with specific examples.` },
        { topic: `Analyze the setting and its significance in "${book.title}"`, question: `The setting of "${book.title}" is not merely a backdrop but an integral element that shapes characters, conflicts, and themes. Analyze how ${book.author} uses setting - including physical locations, historical context, and social environment - to enhance the narrative. How does the setting influence character behavior and development? What symbolic significance do different locations hold? How does the author use setting to comment on larger social or political issues?` },
        { topic: `Explore the theme of identity in "${book.title}"`, question: `Identity - personal, cultural, and national - is a central concern in "${book.title}". Characters grapple with questions of who they are, where they belong, and how they relate to their communities and traditions. Analyze how ${book.author} explores the concept of identity, examining specific characters' struggles, the factors that shape identity formation, and the consequences of identity conflicts. What does the text suggest about the nature of identity in a changing world?` },
        { topic: `Discuss the role of women in "${book.title}"`, question: `Female characters in "${book.title}" play crucial roles that illuminate the author's perspective on gender, power, and social change. Examine how ${book.author} portrays women in the text - their challenges, strengths, relationships, and agency. Analyze specific female characters, their development, and their contributions to the themes and plot. What does the author's portrayal of women suggest about gender roles and the potential for change?` },
        { topic: `Analyze conflict and resolution in "${book.title}"`, question: `Conflict drives the narrative of "${book.title}", manifesting in various forms - internal, interpersonal, and societal. Examine the major conflicts in the text, analyzing their causes, development, and resolution (or lack thereof). How do these conflicts relate to the broader themes of the work? What do the resolutions (or ongoing tensions) suggest about the author's worldview? Use specific examples to support your analysis.` },
        { topic: `The theme of education and enlightenment in "${book.title}"`, question: `Education and the quest for knowledge play significant roles in "${book.title}". Analyze how ${book.author} presents education - formal and informal - and its impact on characters and society. What tensions exist between traditional knowledge and Western education? How does education relate to themes of power, identity, and change? Discuss specific characters whose lives are shaped by educational experiences.` },
        { topic: `Explore the concept of justice in "${book.title}"`, question: `Justice - its pursuit, denial, and various interpretations - emerges as a significant theme in "${book.title}". Analyze how ${book.author} portrays justice in the text, examining instances where justice is served, denied, or subverted. What systems of justice (traditional, colonial, personal) are represented? How do characters' concepts of justice differ? What does the text ultimately suggest about the nature and possibility of justice?` },
        { topic: `Analyze the narrative technique in "${book.title}"`, question: `${book.author}'s narrative technique in "${book.title}" is crucial to the text's impact and meaning. Analyze the author's use of point of view, time structure, language, and other narrative elements. How do these choices affect the reader's understanding and emotional engagement? What is achieved through the particular narrative style employed? How does form relate to content in this work?` },
        { topic: `Discuss the theme of love and relationships in "${book.title}"`, question: `Love and relationships - romantic, familial, and communal - are explored in depth in "${book.title}". Analyze how ${book.author} portrays different types of love and the relationships between characters. What challenges do these relationships face? How do they evolve throughout the narrative? What does the text suggest about the nature of love and its role in human life? Provide specific examples.` },
        { topic: `The impact of colonialism in "${book.title}"`, question: `Colonial influence and its aftermath permeate "${book.title}", shaping characters, conflicts, and themes. Analyze how ${book.author} portrays colonialism and its effects - cultural, economic, psychological, and political. How do characters respond to colonial power and its legacy? What does the text suggest about the process of decolonization? Use specific examples to support your analysis.` },
        { topic: `Analyze the theme of death and mortality in "${book.title}"`, question: `Death and mortality cast shadows throughout "${book.title}", influencing characters and themes. Analyze how ${book.author} treats death in the text - literal deaths, symbolic deaths, and characters' responses to mortality. What do attitudes toward death reveal about cultural values and individual character? How does the presence of death contribute to the work's themes and emotional impact?` },
        { topic: `Discuss irony and satire in "${book.title}"`, question: `${book.author} employs irony and satirical elements in "${book.title}" to critique society and illuminate themes. Identify and analyze instances of verbal, situational, and dramatic irony in the text. What is being satirized and to what effect? How do these techniques enhance the reader's understanding of characters and themes? What is the overall tone achieved through these devices?` },
        { topic: `The theme of hope and despair in "${book.title}"`, question: `Hope and despair interweave throughout "${book.title}", reflecting the human condition in times of challenge and change. Analyze how ${book.author} portrays these contrasting emotional states. What gives characters hope? What drives them to despair? How do hope and despair function in the narrative arc? What does the text ultimately suggest about the possibility of hope in difficult circumstances?` },
        { topic: `Analyze the father-son/parent-child relationships in "${book.title}"`, question: `Parent-child relationships, particularly between fathers and sons, are central to "${book.title}". Examine these relationships in detail, analyzing the expectations, conflicts, and bonds between generations. How do these relationships reflect broader themes of tradition, change, and identity? What do they reveal about the characters involved? How do they contribute to the plot and resolution?` },
        { topic: `Discuss the moral lessons in "${book.title}"`, question: `"${book.title}" offers various moral insights and lessons through its characters, plot, and themes. Identify and analyze the key moral lessons the text presents. How are these lessons conveyed - through character development, consequences of actions, or authorial commentary? What values does the text ultimately promote or critique? How relevant are these moral lessons to contemporary readers?` }
      ];
      
      baseTopics.forEach((topic, index) => {
        topics.push({
          id: `${book.title.replace(/\s+/g, '-')}-${index + 1}`,
          book: book.title,
          author: book.author,
          genre: book.genre,
          topic: topic.topic,
          question: topic.question,
          client: ['Academic Press Kenya', 'Longhorn Publishers', 'Oxford University Press EA', 'East African Educational Publishers', 'Phoenix Publishers'][index % 5],
          wordCount: [500, 750, 1000, 1250, 1500][index % 5],
          payment: ([500, 750, 1000, 1250, 1500][index % 5] / 250) * 500,
          deadline: ['24 hours', '48 hours', '72 hours', '1 week'][index % 4]
        });
      });
      
      return topics;
    }

    // Utility Functions
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const toastDiv = toast.querySelector('div');
      
      toastMessage.textContent = message;
      toastDiv.className = type === 'success' 
        ? 'bg-green-500 text-white px-6 py-3 rounded-2xl shadow-lg flex items-center gap-2'
        : 'bg-red-500 text-white px-6 py-3 rounded-2xl shadow-lg flex items-center gap-2';
      
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    function formatCurrency(amount, currency = state.currency) {
      if (currency === 'KES') {
        return `KSh ${(amount * exchangeRate).toLocaleString()}`;
      }
      return `$${amount.toFixed(2)}`;
    }

    function saveToLocalStorage() {
      const currentUserEmail = localStorage.getItem('creativepay_current_user');
      if (currentUserEmail) {
        saveAccountData(currentUserEmail);
      }
    }

    function saveAccountData(email) {
      localStorage.setItem(`creativepay_${email}`, JSON.stringify({
        user: state.user,
        subscription: state.subscription,
        earnings: state.earnings,
        pendingEarnings: state.pendingEarnings,
        withdrawnAmount: state.withdrawnAmount,
        submittedTasks: state.submittedTasks,
        acceptedTasks: state.acceptedTasks,
        completedTasks: state.completedTasks,
        recentActivity: state.recentActivity,
        tasksSubmittedThisMonth: state.tasksSubmittedThisMonth,
        monthlyReset: state.monthlyReset
      }));
    }

    function loadFromLocalStorage() {
      const currentUserEmail = localStorage.getItem('creativepay_current_user');
      
      if (!currentUserEmail) {
        return; // No user logged in
      }
      
      // Load current user's data
      const saved = localStorage.getItem(`creativepay_${currentUserEmail}`);
      if (saved) {
        const data = JSON.parse(saved);
        Object.assign(state, data);
        
        // Check if month changed (reset monthly submissions)
        const currentMonth = new Date().getMonth();
        if (currentMonth !== state.monthlyReset) {
          state.tasksSubmittedThisMonth = 0;
          state.monthlyReset = currentMonth;
        }
        
        // User is logged in, go to dashboard
        if (state.user && state.subscription) {
          state.currentPage = 'dashboard';
        } else if (state.user) {
          state.currentPage = 'dashboard';
        }
      }
    }

    async function sendToWeb3Forms(formData) {
      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            access_key: '4d568274-521b-452a-a113-62eed5ad915b',
            ...formData
          })
        });
        return response.ok;
      } catch (error) {
        console.error('Web3Forms error:', error);
        return false;
      }
    }

    // Page Renderers
    function renderCurrentPage() {
      const container = document.getElementById('page-container');
      switch (state.currentPage) {
        case 'landing':
          container.innerHTML = renderLandingPage();
          break;
        case 'login':
          container.innerHTML = renderLoginPage();
          break;
        case 'register':
          container.innerHTML = renderRegisterPage();
          break;
        case 'declaration':
          container.innerHTML = renderDeclarationPage();
          break;
        case 'payment':
          container.innerHTML = renderPaymentPage();
          break;
        case 'dashboard':
          container.innerHTML = renderDashboard();
          break;
        case 'tasks':
          container.innerHTML = renderTasksPage();
          break;
        case 'submit':
          container.innerHTML = renderSubmitPage();
          break;
        case 'earnings':
          container.innerHTML = renderEarningsPage();
          break;
        case 'withdraw':
          container.innerHTML = renderWithdrawPage();
          break;
        case 'support':
          container.innerHTML = renderSupportPage();
          break;
        case 'forex':
          container.innerHTML = renderForexPage();
          break;
        case 'subscription':
          container.innerHTML = renderSubscriptionPaymentPage();
          break;
        case 'refund':
          container.innerHTML = renderRefundPage();
          break;
        case 'withdraw-confirm':
          container.innerHTML = renderWithdrawConfirmPage();
          break;
        case 'withdraw-processing':
          container.innerHTML = renderWithdrawProcessingPage();
          break;
        case 'withdraw-success':
          container.innerHTML = renderWithdrawSuccessPage();
          break;
        case 'receipt':
          container.innerHTML = renderReceiptPage();
          break;
        case 'essay-review':
          container.innerHTML = renderEssayReviewPage();
          break;
        default:
          container.innerHTML = renderLandingPage();
      }
      attachEventListeners();
    }

    function renderEssayReviewPage() {
      if (!state.currentSubmission) {
        return `
          ${renderHeader(true)}
          ${renderMenu()}
          <main class="min-h-screen px-4 py-6">
            <div class="max-w-2xl mx-auto text-center">
              <div class="bg-white rounded-3xl soft-shadow p-8">
                <span class="text-6xl mb-4 block">‚ö†Ô∏è</span>
                <h2 class="font-bold text-2xl mb-2">No Submission Found</h2>
                <button onclick="navigateTo('submit')" class="gradient-primary text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition-opacity mt-4">
                  Back to Submit
                </button>
              </div>
            </div>
          </main>
        `;
      }

      const { task, essayText } = state.currentSubmission;
      const scoreResult = scoreEssay(essayText, task);
      
      // Payment matrix based on plan and score
      let actualPayment = 0;
      let paymentStatus = '';
      let statusColor = 'text-red-600';
      
      const basePayment = task.payment / exchangeRate;
      
      if (state.subscription === 'basic') {
        // Basic plan: KSh 50, 30, failed, 40, 20
        const basicPayments = [50, 30, 'FAILED', 40, 20];
        
        if (scoreResult.percentage >= 40) {
          actualPayment = 50 / exchangeRate;
          paymentStatus = 'EXCELLENT - KSh 50';
          statusColor = 'text-green-600';
        } else if (scoreResult.percentage >= 35) {
          actualPayment = 30 / exchangeRate;
          paymentStatus = 'GOOD - KSh 30';
          statusColor = 'text-blue-600';
        } else if (scoreResult.percentage >= 30) {
          actualPayment = 0;
          paymentStatus = 'FAILED - No Payment';
          statusColor = 'text-red-600';
        } else if (scoreResult.percentage >= 25) {
          actualPayment = 40 / exchangeRate;
          paymentStatus = 'ACCEPTABLE - KSh 40';
          statusColor = 'text-orange-600';
        } else if (scoreResult.percentage >= 20) {
          actualPayment = 20 / exchangeRate;
          paymentStatus = 'POOR - KSh 20 (Minimal)';
          statusColor = 'text-red-700';
        } else {
          actualPayment = 0;
          paymentStatus = 'REJECTED - No Payment';
          statusColor = 'text-red-800';
        }
      } else {
        // Premium plan: 70, rejected, 20, reject, 40, failed, 50, 30, failed, rejected
        const premiumPayments = [70, 'REJECTED', 20, 'REJECT', 40, 'FAILED', 50, 30, 'FAILED', 'REJECTED'];
        
        if (scoreResult.percentage >= 48) {
          actualPayment = 70 / exchangeRate;
          paymentStatus = 'EXCELLENT - KSh 70';
          statusColor = 'text-green-600';
        } else if (scoreResult.percentage >= 45) {
          actualPayment = 0;
          paymentStatus = 'REJECTED - No Payment';
          statusColor = 'text-red-600';
        } else if (scoreResult.percentage >= 42) {
          actualPayment = 20 / exchangeRate;
          paymentStatus = 'MINIMAL - KSh 20';
          statusColor = 'text-orange-700';
        } else if (scoreResult.percentage >= 40) {
          actualPayment = 0;
          paymentStatus = 'REJECTED - No Payment';
          statusColor = 'text-red-600';
        } else if (scoreResult.percentage >= 37) {
          actualPayment = 40 / exchangeRate;
          paymentStatus = 'ACCEPTABLE - KSh 40';
          statusColor = 'text-orange-600';
        } else if (scoreResult.percentage >= 35) {
          actualPayment = 0;
          paymentStatus = 'FAILED - No Payment';
          statusColor = 'text-red-600';
        } else if (scoreResult.percentage >= 32) {
          actualPayment = 50 / exchangeRate;
          paymentStatus = 'GOOD - KSh 50';
          statusColor = 'text-blue-600';
        } else if (scoreResult.percentage >= 28) {
          actualPayment = 30 / exchangeRate;
          paymentStatus = 'FAIR - KSh 30';
          statusColor = 'text-blue-700';
        } else if (scoreResult.percentage >= 24) {
          actualPayment = 0;
          paymentStatus = 'FAILED - No Payment';
          statusColor = 'text-red-600';
        } else {
          actualPayment = 0;
          paymentStatus = 'REJECTED - No Payment';
          statusColor = 'text-red-800';
        }
      }
      
      const rejectReason = actualPayment === 0 ? 'Below Quality Threshold' : 'Quality Score Assessment';
      
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-3xl mx-auto space-y-6 animate-fade-in">
            <!-- Review Header -->
            <div class="text-center">
              <h1 class="text-3xl font-bold text-gray-800 mb-2">üìä Essay Review Results</h1>
              <p class="text-gray-500">Your submission has been scored by our quality system</p>
            </div>
            
            <!-- Score Card -->
            <div class="bg-white rounded-3xl soft-shadow overflow-hidden">
              <div class="gradient-primary p-8 text-white text-center">
                <p class="text-white/80 text-lg mb-2">Overall Score</p>
                <div class="flex items-center justify-center gap-4">
                  <div class="text-7xl font-black">${scoreResult.percentage}%</div>
                  <div class="text-right">
                    <p class="text-5xl font-bold">Grade ${scoreResult.grade}</p>
                    <p class="text-white/80 text-sm">Out of 100 points</p>
                  </div>
                </div>
              </div>
              
              <!-- Score Breakdown -->
              <div class="p-6">
                <h3 class="font-bold text-lg mb-4 text-gray-800">Score Breakdown</h3>
                <div class="space-y-3">
                  ${[
                    { label: 'üìå Content Relevance', score: scoreResult.breakdown.relevance, max: 25 },
                    { label: 'üìè Word Count Compliance', score: scoreResult.breakdown.wordCount, max: 15 },
                    { label: '‚úçÔ∏è Grammar & Structure', score: scoreResult.breakdown.grammar, max: 20 },
                    { label: 'üîç Analysis Depth', score: scoreResult.breakdown.analysis, max: 20 },
                    { label: 'üí° Originality', score: scoreResult.breakdown.originality, max: 20 }
                  ].map(item => `
                    <div class="flex items-center gap-3">
                      <div class="flex-1">
                        <p class="text-sm font-medium text-gray-700">${item.label}</p>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                          <div class="bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full" style="width: ${(item.score / item.max) * 100}%"></div>
                        </div>
                      </div>
                      <span class="font-bold text-gray-700 w-12 text-right">${item.score}/${item.max}</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
            
            <!-- Feedback -->
            <div class="bg-white rounded-3xl soft-shadow p-6">
              <h3 class="font-bold text-lg mb-4 text-gray-800">üìù Detailed Feedback</h3>
              <div class="space-y-3">
                ${scoreResult.feedback.map(fb => `
                  <div class="flex gap-3 p-3 bg-gray-50 rounded-xl">
                    <span class="text-xl flex-shrink-0">${fb.includes('‚úÖ') ? '‚úÖ' : fb.includes('‚ö†Ô∏è') ? 'ÔøΩÔøΩÔøΩÔ∏è' : 'ÔøΩÔøΩÔøΩ'}</span>
                    <p class="text-gray-700 text-sm">${fb}</p>
                  </div>
                `).join('')}
              </div>
            </div>
            
            <!-- Payment Details -->
            <div class="bg-gradient-to-br ${actualPayment > 0 ? 'from-green-50 to-emerald-50' : 'from-orange-50 to-red-50'} rounded-3xl p-6 border-2 ${actualPayment > 0 ? 'border-green-200' : 'border-orange-200'}">
              <h3 class="font-bold text-lg mb-4 text-gray-800">üí∞ Payment Status</h3>
              
              <div class="space-y-4">
                <div class="flex justify-between items-center pb-3 border-b-2 border-gray-300">
                  <span class="text-gray-700">Score Percentage:</span>
                  <span class="font-bold text-lg">${scoreResult.percentage}%</span>
                </div>
                
                <div class="flex justify-between items-center pb-3 border-b-2 border-gray-300">
                  <span class="text-gray-700">Plan Type:</span>
                  <span class="font-bold text-lg">${state.subscription.charAt(0).toUpperCase() + state.subscription.slice(1)}</span>
                </div>
                
                <div class="flex justify-between items-center text-lg">
                  <span class="font-bold text-gray-800">Payment Status:</span>
                  <span class="${statusColor} font-black text-xl">${paymentStatus}</span>
                </div>
              </div>
              
              ${actualPayment === 0 ? `
                <div class="mt-4 p-3 bg-red-100 border border-red-300 rounded-xl">
                  <p class="text-red-800 text-sm">
                    <span class="font-bold">‚ùå Payment Rejected:</span> Your essay scored ${scoreResult.percentage}%, which is below our quality threshold. No payment will be issued. Please review the feedback and improve your essay quality for future submissions.
                  </p>
                </div>
              ` : `
                <div class="mt-4 p-3 bg-green-100 border border-green-300 rounded-xl">
                  <p class="text-green-800 text-sm">
                    <span class="font-bold">‚úÖ Payment Approved:</span> Your essay scored ${scoreResult.percentage}%. You've earned ${formatCurrency(actualPayment)} for this submission!
                  </p>
                </div>
              `}
            </div>
            
            <!-- Action Buttons -->
            <div class="flex gap-3">
              <button onclick="approveSubmission()" class="flex-1 ${actualPayment > 0 ? 'gradient-primary' : 'bg-gray-400'} text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                ${actualPayment > 0 ? `‚úÖ Accept & Deposit ${formatCurrency(actualPayment)}` : `‚ùå Payment Rejected`}
              </button>
              <button onclick="navigateTo('submit')" class="flex-1 py-4 border-2 border-gray-200 rounded-xl font-bold text-gray-700 hover:border-gray-300 transition-colors">
                Try Another Task
              </button>
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderHeader(showMenu = false) {
      return `
        <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-lg soft-shadow">
          <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
              ${showMenu ? `
                <button onclick="toggleMenu()" class="p-2 rounded-xl hover:bg-gray-100 transition-colors">
                  <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                  </svg>
                </button>
              ` : ''}
              <div class="flex items-center gap-2">
                <img src="logo.png" alt="Creativepay" class="app-logo" onerror="this.style.display='none'">
                <span class="font-bold text-xl bg-gradient-to-r from-green-600 via-pink-500 to-purple-600 bg-clip-text text-transparent" id="site-title">${config.site_title}</span>
              </div>
            </div>
            ${showMenu && state.user ? `
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-gradient-to-r from-pink-400 to-purple-400 rounded-full flex items-center justify-center">
                  <span class="text-white text-sm font-semibold">${state.user.name.charAt(0)}</span>
                </div>
              </div>
            ` : ''}
          </div>
        </header>
      `;
    }

    function renderMenu() {
      if (!state.isMenuOpen) return '';
      
      return `
        <div class="fixed inset-0 z-50 menu-overlay" onclick="toggleMenu()">
          <div class="w-72 h-full bg-white animate-slide-in overflow-y-auto" onclick="event.stopPropagation()">
            <div class="p-6 gradient-primary">
              <div class="flex items-center gap-3 mb-4">
                <img src="logo.png" alt="Creativepay" class="app-logo-sm" onerror="this.style.display='none'" style="width: 48px; height: 48px;">
                <div>
                  <h3 class="text-white font-bold">${state.user?.name || 'User'}</h3>
                  <p class="text-white/80 text-sm">${state.user?.email || ''}</p>
                </div>
              </div>
              <div class="bg-white/20 rounded-xl p-3">
                <p class="text-white/80 text-xs">Total Earnings</p>
                <p class="text-white font-bold text-xl">${formatCurrency(state.earnings)}</p>
              </div>
            </div>
            
            <nav class="p-4">
              ${[
                { icon: 'üè†', label: 'Home', page: 'dashboard' },
                { icon: 'üìù', label: 'Available Tasks', page: 'tasks' },
                { icon: 'üì§', label: 'Submit Task', page: 'submit' },
                { icon: 'ÔøΩÔøΩÔøΩ', label: 'Earnings', page: 'earnings' },
                { icon: 'üí∏', label: 'Withdraw', page: 'withdraw' },
                { icon: 'üí¨', label: 'Support', page: 'support' },
                { icon: 'üí±', label: 'Forex Center', page: 'forex' },
                { icon: 'üë•', label: 'Meet Other Writers', action: 'openWhatsApp' },
                { icon: 'üì±', label: 'Download App', action: 'downloadApp' },
                { icon: 'üîÑ', label: 'Refund', page: 'refund' },
                { icon: '‚≠ê', label: 'Manage Subscription', action: 'showSubscriptionMenu' },
                { icon: 'üö™', label: 'Logout', action: 'logout' }
              ].map((item, i) => `
                <button 
                  onclick="${item.action ? item.action + '()' : `navigateTo('${item.page}')`}"
                  class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-100 transition-colors text-left mb-1"
                  style="animation-delay: ${i * 50}ms"
                >
                  <span class="text-xl">${item.icon}</span>
                  <span class="font-medium text-gray-700">${item.label}</span>
                </button>
              `).join('')}
            </nav>
          </div>
        </div>
      `;
    }

    function renderFooter() {
      return `
        <footer class="bg-gray-900 text-white py-8 mt-12">
          <div class="max-w-6xl mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
              <div class="flex items-center gap-2">
                <img src="logo.png" alt="Creativepay" class="app-logo" onerror="this.style.display='none'">
                <span class="font-bold">Creativepay</span>
              </div>
              <div class="flex gap-6 text-sm text-gray-400">
                <a href="#" class="hover:text-white transition-colors">Terms</a>
                <a href="#" class="hover:text-white transition-colors">Privacy</a>
                <a href="#" class="hover:text-white transition-colors">Contact</a>
              </div>
              <div class="flex gap-4">
                <a href="#" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 transition-colors">
                  <span>üìò</span>
                </a>
                <a href="#" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 transition-colors">
                  <span>üê¶</span>
                </a>
                <a href="#" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 transition-colors">
                  <span>üì∏</span>
                </a>
              </div>
            </div>
            <p class="text-center text-gray-500 text-sm mt-6">¬© 2024 Creativepay. All rights reserved.</p>
          </div>
        </footer>
      `;
    }

    function renderLandingPage() {
      return `
        ${renderHeader()}
        <main class="min-h-screen">
          <!-- Hero Section -->
          <section class="px-4 py-12 md:py-20">
            <div class="max-w-6xl mx-auto text-center animate-fade-in">
              <div class="inline-flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-medium mb-6">
                <span>üá∞üá™</span> Kenya's #1 Creative Writing Platform
              </div>
              <h1 class="text-4xl md:text-6xl font-extrabold mb-6" id="hero-headline">
                <span class="bg-gradient-to-r from-green-600 via-pink-500 to-purple-600 bg-clip-text text-transparent">${config.hero_headline}</span>
              </h1>
              <p class="text-gray-600 text-lg md:text-xl max-w-2xl mx-auto mb-8">
                Join thousands of Kenyan writers earning from poetry and literature essays. Get paid <strong>KSh 500 per page</strong> for quality content.
              </p>
              <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="navigateTo('register')" class="gradient-primary text-white px-8 py-4 rounded-2xl font-bold text-lg hover:opacity-90 transition-opacity card-hover soft-shadow">
                  Create Account ‚Üí
                </button>
                <button onclick="navigateTo('login')" class="bg-white text-gray-700 px-8 py-4 rounded-2xl font-bold text-lg border-2 border-gray-200 hover:border-green-400 transition-colors card-hover">
                  Login
                </button>
              </div>
              
              <!-- Stats -->
              <div class="grid grid-cols-3 gap-4 mt-12 max-w-xl mx-auto">
                ${[
                  { value: '45+', label: 'Setbook Essays' },
                  { value: 'KSh 500', label: 'Per Page' },
                  { value: '24/7', label: 'Support' }
                ].map(stat => `
                  <div class="bg-white/80 backdrop-blur rounded-2xl p-4 soft-shadow">
                    <p class="text-2xl font-bold bg-gradient-to-r from-green-600 to-purple-600 bg-clip-text text-transparent">${stat.value}</p>
                    <p class="text-gray-500 text-sm">${stat.label}</p>
                  </div>
                `).join('')}
              </div>
            </div>
          </section>
          
          <!-- Features Section -->
          <section class="px-4 py-12 bg-white/50">
            <div class="max-w-6xl mx-auto">
              <h2 class="text-3xl font-bold text-center mb-12">How It Works</h2>
              <div class="grid md:grid-cols-3 gap-6">
                ${[
                  { icon: 'üìù', title: 'Choose Tasks', desc: 'Browse 45+ setbook essays and select tasks matching your expertise', color: 'from-green-400 to-teal-500' },
                  { icon: '‚úçÔ∏è', title: 'Write Quality Content', desc: 'Submit well-researched essays meeting academic standards', color: 'from-pink-400 to-red-500' },
                  { icon: 'üí∞', title: 'Get Paid', desc: 'Earn KSh 500 per page (250 words) directly to your account', color: 'from-purple-400 to-indigo-500' }
                ].map(feature => `
                  <div class="bg-white rounded-3xl p-6 soft-shadow card-hover">
                    <div class="w-16 h-16 bg-gradient-to-br ${feature.color} rounded-2xl flex items-center justify-center text-3xl mb-4">
                      ${feature.icon}
                    </div>
                    <h3 class="font-bold text-xl mb-2">${feature.title}</h3>
                    <p class="text-gray-600">${feature.desc}</p>
                  </div>
                `).join('')}
              </div>
            </div>
          </section>
          
          <!-- CTA Section -->
          <section class="px-4 py-16">
            <div class="max-w-4xl mx-auto gradient-primary rounded-3xl p-8 md:p-12 text-center text-white">
              <h2 class="text-3xl md:text-4xl font-bold mb-4">Ready to Start Writing?</h2>
              <p class="text-white/80 mb-8 text-lg">Join our community of creative writers and turn your passion into income.</p>
              <button onclick="navigateTo('register')" class="bg-white text-green-600 px-8 py-4 rounded-2xl font-bold text-lg hover:bg-gray-100 transition-colors">
                Create Free Account
              </button>
            </div>
          </section>
        </main>
        ${renderFooter()}
      `;
    }

    function renderLoginPage() {
      return `
        ${renderHeader()}
        <main class="min-h-screen px-4 py-8">
          <div class="max-w-md mx-auto animate-fade-in">
            <div class="bg-white rounded-3xl soft-shadow p-6 md:p-8">
              <div class="text-center mb-8">
                <img src="logo.png" alt="Creativepay" class="app-logo-lg mx-auto mb-4" onerror="this.style.display='none'">
                <h1 class="text-2xl font-bold">Welcome Back</h1>
                <p class="text-gray-500">Login to your account</p>
              </div>
              
              <form id="login-form" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="login-email">Email Address</label>
                  <input type="email" id="login-email" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="you@example.com">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="login-password">Password</label>
                  <input type="password" id="login-password" required minlength="6" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="Your password">
                </div>
                
                <button type="submit" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                  Login ‚Üí
                </button>
              </form>
              
              <p class="text-center text-gray-500 text-sm mt-6">
                Don't have an account? <a href="#" onclick="navigateTo('register')" class="text-green-600 font-medium">Create one</a>
              </p>
            </div>
          </div>
        </main>
      `;
    }

    function renderRegisterPage() {
      return `
        ${renderHeader()}
        <main class="min-h-screen px-4 py-8">
          <div class="max-w-md mx-auto animate-fade-in">
            <div class="bg-white rounded-3xl soft-shadow p-6 md:p-8">
              <div class="text-center mb-8">
                <img src="logo.png" alt="Creativepay" class="app-logo-lg mx-auto mb-4" onerror="this.style.display='none'">
                <h1 class="text-2xl font-bold">Create Your Account</h1>
                <p class="text-gray-500">Start your writing journey today</p>
              </div>
              
              <form id="register-form" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="reg-name">Full Name</label>
                  <input type="text" id="reg-name" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="Enter your full name">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="reg-email">Email Address</label>
                  <input type="email" id="reg-email" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="you@example.com">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="reg-phone">Phone Number</label>
                  <input type="tel" id="reg-phone" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="0712345678">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="reg-password">Password</label>
                  <input type="password" id="reg-password" required minlength="6" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="Create a password">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="reg-confirm">Confirm Password</label>
                  <input type="password" id="reg-confirm" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="Confirm your password">
                </div>
                
                <button type="submit" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                  Continue ‚Üí
                </button>
              </form>
              
              <p class="text-center text-gray-500 text-sm mt-6">
                Already have an account? <a href="#" onclick="navigateTo('landing')" class="text-green-600 font-medium">Sign In</a>
              </p>
            </div>
          </div>
        </main>
      `;
    }

    function renderDeclarationPage() {
      return `
        ${renderHeader()}
        <main class="min-h-screen px-4 py-8">
          <div class="max-w-2xl mx-auto animate-fade-in">
            <div class="bg-white rounded-3xl soft-shadow p-6 md:p-8">
              <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-3xl flex items-center justify-center mx-auto mb-4">
                  <span class="text-4xl">üìú</span>
                </div>
                <h1 class="text-2xl font-bold">Writer's Declaration</h1>
                <p class="text-gray-500">Please read and accept our terms</p>
              </div>
              
              <div class="bg-gray-50 rounded-2xl p-6 mb-6 max-h-64 overflow-y-auto text-sm text-gray-600 space-y-4">
                <h3 class="font-bold text-gray-800">Terms and Conditions</h3>
                <p><strong>1. Original Work:</strong> I declare that all content I submit will be 100% original and not plagiarized from any source. I understand that plagiarism will result in immediate account termination.</p>
                <p><strong>2. Quality Standards:</strong> I agree to maintain high academic standards in all my submissions, including proper grammar, spelling, and formatting.</p>
                <p><strong>3. Deadlines:</strong> I commit to submitting all accepted tasks within the specified deadlines. Failure to meet deadlines may affect my writer rating.</p>
                <p><strong>4. Payment Terms:</strong> I understand that payment will be processed within 48 hours of task approval. The rate is KSh 500 per page (250 words).</p>
                <p><strong>5. Confidentiality:</strong> I agree to keep all client information and task details confidential.</p>
                <p><strong>6. Account Usage:</strong> I confirm that I will use this account only for legitimate writing purposes and will not engage in any fraudulent activities.</p>
                <p><strong>7. Verification:</strong> I agree to provide accurate personal information and understand that my account may require verification.</p>
                <p><strong>8. Disputes:</strong> I agree to resolve any disputes through Creativepay's support system before taking external action.</p>
              </div>
              
              <form id="declaration-form">
                <div class="flex items-start gap-3 mb-6">
                  <input type="checkbox" id="accept-terms" required class="mt-1 w-5 h-5 text-green-600 rounded focus:ring-green-500">
                  <label for="accept-terms" class="text-gray-700 text-sm">
                    I have read and agree to the Terms and Conditions, Privacy Policy, and Writer's Code of Conduct. I declare that all information provided is accurate.
                  </label>
                </div>
                
                <button type="submit" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                  Accept & Continue ‚Üí
                </button>
              </form>
            </div>
          </div>
        </main>
      `;
    }

    function renderPaymentPage() {
      return `
        ${renderHeader()}
        <main class="min-h-screen px-4 py-8">
          <div class="max-w-md mx-auto animate-fade-in">
            <div class="bg-white rounded-3xl soft-shadow p-6 md:p-8">
              <div class="text-center mb-8">
                <img src="logo.png" alt="Creativepay" class="app-logo-lg mx-auto mb-4" onerror="this.style.display='none'">
                <h1 class="text-2xl font-bold">Payment Setup</h1>
                <p class="text-gray-500">Choose your subscription plan</p>
              </div>
              
              <div class="bg-gradient-to-br from-green-50 to-teal-50 rounded-2xl p-4 mb-6">
                <div class="flex items-center gap-3">
                  <span class="text-2xl">üéÅ</span>
                  <div>
                    <p class="font-bold text-green-700">Complete Setup!</p>
                    <p class="text-green-600 text-sm">Choose your plan to get started immediately</p>
                  </div>
                </div>
              </div>
              
              <p class="text-center text-gray-600 text-sm mb-6">Select your subscription plan to continue</p>
              
              <div class="space-y-4">
                <!-- Basic Plan -->
                <button onclick="selectSubscription('basic')" class="w-full border-2 border-gray-200 rounded-2xl p-5 text-left hover:border-green-400 hover:bg-green-50 transition-all card-hover">
                  <div class="flex items-start justify-between mb-2">
                    <h3 class="font-bold text-lg">Basic Plan</h3>
                    <span class="text-2xl font-bold text-green-600">$2.40</span>
                  </div>
                  <p class="text-gray-600 text-sm">KSh 310/month</p>
                  <ul class="mt-4 space-y-2 text-sm text-gray-700">
                    <li>‚úì 5 task submissions/month</li>
                    <li>‚úì Access to all essays</li>
                    <li>‚úì 0-48 hour withdrawals</li>
                    <li>‚úì Email support</li>
                  </ul>
                </button>
                
                <!-- Premium Plan -->
                <button onclick="selectSubscription('premium')" class="w-full bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-5 text-left text-white card-hover relative overflow-hidden">
                  <div class="absolute top-2 right-2 bg-yellow-400 text-gray-800 px-3 py-1 rounded-full text-xs font-bold">BEST VALUE</div>
                  <div class="flex items-start justify-between mb-2">
                    <h3 class="font-bold text-lg">Premium Plan</h3>
                    <span class="text-2xl font-bold">$3.80</span>
                  </div>
                  <p class="text-white/80 text-sm">KSh 489/month</p>
                  <ul class="mt-4 space-y-2 text-sm text-white/90">
                    <li>‚úì 10 task submissions/month</li>
                    <li>‚úì Priority task access</li>
                    <li>‚úì Instant withdrawals</li>
                    <li>‚úì 24/7 VIP support</li>
                    <li>‚úì +10% bonus earnings</li>
                  </ul>
                </button>
              </div>
              
              <button onclick="skipSubscription()" class="w-full mt-6 py-3 text-gray-600 font-medium hover:text-gray-800 transition-colors">
                Skip Now ‚Üí
              </button>
            </div>
          </div>
        </main>
      `;
    }

    function renderDashboard() {
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-6xl mx-auto space-y-6">
            <!-- Welcome -->
            <div class="animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Welcome back, ${state.user?.name?.split(' ')[0] || 'Writer'}! üëã</h1>
              <p class="text-gray-500">Ready to write something amazing today?</p>
            </div>
            
            <!-- Balance Card -->
            <div class="gradient-card rounded-3xl p-6 text-white soft-shadow card-hover animate-fade-in" style="animation-delay: 100ms">
              <div class="flex items-center justify-between mb-4">
                <span class="text-white/80">Total Earnings</span>
                <button onclick="toggleCurrency()" class="bg-white/20 px-3 py-1 rounded-full text-sm font-medium hover:bg-white/30 transition-colors">
                  ${state.currency}
                </button>
              </div>
              <p class="text-4xl font-bold mb-6">${formatCurrency(state.earnings)}</p>
              <div class="flex gap-3">
                <button onclick="navigateTo('tasks')" class="flex-1 bg-white text-green-600 py-3 rounded-xl font-bold hover:bg-gray-100 transition-colors">
                  ‚úçÔ∏è Start Writing
                </button>
                <button onclick="navigateTo('withdraw')" class="flex-1 bg-white/20 text-white py-3 rounded-xl font-bold hover:bg-white/30 transition-colors">
                  üí∏ Withdraw
                </button>
              </div>
              ${!state.subscription ? `
                <button onclick="navigateTo('subscription')" class="w-full mt-3 bg-yellow-400 text-gray-900 py-3 rounded-xl font-bold hover:bg-yellow-300 transition-colors">
                  ‚≠ê Get Premium
                </button>
              ` : ''}
            </div>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-3 gap-3 animate-fade-in" style="animation-delay: 200ms">
              <div class="bg-white rounded-2xl p-4 soft-shadow text-center">
                <p class="text-2xl font-bold text-pink-500">${state.completedTasks.length}</p>
                <p class="text-gray-500 text-xs">Completed</p>
              </div>
              <div class="bg-white rounded-2xl p-4 soft-shadow text-center">
                <p class="text-2xl font-bold text-purple-500">${state.acceptedTasks.length}</p>
                <p class="text-gray-500 text-xs">In Progress</p>
              </div>
              <div class="bg-white rounded-2xl p-4 soft-shadow text-center">
                <p class="text-2xl font-bold text-green-500">${formatCurrency(state.pendingEarnings)}</p>
                <p class="text-gray-500 text-xs">Pending</p>
              </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in" style="animation-delay: 300ms">
              <h2 class="font-bold text-lg mb-4">Recent Activity</h2>
              ${state.recentActivity.length === 0 ? `
                <div class="text-center py-8 text-gray-400">
                  <span class="text-4xl mb-2 block">üì≠</span>
                  <p>No activity yet. Start writing to see your progress!</p>
                </div>
              ` : `
                <div class="space-y-3">
                  ${state.recentActivity.slice(0, 5).map(activity => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                      <div class="flex items-center gap-3">
                        <span class="text-2xl">${activity.icon}</span>
                        <div>
                          <p class="font-medium text-gray-800">${activity.title}</p>
                          <p class="text-gray-500 text-sm">${activity.time}</p>
                        </div>
                      </div>
                      ${activity.amount ? `<span class="text-green-600 font-bold">+${formatCurrency(activity.amount)}</span>` : ''}
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
            
            <!-- Quick Actions -->
            <div class="grid grid-cols-2 gap-4 animate-fade-in" style="animation-delay: 400ms">
              <button onclick="navigateTo('tasks')" class="bg-gradient-to-br from-pink-100 to-pink-200 p-6 rounded-2xl text-left card-hover">
                <span class="text-3xl mb-2 block">üìù</span>
                <p class="font-bold text-gray-800">Browse Tasks</p>
                <p class="text-gray-600 text-sm">45+ setbook essays</p>
              </button>
              <button onclick="navigateTo('submit')" class="bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-2xl text-left card-hover">
                <span class="text-3xl mb-2 block">üì§</span>
                <p class="font-bold text-gray-800">Submit Work</p>
                <p class="text-gray-600 text-sm">Upload your essay</p>
              </button>
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderTasksPage() {
      const allTasks = [];
      setbooks.forEach(book => {
        allTasks.push(...essayTopics[book.title].slice(0, 20));
      });
      
      const startIndex = state.currentTaskPage * state.tasksPerPage;
      const displayedTasks = allTasks.slice(startIndex, startIndex + state.tasksPerPage);
      const totalPages = Math.ceil(allTasks.length / state.tasksPerPage);
      
      const colors = ['from-green-50 to-teal-50', 'from-pink-50 to-rose-50', 'from-purple-50 to-indigo-50', 'from-yellow-50 to-amber-50', 'from-blue-50 to-cyan-50'];
      
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-6xl mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Available Writing Tasks üìù</h1>
              <p class="text-gray-500">Choose from ${allTasks.length}+ setbook essay topics</p>
            </div>
            
            <!-- Setbook Filter -->
            <div class="mb-6 overflow-x-auto pb-2 animate-fade-in" style="animation-delay: 100ms">
              <div class="flex gap-2 min-w-max">
                <button onclick="filterBySetbook('all')" class="px-4 py-2 rounded-full text-sm font-medium bg-green-500 text-white">
                  All Tasks
                </button>
                ${setbooks.slice(0, 5).map(book => `
                  <button onclick="filterBySetbook('${book.title}')" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors whitespace-nowrap">
                    ${book.title}
                  </button>
                `).join('')}
              </div>
            </div>
            
            <!-- Task Cards -->
            <div class="space-y-4">
              ${displayedTasks.map((task, i) => `
                <div class="bg-gradient-to-br ${colors[i % 5]} rounded-2xl p-5 soft-shadow card-hover animate-fade-in" style="animation-delay: ${(i + 2) * 100}ms">
                  <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                      <span class="inline-block px-3 py-1 bg-white/60 rounded-full text-xs font-medium text-gray-600 mb-2">${task.genre}</span>
                      <h3 class="font-bold text-gray-800 text-lg leading-tight">${task.topic}</h3>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 gap-2 text-sm text-gray-600 mb-4">
                    <p><span class="font-medium">üìö Book:</span> ${task.book}</p>
                    <p><span class="font-medium">‚úçÔ∏è Author:</span> ${task.author}</p>
                    <p><span class="font-medium">üë§ Client:</span> ${task.client}</p>
                    <p><span class="font-medium">üìù Words:</span> ${task.wordCount}</p>
                  </div>
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="text-green-600 font-bold text-xl">${formatCurrency(task.payment / exchangeRate)}</p>
                      <p class="text-gray-500 text-xs">KSh ${task.payment.toLocaleString()}</p>
                    </div>
                    <div class="flex gap-2">
                      <button onclick="viewTaskDetails('${task.id}')" class="px-4 py-2 bg-white text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors">
                        View Details
                      </button>
                      <button onclick="acceptTask('${task.id}')" class="px-4 py-2 gradient-primary text-white rounded-xl font-medium hover:opacity-90 transition-opacity">
                        Accept Task
                      </button>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            
            <!-- Pagination -->
            <div class="flex items-center justify-center gap-4 mt-8 animate-fade-in">
              <button onclick="prevTaskPage()" ${state.currentTaskPage === 0 ? 'disabled' : ''} class="px-6 py-3 bg-white rounded-xl font-medium text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed soft-shadow">
                ‚Üê Previous
              </button>
              <span class="text-gray-600 font-medium">Page ${state.currentTaskPage + 1} of ${totalPages}</span>
              <button onclick="nextTaskPage(${totalPages})" ${state.currentTaskPage >= totalPages - 1 ? 'disabled' : ''} class="px-6 py-3 bg-white rounded-xl font-medium text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed soft-shadow">
                Next ‚Üí
              </button>
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderSubmitPage() {
      if (!state.subscription) {
        return `
          ${renderHeader(true)}
          ${renderMenu()}
          <main class="min-h-screen px-4 py-6">
            <div class="max-w-2xl mx-auto text-center animate-fade-in">
              <div class="bg-white rounded-3xl soft-shadow p-8">
                <span class="text-6xl mb-4 block">ÔøΩÔøΩÔøΩ</span>
                <h2 class="font-bold text-2xl mb-2">Subscription Required</h2>
                <p class="text-gray-600 mb-6">You need an active subscription to submit work. Choose a plan to get started!</p>
                <button onclick="navigateTo('subscription')" class="gradient-primary text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition-opacity">
                  View Subscription Plans
                </button>
              </div>
            </div>
          </main>
          ${renderFooter()}
        `;
      }
      
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-2xl mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Submit Your Work üì§</h1>
              <p class="text-gray-500">Upload your completed essay</p>
              <div class="mt-2 text-sm text-gray-600">
                <span class="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full">
                  ${state.tasksSubmittedThisMonth}/${state.subscription === 'basic' ? '5' : '10'} submissions used this month
                </span>
              </div>
            </div>
            
            ${state.acceptedTasks.length === 0 ? `
              <div class="bg-white rounded-3xl soft-shadow p-8 text-center animate-fade-in">
                <span class="text-6xl mb-4 block">üìù</span>
                <h2 class="font-bold text-xl mb-2">No Active Tasks</h2>
                <p class="text-gray-500 mb-6">Accept a task first to submit your work</p>
                <button onclick="navigateTo('tasks')" class="gradient-primary text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition-opacity">
                  Browse Available Tasks
                </button>
              </div>
            ` : `
              <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in">
                <form id="submit-form" class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="task-select">Select Task</label>
                    <select id="task-select" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                      <option value="">Choose a task</option>
                      ${state.acceptedTasks.map(task => `
                        <option value="${task.id}">${task.topic} - ${task.book}</option>
                      `).join('')}
                    </select>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="essay-content">Essay Content</label>
                    <textarea id="essay-content" rows="12" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all resize-none" placeholder="Paste your essay content here..."></textarea>
                    <p class="text-gray-500 text-sm mt-1">Word count: <span id="word-count">0</span></p>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="file-upload">Or Upload Document (Optional)</label>
                    <div class="border-2 border-dashed border-gray-200 rounded-xl p-6 text-center hover:border-green-400 transition-colors cursor-pointer" onclick="document.getElementById('file-upload').click()">
                      <span class="text-4xl mb-2 block">üìÑ</span>
                      <p class="text-gray-600">Click to upload or drag and drop</p>
                      <p class="text-gray-400 text-sm">DOC, DOCX, or PDF (Max 10MB)</p>
                      <input type="file" id="file-upload" class="hidden" accept=".doc,.docx,.pdf">
                    </div>
                  </div>
                  
                  <button type="submit" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                    Submit Essay ‚Üí
                  </button>
                </form>
              </div>
            `}
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderEarningsPage() {
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-2xl mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Your Earnings üí∞</h1>
              <p class="text-gray-500">Track your writing income</p>
            </div>
            
            <!-- Earnings Overview -->
            <div class="gradient-card rounded-3xl p-6 text-white soft-shadow mb-6 animate-fade-in" style="animation-delay: 100ms">
              <p class="text-white/80 mb-1">Total Earnings</p>
              <p class="text-4xl font-bold mb-4">${formatCurrency(state.earnings)}</p>
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-white/20 rounded-xl p-3">
                  <p class="text-white/80 text-sm">Pending</p>
                  <p class="font-bold text-xl">${formatCurrency(state.pendingEarnings)}</p>
                </div>
                <div class="bg-white/20 rounded-xl p-3">
                  <p class="text-white/80 text-sm">Withdrawn</p>
                  <p class="font-bold text-xl">${formatCurrency(state.withdrawnAmount)}</p>
                </div>
              </div>
            </div>
            
            <!-- Earnings Breakdown -->
            <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in" style="animation-delay: 200ms">
              <h2 class="font-bold text-lg mb-4">Earnings History</h2>
              ${state.completedTasks.length === 0 ? `
                <div class="text-center py-8 text-gray-400">
                  <span class="text-4xl mb-2 block">üìä</span>
                  <p>Complete tasks to see your earnings history</p>
                </div>
              ` : `
                <div class="space-y-3">
                  ${state.completedTasks.map(task => `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-xl">
                      <div>
                        <p class="font-medium text-gray-800">${task.topic.substring(0, 40)}...</p>
                        <p class="text-gray-500 text-sm">${task.book}</p>
                      </div>
                      <span class="text-green-600 font-bold">+${formatCurrency(task.payment / exchangeRate)}</span>
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderWithdrawPage() {
      if (!state.subscription) {
        return `
          ${renderHeader(true)}
          ${renderMenu()}
          <main class="min-h-screen px-4 py-6">
            <div class="max-w-md mx-auto text-center animate-fade-in">
              <div class="bg-white rounded-3xl soft-shadow p-8">
                <span class="text-6xl mb-4 block">üîí</span>
                <h2 class="font-bold text-2xl mb-2">Subscription Required</h2>
                <p class="text-gray-600 mb-6">You need an active subscription to withdraw. Choose a plan now!</p>
                <button onclick="navigateTo('subscription')" class="gradient-primary text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition-opacity">
                  View Plans
                </button>
              </div>
            </div>
          </main>
          ${renderFooter()}
        `;
      }
      
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-md mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Withdraw Funds üí∏</h1>
              <p class="text-gray-500">Transfer earnings to your account</p>
              <div class="mt-2 inline-block px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-bold">
                ${state.subscription.charAt(0).toUpperCase() + state.subscription.slice(1)}: ${state.subscription === 'premium' ? 'Instant' : '0-48h'} withdrawal
              </div>
            </div>
            
            <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in" style="animation-delay: 100ms">
              <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-2xl p-4 mb-6">
                <p class="text-gray-600 text-sm">Available Balance</p>
                <p class="text-3xl font-bold text-green-600">${formatCurrency(state.earnings - state.withdrawnAmount)}</p>
              </div>
              
              <form id="withdraw-form" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="withdraw-amount">Amount</label>
                  <input type="number" id="withdraw-amount" required min="5" max="${state.earnings - state.withdrawnAmount}" step="0.01" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="Enter amount" oninput="updateWithdrawalFee()">
                </div>
                
                <div class="bg-blue-50 rounded-xl p-3">
                  <div class="flex justify-between text-sm mb-2">
                    <span class="text-gray-600">Subtotal:</span>
                    <span class="font-medium" id="withdrawal-subtotal">$0.00</span>
                  </div>
                  <div class="flex justify-between text-sm mb-2 pb-2 border-b border-blue-200">
                    <span class="text-gray-600">Transaction Fee (10%):</span>
                    <span class="font-medium text-red-600" id="withdrawal-fee">-$0.00</span>
                  </div>
                  <div class="flex justify-between text-sm">
                    <span class="font-bold text-gray-800">You'll Receive:</span>
                    <span class="font-bold text-green-600" id="withdrawal-net">$0.00</span>
                  </div>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="withdraw-currency">Withdraw In</label>
                  <select id="withdraw-currency" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <option value="USD">US Dollars (USD)</option>
                    <option value="KES">Kenya Shillings (KES)</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="withdraw-method">Payment Method</label>
                  <select id="withdraw-method" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <option value="">Select method</option>
                    <option value="mpesa">M-Pesa</option>
                    <option value="bank">Bank Transfer</option>
                    <option value="paypal">PayPal</option>
                  </select>
                </div>
                
                <div class="bg-yellow-50 rounded-xl p-4">
                  <p class="text-yellow-800 text-sm">
                    <span class="font-bold">Note:</span> Minimum withdrawal is $0.50 (KSh 64.50). Processing time: ${state.subscription === 'premium' ? 'Instant' : '0-48 hours'}.
                  </p>
                </div>
                
                <button type="submit" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                  Continue to Review ‚Üí
                </button>
              </form>
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderSupportPage() {
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-md mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Support üí¨</h1>
              <p class="text-gray-500">We're here to help</p>
            </div>
            
            <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in" style="animation-delay: 100ms">
              <form id="support-form" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="support-subject">Subject</label>
                  <select id="support-subject" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <option value="">Select topic</option>
                    <option value="payment">Payment Issues</option>
                    <option value="task">Task Related</option>
                    <option value="account">Account Issues</option>
                    <option value="technical">Technical Support</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="support-message">Message</label>
                  <textarea id="support-message" rows="6" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all resize-none" placeholder="Describe your issue..."></textarea>
                </div>
                
                <button type="submit" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                  Send Message ‚Üí
                </button>
              </form>
              
              <div class="mt-6 pt-6 border-t border-gray-100">
                <p class="text-gray-600 text-sm text-center">
                  Or email us directly at<br>
                  <a href="mailto:joblifyafrica@gmail.com" class="text-green-600 font-medium">joblifyafrica@gmail.com</a>
                </p>
              </div>
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderForexPage() {
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-md mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Forex Center üí±</h1>
              <p class="text-gray-500">Currency conversion rates</p>
            </div>
            
            <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in" style="animation-delay: 100ms">
              <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-4 mb-6">
                <p class="text-gray-600 text-sm mb-2">Current Rate</p>
                <div class="flex items-center justify-between">
                  <span class="text-2xl font-bold text-purple-600">1 USD</span>
                  <span class="text-2xl">=</span>
                  <span class="text-2xl font-bold text-pink-600">KSh ${exchangeRate}</span>
                </div>
              </div>
              
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="forex-amount">Amount (USD)</label>
                  <input type="number" id="forex-amount" value="100" min="1" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" oninput="updateForex()">
                </div>
                
                <div class="bg-gray-50 rounded-xl p-4">
                  <p class="text-gray-600 text-sm">Equivalent in KES</p>
                  <p class="text-2xl font-bold text-green-600" id="forex-result">KSh ${(100 * exchangeRate).toLocaleString()}</p>
                </div>
              </div>
              
              <div class="mt-6 p-4 bg-blue-50 rounded-xl">
                <p class="text-blue-800 text-sm">
                  <span class="font-bold">üí° Tip:</span> Rates are updated daily. Actual conversion may vary slightly based on your withdrawal method.
                </p>
              </div>
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderSubscriptionPaymentPage() {
      const currentDate = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
      
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-md mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Verify Payment ‚úÖ</h1>
              <p class="text-gray-500">Complete your subscription</p>
            </div>
            
            <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in" style="animation-delay: 100ms">
              ${state.selectedPlan ? `
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-4 mb-6">
                  <p class="text-gray-600 text-sm mb-1">Selected Plan</p>
                  <p class="text-2xl font-bold text-purple-600">${state.selectedPlan.charAt(0).toUpperCase() + state.selectedPlan.slice(1)}</p>
                  <p class="text-gray-600 text-sm">${state.selectedPlan === 'basic' ? 'KSh 310' : 'KSh 489'}/month</p>
                </div>
                
                <!-- STK Push Button -->
                <div class="mb-6">
                  <button onclick="initiateStkPush('${state.selectedPlan}')" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity mb-2">
                    üí≥ Initiate STK Push
                  </button>
                  <p class="text-gray-500 text-xs text-center">You'll receive an M-Pesa prompt on your phone</p>
                </div>
                
                <!-- Already Paid Section -->
                <div class="border-t pt-6">
                  <button onclick="togglePaymentVerification()" class="text-green-600 font-medium text-sm hover:text-green-700 transition-colors">
                    ‚úì Already subscribed but payment not reflecting? Click here
                  </button>
                  
                  <div id="payment-verification" class="hidden mt-4">
                    <p class="text-gray-600 text-sm mb-3">Paste your M-Pesa payment message below:</p>
                    <textarea id="mpesa-message" rows="6" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all resize-none text-sm font-mono" placeholder="Paste your M-Pesa confirmation message here..."></textarea>
                    <button onclick="verifyMpesaMessage('${state.selectedPlan}', '${currentDate}')" class="w-full mt-3 bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition-colors">
                      Verify Payment
                    </button>
                  </div>
                </div>
              ` : `
                <div class="text-center py-8">
                  <span class="text-5xl mb-3 block">üéØ</span>
                  <p class="text-gray-600 text-sm">Select a subscription plan from the menu to continue</p>
                </div>
              `}
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    function renderRefundPage() {
      return `
        ${renderHeader(true)}
        ${renderMenu()}
        <main class="min-h-screen px-4 py-6">
          <div class="max-w-md mx-auto">
            <div class="mb-6 animate-fade-in">
              <h1 class="text-2xl font-bold text-gray-800">Request Refund ÔøΩÔøΩ</h1>
              <p class="text-gray-500">Submit a refund request</p>
            </div>
            
            <div class="bg-white rounded-3xl soft-shadow p-6 animate-fade-in" style="animation-delay: 100ms">
              <form id="refund-form" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="refund-reason">Reason for Refund</label>
                  <select id="refund-reason" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                    <option value="">Select reason</option>
                    <option value="wrong-payment">Wrong Payment Amount</option>
                    <option value="duplicate">Duplicate Payment</option>
                    <option value="service">Service Issue</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="refund-amount">Refund Amount ($)</label>
                  <input type="number" id="refund-amount" required min="1" step="0.01" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all" placeholder="Enter amount">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1" for="refund-details">Additional Details</label>
                  <textarea id="refund-details" rows="4" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all resize-none" placeholder="Please provide more details..."></textarea>
                </div>
                
                <div class="bg-yellow-50 rounded-xl p-4">
                  <p class="text-yellow-800 text-sm">
                    <span class="font-bold">Note:</span> Refund requests are processed within 5-7 business days. You will receive an email confirmation.
                  </p>
                </div>
                
                <button type="submit" class="w-full gradient-primary text-white py-4 rounded-xl font-bold text-lg hover:opacity-90 transition-opacity">
                  Submit Request ‚Üí
                </button>
              </form>
            </div>
          </div>
        </main>
        ${renderFooter()}
      `;
    }

    // Task Details Modal
    function renderTaskDetailsModal(task) {
      return `
        <div id="task-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" onclick="closeTaskModal(event)">
          <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90%] overflow-y-auto soft-shadow animate-fade-in" onclick="event.stopPropagation()">
            <!-- PDF-style header -->
            <div class="gradient-primary p-6 text-white">
              <div class="flex items-center gap-3 mb-4">
                <img src="logo.png" alt="Creativepay" class="app-logo" onerror="this.style.display='none'">
                <div>
                  <h2 class="font-bold text-xl">Creativepay</h2>
                  <p class="text-white/80 text-sm">Writing Task Details</p>
                </div>
              </div>
            </div>
            
            <div class="p-6">
              <div class="mb-6">
                <span class="inline-block px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium mb-3">${task.genre}</span>
                <h3 class="text-xl font-bold text-gray-800 mb-2">${task.topic}</h3>
                <p class="text-gray-500">From "${task.book}" by ${task.author}</p>
              </div>
              
              <div class="bg-gray-50 rounded-2xl p-5 mb-6">
                <h4 class="font-bold text-gray-800 mb-3">üìù Essay Question:</h4>
                <p class="text-gray-700 leading-relaxed">${task.question}</p>
              </div>
              
              <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-green-50 rounded-xl p-4">
                  <p class="text-gray-600 text-sm">Word Count</p>
                  <p class="font-bold text-green-600">${task.wordCount} words</p>
                </div>
                <div class="bg-pink-50 rounded-xl p-4">
                  <p class="text-gray-600 text-sm">Payment</p>
                  <p class="font-bold text-pink-600">${formatCurrency(task.payment / exchangeRate)}</p>
                </div>
                <div class="bg-purple-50 rounded-xl p-4">
                  <p class="text-gray-600 text-sm">Client</p>
                  <p class="font-bold text-purple-600">${task.client}</p>
                </div>
                <div class="bg-yellow-50 rounded-xl p-4">
                  <p class="text-gray-600 text-sm">Deadline</p>
                  <p class="font-bold text-yellow-600">${task.deadline}</p>
                </div>
              </div>
              
              <div class="flex gap-3">
                <button onclick="downloadTaskPDF('${task.id}')" class="flex-1 py-3 border-2 border-gray-200 rounded-xl font-bold text-gray-600 hover:border-green-400 transition-colors">
                  üì• Download PDF
                </button>
                <button onclick="acceptTask('${task.id}'); closeTaskModal()" class="flex-1 gradient-primary text-white py-3 rounded-xl font-bold hover:opacity-90 transition-opacity">
                  Accept Task
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Navigation and Actions
    function navigateTo(page) {
      state.currentPage = page;
      state.isMenuOpen = false;
      renderCurrentPage();
      window.scrollTo(0, 0);
    }

    function toggleMenu() {
      state.isMenuOpen = !state.isMenuOpen;
      renderCurrentPage();
    }

    function toggleCurrency() {
      state.currency = state.currency === 'USD' ? 'KES' : 'USD';
      renderCurrentPage();
    }

    function openWhatsApp() {
      window.open('https://chat.whatsapp.com/BB9RnEv8b5E9AuOafdAac6?mode=gi_t', '_blank', 'noopener,noreferrer');
    }

    function downloadApp() {
      window.open('https://appsgeyser.io/19496137/Creativepay', '_blank', 'noopener,noreferrer');
    }

    function logout() {
      const currentUserEmail = localStorage.getItem('creativepay_current_user');
      
      if (currentUserEmail) {
        // Save current state before logout
        saveAccountData(currentUserEmail);
      }
      
      // Clear current user session
      localStorage.removeItem('creativepay_current_user');
      
      // Reset state
      state.user = null;
      state.subscription = null;
      state.earnings = 0;
      state.pendingEarnings = 0;
      state.withdrawnAmount = 0;
      state.submittedTasks = [];
      state.acceptedTasks = [];
      state.completedTasks = [];
      state.recentActivity = [];
      state.tasksSubmittedThisMonth = 0;
      state.currentPage = 'landing';
      state.isMenuOpen = false;
      renderCurrentPage();
      showToast('Logged out successfully');
    }

    function showSubscriptionMenu() {
      state.isMenuOpen = false;
      const modal = document.createElement('div');
      modal.innerHTML = `
        <div id="subscription-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" onclick="closeSubModal(event)">
          <div class="bg-white rounded-3xl max-w-md w-full soft-shadow animate-fade-in" onclick="event.stopPropagation()">
            <div class="gradient-primary p-6 text-white">
              <h2 class="font-bold text-xl">Choose Your Plan</h2>
              <p class="text-white/80 text-sm">Select a subscription to continue</p>
            </div>
            
            <div class="p-6 space-y-3">
              <!-- Basic Plan -->
              <button onclick="selectPlanAndPay('basic')" class="w-full border-2 border-gray-200 rounded-2xl p-4 text-left hover:border-green-400 hover:bg-green-50 transition-all card-hover">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="font-bold">üåü Basic Plan</h3>
                  <span class="text-green-600 font-bold">KSh 310</span>
                </div>
                <p class="text-gray-600 text-sm">5 tasks/month ‚Ä¢ 0-48h withdrawals</p>
              </button>
              
              <!-- Premium Plan -->
              <button onclick="selectPlanAndPay('premium')" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl p-4 text-left hover:opacity-90 transition-all card-hover relative">
                <div class="absolute top-2 right-2 bg-yellow-400 text-gray-800 px-2 py-1 rounded text-xs font-bold">BEST</div>
                <div class="flex items-center justify-between mb-2">
                  <h3 class="font-bold">üëë Premium Plan</h3>
                  <span class="font-bold">KSh 489</span>
                </div>
                <p class="text-white/90 text-sm">10 tasks/month ‚Ä¢ Instant withdrawals ‚Ä¢ +10% bonus</p>
              </button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function closeSubModal(event) {
      if (event && event.target.id !== 'subscription-modal') return;
      const modal = document.getElementById('subscription-modal');
      if (modal) modal.remove();
    }

    function selectPlanAndPay(plan) {
      state.selectedPlan = plan;
      closeSubModal();
      navigateTo('subscription');
      renderCurrentPage();
    }

    function togglePaymentVerification() {
      const verificationDiv = document.getElementById('payment-verification');
      if (verificationDiv) {
        verificationDiv.classList.toggle('hidden');
      }
    }

    function initiateStkPush(plan) {
      const amount = plan === 'basic' ? '310' : '489';
      // Redirect to payment link
      window.open('https://lipana.dev/pay/starterkit', '_blank', 'noopener,noreferrer');
      showToast(`Opening payment link for KSh ${amount}...`);
    }

    function verifyMpesaMessage(plan, currentDate) {
      const mpesaMessage = document.getElementById('mpesa-message').value.trim();
      
      if (!mpesaMessage) {
        showToast('Please paste your M-Pesa message', 'error');
        return;
      }
      
      // Check for M-Pesa confirmation components
      const hasConfirmation = mpesaMessage.toLowerCase().includes('confirmed');
      const hasLipana = mpesaMessage.toLowerCase().includes('lipana') || mpesaMessage.toLowerCase().includes('lipana technologies');
      const amount = plan === 'basic' ? '310' : '489';
      const hasAmount = mpesaMessage.includes(amount);
      const hasDate = mpesaMessage.includes(currentDate);
      
      // Parse date from message (common M-Pesa format)
      const messageLower = mpesaMessage.toLowerCase();
      const dateMatch = mpesaMessage.match(/(\d{1,2}\/\d{1,2}\/\d{2,4}|\d{1,2}-\w+-\d{2,4})/);
      
      if (!hasConfirmation) {
        showToast('This doesn\'t look like a valid M-Pesa confirmation message', 'error');
        return;
      }
      
      if (!hasLipana) {
        showToast('Recipient should be "Lipana Technologies Limited"', 'error');
        return;
      }
      
      if (!hasAmount) {
        showToast(`Expected amount KSh ${amount} not found in message`, 'error');
        return;
      }
      
      // Payment verified!
      state.subscription = plan;
      state.selectedPlan = null;
      state.recentActivity.unshift({
        icon: '‚≠ê',
        title: `${plan.charAt(0).toUpperCase() + plan.slice(1)} subscription activated`,
        time: 'Just now',
        amount: null
      });
      
      saveToLocalStorage();
      document.getElementById('mpesa-message').value = '';
      showToast(`‚úÖ Payment verified! Welcome to ${plan === 'basic' ? 'Basic' : 'Premium'} plan!`);
      
      setTimeout(() => {
        navigateTo('dashboard');
      }, 1500);
    }

    function prevTaskPage() {
      if (state.currentTaskPage > 0) {
        state.currentTaskPage--;
        renderCurrentPage();
      }
    }

    function nextTaskPage(totalPages) {
      if (state.currentTaskPage < totalPages - 1) {
        state.currentTaskPage++;
        renderCurrentPage();
      }
    }

    function filterBySetbook(bookTitle) {
      state.currentTaskPage = 0;
      renderCurrentPage();
    }

    function findTaskById(taskId) {
      for (const book of setbooks) {
        const task = essayTopics[book.title].find(t => t.id === taskId);
        if (task) return task;
      }
      return null;
    }

    function viewTaskDetails(taskId) {
      const task = findTaskById(taskId);
      if (task) {
        document.body.insertAdjacentHTML('beforeend', renderTaskDetailsModal(task));
      }
    }

    function closeTaskModal(event) {
      if (event && event.target.id !== 'task-modal') return;
      const modal = document.getElementById('task-modal');
      if (modal) modal.remove();
    }

    function downloadTaskPDF(taskId) {
      const task = findTaskById(taskId);
      if (task) {
        const pdfContent = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêÔøΩÔøΩÔøΩ‚ïêÔøΩÔøΩÔøΩ‚ïó
‚ïë            CREATIVEPAY WRITING TASK DETAILS                ‚ïë
‚ïë    Kenya's #1 Creative Writing Platform                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

TASK INFORMATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Topic: ${task.topic}

Book: ${task.book}
Author: ${task.author}
Genre: ${task.genre}

CLIENT: ${task.client}


ESSAY QUESTION / PROMPT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${task.question}


TASK REQUIREMENTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêÔøΩÔøΩ‚ïê‚ïê‚ïêÔøΩÔøΩ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚Ä¢ Word Count: ${task.wordCount} words
‚Ä¢ Deadline: ${task.deadline}
‚Ä¢ Payment: ${formatCurrency(task.payment / exchangeRate)} (KSh ${task.payment.toLocaleString()})


INSTRUCTIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. Write original content - NO PLAGIARISM allowed
2. Follow academic writing standards
3. Cite sources where applicable
4. Proofread for grammar and spelling
5. Submit through the Creativepay platform
6. Payment processed upon approval


SUBMISSION CHECKLIST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚òê Essay addresses the prompt directly
‚òê Content is original and well-researched
‚òê Grammar and spelling are correct
‚òê Proper formatting and citations included
‚òê Word count meets requirement (${task.wordCount} words)
‚òê Ready for quality review


‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
¬© 2024 Creativepay Ltd. All rights reserved.
Document Generated: ${new Date().toLocaleString()}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêÔøΩÔøΩ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïêÔøΩÔøΩÔøΩ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        `;
        
        const blob = new Blob([pdfContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `creativepay-task-${taskId}.txt`;
        a.click();
        URL.revokeObjectURL(url);
        showToast('Task details downloaded!');
      }
    }

    function acceptTask(taskId) {
      const task = findTaskById(taskId);
      if (task && !state.acceptedTasks.find(t => t.id === taskId)) {
        state.acceptedTasks.push(task);
        state.recentActivity.unshift({
          icon: 'üìù',
          title: `Task accepted: ${task.topic.substring(0, 30)}...`,
          time: 'Just now',
          amount: null
        });
        saveToLocalStorage();
        closeTaskModal();
        showToast('Task accepted! Go to Submit to upload your work.');
        renderCurrentPage();
      }
    }

    function updateForex() {
      const amount = parseFloat(document.getElementById('forex-amount').value) || 0;
      document.getElementById('forex-result').textContent = `KSh ${(amount * exchangeRate).toLocaleString()}`;
    }

    // Essay Content Validation
    function validateEssayContent(essayText, task) {
      // Extract keywords from the task
      const taskKeywords = extractKeywords(task.topic + ' ' + task.book + ' ' + task.author);
      
      // Minimum word count (should be at least 60% of required)
      const minimumWords = Math.floor(task.wordCount * 0.6);
      const essayWords = essayText.split(/\s+/).filter(w => w).length;
      
      if (essayWords < minimumWords) {
        return {
          isValid: false,
          message: `Essay is too short. Minimum ${minimumWords} words required, but you provided ${essayWords}.`
        };
      }
      
      // Check for relevant keywords
      const essayLower = essayText.toLowerCase();
      const matchedKeywords = taskKeywords.filter(kw => essayLower.includes(kw.toLowerCase()));
      
      if (matchedKeywords.length < Math.max(2, taskKeywords.length * 0.3)) {
        return {
          isValid: false,
          message: `Essay doesn't seem related to the topic. Please ensure it discusses the key concepts from "${task.book}" and addresses the essay question.`
        };
      }
      
      // Check for minimum content depth (avoid very short sentences throughout)
      const sentences = essayText.split(/[.!?]+/).filter(s => s.trim().length > 0);
      const avgSentenceLength = essayWords / Math.max(sentences.length, 1);
      
      if (avgSentenceLength < 8) {
        return {
          isValid: false,
          message: 'Essay lacks depth. Please write more comprehensive sentences with better analysis.'
        };
      }
      
      return {
        isValid: true,
        message: 'Essay is valid'
      };
    }

    // Comprehensive essay scoring system - STRICT CRITERIA
    function scoreEssay(essayText, task) {
      let totalScore = 0;
      const feedback = [];
      
      // 1. Content Relevance (25 points) - STRICT
      const taskKeywords = extractKeywords(task.topic + ' ' + task.book + ' ' + task.author);
      const essayLower = essayText.toLowerCase();
      const matchedKeywords = taskKeywords.filter(kw => essayLower.includes(kw.toLowerCase()));
      const relevancePercentage = (matchedKeywords.length / taskKeywords.length);
      let relevanceScore = 0;
      
      if (relevancePercentage >= 0.8) {
        relevanceScore = 25;
        feedback.push('‚úÖ Excellent topic relevance and focus');
      } else if (relevancePercentage >= 0.6) {
        relevanceScore = 15;
        feedback.push('‚ö†Ô∏è Content could be more directly aligned with the prompt');
      } else {
        relevanceScore = 5;
        feedback.push('‚ùå Content lacks relevance to the essay topic - CRITICAL');
      }
      totalScore += relevanceScore;
      
      // 2. Word Count & Length (15 points) - VERY STRICT
      const essayWords = essayText.split(/\s+/).filter(w => w).length;
      const wordPercentage = (essayWords / task.wordCount) * 100;
      let wordCountScore = 0;
      
      if (wordPercentage >= 95 && wordPercentage <= 105) {
        wordCountScore = 15;
        feedback.push('‚úÖ Perfect word count compliance');
      } else if (wordPercentage >= 85 && wordPercentage <= 115) {
        wordCountScore = 8;
        feedback.push('‚ö†Ô∏è Word count slightly off target');
      } else {
        wordCountScore = 2;
        feedback.push('‚ùå Word count far below requirement - REJECTED');
      }
      totalScore += wordCountScore;
      
      // 3. Grammar & Language Quality (20 points) - STRICT
      const sentences = essayText.split(/[.!?]+/).filter(s => s.trim().length > 0);
      const avgSentenceLength = essayWords / Math.max(sentences.length, 1);
      const hasProperStructure = sentences.length > essayWords / 15;
      const hasVariation = essayText.match(/[,;:]/g) ? true : false;
      const hasComplexSentences = essayText.match(/\b(although|however|therefore|consequently|moreover|furthermore)\b/gi);
      
      let grammarScore = 0;
      if (grammarScore >= 18 && hasComplexSentences && hasVariation && avgSentenceLength >= 12) {
        grammarScore = 20;
        feedback.push('‚úÖ Excellent grammar and sophisticated structure');
      } else if (avgSentenceLength >= 10 && hasVariation && hasProperStructure) {
        grammarScore = 12;
        feedback.push('‚ö†Ô∏è Grammar acceptable but lacks sophistication');
      } else {
        grammarScore = 3;
        feedback.push('‚ùå Poor grammar and structure issues - REJECTED');
      }
      totalScore += grammarScore;
      
      // 4. Analysis Depth (20 points) - VERY STRICT
      const analysisIndicators = (essayText.match(/\b(analysis|analyze|examine|discuss|evaluate|argue|explain|evidence|support|demonstrate|illustrate|conclude|implies|suggests|reveals)\b/gi) || []).length;
      const citationPatterns = (essayText.match(/\b(according|quotes|states|argues|claims)\b/gi) || []).length;
      const depthScore = Math.min(20, (analysisIndicators * 1.5) + (citationPatterns * 2));
      
      if (depthScore >= 16) {
        feedback.push('‚úÖ Strong critical analysis with evidence');
      } else if (depthScore >= 10) {
        feedback.push('‚ö†Ô∏è Analysis is superficial - needs more depth');
      } else {
        feedback.push('‚ùå Insufficient analysis - mostly description - REJECTED');
      }
      totalScore += depthScore;
      
      // 5. Originality & Plagiarism Check (20 points) - STRICT
      const uniqueWords = new Set(essayText.toLowerCase().split(/\s+/)).size;
      const vocabularyDiversity = (uniqueWords / essayWords) * 100;
      let originalityScore = 0;
      
      if (vocabularyDiversity >= 65 && analysisIndicators >= 8) {
        originalityScore = 20;
        feedback.push('‚úÖ Strong vocabulary diversity - original work');
      } else if (vocabularyDiversity >= 50 && analysisIndicators >= 5) {
        originalityScore = 10;
        feedback.push('‚ö†Ô∏è Moderate originality - vocabulary could be more diverse');
      } else {
        originalityScore = 2;
        feedback.push('‚ùå Low vocabulary diversity - potential plagiarism risk - REJECTED');
      }
      totalScore += originalityScore;
      
      // Calculate final percentage - ALL SCORES BELOW 50%
      let finalPercentage = (totalScore / 100) * 100;
      // Force all scores below 50% range
      if (finalPercentage > 49) {
        finalPercentage = Math.random() * 40 + 10; // Random between 10-49%
      }
      finalPercentage = Math.round(finalPercentage);
      
      // Determine status (below 50%)
      let grade = 'F';
      let status = 'FAILED';
      
      if (finalPercentage >= 40) {
        grade = 'D';
        status = 'PASS (Low)';
      } else if (finalPercentage >= 30) {
        grade = 'F';
        status = 'FAILED';
      } else if (finalPercentage >= 20) {
        grade = 'F';
        status = 'REJECTED';
      } else {
        grade = 'F';
        status = 'REJECTED';
      }
      
      return {
        score: Math.round(totalScore),
        percentage: finalPercentage,
        grade,
        status,
        feedback,
        breakdown: {
          relevance: Math.round(relevanceScore),
          wordCount: Math.round(wordCountScore),
          grammar: Math.round(grammarScore),
          analysis: Math.round(depthScore),
          originality: Math.round(originalityScore)
        }
      };
    }

    function extractKeywords(text) {
      // Extract important words from text
      const stopWords = new Set([
        'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'is', 'are', 'was', 'were', 'be', 'been', 'being',
        'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may', 'might', 'can', 'must', 'this', 'that', 'these', 'those'
      ]);
      
      return text
        .toLowerCase()
        .split(/\s+/)
        .filter(word => word.length > 3 && !stopWords.has(word) && !word.match(/^\d+$/))
        .slice(0, 20);
    }

    function showTaskLimitModal(maxTasks) {
      const modal = document.createElement('div');
      modal.innerHTML = `
        <div id="limit-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" onclick="closeLimitModal(event)">
          <div class="bg-white rounded-3xl max-w-md w-full soft-shadow animate-fade-in" onclick="event.stopPropagation()">
            <div class="bg-gradient-to-br from-orange-500 to-red-500 p-6 text-white">
              <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <span class="text-3xl">‚è±Ô∏è</span>
              </div>
              <h2 class="font-bold text-xl text-center">Monthly Limit Reached</h2>
            </div>
            
            <div class="p-6 text-center">
              <p class="text-gray-600 mb-6">
                You've used all ${maxTasks} task submissions for this month. 
              </p>
              
              <div class="bg-blue-50 rounded-2xl p-4 mb-6 text-left">
                <p class="text-blue-800 text-sm">
                  <span class="font-bold">üí° Upgrade to Premium!</span><br>
                  Get 10 submissions/month instead of 5, instant withdrawals, and 10% bonus earnings.
                </p>
              </div>
              
              <div class="space-y-3">
                <button onclick="navigateTo('subscription'); closeLimitModal()" class="w-full gradient-primary text-white py-4 rounded-xl font-bold hover:opacity-90 transition-opacity">
                  Renew Subscription ‚Üí
                </button>
                <button onclick="closeLimitModal()" class="w-full py-4 border-2 border-gray-200 rounded-xl font-bold text-gray-700 hover:border-gray-300 transition-colors">
                  Continue Later
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function closeLimitModal(event) {
      if (event && event.target.id !== 'limit-modal') return;
      const modal = document.getElementById('limit-modal');
      if (modal) modal.remove();
    }

    function approveSubmission() {
      if (!state.currentSubmission) return;
      
      const { task, essayText } = state.currentSubmission;
      const scoreResult = scoreEssay(essayText, task);
      
      // Calculate payment in KES first
      let basePmentKes = task.payment; // Already in KES
      let actualPaymentKes = basePmentKes;
      
      // Payment scaling based on score percentage
      if (scoreResult.percentage >= 40) {
        actualPaymentKes = basePmentKes; // Full payment
      } else if (scoreResult.percentage >= 35) {
        actualPaymentKes = basePmentKes * 0.6; // 60% payment
      } else if (scoreResult.percentage >= 30) {
        actualPaymentKes = basePmentKes * 0.4; // 40% payment
      } else if (scoreResult.percentage >= 25) {
        actualPaymentKes = basePmentKes * 0.8; // 80% payment
      } else if (scoreResult.percentage >= 20) {
        actualPaymentKes = basePmentKes * 0.4; // 40% payment
      } else {
        actualPaymentKes = 0; // No payment
      }
      
      // Convert KES to USD
      let actualPaymentUsd = actualPaymentKes / exchangeRate;
      
      // Apply premium bonus if applicable
      if (state.subscription === 'premium') {
        actualPaymentUsd = actualPaymentUsd * 1.1; // 10% bonus
      }
      
      // Update state with USD amount
      state.completedTasks.push(task);
      state.submittedTasks = state.submittedTasks.filter(t => t.id !== state.currentSubmission.taskId);
      state.earnings += actualPaymentUsd;
      
      state.recentActivity.unshift({
        icon: '‚úÖ',
        title: `Task completed: ${task.topic.substring(0, 25)}... (${scoreResult.percentage}%)`,
        time: 'Just now',
        amount: actualPaymentUsd
      });
      
      state.currentSubmission = null;
      saveToLocalStorage();
      
      showToast(`üéâ Submitted! +${formatCurrency(actualPaymentUsd)} earned`);
      setTimeout(() => {
        navigateTo('dashboard');
      }, 1000);
    }

    function skipSubscription() {
      state.user.skippedSubscription = true;
      saveToLocalStorage();
      navigateTo('dashboard');
      showToast('You can select a subscription anytime from your dashboard!');
    }

    function updateForex() {
      const amount = parseFloat(document.getElementById('forex-amount').value) || 0;
      document.getElementById('forex-result').textContent = `KSh ${(amount * exchangeRate).toLocaleString()}`;
    }

    // Event Listeners
    function attachEventListeners() {
      // Login Form
      const loginForm = document.getElementById('login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const email = document.getElementById('login-email').value;
          const password = document.getElementById('login-password').value;
          
          // Load all saved accounts
          const allAccounts = JSON.parse(localStorage.getItem('creativepay_accounts') || '[]');
          const account = allAccounts.find(acc => acc.email === email);
          
          if (!account) {
            showToast('Account not found. Please create one first.', 'error');
            return;
          }
          
          if (account.password !== password) {
            showToast('Incorrect password', 'error');
            return;
          }
          
          // Load this account's data
          const accountData = JSON.parse(localStorage.getItem(`creativepay_${email}`) || '{}');
          state.user = account;
          state.subscription = accountData.subscription || null;
          state.earnings = accountData.earnings || 0;
          state.pendingEarnings = accountData.pendingEarnings || 0;
          state.withdrawnAmount = accountData.withdrawnAmount || 0;
          state.submittedTasks = accountData.submittedTasks || [];
          state.acceptedTasks = accountData.acceptedTasks || [];
          state.completedTasks = accountData.completedTasks || [];
          state.recentActivity = accountData.recentActivity || [];
          state.tasksSubmittedThisMonth = accountData.tasksSubmittedThisMonth || 0;
          state.monthlyReset = accountData.monthlyReset || new Date().getMonth();
          
          // Store current logged-in user
          localStorage.setItem('creativepay_current_user', email);
          
          navigateTo('dashboard');
          showToast(`Welcome back, ${account.name}!`);
        });
      }
      
      // Register Form
      const registerForm = document.getElementById('register-form');
      if (registerForm) {
        registerForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const name = document.getElementById('reg-name').value;
          const email = document.getElementById('reg-email').value;
          const phone = document.getElementById('reg-phone').value;
          const password = document.getElementById('reg-password').value;
          const confirm = document.getElementById('reg-confirm').value;
          
          if (password !== confirm) {
            showToast('Passwords do not match', 'error');
            return;
          }
          
          // Check if email already exists
          const allAccounts = JSON.parse(localStorage.getItem('creativepay_accounts') || '[]');
          if (allAccounts.find(acc => acc.email === email)) {
            showToast('Email already registered. Please login instead.', 'error');
            return;
          }
          
          // Create new account
          const newAccount = { name, email, phone, password };
          allAccounts.push(newAccount);
          localStorage.setItem('creativepay_accounts', JSON.stringify(allAccounts));
          
          // Set current user
          state.user = newAccount;
          localStorage.setItem('creativepay_current_user', email);
          
          await sendToWeb3Forms({
            subject: 'New Registration - Creativepay',
            name,
            email,
            phone,
            type: 'registration'
          });
          
          navigateTo('declaration');
          showToast('Account created! Please accept the terms.');
        });
      }
      
      // Declaration Form
      const declarationForm = document.getElementById('declaration-form');
      if (declarationForm) {
        declarationForm.addEventListener('submit', (e) => {
          e.preventDefault();
          navigateTo('payment');
        });
      }
      
      // Payment Form
      const paymentForm = document.getElementById('payment-form');
      if (paymentForm) {
        const methodSelect = document.getElementById('payment-method');
        methodSelect.addEventListener('change', (e) => {
          document.getElementById('mpesa-fields').classList.add('hidden');
          document.getElementById('bank-fields').classList.add('hidden');
          document.getElementById('paypal-fields').classList.add('hidden');
          
          if (e.target.value === 'mpesa') {
            document.getElementById('mpesa-fields').classList.remove('hidden');
          } else if (e.target.value === 'bank') {
            document.getElementById('bank-fields').classList.remove('hidden');
          } else if (e.target.value === 'paypal') {
            document.getElementById('paypal-fields').classList.remove('hidden');
          }
        });
        
        paymentForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const method = document.getElementById('payment-method').value;
          
          let paymentDetails = { method };
          if (method === 'mpesa') {
            paymentDetails.mpesaName = document.getElementById('mpesa-name').value;
            paymentDetails.mpesaNumber = document.getElementById('mpesa-number').value;
          } else if (method === 'bank') {
            paymentDetails.bankName = document.getElementById('bank-name').value;
            paymentDetails.accountNumber = document.getElementById('account-number').value;
          } else if (method === 'paypal') {
            paymentDetails.paypalEmail = document.getElementById('paypal-email').value;
          }
          
          state.user.paymentMethod = paymentDetails;
          state.earnings = 2; // Welcome bonus
          state.recentActivity.push({
            icon: 'ÔøΩÔøΩÔøΩÔøΩ',
            title: 'Welcome bonus received',
            time: 'Just now',
            amount: 2
          });
          
          await sendToWeb3Forms({
            subject: 'Payment Setup - Creativepay',
            name: state.user.name,
            email: state.user.email,
            ...paymentDetails,
            type: 'payment_setup',
            welcome_bonus: '$2.00'
          });
          
          saveToLocalStorage();
          navigateTo('dashboard');
          showToast('üéâ Welcome! You received a $2.00 bonus!');
        });
      }
      
      // Submit Form
      const submitForm = document.getElementById('submit-form');
      if (submitForm) {
        const essayContent = document.getElementById('essay-content');
        if (essayContent) {
          essayContent.addEventListener('input', () => {
            const words = essayContent.value.trim().split(/\s+/).filter(w => w).length;
            document.getElementById('word-count').textContent = words;
          });
        }
        
        submitForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          const maxTasks = state.subscription === 'basic' ? 5 : 10;
          if (state.tasksSubmittedThisMonth >= maxTasks) {
            showTaskLimitModal(maxTasks);
            return;
          }
          
          const taskId = document.getElementById('task-select').value;
          const task = state.acceptedTasks.find(t => t.id === taskId);
          const essayText = document.getElementById('essay-content').value.trim();
          
          if (!task) {
            showToast('Please select a task', 'error');
            return;
          }
          
          // Validate content quality and relevance
          const validationResult = validateEssayContent(essayText, task);
          if (!validationResult.isValid) {
            showToast(validationResult.message, 'error');
            return;
          }
          
          state.acceptedTasks = state.acceptedTasks.filter(t => t.id !== taskId);
          state.submittedTasks.push(task);
          state.tasksSubmittedThisMonth++;
          
          // Store submission for review
          state.currentSubmission = {
            task,
            essayText,
            taskId
          };
          
          state.recentActivity.unshift({
            icon: 'üì§',
            title: `Submitted: ${task.topic.substring(0, 30)}...`,
            time: 'Just now',
            amount: null
          });
          
          saveToLocalStorage();
          showToast('Essay submitted! Processing...');
          
          // Simulate review process
          setTimeout(() => {
            state.currentPage = 'essay-review';
            renderCurrentPage();
          }, 1500);
        });
      }
      
      // Withdraw Form
      const withdrawForm = document.getElementById('withdraw-form');
      if (withdrawForm) {
        withdrawForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const amount = parseFloat(document.getElementById('withdraw-amount').value);
          const currency = document.getElementById('withdraw-currency').value;
          const method = document.getElementById('withdraw-method').value;
          
          const available = state.earnings - state.withdrawnAmount;
          if (amount > available) {
            showToast('Insufficient balance', 'error');
            return;
          }
          
          if (amount < 0.5) {
            showToast('Minimum withdrawal is $0.50', 'error');
            return;
          }
          
          if (!method) {
            showToast('Please select a payment method', 'error');
            return;
          }
          
          state.pendingWithdrawal = {
            amount,
            currency,
            method
          };
          
          saveToLocalStorage();
          navigateTo('withdraw-confirm');
        });
      }
      
      // Support Form
      const supportForm = document.getElementById('support-form');
      if (supportForm) {
        supportForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const subject = document.getElementById('support-subject').value;
          const message = document.getElementById('support-message').value;
          
          await sendToWeb3Forms({
            subject: `Support: ${subject} - Creativepay`,
            name: state.user?.name || 'Guest',
            email: state.user?.email || 'Not provided',
            message,
            type: 'support'
          });
          
          showToast('Message sent! We\'ll respond within 24 hours.');
          document.getElementById('support-message').value = '';
        });
      }
      
      // Refund Form
      const refundForm = document.getElementById('refund-form');
      if (refundForm) {
        refundForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const reason = document.getElementById('refund-reason').value;
          const amount = document.getElementById('refund-amount').value;
          const details = document.getElementById('refund-details').value;
          
          await sendToWeb3Forms({
            subject: 'Refund Request - Creativepay',
            name: state.user?.name || 'Guest',
            email: state.user?.email || 'Not provided',
            reason,
            amount: `$${amount}`,
            details,
            type: 'refund'
          });
          
          showToast('Refund request submitted! We\'ll review within 5-7 days.');
          navigateTo('dashboard');
        });
      }
    }

    // Initialize
    loadFromLocalStorage();
    renderCurrentPage();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ca9a4e0a2599c05',t:'MTc3MDUzODE1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>