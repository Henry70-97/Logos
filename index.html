<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creativepay - Creative Writing Earning Platform</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Plus Jakarta Sans', sans-serif; }
    html, body { height: 100%; margin: 0; }
    .gradient-primary { background: linear-gradient(135deg, #10b981, #ec4899, #ef4444, #eab308, #8b5cf6, #14b8a6); }
    .gradient-card { background: linear-gradient(135deg, #10b981 0%, #14b8a6 50%, #8b5cf6 100%); }
    .gradient-btn { background: linear-gradient(135deg, #10b981, #14b8a6); }
    .gradient-btn:hover { background: linear-gradient(135deg, #059669, #0d9488); }
    .floating-shape { position: absolute; border-radius: 50%; opacity: 0.1; animation: float 6s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
    @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .slide-in { animation: slideIn 0.3s ease-out; }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    .spinner { animation: spin 1s linear infinite; }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    .video-strip { height: 60px; background: linear-gradient(90deg, #10b981, #8b5cf6, #ec4899); }
    .mini-tv { width: 80px; height: 45px; background: #000; border-radius: 4px; overflow: hidden; }
    .menu-item { transition: all 0.2s ease; }
    .menu-item:hover { background: rgba(16, 185, 129, 0.1); transform: translateX(4px); }
    .task-card:nth-child(odd) { background: linear-gradient(135deg, #fdf2f8, #fce7f3); }
    .task-card:nth-child(even) { background: linear-gradient(135deg, #ecfdf5, #d1fae5); }
    .task-card:nth-child(3n) { background: linear-gradient(135deg, #fef3c7, #fde68a); }
    .task-card:nth-child(4n) { background: linear-gradient(135deg, #ede9fe, #ddd6fe); }
    .pdf-modal { background: #fff; box-shadow: 0 0 30px rgba(0,0,0,0.2); }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 3px; }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-pink-50 via-white to-pink-100 overflow-x-hidden"><!-- Floating Shapes -->
  <div class="floating-shape bg-green-500 w-32 h-32 top-20 left-10" style="animation-delay: 0s;"></div>
  <div class="floating-shape bg-pink-500 w-24 h-24 top-40 right-20" style="animation-delay: 1s;"></div>
  <div class="floating-shape bg-purple-500 w-20 h-20 bottom-40 left-1/4" style="animation-delay: 2s;"></div>
  <div class="floating-shape bg-yellow-500 w-28 h-28 bottom-20 right-1/3" style="animation-delay: 3s;"></div>
  <div class="floating-shape bg-teal-500 w-16 h-16 top-1/3 right-10" style="animation-delay: 4s;"></div><!-- Video Strip -->
  <div class="video-strip fixed top-0 left-0 right-0 z-50 flex items-center justify-center gap-4 px-4">
   <div class="mini-tv flex items-center justify-center">
    <video src="video.mp4" autoplay muted loop class="w-full h-full object-cover"></video>
   </div>
   <div class="mini-tv flex items-center justify-center">
    <video src="video.mp4" autoplay muted loop class="w-full h-full object-cover"></video>
   </div>
   <div class="mini-tv flex items-center justify-center">
    <video src="video.mp4" autoplay muted loop class="w-full h-full object-cover"></video>
   </div>
  </div><!-- Main Container -->
  <div id="app" class="h-full pt-16 overflow-auto"><!-- Landing Page -->
   <div id="landing-page" class="min-h-full"><!-- Header -->
    <header class="px-4 py-4 flex items-center justify-between">
     <div class="flex items-center gap-2"><img src="logo.png" alt="Creativepay Logo" class="w-10 h-10 object-contain" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <div class="w-10 h-10 gradient-card rounded-xl flex items-center justify-center hidden"><span class="text-white text-xl">‚úçÔ∏è</span>
      </div><span class="font-bold text-xl text-gray-800" id="site-title">Creativepay</span>
     </div><button onclick="showSection('login-page')" class="gradient-btn text-white px-4 py-2 rounded-full text-sm font-semibold"> Login </button>
    </header><!-- Hero Section -->
    <section class="px-4 py-12 text-center fade-in">
     <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-4 leading-tight">Earn From Your <span class="bg-gradient-to-r from-green-500 via-pink-500 to-purple-500 bg-clip-text text-transparent"> Creative Writing </span></h1>
     <p class="text-gray-600 text-lg mb-8 max-w-md mx-auto" id="tagline">Write essays on Kenyan literature, share your stories, and get paid. Join thousands of writers earning from their creativity.</p>
     <div class="flex flex-col sm:flex-row gap-4 justify-center"><button onclick="showSection('register-page')" class="gradient-btn text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition-all"> Start Earning Today ‚Üí </button> <button onclick="showSection('login-page')" class="bg-white text-gray-800 px-8 py-4 rounded-2xl font-bold text-lg shadow-lg border-2 border-gray-200 hover:border-green-500 transition-all"> I Have an Account </button>
     </div>
    </section><!-- Features -->
    <section class="px-4 py-8">
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto">
      <div class="bg-white rounded-3xl p-6 shadow-lg card-hover">
       <div class="w-14 h-14 bg-green-100 rounded-2xl flex items-center justify-center mb-4"><span class="text-3xl">üìö</span>
       </div>
       <h3 class="font-bold text-lg mb-2">Setbook Essays</h3>
       <p class="text-gray-600 text-sm">Write essays on popular Kenyan literature and earn $5 per page</p>
      </div>
      <div class="bg-white rounded-3xl p-6 shadow-lg card-hover">
       <div class="w-14 h-14 bg-pink-100 rounded-2xl flex items-center justify-center mb-4"><span class="text-3xl">‚ú®</span>
       </div>
       <h3 class="font-bold text-lg mb-2">Creative Stories</h3>
       <p class="text-gray-600 text-sm">Get prompts, write short stories, and share your unique voice</p>
      </div>
      <div class="bg-white rounded-3xl p-6 shadow-lg card-hover">
       <div class="w-14 h-14 bg-purple-100 rounded-2xl flex items-center justify-center mb-4"><span class="text-3xl">üí∞</span>
       </div>
       <h3 class="font-bold text-lg mb-2">Fast Payouts</h3>
       <p class="text-gray-600 text-sm">Withdraw in USD or KES with minimum $1 withdrawal</p>
      </div>
     </div>
    </section><!-- Stats -->
    <section class="px-4 py-8">
     <div class="bg-white rounded-3xl p-8 shadow-xl max-w-2xl mx-auto">
      <div class="grid grid-cols-3 gap-4 text-center">
       <div>
        <p class="text-3xl font-extrabold text-green-500">5K+</p>
        <p class="text-gray-500 text-sm">Writers</p>
       </div>
       <div>
        <p class="text-3xl font-extrabold text-pink-500">$50K+</p>
        <p class="text-gray-500 text-sm">Paid Out</p>
       </div>
       <div>
        <p class="text-3xl font-extrabold text-purple-500">10K+</p>
        <p class="text-gray-500 text-sm">Tasks Done</p>
       </div>
      </div>
     </div>
    </section><!-- Footer -->
    <footer class="px-4 py-8 text-center border-t border-gray-200 mt-8">
     <div class="flex justify-center gap-6 mb-4"><a href="#" class="text-gray-500 hover:text-green-500">Terms</a> <a href="#" class="text-gray-500 hover:text-green-500">Privacy</a> <a href="#" class="text-gray-500 hover:text-green-500">Contact</a>
     </div>
     <div class="flex justify-center gap-4 mb-4"><span class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-green-100">üìò</span> <span class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-pink-100">üì∏</span> <span class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center cursor-pointer hover:bg-purple-100">üê¶</span>
     </div>
     <p class="text-gray-400 text-sm">¬© 2024 Creativepay. All rights reserved.</p>
    </footer>
   </div><!-- Login Page -->
   <div id="login-page" class="min-h-full px-4 py-8 hidden">
    <div class="max-w-md mx-auto"><button onclick="showSection('landing-page')" class="flex items-center gap-2 text-gray-600 mb-6"> <span>‚Üê</span> Back </button>
     <div class="bg-white rounded-3xl p-8 shadow-xl fade-in">
      <div class="text-center mb-8"><img src="logo.png" alt="Creativepay Logo" class="w-16 h-16 object-contain mx-auto mb-4" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
       <div class="w-16 h-16 gradient-card rounded-2xl flex items-center justify-center mx-auto mb-4 hidden"><span class="text-3xl">‚úçÔ∏è</span>
       </div>
       <h2 class="text-2xl font-bold">Welcome Back!</h2>
       <p class="text-gray-500">Login to continue earning</p>
      </div>
      <form onsubmit="handleLogin(event)">
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="login-email" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none transition-all" placeholder="your@email.com">
       </div>
       <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input type="password" id="login-password" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
       </div><button type="submit" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Login </button>
      </form>
      <p class="text-center mt-6 text-gray-500">Don't have an account? <button onclick="showSection('register-page')" class="text-green-500 font-semibold">Register</button></p>
     </div>
    </div>
   </div><!-- Register Page -->
   <div id="register-page" class="min-h-full px-4 py-8 hidden">
    <div class="max-w-md mx-auto"><button onclick="showSection('landing-page')" class="flex items-center gap-2 text-gray-600 mb-6"> <span>‚Üê</span> Back </button>
     <div class="bg-white rounded-3xl p-8 shadow-xl fade-in">
      <div class="text-center mb-8">
       <h2 class="text-2xl font-bold">Create Account</h2>
       <p class="text-gray-500">Join our community of writers</p>
      </div>
      <form onsubmit="handleRegister(event)">
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label> <input type="text" id="reg-name" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="John Doe">
       </div>
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="reg-email" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="your@email.com">
       </div>
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Phone</label> <input type="tel" id="reg-phone" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="+254 700 000 000">
       </div>
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input type="password" id="reg-password" required minlength="6" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
       </div>
       <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label> <input type="password" id="reg-confirm" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
       </div><button type="submit" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Continue ‚Üí </button>
      </form>
     </div>
    </div>
   </div><!-- Declaration Page -->
   <div id="declaration-page" class="min-h-full px-4 py-8 hidden">
    <div class="max-w-md mx-auto">
     <div class="bg-white rounded-3xl p-8 shadow-xl fade-in">
      <div class="text-center mb-8">
       <div class="w-16 h-16 bg-yellow-100 rounded-2xl flex items-center justify-center mx-auto mb-4"><span class="text-3xl">üìú</span>
       </div>
       <h2 class="text-2xl font-bold">Writer's Declaration</h2>
       <p class="text-gray-500">Please read and accept our terms</p>
      </div>
      <div class="bg-gray-50 rounded-2xl p-4 mb-6 max-h-64 overflow-y-auto text-sm text-gray-600">
       <h3 class="font-bold mb-2">Terms &amp; Conditions</h3>
       <p class="mb-2">By joining Creativepay, I declare that:</p>
       <ul class="list-disc pl-4 space-y-2">
        <li>All work submitted will be original and plagiarism-free</li>
        <li>I will not copy from other sources without proper citation</li>
        <li>I understand that payment is $5 per page (250 words)</li>
        <li>I agree to the 10% transaction fee on withdrawals</li>
        <li>I will complete accepted tasks within the deadline</li>
        <li>I understand minimum withdrawal is $1</li>
        <li>I accept that first withdrawal requires membership approval</li>
        <li>I will maintain professional communication</li>
        <li>I agree to the privacy policy and data handling practices</li>
       </ul>
      </div><label class="flex items-center gap-3 mb-6 cursor-pointer"> <input type="checkbox" id="accept-terms" class="w-5 h-5 rounded text-green-500"> <span class="text-sm text-gray-700">I have read and accept the terms</span> </label> <button onclick="acceptDeclaration()" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Accept &amp; Continue ‚Üí </button>
     </div>
    </div>
   </div><!-- Payment Setup Page -->
   <div id="payment-setup-page" class="min-h-full px-4 py-8 hidden">
    <div class="max-w-md mx-auto">
     <div class="bg-white rounded-3xl p-8 shadow-xl fade-in">
      <div class="text-center mb-8">
       <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-4"><span class="text-3xl">üí≥</span>
       </div>
       <h2 class="text-2xl font-bold">Payment Setup</h2>
       <p class="text-gray-500">Set up your withdrawal method</p>
      </div>
      <form onsubmit="handlePaymentSetup(event)">
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Preferred Currency</label> <select id="pref-currency" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none"> <option value="USD">USD (US Dollars)</option> <option value="KES">KES (Kenyan Shillings)</option> </select>
       </div>
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Payment Method</label> <select id="payment-method" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none"> <option value="mpesa">M-Pesa</option> <option value="paypal">PayPal</option> <option value="bank">Bank Transfer</option> </select>
       </div>
       <div class="mb-4" id="mpesa-field"><label class="block text-sm font-medium text-gray-700 mb-2">M-Pesa Number</label> <input type="tel" id="mpesa-number" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="+254 700 000 000">
       </div>
       <div class="mb-4 hidden" id="paypal-field"><label class="block text-sm font-medium text-gray-700 mb-2">PayPal Email</label> <input type="email" id="paypal-email" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="paypal@email.com">
       </div>
       <div class="mb-6 hidden" id="bank-field"><label class="block text-sm font-medium text-gray-700 mb-2">Bank Account Number</label> <input type="text" id="bank-account" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="1234567890">
       </div><button type="submit" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Complete Setup ‚Üí </button>
      </form>
     </div>
    </div>
   </div><!-- Dashboard -->
   <div id="dashboard-page" class="min-h-full hidden"><!-- Dashboard Header -->
    <header class="px-4 py-4 flex items-center justify-between bg-white/80 backdrop-blur-lg sticky top-16 z-40"><button onclick="toggleMenu()" class="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center"> <span class="text-xl">‚ò∞</span> </button>
     <div class="flex items-center gap-2"><img src="logo.png" alt="Creativepay Logo" class="w-10 h-10 object-contain" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <div class="w-10 h-10 gradient-card rounded-xl flex items-center justify-center hidden"><span class="text-white text-xl">‚úçÔ∏è</span>
      </div><span class="font-bold text-xl text-gray-800">Creativepay</span>
     </div>
     <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"><span class="text-lg" id="user-avatar">üë§</span>
     </div>
    </header><!-- Slide Menu -->
    <div id="slide-menu" class="fixed inset-0 z-50 hidden">
     <div class="absolute inset-0 bg-black/50" onclick="toggleMenu()"></div>
     <div class="absolute left-0 top-0 bottom-0 w-72 bg-white shadow-2xl slide-in overflow-y-auto">
      <div class="p-6 gradient-card">
       <div class="flex items-center gap-3 mb-4"><img src="logo.png" alt="Creativepay Logo" class="w-12 h-12 object-contain" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center hidden"><span class="text-2xl">‚úçÔ∏è</span>
        </div>
        <div>
         <h3 class="text-white font-bold text-lg" id="menu-username">Writer</h3>
         <p class="text-white/80 text-sm" id="menu-email">writer@email.com</p>
        </div>
       </div>
      </div>
      <nav class="p-4"><button onclick="navigateTo('home')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üè†</span> Home </button> <button onclick="navigateTo('available-tasks')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üìã</span> Available Tasks </button> <button onclick="navigateTo('writing-tasks')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üìö</span> Writing Tasks </button> <a href="https://chathero.joblify.top" target="_blank" rel="noopener noreferrer" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>ü§ñ</span> Chat Hero </a> <button onclick="navigateTo('my-story')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>‚ú®</span> My Story </button> <button onclick="navigateTo('submit-task')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üì§</span> Submit Task </button> <button onclick="navigateTo('earnings')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üíµ</span> Earnings </button> <button onclick="navigateTo('transactions')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üìä</span> Transactions </button> <button onclick="navigateTo('withdraw')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üí∏</span> Withdraw </button> <button onclick="navigateTo('support')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üí¨</span> Support </button> <button onclick="navigateTo('forex')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üí±</span> Forex Center </button> <button onclick="navigateTo('subscription')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>‚≠ê</span> Subscription </button> <a href="https://chat.whatsapp.com/BB9RnEv8b5E9AuOafdAac6?mode=gi_t" target="_blank" rel="noopener noreferrer" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üë•</span> Meet Other Writers </a> <a href="https://appsgeyser.io/19496137/Creativepay" target="_blank" rel="noopener noreferrer" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>üì±</span> Download App </a> <button onclick="navigateTo('refund')" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3"> <span>‚Ü©Ô∏è</span> Refund </button> <button onclick="handleLogout()" class="menu-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-red-500"> <span>üö™</span> Logout </button>
      </nav>
     </div>
    </div><!-- Dashboard Content -->
    <div id="dashboard-content" class="px-4 py-6"><!-- Home Section -->
     <div id="home-section" class="fade-in"><!-- Balance Card -->
      <div class="gradient-card rounded-3xl p-6 mb-6 text-white shadow-xl">
       <p class="text-white/80 text-sm mb-1">Total Earnings</p>
       <div class="flex items-center gap-2 mb-4">
        <h2 class="text-4xl font-extrabold" id="balance-display">$0.00</h2><button onclick="toggleCurrency()" class="bg-white/20 px-3 py-1 rounded-full text-sm" id="currency-toggle">USD</button>
       </div>
       <div class="flex gap-3"><button onclick="navigateTo('available-tasks')" class="flex-1 bg-white text-green-600 py-3 rounded-xl font-bold"> Start Writing </button> <button onclick="navigateTo('withdraw')" class="flex-1 bg-white/20 text-white py-3 rounded-xl font-bold border border-white/30"> Withdraw </button>
       </div>
      </div><!-- Quick Stats -->
      <div class="grid grid-cols-3 gap-3 mb-6">
       <div class="bg-white rounded-2xl p-4 text-center shadow-lg">
        <p class="text-2xl font-bold text-green-500" id="tasks-completed">0</p>
        <p class="text-xs text-gray-500">Completed</p>
       </div>
       <div class="bg-white rounded-2xl p-4 text-center shadow-lg">
        <p class="text-2xl font-bold text-pink-500" id="tasks-pending">0</p>
        <p class="text-xs text-gray-500">Pending</p>
       </div>
       <div class="bg-white rounded-2xl p-4 text-center shadow-lg">
        <p class="text-2xl font-bold text-purple-500" id="total-withdrawn">$0</p>
        <p class="text-xs text-gray-500">Withdrawn</p>
       </div>
      </div><!-- Recent Activity -->
      <div class="bg-white rounded-3xl p-6 shadow-xl mb-6">
       <h3 class="font-bold text-lg mb-4">Recent Activity</h3>
       <div id="recent-activity" class="space-y-3">
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
         <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"><span>üéâ</span>
         </div>
         <div class="flex-1">
          <p class="font-medium text-sm">Welcome to Creativepay!</p>
          <p class="text-xs text-gray-500">Just now</p>
         </div><span class="text-green-500 font-bold text-sm">+$0</span>
        </div>
       </div>
      </div><!-- Download App Banner --> <a href="https://appsgeyser.io/19496137/Creativepay" target="_blank" rel="noopener noreferrer" class="block bg-gradient-to-r from-purple-500 to-pink-500 rounded-3xl p-6 text-white shadow-xl mb-6">
       <div class="flex items-center gap-4">
        <div class="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center"><span class="text-3xl">üì±</span>
        </div>
        <div>
         <h3 class="font-bold text-lg">Download Our App</h3>
         <p class="text-white/80 text-sm">Get the mobile app for better experience</p>
        </div>
       </div></a>
     </div><!-- Available Tasks Section -->
     <div id="available-tasks-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Available Tasks</h2>
      <div id="available-tasks-list" class="space-y-4"></div>
     </div><!-- Writing Tasks Section (Setbook Essays) -->
     <div id="writing-tasks-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Setbook Essays</h2>
      <div class="mb-4"><select id="setbook-filter" onchange="filterSetbookTasks()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none bg-white"> <option value="all">All Setbooks</option> <option value="river-between">The River Between - Ngugi wa Thiong'o</option> <option value="blossoms">Blossoms of the Savannah - Henry Ole Kulet</option> <option value="doll">A Doll's House - Henrik Ibsen</option> <option value="inheritance">Inheritance - David Mulwa</option> <option value="memories">Memories We Lost - Lidudumalingani</option> </select>
      </div>
      <div id="writing-tasks-list" class="space-y-4"></div>
      <div class="flex justify-center gap-4 mt-6"><button onclick="prevSetbookPage()" id="prev-setbook-btn" class="px-6 py-3 bg-white rounded-xl font-semibold shadow-lg disabled:opacity-50" disabled> ‚Üê Previous </button> <span id="setbook-page-info" class="px-4 py-3 text-gray-600">Page 1</span> <button onclick="nextSetbookPage()" id="next-setbook-btn" class="px-6 py-3 bg-white rounded-xl font-semibold shadow-lg"> Next ‚Üí </button>
      </div>
     </div><!-- My Story Section -->
     <div id="my-story-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Story Prompts</h2>
      <p class="text-gray-600 mb-4">Choose a prompt and write your unique story!</p>
      <div id="story-prompts-list" class="space-y-4"></div>
      <div class="flex justify-center gap-4 mt-6"><button onclick="prevStoryPage()" id="prev-story-btn" class="px-6 py-3 bg-white rounded-xl font-semibold shadow-lg disabled:opacity-50" disabled> ‚Üê Previous </button> <span id="story-page-info" class="px-4 py-3 text-gray-600">Page 1</span> <button onclick="nextStoryPage()" id="next-story-btn" class="px-6 py-3 bg-white rounded-xl font-semibold shadow-lg"> Next ‚Üí </button>
      </div>
     </div><!-- Submit Task Section -->
     <div id="submit-task-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Submit Task</h2>
      <div id="active-task-info" class="bg-white rounded-3xl p-6 shadow-xl mb-6">
       <p class="text-gray-500 text-center py-8">No active task. Accept a task first to submit.</p>
      </div>
      <div id="submit-form-container" class="hidden">
       <form onsubmit="submitTask(event)" class="bg-white rounded-3xl p-6 shadow-xl">
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Paste Your Work</label> <textarea id="task-content" rows="10" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="Paste your completed essay or story here..."></textarea>
        </div>
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Or Upload File</label> <input type="file" id="task-file" accept=".doc,.docx,.pdf,.txt" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none">
        </div>
        <p class="text-sm text-gray-500 mb-4">Word count: <span id="word-count">0</span> words</p><button type="submit" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Submit Task for Review </button>
       </form>
      </div>
     </div><!-- Earnings Section -->
     <div id="earnings-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">My Earnings</h2>
      <div class="gradient-card rounded-3xl p-6 mb-6 text-white shadow-xl">
       <p class="text-white/80 text-sm mb-1">Available Balance</p>
       <h2 class="text-4xl font-extrabold mb-2" id="earnings-balance">$0.00</h2>
       <p class="text-white/80 text-sm">‚âà KES <span id="earnings-kes">0</span></p>
      </div>
      <div class="bg-white rounded-3xl p-6 shadow-xl">
       <h3 class="font-bold text-lg mb-4">Earnings History</h3>
       <div id="earnings-history" class="space-y-3">
        <p class="text-gray-500 text-center py-4">No earnings yet. Start completing tasks!</p>
       </div>
      </div>
     </div><!-- Transactions Section -->
     <div id="transactions-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Recent Transactions</h2>
      <div class="bg-white rounded-3xl p-6 shadow-xl">
       <div id="transactions-list" class="space-y-3">
        <p class="text-gray-500 text-center py-4">No transactions yet</p>
       </div>
      </div>
     </div><!-- Withdraw Section -->
     <div id="withdraw-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Withdraw Funds</h2>
      <div class="bg-white rounded-3xl p-6 shadow-xl mb-6">
       <div class="text-center mb-6">
        <p class="text-gray-500 text-sm">Available Balance</p>
        <h2 class="text-3xl font-extrabold text-green-500" id="withdraw-balance">$0.00</h2>
       </div>
       <form onsubmit="handleWithdraw(event)">
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Amount (USD)</label> <input type="number" id="withdraw-amount" min="1" step="0.01" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="Enter amount">
         <p class="text-xs text-gray-500 mt-1">Minimum: $1 | 10% transaction fee applies</p>
        </div>
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Withdraw In</label> <select id="withdraw-currency" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none"> <option value="USD">USD (US Dollars)</option> <option value="KES">KES (Kenyan Shillings)</option> </select>
        </div>
        <div class="bg-gray-50 rounded-xl p-4 mb-4">
         <div class="flex justify-between text-sm mb-2"><span class="text-gray-500">Amount</span> <span id="calc-amount">$0.00</span>
         </div>
         <div class="flex justify-between text-sm mb-2"><span class="text-gray-500">Fee (10%)</span> <span id="calc-fee">-$0.00</span>
         </div>
         <div class="flex justify-between font-bold border-t pt-2"><span>You'll Receive</span> <span id="calc-total">$0.00</span>
         </div>
        </div><button type="submit" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Withdraw </button>
       </form>
      </div>
     </div><!-- Support Section -->
     <div id="support-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Support</h2>
      <div class="bg-white rounded-3xl p-6 shadow-xl">
       <form onsubmit="handleSupport(event)">
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Subject</label> <input type="text" id="support-subject" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="What do you need help with?">
        </div>
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Message</label> <textarea id="support-message" rows="5" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="Describe your issue..."></textarea>
        </div><button type="submit" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Send Message </button>
       </form>
      </div>
     </div><!-- Forex Center Section -->
     <div id="forex-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Forex Center</h2>
      <div class="bg-white rounded-3xl p-6 shadow-xl mb-6">
       <div class="text-center mb-6">
        <p class="text-gray-500 text-sm">Current Rate</p>
        <h2 class="text-3xl font-extrabold">1 USD = 130 KES</h2>
       </div>
       <div class="grid grid-cols-2 gap-4">
        <div class="bg-green-50 rounded-2xl p-4 text-center">
         <p class="text-sm text-gray-500">You Have</p>
         <p class="text-2xl font-bold text-green-600" id="forex-usd">$0</p>
        </div>
        <div class="bg-pink-50 rounded-2xl p-4 text-center">
         <p class="text-sm text-gray-500">In KES</p>
         <p class="text-2xl font-bold text-pink-600" id="forex-kes">KES 0</p>
        </div>
       </div>
      </div>
      <div class="bg-white rounded-3xl p-6 shadow-xl">
       <h3 class="font-bold mb-4">Currency Converter</h3>
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">USD Amount</label> <input type="number" id="convert-usd" oninput="convertCurrency()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="Enter USD">
       </div>
       <div class="text-center py-2"><span class="text-2xl">‚ÜïÔ∏è</span>
       </div>
       <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">KES Amount</label> <input type="number" id="convert-kes" readonly class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-gray-50" placeholder="KES result">
       </div>
      </div>
     </div><!-- Subscription Section -->
     <div id="subscription-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Premium Membership</h2>
      <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-3xl p-6 shadow-xl border-2 border-yellow-400">
       <div class="flex items-center gap-3 mb-4">
        <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center"><span class="text-2xl">‚≠ê</span>
        </div>
        <div>
         <h3 class="font-bold text-lg">Premium Writer</h3>
         <p class="text-yellow-600 text-sm">KES 357/month</p>
        </div>
       </div>
       <ul class="space-y-2 mb-6 text-sm">
        <li class="flex items-center gap-2"><span class="text-green-500">‚úì</span> Access to premium writing tasks</li>
        <li class="flex items-center gap-2"><span class="text-green-500">‚úì</span> Higher earning rates</li>
        <li class="flex items-center gap-2"><span class="text-green-500">‚úì</span> Instant withdrawals (no delays)</li>
        <li class="flex items-center gap-2"><span class="text-green-500">‚úì</span> First withdrawal approval</li>
        <li class="flex items-center gap-2"><span class="text-green-500">‚úì</span> Priority customer support</li>
        <li class="flex items-center gap-2"><span class="text-green-500">‚úì</span> Access to all setbook essays</li>
       </ul><button onclick="redirectToPayment()" class="w-full bg-yellow-400 text-yellow-900 py-4 rounded-xl font-bold text-lg mb-3"> Subscribe Now ‚Üí Pay on Lipana </button> <button onclick="showPaymentVerification()" class="w-full bg-white text-yellow-600 py-3 rounded-xl font-semibold border-2 border-yellow-400"> Already Paid? Verify Payment </button>
      </div>
     </div><!-- Payment Verification Section -->
     <div id="payment-verification-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Verify Payment</h2>
      <div class="bg-white rounded-3xl p-6 shadow-xl">
       <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
        <p class="text-sm text-blue-700"><strong>‚ÑπÔ∏è Instructions:</strong> Paste your M-Pesa confirmation message below. We'll verify the payment details.</p>
       </div>
       <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-3">Paste M-Pesa Message</label> <textarea id="mpesa-message" rows="6" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none font-mono text-sm" placeholder="Paste your M-Pesa confirmation message here..."></textarea>
       </div>
       <div class="grid grid-cols-2 gap-3 mb-6 text-sm">
        <div class="bg-gray-50 rounded-xl p-3">
         <p class="text-gray-500 mb-1">Expected Recipient</p>
         <p class="font-bold">LIPANA TECHNOLOGIES LIMITED</p>
        </div>
        <div class="bg-gray-50 rounded-xl p-3">
         <p class="text-gray-500 mb-1">Expected Amount</p>
         <p class="font-bold">KES 357</p>
        </div>
        <div class="bg-gray-50 rounded-xl p-3">
         <p class="text-gray-500 mb-1">Expected Date</p>
         <p class="font-bold" id="expected-date"></p>
        </div>
        <div class="bg-gray-50 rounded-xl p-3">
         <p class="text-gray-500 mb-1">Verification Status</p>
         <p class="font-bold text-yellow-600" id="verification-status">Pending</p>
        </div>
       </div><button onclick="verifyPayment()" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg mb-3"> Verify Payment </button> <button onclick="navigateTo('subscription')" class="w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-semibold"> Back to Subscription </button>
      </div>
     </div><!-- Refund Section -->
     <div id="refund-section" class="hidden fade-in">
      <h2 class="text-2xl font-bold mb-4">Request Refund</h2>
      <div class="bg-white rounded-3xl p-6 shadow-xl">
       <form onsubmit="handleRefund(event)">
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Transaction ID</label> <input type="text" id="refund-txid" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="Enter transaction ID">
        </div>
        <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Reason for Refund</label> <textarea id="refund-reason" rows="4" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-green-500 focus:outline-none" placeholder="Explain why you need a refund..."></textarea>
        </div><button type="submit" class="w-full gradient-btn text-white py-4 rounded-xl font-bold text-lg"> Submit Refund Request </button>
       </form>
      </div>
     </div>
    </div>
   </div><!-- Task Details Modal -->
   <div id="task-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50" onclick="closeTaskModal()"></div>
    <div class="absolute inset-4 md:inset-20 bg-white rounded-3xl overflow-hidden flex flex-col">
     <div class="gradient-card p-4 flex items-center justify-between">
      <div class="flex items-center gap-3"><img src="logo.png" alt="Creativepay Logo" class="w-8 h-8 object-contain" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
       <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center hidden"><span class="text-lg">‚úçÔ∏è</span>
       </div><span class="text-white font-bold">Creativepay</span>
      </div><button onclick="closeTaskModal()" class="text-white text-2xl">√ó</button>
     </div>
     <div class="flex-1 overflow-y-auto p-6 pdf-modal" id="task-modal-content"><!-- Task details will be injected here -->
     </div>
     <div class="p-4 border-t flex gap-3"><button onclick="downloadTaskPDF()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold"> üì• Download PDF </button> <button onclick="acceptTask()" id="accept-task-btn" class="flex-1 gradient-btn text-white py-3 rounded-xl font-bold"> Accept Task </button>
     </div>
    </div>
   </div><!-- Confirmation Modal -->
   <div id="confirm-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 max-w-md mx-auto bg-white rounded-3xl p-6 shadow-xl">
     <div class="text-center mb-6">
      <div id="confirm-icon" class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4"><span class="text-3xl">‚ö†Ô∏è</span>
      </div>
      <h3 id="confirm-title" class="text-xl font-bold mb-2">Confirm Action</h3>
      <p id="confirm-message" class="text-gray-600"></p>
     </div>
     <div class="flex gap-3"><button onclick="closeConfirmModal()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold"> Cancel </button> <button onclick="confirmAction()" id="confirm-btn" class="flex-1 gradient-btn text-white py-3 rounded-xl font-bold"> Confirm </button>
     </div>
    </div>
   </div><!-- Loading Modal -->
   <div id="loading-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 max-w-sm mx-auto bg-white rounded-3xl p-8 shadow-xl text-center">
     <div class="w-16 h-16 border-4 border-green-500 border-t-transparent rounded-full spinner mx-auto mb-4"></div>
     <p id="loading-message" class="text-gray-600">Processing...</p>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed bottom-20 left-4 right-4 z-50 hidden">
    <div class="max-w-md mx-auto bg-gray-800 text-white px-6 py-4 rounded-2xl shadow-xl flex items-center gap-3"><span id="toast-icon">‚úì</span> <span id="toast-message">Success!</span>
    </div>
   </div><!-- Receipt Modal -->
   <div id="receipt-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50" onclick="closeReceiptModal()"></div>
    <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 max-w-md mx-auto bg-white rounded-3xl overflow-hidden shadow-xl">
     <div class="gradient-card p-4 text-center"><span class="text-white font-bold text-lg">Payment Receipt</span>
     </div>
     <div class="p-6" id="receipt-content"><!-- Receipt details -->
     </div>
     <div class="p-4 border-t"><button onclick="closeReceiptModal()" class="w-full gradient-btn text-white py-3 rounded-xl font-bold"> Close </button>
     </div>
    </div>
   </div><!-- Approval Required Modal -->
   <div id="approval-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="absolute inset-x-4 top-1/2 -translate-y-1/2 max-w-md mx-auto bg-white rounded-3xl p-6 shadow-xl">
     <div class="text-center mb-6">
      <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><span class="text-3xl">üîí</span>
      </div>
      <h3 class="text-xl font-bold mb-2 text-red-600">Withdrawal Failed</h3>
      <p id="approval-message" class="text-gray-600"></p>
     </div><button onclick="goToSubscription()" class="w-full bg-yellow-400 text-yellow-900 py-4 rounded-xl font-bold text-lg"> ‚≠ê Get Premium Access </button> <button onclick="closeApprovalModal()" class="w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-semibold mt-3"> Maybe Later </button>
    </div>
   </div>
  </div>
  <script>
    // Configuration
    const defaultConfig = {
      site_title: 'Creativepay',
      tagline: 'Write essays on Kenyan literature, share your stories, and get paid. Join thousands of writers earning from their creativity.'
    };

    let config = { ...defaultConfig };
    const EXCHANGE_RATE = 130;
    const WEB3FORMS_KEY = '4d568274-521b-452a-a113-62eed5ad915b';

    // User State
    let user = JSON.parse(localStorage.getItem('creativepay_user')) || null;
    let currentTask = JSON.parse(localStorage.getItem('creativepay_current_task')) || null;
    let earnings = JSON.parse(localStorage.getItem('creativepay_earnings')) || [];
    let transactions = JSON.parse(localStorage.getItem('creativepay_transactions')) || [];
    let activities = JSON.parse(localStorage.getItem('creativepay_activities')) || [];
    let isApprovedMember = JSON.parse(localStorage.getItem('creativepay_approved')) || false;
    let hasWithdrawn = JSON.parse(localStorage.getItem('creativepay_withdrawn')) || false;
    let currentCurrency = 'USD';
    let currentSetbookPage = 0;
    let currentStoryPage = 0;
    let currentModalTask = null;
    let pendingConfirmAction = null;

    // Setbook Tasks Data
    const setbookTasks = generateSetbookTasks();
    const storyPrompts = generateStoryPrompts();
    const availableTasks = generateAvailableTasks();

    function generateSetbookTasks() {
      const books = [
        { id: 'river-between', title: 'The River Between', author: 'Ngugi wa Thiong\'o' },
        { id: 'blossoms', title: 'Blossoms of the Savannah', author: 'Henry Ole Kulet' },
        { id: 'doll', title: 'A Doll\'s House', author: 'Henrik Ibsen' },
        { id: 'inheritance', title: 'Inheritance', author: 'David Mulwa' },
        { id: 'memories', title: 'Memories We Lost', author: 'Lidudumalingani' }
      ];

      const questions = {
        'river-between': [
          { topic: 'Cultural Conflict', question: 'Discuss how Ngugi wa Thiong\'o presents the conflict between tradition and modernity in "The River Between." Analyze how characters like Waiyaki, Muthoni, and Chege represent different responses to cultural change.' },
          { topic: 'Role of Education', question: 'Examine the significance of Western education in "The River Between." How does Waiyaki\'s pursuit of education represent both hope and conflict?' },
          { topic: 'Female Circumcision', question: 'Analyze the portrayal of female circumcision in "The River Between." How does Muthoni\'s decision reflect the broader themes of identity and belonging?' },
          { topic: 'Leadership and Prophecy', question: 'Discuss the theme of leadership and prophecy in "The River Between." How does Chege\'s prophecy shape Waiyaki\'s destiny?' },
          { topic: 'Christianity vs Traditional Religion', question: 'Examine the conflict between Christianity and traditional Gikuyu religion in the novel.' },
          { topic: 'Symbolism of the River', question: 'Analyze the symbolism of the river Honia in "The River Between."' },
          { topic: 'Love and Sacrifice', question: 'Discuss the theme of love and sacrifice through Waiyaki and Nyambura.' },
          { topic: 'Identity Crisis', question: 'Examine how characters struggle with questions of identity.' },
          { topic: 'Role of Women', question: 'Analyze the portrayal of women in "The River Between."' },
          { topic: 'Colonialism and Resistance', question: 'Discuss how the novel portrays early colonialism impact.' },
          { topic: 'The Land and Belonging', question: 'Examine the significance of land in "The River Between."' },
          { topic: 'Betrayal and Trust', question: 'Analyze the theme of betrayal in "The River Between."' },
          { topic: 'Dreams and Visions', question: 'Discuss the role of dreams and visions.' },
          { topic: 'Coming of Age', question: 'Examine "The River Between" as a coming-of-age story.' },
          { topic: 'The Role of Elders', question: 'Analyze the portrayal of elders and their wisdom.' },
          { topic: 'Isolation and Community', question: 'Discuss themes of isolation and community.' },
          { topic: 'Hope and Despair', question: 'Examine the interplay between hope and despair.' },
          { topic: 'Truth and Deception', question: 'Analyze instances of truth and deception.' },
          { topic: 'Martyrdom', question: 'Discuss the concept of martyrdom.' },
          { topic: 'Nature and Spirituality', question: 'Examine the connection between nature and spirituality.' }
        ],
        'blossoms': [
          { topic: 'Female Genital Mutilation', question: 'Analyze how Kulet presents FGM in "Blossoms of the Savannah."' },
          { topic: 'Women\'s Education', question: 'Examine the theme of women\'s education.' },
          { topic: 'Cultural Transition', question: 'Discuss how the novel portrays the Maasai community in transition.' },
          { topic: 'Patriarchy and Resistance', question: 'Analyze patriarchal structures and female resistance.' },
          { topic: 'Marriage and Choice', question: 'Examine the theme of marriage and forced marriages.' },
          { topic: 'Modernization and Values', question: 'Discuss modernization vs traditional values.' },
          { topic: 'Sisterhood and Support', question: 'Analyze the relationship between Taiyo and Resian.' },
          { topic: 'Corruption and Greed', question: 'Examine corruption and greed portrayal.' },
          { topic: 'Identity and Belonging', question: 'Discuss identity and belonging themes.' },
          { topic: 'The Role of Mothers', question: 'Analyze maternal figures and their navigation.' },
          { topic: 'Violence and Power', question: 'Examine violence as a tool of power.' },
          { topic: 'Hope and Transformation', question: 'Discuss themes of hope and transformation.' },
          { topic: 'Economic Empowerment', question: 'Analyze economic independence and liberation.' },
          { topic: 'Urban vs Rural Life', question: 'Examine the contrast between urban and rural.' },
          { topic: 'Betrayal and Trust', question: 'Analyze instances of betrayal.' },
          { topic: 'Dreams and Aspirations', question: 'Discuss character dreams and aspirations.' },
          { topic: 'Cultural Pride', question: 'Examine balance between critique and celebration.' },
          { topic: 'Masculine Identity', question: 'Analyze portrayal of masculinity.' },
          { topic: 'Agency and Voice', question: 'Discuss how characters find voice and agency.' },
          { topic: 'The Symbol of Blossoms', question: 'Analyze significance of the title.' }
        ],
        'doll': [
          { topic: 'Women\'s Liberation', question: 'Analyze how Ibsen presents women\'s liberation.' },
          { topic: 'Marriage and Deception', question: 'Examine the theme of deception in marriage.' },
          { topic: 'Society and Conformity', question: 'Discuss critique of societal expectations.' },
          { topic: 'The Symbol of the Dollhouse', question: 'Analyze the dollhouse symbolism.' },
          { topic: 'Money and Independence', question: 'Examine the role of money and independence.' },
          { topic: 'Sacrifice and Recognition', question: 'Discuss themes of sacrifice.' },
          { topic: 'Appearance vs Reality', question: 'Analyze contrast between appearance and reality.' },
          { topic: 'The Role of Mrs. Linde', question: 'Examine Mrs. Linde character function.' },
          { topic: 'Krogstad as Antagonist', question: 'Analyze Krogstad character.' },
          { topic: 'Children and Parenthood', question: 'Discuss themes of parenthood.' },
          { topic: 'The Tarantella Dance', question: 'Analyze the dance significance.' },
          { topic: 'Law and Morality', question: 'Examine conflict between law and morality.' },
          { topic: 'Torvald\'s Character', question: 'Analyze Torvald Helmer character.' },
          { topic: 'The Ending', question: 'Discuss the controversial ending.' },
          { topic: 'Love and Selfhood', question: 'Examine relationship between love and selfhood.' },
          { topic: 'Reputation and Honor', question: 'Analyze importance of reputation.' },
          { topic: 'Dr. Rank\'s Role', question: 'Discuss Dr. Rank character function.' },
          { topic: 'Transformation and Growth', question: 'Trace Nora\'s transformation.' },
          { topic: 'Christmas Setting', question: 'Analyze the Christmas setting significance.' },
          { topic: 'Language and Power', question: 'Examine how language reflects power.' }
        ],
        'inheritance': [
          { topic: 'Corruption and Power', question: 'Analyze corruption and abuse of power in the play.' },
          { topic: 'Neo-colonialism', question: 'Examine neo-colonialism theme.' },
          { topic: 'Women and Resistance', question: 'Analyze women\'s role in resistance.' },
          { topic: 'Land and Dispossession', question: 'Discuss land and dispossession theme.' },
          { topic: 'Betrayal of Independence', question: 'Examine betrayal of independence.' },
          { topic: 'Family and Politics', question: 'Analyze intersection of family and politics.' },
          { topic: 'Justice and Retribution', question: 'Discuss themes of justice.' },
          { topic: 'Voice of the People', question: 'Examine representation of ordinary people.' },
          { topic: 'Memory and History', question: 'Analyze role of memory and history.' },
          { topic: 'Religion and Politics', question: 'Discuss relationship between religion and politics.' },
          { topic: 'Education and Awareness', question: 'Examine education theme.' },
          { topic: 'Generational Conflict', question: 'Analyze generational conflicts.' },
          { topic: 'Violence and Oppression', question: 'Discuss violence portrayal.' },
          { topic: 'Hope and Renewal', question: 'Examine themes of hope.' },
          { topic: 'Symbolism', question: 'Analyze symbolic elements.' },
          { topic: 'Foreign Investment', question: 'Examine foreign investment portrayal.' },
          { topic: 'Leadership and Accountability', question: 'Discuss accountability themes.' },
          { topic: 'The Masses', question: 'Analyze portrayal of the masses.' },
          { topic: 'Satire and Critique', question: 'Examine satirical elements.' },
          { topic: 'Legacy of Colonialism', question: 'Discuss colonial legacy.' }
        ],
        'memories': [
          { topic: 'Mental Health', question: 'Analyze presentation of mental illness.' },
          { topic: 'Family Bonds', question: 'Examine family bonds theme.' },
          { topic: 'Stigma and Shame', question: 'Discuss stigma surrounding mental illness.' },
          { topic: 'Traditional vs Modern Medicine', question: 'Analyze healing approaches.' },
          { topic: 'Narrative Perspective', question: 'Examine narrative significance.' },
          { topic: 'Memory and Identity', question: 'Discuss role of memory.' },
          { topic: 'Rural Community', question: 'Examine rural community portrayal.' },
          { topic: 'Hope and Despair', question: 'Analyze interplay of emotions.' },
          { topic: 'Childhood and Responsibility', question: 'Discuss childhood themes.' },
          { topic: 'The Power of Stories', question: 'Examine storytelling function.' },
          { topic: 'Loss and Grief', question: 'Analyze theme of loss.' },
          { topic: 'Setting and Atmosphere', question: 'Discuss setting contribution.' },
          { topic: 'Mother Figures', question: 'Examine mother portrayal.' },
          { topic: 'Isolation and Connection', question: 'Analyze isolation and connection.' },
          { topic: 'Cultural Beliefs', question: 'Discuss cultural beliefs impact.' },
          { topic: 'Resilience', question: 'Examine resilience theme.' },
          { topic: 'Language and Communication', question: 'Analyze communication role.' },
          { topic: 'Poverty and Healthcare', question: 'Discuss healthcare access.' },
          { topic: 'The Title\'s Meaning', question: 'Analyze title significance.' },
          { topic: 'Love in Difficult Times', question: 'Examine love in adversity.' }
        ]
      };

      const tasks = [];
      const clients = ['Prof. Kamau', 'Dr. Ochieng', 'Mrs. Wanjiku', 'Mr. Otieno', 'Academic Hub', 'Essay Masters', 'Kenya Scholars', 'Write Pro', 'Literary Circle', 'Study Aid'];
      
      books.forEach(book => {
        questions[book.id].forEach((q, i) => {
          tasks.push({
            id: `${book.id}-${i + 1}`,
            bookId: book.id,
            book: book.title,
            author: book.author,
            topic: q.topic,
            question: q.question,
            client: clients[Math.floor(Math.random() * clients.length)],
            genre: 'Literary Analysis',
            wordCount: 250 + Math.floor(Math.random() * 4) * 250,
            clientBudget: 7.5,
            writerPay: 5.0,
            type: 'setbook'
          });
        });
      });

      return tasks;
    }

    function generateStoryPrompts() {
      const prompts = [
        { title: 'The Village Elder\'s Secret', keywords: ['tradition', 'mystery', 'wisdom', 'community', 'ancestors'], description: 'Write about a young person discovering a village elder\'s secret.' },
        { title: 'Last Bus to Nairobi', keywords: ['journey', 'strangers', 'destiny', 'conversation', 'hope'], description: 'A story about unexpected connections during a long bus journey.' },
        { title: 'The Unfinished Letter', keywords: ['love', 'regret', 'memory', 'family', 'forgiveness'], description: 'Someone finds an unfinished letter from a deceased relative.' },
        { title: 'Market Day', keywords: ['commerce', 'community', 'survival', 'relationships', 'resilience'], description: 'Capture vibrant life through a first-time vendor.' },
        { title: 'The Mango Tree', keywords: ['childhood', 'friendship', 'growth', 'seasons', 'memory'], description: 'A story centered around a tree witnessing generations.' },
        { title: 'When the Rains Fail', keywords: ['drought', 'survival', 'community', 'sacrifice', 'nature'], description: 'A community faces unprecedented drought.' },
        { title: 'The New Teacher', keywords: ['education', 'change', 'resistance', 'innovation', 'youth'], description: 'A young teacher arrives with modern ideas.' },
        { title: 'Grandmother\'s Recipe', keywords: ['heritage', 'food', 'memory', 'connection', 'identity'], description: 'Recreating a traditional dish connecting to the past.' },
        { title: 'The Night Watchman', keywords: ['solitude', 'observation', 'secrets', 'duty', 'wisdom'], description: 'The night watchman sees and knows more than suspected.' },
        { title: 'Digital Masai', keywords: ['tradition', 'technology', 'identity', 'change', 'balance'], description: 'A young Maasai woman balancing culture and tech.' },
        { title: 'The Forgotten Photograph', keywords: ['history', 'family', 'mystery', 'connection', 'discovery'], description: 'An old photograph leads to uncovering forgotten stories.' },
        { title: 'Fisherman\'s Dawn', keywords: ['livelihood', 'nature', 'perseverance', 'family', 'tradition'], description: 'One eventful day on Lake Victoria.' },
        { title: 'The Wedding Proposal', keywords: ['love', 'culture', 'negotiation', 'family', 'tradition'], description: 'Navigating complex bride price traditions.' },
        { title: 'Mama Mboga', keywords: ['entrepreneurship', 'survival', 'motherhood', 'community', 'determination'], description: 'Daily struggles of a vegetable seller in Nairobi.' },
        { title: 'The Football Dream', keywords: ['ambition', 'sacrifice', 'sports', 'family', 'opportunity'], description: 'Choosing between family and professional dreams.' },
        { title: 'Echoes of the Ancestors', keywords: ['spirituality', 'tradition', 'modernity', 'calling', 'identity'], description: 'Modern professional experiencing spiritual visions.' },
        { title: 'The Loan', keywords: ['debt', 'trust', 'friendship', 'money', 'consequences'], description: 'A small loan between friends causes consequences.' },
        { title: 'Harvest Moon', keywords: ['agriculture', 'celebration', 'community', 'change', 'seasons'], description: 'Harvest celebration shadowed by land development.' },
        { title: 'The Translator', keywords: ['language', 'communication', 'identity', 'belonging', 'bridge'], description: 'A translator faces a moral dilemma.' },
        { title: 'Midnight Radio', keywords: ['connection', 'loneliness', 'voice', 'community', 'storytelling'], description: 'Late-night radio host connects lonely listeners.' },
        { title: 'The Healer\'s Apprentice', keywords: ['tradition', 'healing', 'learning', 'responsibility', 'herbs'], description: 'Learning ancient herbal medicine from an aging healer.' },
        { title: 'The Reunion', keywords: ['diaspora', 'return', 'change', 'identity', 'belonging'], description: 'Return home after decades challenges expectations.' },
        { title: 'Safari of Shadows', keywords: ['wildlife', 'conservation', 'conflict', 'nature', 'humanity'], description: 'Wildlife ranger confronts poachers.' },
        { title: 'The Artist\'s Canvas', keywords: ['creativity', 'expression', 'censorship', 'truth', 'courage'], description: 'Artist creates controversial piece.' },
        { title: 'One Shilling', keywords: ['poverty', 'kindness', 'strangers', 'dignity', 'connection'], description: 'A small act of giving creates ripples.' },
        { title: 'The New Neighbor', keywords: ['community', 'suspicion', 'acceptance', 'diversity', 'trust'], description: 'New family from different ethnic group.' },
        { title: 'The Promised Land', keywords: ['migration', 'hope', 'displacement', 'resilience', 'home'], description: 'Family displaced searches for new home.' },
        { title: 'Crossroads', keywords: ['decision', 'youth', 'future', 'pressure', 'identity'], description: 'Young person choosing between duty and dreams.' },
        { title: 'The Inheritance', keywords: ['death', 'family', 'conflict', 'land', 'legacy'], description: 'Family gathers to divide inheritance.' },
        { title: 'Voice of the Ancestors', keywords: ['tradition', 'ceremony', 'spirituality', 'connection', 'heritage'], description: 'Traditional ceremony awakens spiritual connection.' }
      ];

      return prompts.map((p, i) => ({
        id: `story-${i + 1}`,
        ...p,
        wordCount: 500 + Math.floor(Math.random() * 3) * 250,
        clientBudget: 7.5,
        writerPay: 5.0,
        type: 'story'
      }));
    }

    function generateAvailableTasks() {
      const tasks = [
        { title: 'Essay on Climate Change in Kenya', genre: 'Environmental Studies', client: 'Green Kenya Foundation' },
        { title: 'Analysis of Kenyan Political System', genre: 'Political Science', client: 'Civic Education Hub' },
        { title: 'Review of Kenyan Music Evolution', genre: 'Cultural Studies', client: 'Arts Kenya' },
        { title: 'Impact of Technology on Rural Kenya', genre: 'Technology & Society', client: 'Digital Kenya' },
        { title: 'Women Empowerment in East Africa', genre: 'Gender Studies', client: 'Equality Now Kenya' },
        { title: 'Traditional Medicine in Modern Kenya', genre: 'Healthcare', client: 'Health Kenya Research' },
        { title: 'Youth Unemployment Solutions', genre: 'Economics', client: 'Youth Empowerment Kenya' },
        { title: 'Sustainable Agriculture Practices', genre: 'Agriculture', client: 'Farm Kenya Initiative' },
        { title: 'Tourism Recovery Post-Pandemic', genre: 'Tourism Studies', client: 'Visit Kenya Board' },
        { title: 'Education Reform Proposals', genre: 'Education', client: 'Better Schools Kenya' },
        { title: 'Wildlife Conservation Challenges', genre: 'Environmental Studies', client: 'Safari Kenya Trust' },
        { title: 'Urban Planning in Nairobi', genre: 'Urban Studies', client: 'Nairobi Metropolitan' },
        { title: 'Mental Health Awareness', genre: 'Psychology', client: 'Mind Kenya' },
        { title: 'Renewable Energy Adoption', genre: 'Energy Studies', client: 'Power Kenya Initiative' },
        { title: 'Small Business Development', genre: 'Entrepreneurship', client: 'SME Kenya Hub' },
        { title: 'Food Security Analysis', genre: 'Agriculture', client: 'Feed Kenya Program' },
        { title: 'Cultural Preservation Methods', genre: 'Cultural Studies', client: 'Heritage Kenya' },
        { title: 'Digital Financial Services', genre: 'Finance', client: 'Fintech Kenya' },
        { title: 'Sports Development Strategy', genre: 'Sports Management', client: 'Athletics Kenya' },
        { title: 'Healthcare System Analysis', genre: 'Healthcare', client: 'Universal Health Kenya' }
      ];

      return tasks.map((t, i) => ({
        id: `task-${i + 1}`,
        ...t,
        wordCount: 500 + Math.floor(Math.random() * 4) * 250,
        clientBudget: 7.5,
        writerPay: 5.0,
        type: 'general'
      }));
    }

    // Initialize SDK
    async function initSDK() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...config, ...newConfig };
            updateUI();
          },
          mapToCapabilities: () => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['site_title', cfg.site_title || defaultConfig.site_title],
            ['tagline', cfg.tagline || defaultConfig.tagline]
          ])
        });
        config = { ...defaultConfig, ...window.elementSdk.config };
      }
      updateUI();
      initializeApp();
    }

    function updateUI() {
      const titleEl = document.getElementById('site-title');
      const taglineEl = document.getElementById('tagline');
      if (titleEl) titleEl.textContent = config.site_title || defaultConfig.site_title;
      if (taglineEl) taglineEl.textContent = config.tagline || defaultConfig.tagline;
    }

    function initializeApp() {
      if (user) {
        showSection('dashboard-page');
        updateDashboard();
      }
      setupPaymentMethodToggle();
      setupWithdrawCalculator();
    }

    // Navigation Functions
    function showSection(sectionId) {
      const sections = ['landing-page', 'login-page', 'register-page', 'declaration-page', 'payment-setup-page', 'dashboard-page'];
      sections.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.toggle('hidden', id !== sectionId);
      });
    }

    function navigateTo(section) {
      toggleMenu();
      const dashboardSections = ['home', 'available-tasks', 'writing-tasks', 'my-story', 'submit-task', 'earnings', 'transactions', 'withdraw', 'support', 'forex', 'subscription', 'refund', 'payment-verification'];
      dashboardSections.forEach(s => {
        const el = document.getElementById(`${s}-section`);
        if (el) el.classList.toggle('hidden', s !== section);
      });

      if (section === 'available-tasks') renderAvailableTasks();
      if (section === 'writing-tasks') renderSetbookTasks();
      if (section === 'my-story') renderStoryPrompts();
      if (section === 'earnings') updateEarningsSection();
      if (section === 'transactions') updateTransactionsSection();
      if (section === 'withdraw') updateWithdrawSection();
      if (section === 'forex') updateForexSection();
      if (section === 'submit-task') updateSubmitSection();
    }

    function toggleMenu() {
      const menu = document.getElementById('slide-menu');
      menu.classList.toggle('hidden');
      if (user) {
        document.getElementById('menu-username').textContent = user.name;
        document.getElementById('menu-email').textContent = user.email;
      }
    }

    // Authentication Functions
    function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      const storedUser = JSON.parse(localStorage.getItem('creativepay_user'));
      if (storedUser && storedUser.email === email && storedUser.password === password) {
        user = storedUser;
        showSection('dashboard-page');
        updateDashboard();
        showToast('Welcome back, ' + user.name + '!', 'üëã');
      } else {
        showToast('Invalid email or password', '‚ùå');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const name = document.getElementById('reg-name').value;
      const email = document.getElementById('reg-email').value;
      const phone = document.getElementById('reg-phone').value;
      const password = document.getElementById('reg-password').value;
      const confirm = document.getElementById('reg-confirm').value;

      if (password !== confirm) {
        showToast('Passwords do not match', '‚ùå');
        return;
      }

      showLoading('Creating your account...');
      
      try {
        await sendToWeb3Forms({
          type: 'Registration',
          name,
          email,
          phone,
          timestamp: new Date().toISOString()
        });
      } catch (err) {
        console.error('Web3Forms error:', err);
      }

      user = { name, email, phone, password, balance: 0, tasksCompleted: 0, tasksPending: 0, totalWithdrawn: 0 };
      localStorage.setItem('creativepay_user', JSON.stringify(user));
      
      hideLoading();
      showSection('declaration-page');
    }

    function acceptDeclaration() {
      const checkbox = document.getElementById('accept-terms');
      if (!checkbox.checked) {
        showToast('Please accept the terms to continue', '‚ö†Ô∏è');
        return;
      }
      showSection('payment-setup-page');
    }

    async function handlePaymentSetup(e) {
      e.preventDefault();
      const currency = document.getElementById('pref-currency').value;
      const method = document.getElementById('payment-method').value;
      let paymentDetails = {};

      if (method === 'mpesa') {
        paymentDetails.mpesa = document.getElementById('mpesa-number').value;
      } else if (method === 'paypal') {
        paymentDetails.paypal = document.getElementById('paypal-email').value;
      } else {
        paymentDetails.bank = document.getElementById('bank-account').value;
      }

      showLoading('Setting up payment...');

      try {
        await sendToWeb3Forms({
          type: 'Payment Setup',
          user: user.email,
          currency,
          method,
          details: JSON.stringify(paymentDetails),
          timestamp: new Date().toISOString()
        });
      } catch (err) {
        console.error('Web3Forms error:', err);
      }

      user.paymentMethod = method;
      user.paymentDetails = paymentDetails;
      user.preferredCurrency = currency;
      localStorage.setItem('creativepay_user', JSON.stringify(user));

      hideLoading();
      
      addActivity('üéâ Welcome to Creativepay!', 0);
      
      showSection('dashboard-page');
      updateDashboard();
      showToast('Account setup complete!', '‚úÖ');
    }

    function handleLogout() {
      toggleMenu();
      user = null;
      showSection('landing-page');
      showToast('Logged out successfully', 'üëã');
    }

    // Dashboard Functions
    function updateDashboard() {
      if (!user) return;

      const balance = user.balance || 0;
      document.getElementById('balance-display').textContent = currentCurrency === 'USD' 
        ? `$${balance.toFixed(2)}` 
        : `KES ${(balance * EXCHANGE_RATE).toFixed(0)}`;
      document.getElementById('currency-toggle').textContent = currentCurrency;
      document.getElementById('tasks-completed').textContent = user.tasksCompleted || 0;
      document.getElementById('tasks-pending').textContent = user.tasksPending || 0;
      document.getElementById('total-withdrawn').textContent = `$${(user.totalWithdrawn || 0).toFixed(0)}`;
      document.getElementById('user-avatar').textContent = user.name ? user.name[0].toUpperCase() : 'üë§';

      renderActivities();
    }

    function toggleCurrency() {
      currentCurrency = currentCurrency === 'USD' ? 'KES' : 'USD';
      updateDashboard();
    }

    function renderActivities() {
      const container = document.getElementById('recent-activity');
      if (activities.length === 0) {
        container.innerHTML = `
          <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
              <span>üéâ</span>
            </div>
            <div class="flex-1">
              <p class="font-medium text-sm">Welcome to Creativepay!</p>
              <p class="text-xs text-gray-500">Just now</p>
            </div>
            <span class="text-green-500 font-bold text-sm">+$0</span>
          </div>
        `;
        return;
      }

      container.innerHTML = activities.slice(0, 5).map(a => `
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
          <div class="w-10 h-10 ${a.amount > 0 ? 'bg-green-100' : 'bg-pink-100'} rounded-full flex items-center justify-center">
            <span>${a.icon}</span>
          </div>
          <div class="flex-1">
            <p class="font-medium text-sm">${a.description}</p>
            <p class="text-xs text-gray-500">${a.time}</p>
          </div>
          <span class="${a.amount >= 0 ? 'text-green-500' : 'text-red-500'} font-bold text-sm">${a.amount >= 0 ? '+' : ''}$${a.amount.toFixed(2)}</span>
        </div>
      `).join('');
    }

    function addActivity(description, amount, icon = 'üìù') {
      activities.unshift({
        description,
        amount,
        icon,
        time: 'Just now'
      });
      localStorage.setItem('creativepay_activities', JSON.stringify(activities));
      renderActivities();
    }

    function addTransaction(description, type, amount) {
      transactions.unshift({
        description,
        type,
        amount,
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString()
      });
      localStorage.setItem('creativepay_transactions', JSON.stringify(transactions));
    }

    // Task Functions
    function renderAvailableTasks() {
      const container = document.getElementById('available-tasks-list');
      container.innerHTML = availableTasks.map((task, i) => `
        <div class="task-card rounded-2xl p-5 shadow-lg card-hover">
          <div class="flex justify-between items-start mb-3">
            <span class="px-3 py-1 bg-white/50 rounded-full text-xs font-medium">${task.genre}</span>
            <span class="text-green-600 font-bold">$${(task.wordCount / 250 * task.writerPay).toFixed(2)}</span>
          </div>
          <h3 class="font-bold text-lg mb-2">${task.title}</h3>
          <div class="space-y-1 text-sm text-gray-600 mb-4">
            <p>üë§ Client: ${task.client}</p>
            <p>üìù Word Count: ${task.wordCount} words (${task.wordCount / 250} pages)</p>
            <p>üí∞ You Earn: $${(task.wordCount / 250 * task.writerPay).toFixed(2)}</p>
          </div>
          <button onclick="viewTaskDetails('available', ${i})" class="w-full gradient-btn text-white py-3 rounded-xl font-semibold">
            View Details
          </button>
        </div>
      `).join('');
    }

    function renderSetbookTasks() {
      const filter = document.getElementById('setbook-filter').value;
      let filteredTasks = setbookTasks;
      if (filter !== 'all') {
        filteredTasks = setbookTasks.filter(t => t.bookId === filter);
      }

      const startIndex = currentSetbookPage * 5;
      const endIndex = startIndex + 5;
      const pageTasks = filteredTasks.slice(startIndex, endIndex);

      const container = document.getElementById('writing-tasks-list');
      container.innerHTML = pageTasks.map((task, i) => `
        <div class="task-card rounded-2xl p-5 shadow-lg card-hover">
          <div class="flex justify-between items-start mb-3">
            <span class="px-3 py-1 bg-white/50 rounded-full text-xs font-medium">${task.genre}</span>
            <span class="text-green-600 font-bold">$${(task.wordCount / 250 * task.writerPay).toFixed(2)}</span>
          </div>
          <h3 class="font-bold text-lg mb-1">${task.topic}</h3>
          <p class="text-sm text-gray-600 mb-2">üìö ${task.book} - ${task.author}</p>
          <div class="space-y-1 text-sm text-gray-600 mb-4">
            <p>üë§ Client: ${task.client}</p>
            <p>üìù Word Count: ${task.wordCount} words (${task.wordCount / 250} pages)</p>
            <p>üí∞ You Earn: $${(task.wordCount / 250 * task.writerPay).toFixed(2)}</p>
          </div>
          <button onclick="viewTaskDetails('setbook', ${startIndex + i})" class="w-full gradient-btn text-white py-3 rounded-xl font-semibold">
            View Details
          </button>
        </div>
      `).join('');

      document.getElementById('setbook-page-info').textContent = `Page ${currentSetbookPage + 1} of ${Math.ceil(filteredTasks.length / 5)}`;
      document.getElementById('prev-setbook-btn').disabled = currentSetbookPage === 0;
      document.getElementById('next-setbook-btn').disabled = endIndex >= filteredTasks.length;
    }

    function filterSetbookTasks() {
      currentSetbookPage = 0;
      renderSetbookTasks();
    }

    function prevSetbookPage() {
      if (currentSetbookPage > 0) {
        currentSetbookPage--;
        renderSetbookTasks();
      }
    }

    function nextSetbookPage() {
      currentSetbookPage++;
      renderSetbookTasks();
    }

    function renderStoryPrompts() {
      const startIndex = currentStoryPage * 5;
      const endIndex = startIndex + 5;
      const pagePrompts = storyPrompts.slice(startIndex, endIndex);

      const container = document.getElementById('story-prompts-list');
      container.innerHTML = pagePrompts.map((prompt, i) => `
        <div class="task-card rounded-2xl p-5 shadow-lg card-hover">
          <div class="flex justify-between items-start mb-3">
            <span class="px-3 py-1 bg-white/50 rounded-full text-xs font-medium">Short Story</span>
            <span class="text-green-600 font-bold">$${(prompt.wordCount / 250 * prompt.writerPay).toFixed(2)}</span>
          </div>
          <h3 class="font-bold text-lg mb-2">${prompt.title}</h3>
          <p class="text-sm text-gray-600 mb-3">${prompt.description}</p>
          <div class="flex flex-wrap gap-2 mb-4">
            ${prompt.keywords.map(k => `<span class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs">${k}</span>`).join('')}
          </div>
          <div class="text-sm text-gray-600 mb-4">
            <p>üìù Word Count: ${prompt.wordCount} words</p>
          </div>
          <button onclick="viewTaskDetails('story', ${startIndex + i})" class="w-full gradient-btn text-white py-3 rounded-xl font-semibold">
            View Details
          </button>
        </div>
      `).join('');

      document.getElementById('story-page-info').textContent = `Page ${currentStoryPage + 1} of ${Math.ceil(storyPrompts.length / 5)}`;
      document.getElementById('prev-story-btn').disabled = currentStoryPage === 0;
      document.getElementById('next-story-btn').disabled = endIndex >= storyPrompts.length;
    }

    function prevStoryPage() {
      if (currentStoryPage > 0) {
        currentStoryPage--;
        renderStoryPrompts();
      }
    }

    function nextStoryPage() {
      currentStoryPage++;
      renderStoryPrompts();
    }

    // Task Modal Functions
    function viewTaskDetails(type, index) {
      let task;
      if (type === 'available') {
        task = availableTasks[index];
      } else if (type === 'setbook') {
        task = setbookTasks[index];
      } else {
        task = storyPrompts[index];
      }

      currentModalTask = task;

      const content = document.getElementById('task-modal-content');
      content.innerHTML = `
        <div class="text-center mb-6">
          <div class="w-20 h-20 gradient-card rounded-2xl flex items-center justify-center mx-auto mb-4">
            <span class="text-4xl">‚úçÔ∏è</span>
          </div>
          <h2 class="text-2xl font-bold text-gray-800">Creativepay</h2>
          <p class="text-gray-500">Writing Task Details</p>
        </div>
        
        <div class="border-t border-b py-6 mb-6">
          <h3 class="text-xl font-bold mb-4">${task.title || task.topic}</h3>
          ${task.book ? `<p class="text-gray-600 mb-2">üìö <strong>Book:</strong> ${task.book} by ${task.author}</p>` : ''}
          <p class="text-gray-600 mb-2">üìÇ <strong>Genre:</strong> ${task.genre || 'Short Story'}</p>
          <p class="text-gray-600 mb-2">üë§ <strong>Client:</strong> ${task.client || 'Creativepay'}</p>
          <p class="text-gray-600 mb-2">üìù <strong>Word Count:</strong> ${task.wordCount} words (${task.wordCount / 250} pages)</p>
        </div>

        <div class="mb-6">
          <h4 class="font-bold mb-3">üìã Task Description</h4>
          <p class="text-gray-700 leading-relaxed">${task.question || task.description}</p>
        </div>

        ${task.keywords ? `
        <div class="mb-6">
          <h4 class="font-bold mb-3">üîë Keywords to Use</h4>
          <div class="flex flex-wrap gap-2">
            ${task.keywords.map(k => `<span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">${k}</span>`).join('')}
          </div>
        </div>
        ` : ''}

        <div class="bg-green-50 rounded-2xl p-4">
          <h4 class="font-bold mb-2">üí∞ Payment Details</h4>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Client Budget (per page):</span>
              <span>$7.50</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Platform Fee (per page):</span>
              <span>$2.50</span>
            </div>
            <div class="flex justify-between font-bold text-green-600 pt-2 border-t">
              <span>Your Earnings:</span>
              <span>$${(task.wordCount / 250 * 5).toFixed(2)}</span>
            </div>
          </div>
        </div>
      `;

      document.getElementById('task-modal').classList.remove('hidden');
    }

    function closeTaskModal() {
      document.getElementById('task-modal').classList.add('hidden');
    }

    function downloadTaskPDF() {
      showToast('PDF download started', 'üì•');
    }

    function acceptTask() {
      if (currentTask) {
        showToast('You already have an active task. Complete it first.', '‚ö†Ô∏è');
        return;
      }

      currentTask = { ...currentModalTask, acceptedAt: new Date().toISOString() };
      localStorage.setItem('creativepay_current_task', JSON.stringify(currentTask));
      
      user.tasksPending = (user.tasksPending || 0) + 1;
      localStorage.setItem('creativepay_user', JSON.stringify(user));

      addActivity(`Accepted: ${currentTask.title || currentTask.topic}`, 0, '‚úÖ');
      addTransaction(`Task Accepted: ${currentTask.title || currentTask.topic}`, 'task_accepted', 0);
      
      closeTaskModal();
      navigateTo('submit-task');
      showToast('Task accepted! You can now submit your work.', '‚úÖ');
    }

    // Submit Task Functions
    function updateSubmitSection() {
      const infoContainer = document.getElementById('active-task-info');
      const formContainer = document.getElementById('submit-form-container');

      if (!currentTask) {
        infoContainer.innerHTML = `<p class="text-gray-500 text-center py-8">No active task. Accept a task first to submit.</p>`;
        formContainer.classList.add('hidden');
        return;
      }

      infoContainer.innerHTML = `
        <div class="space-y-3">
          <h3 class="font-bold text-lg">${currentTask.title || currentTask.topic}</h3>
          ${currentTask.book ? `<p class="text-sm text-gray-600">üìö ${currentTask.book} by ${currentTask.author}</p>` : ''}
          <p class="text-sm text-gray-600">üìù Required: ${currentTask.wordCount} words</p>
          <p class="text-sm text-green-600 font-semibold">üí∞ Earnings: $${(currentTask.wordCount / 250 * 5).toFixed(2)}</p>
        </div>
      `;
      formContainer.classList.remove('hidden');

      const textarea = document.getElementById('task-content');
      textarea.oninput = () => {
        const words = textarea.value.trim().split(/\s+/).filter(w => w).length;
        document.getElementById('word-count').textContent = words;
      };
    }

    // Live Review System
    function performLiveReview(content, task) {
      const contentLower = content.toLowerCase();
      const words = contentLower.split(/\s+/);
      
      const topicKeywords = {
        'Cultural Conflict': ['culture', 'tradition', 'modernity', 'conflict', 'change', 'waiyaki', 'muthoni', 'chege', 'identity', 'society', 'tension', 'clash', 'waigani', 'colonial', 'resistance', 'beliefs'],
        'Role of Education': ['education', 'learning', 'school', 'knowledge', 'waiyaki', 'literacy', 'enlightenment', 'teacher', 'student', 'western', 'mission', 'understand', 'intellectu'],
        'Female Circumcision': ['circumcision', 'muthoni', 'tradition', 'ritual', 'identity', 'choice', 'maina', 'nyambura', 'female', 'custom', 'practice', 'cultural', 'religion'],
        'Leadership and Prophecy': ['prophecy', 'leader', 'chege', 'waiyaki', 'destiny', 'predict', 'guide', 'responsibility', 'vision', 'tribal', 'chief'],
        'Christianity vs Traditional Religion': ['christianity', 'religion', 'traditional', 'missionary', 'faith', 'belief', 'god', 'spirit', 'ritual', 'church', 'convert', 'worship'],
        'Symbolism of the River': ['river', 'honia', 'symbol', 'boundary', 'division', 'water', 'flow', 'crossing', 'connection', 'metaphor', 'spiritual'],
        'Love and Sacrifice': ['love', 'sacrifice', 'waiyaki', 'nyambura', 'devotion', 'commitment', 'emotion', 'relationship', 'passion', 'suffering', 'loss'],
        'Identity Crisis': ['identity', 'crisis', 'confused', 'belonging', 'torn', 'conflict', 'self', 'character', 'gikuyu', 'european', 'tradition'],
        'Role of Women': ['women', 'female', 'nyambura', 'muthoni', 'mother', 'role', 'strength', 'agency', 'voice', 'empowerment', 'maternal'],
        'Colonialism and Resistance': ['colonial', 'colonialism', 'resistance', 'european', 'british', 'oppression', 'independence', 'struggle', 'freedom', 'exploit'],
        'The Land and Belonging': ['land', 'home', 'belonging', 'territory', 'ownership', 'connection', 'community', 'ancestral', 'soil', 'place'],
        'Betrayal and Trust': ['betrayal', 'trust', 'betrayed', 'loyal', 'faithful', 'deception', 'broken', 'confidence', 'dishonest'],
        'Dreams and Visions': ['dream', 'vision', 'prophetic', 'foresee', 'reveal', 'spiritual', 'revelation', 'intuition', 'premonition'],
        'Coming of Age': ['coming', 'age', 'mature', 'growth', 'young', 'adolescent', 'development', 'transition', 'adult', 'wisdom'],
        'The Role of Elders': ['elders', 'elder', 'old', 'wisdom', 'advice', 'guide', 'experience', 'grandfather', 'ancestor', 'respect'],
        'Isolation and Community': ['isolation', 'community', 'alone', 'lonely', 'together', 'group', 'social', 'connect', 'separate', 'unite'],
        'Hope and Despair': ['hope', 'despair', 'hopeless', 'optimistic', 'pessimistic', 'future', 'positive', 'negative', 'encouraging', 'bleak'],
        'Truth and Deception': ['truth', 'deception', 'honest', 'lies', 'false', 'real', 'genuine', 'fake', 'deceive', 'reveal'],
        'Martyrdom': ['martyr', 'sacrifice', 'suffer', 'death', 'noble', 'cause', 'courage', 'heroic', 'devoted'],
        'Nature and Spirituality': ['nature', 'spiritual', 'sacred', 'divine', 'holy', 'supernatural', 'mystical', 'forest', 'mountain']
      };

      const topic = task.topic || task.title || '';
      const relevantKeywords = topicKeywords[topic] || [];
      
      let score = 0;
      let feedback = [];
      
      const actualWordCount = words.length;
      const expectedWordCount = task.wordCount || 500;
      const wordCountRatio = actualWordCount / expectedWordCount;
      
      if (wordCountRatio >= 0.9) {
        score += 20;
        feedback.push({ type: 'good', text: `‚úì Word count excellent: ${actualWordCount}/${expectedWordCount} words` });
      } else if (wordCountRatio >= 0.7) {
        score += 12;
        feedback.push({ type: 'warning', text: `‚ö† Word count low: ${actualWordCount}/${expectedWordCount} words (70% threshold)` });
      } else {
        score += 5;
        feedback.push({ type: 'bad', text: `‚úó Word count too low: ${actualWordCount}/${expectedWordCount} words` });
      }

      let topicMatches = 0;
      const mainTopicWords = topic.toLowerCase().split(' ').filter(w => w.length > 3);
      mainTopicWords.forEach(topicWord => {
        if (contentLower.includes(topicWord)) {
          topicMatches++;
        }
      });

      const topicCoverage = mainTopicWords.length > 0 ? topicMatches / mainTopicWords.length : 0;
      
      if (topicCoverage >= 0.8) {
        score += 30;
        feedback.push({ type: 'good', text: `‚úì Content directly addresses the topic: "${topic}"` });
      } else if (topicCoverage >= 0.5) {
        score += 15;
        feedback.push({ type: 'warning', text: `‚ö† Topic coverage moderate - could be more focused on: "${topic}"` });
      } else {
        score += 2;
        feedback.push({ type: 'bad', text: `‚úó Content poorly aligned with topic: "${topic}" - appears off-topic` });
      }

      let keywordMatches = 0;
      relevantKeywords.forEach(keyword => {
        if (contentLower.includes(keyword)) {
          keywordMatches++;
        }
      });

      const keywordCoverage = relevantKeywords.length > 0 ? keywordMatches / relevantKeywords.length : 0;

      if (keywordCoverage >= 0.7) {
        score += 25;
        feedback.push({ type: 'good', text: `‚úì Excellent use of relevant keywords: ${keywordMatches}/${relevantKeywords.length} found` });
      } else if (keywordCoverage >= 0.4) {
        score += 12;
        feedback.push({ type: 'warning', text: `‚ö† Moderate keyword usage: ${keywordMatches}/${relevantKeywords.length} relevant terms used` });
      } else {
        score += 3;
        feedback.push({ type: 'bad', text: `‚úó Insufficient keywords: only ${keywordMatches}/${relevantKeywords.length} found` });
      }

      const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 20);
      const avgSentenceLength = actualWordCount / (sentences.length || 1);

      if (avgSentenceLength >= 15 && sentences.length >= 10) {
        score += 15;
        feedback.push({ type: 'good', text: `‚úì Good content depth and structure: ${sentences.length} well-formed sentences` });
      } else if (sentences.length >= 5) {
        score += 8;
        feedback.push({ type: 'warning', text: `‚ö† Content could be more developed: ${sentences.length} sentences` });
      } else {
        score += 2;
        feedback.push({ type: 'bad', text: `‚úó Content appears fragmented or poorly structured` });
      }

      const repetitionRatio = countRepetition(contentLower);
      if (repetitionRatio < 0.15) {
        score += 10;
        feedback.push({ type: 'good', text: `‚úì Original content - low repetition detected` });
      } else if (repetitionRatio < 0.25) {
        score += 5;
        feedback.push({ type: 'warning', text: `‚ö† Moderate repetition detected - consider diversifying language` });
      } else {
        score += 1;
        feedback.push({ type: 'bad', text: `‚úó High repetition - content may not be original` });
      }

      const variance = Math.floor(Math.random() * 15) - 7;
      score = Math.max(10, Math.min(100, score + variance));

      let status = 'REJECTED';
      let statusIcon = '‚ùå';
      if (score >= 80) {
        status = 'APPROVED';
        statusIcon = '‚úÖ';
      } else if (score >= 60) {
        status = 'REVIEW';
        statusIcon = '‚è≥';
      }

      return {
        score: Math.round(score),
        status: status,
        statusIcon: statusIcon,
        feedback: feedback,
        earnings: status === 'APPROVED' ? (task.wordCount / 250) * 5 : status === 'REVIEW' ? (task.wordCount / 250) * 5 * 0.6 : 0,
        wordCount: actualWordCount,
        keywordMatches: keywordMatches,
        totalKeywords: relevantKeywords.length,
        topicCoverage: Math.round(topicCoverage * 100),
        task: task
      };
    }

    function countRepetition(text) {
      const words = text.split(/\s+/).filter(w => w.length > 3);
      const wordFreq = {};
      words.forEach(w => {
        wordFreq[w] = (wordFreq[w] || 0) + 1;
      });

      let repetitions = 0;
      Object.values(wordFreq).forEach(freq => {
        if (freq > 3) repetitions += freq - 3;
      });

      return words.length > 0 ? repetitions / words.length : 0;
    }

    function showReviewModal(reviewResult) {
      const modal = document.createElement('div');
      modal.id = 'review-modal';
      modal.className = 'fixed inset-0 z-50';
      modal.innerHTML = `
        <div class="absolute inset-0 bg-black/50" onclick="closeReviewModal()"></div>
        <div class="absolute inset-4 md:inset-20 max-h-[90vh] overflow-y-auto bg-white rounded-3xl shadow-2xl">
          <div class="gradient-card p-6 flex items-center justify-between sticky top-0">
            <div>
              <h2 class="text-2xl font-bold text-white">Live Task Review</h2>
              <p class="text-white/80">Analyzing your submission...</p>
            </div>
            <button onclick="closeReviewModal()" class="text-white text-3xl">√ó</button>
          </div>

          <div class="p-6 space-y-6">
            <div class="text-center">
              <div class="inline-block relative">
                <svg class="w-32 h-32" viewBox="0 0 120 120">
                  <circle cx="60" cy="60" r="54" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                  <circle cx="60" cy="60" r="54" fill="none" stroke="${getScoreColor(reviewResult.score)}" stroke-width="8" 
                    stroke-dasharray="${(reviewResult.score / 100) * 339.29} 339.29" 
                    transform="rotate(-90 60 60)" style="transition: all 0.5s ease;"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center flex-col">
                  <span class="text-4xl font-bold">${reviewResult.score}</span>
                  <span class="text-sm text-gray-500">out of 100</span>
                </div>
              </div>
              <div class="mt-4">
                <p class="text-2xl font-bold">${reviewResult.statusIcon} ${reviewResult.status}</p>
              </div>
            </div>

            <div class="bg-gray-50 rounded-2xl p-4">
              <h3 class="font-bold mb-3">üìã Task Details</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">Task:</span>
                  <span class="font-semibold">${reviewResult.task.topic || reviewResult.task.title}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Expected Words:</span>
                  <span class="font-semibold">${reviewResult.task.wordCount}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Your Words:</span>
                  <span class="font-semibold">${reviewResult.wordCount}</span>
                </div>
              </div>
            </div>

            <div class="space-y-3">
              <h3 class="font-bold">üìä Quality Analysis</h3>
              
              <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-3">
                <p class="text-sm font-semibold text-blue-900">Topic Coverage: ${reviewResult.topicCoverage}%</p>
                <div class="w-full bg-blue-200 rounded-full h-2 mt-2">
                  <div class="bg-blue-500 h-2 rounded-full" style="width: ${reviewResult.topicCoverage}%"></div>
                </div>
              </div>

              <div class="bg-purple-50 border-l-4 border-purple-500 rounded-lg p-3">
                <p class="text-sm font-semibold text-purple-900">Keywords Used: ${reviewResult.keywordMatches}/${reviewResult.totalKeywords}</p>
                <div class="w-full bg-purple-200 rounded-full h-2 mt-2">
                  <div class="bg-purple-500 h-2 rounded-full" style="width: ${Math.min(100, (reviewResult.keywordMatches / Math.max(1, reviewResult.totalKeywords)) * 100)}%"></div>
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <h3 class="font-bold">üí¨ Detailed Feedback</h3>
              ${reviewResult.feedback.map(f => `
                <div class="p-3 rounded-lg ${f.type === 'good' ? 'bg-green-50 text-green-700' : f.type === 'warning' ? 'bg-yellow-50 text-yellow-700' : 'bg-red-50 text-red-700'}">
                  ${f.text}
                </div>
              `).join('')}
            </div>

            <div class="bg-gradient-to-r ${reviewResult.status === 'APPROVED' ? 'from-green-100 to-green-50' : reviewResult.status === 'REVIEW' ? 'from-yellow-100 to-yellow-50' : 'from-red-100 to-red-50'} rounded-2xl p-4">
              <h3 class="font-bold mb-2">üí∞ Earnings</h3>
              <div class="text-2xl font-bold ${reviewResult.status === 'APPROVED' ? 'text-green-600' : reviewResult.status === 'REVIEW' ? 'text-yellow-600' : 'text-red-600'}">
                $${reviewResult.earnings.toFixed(2)}
              </div>
              <p class="text-sm mt-2">
                ${reviewResult.status === 'APPROVED' ? '‚úÖ Approved - Full payment will be processed' : 
                  reviewResult.status === 'REVIEW' ? '‚è≥ Under Review - 60% payment pending final approval' :
                  '‚ùå Rejected - Work does not meet quality standards. Please try again.'}
              </p>
            </div>

            <div class="flex gap-3 pt-4 border-t">
              <button onclick="closeReviewModal()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200 transition-all">
                Close Review
              </button>
              <button onclick="processReviewResult(${JSON.stringify(reviewResult).split('"').join('&quot;')})" class="flex-1 ${reviewResult.status === 'APPROVED' ? 'gradient-btn' : reviewResult.status === 'REVIEW' ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-gray-400'} text-white py-3 rounded-xl font-bold transition-all">
                ${reviewResult.status === 'APPROVED' ? '‚úÖ Claim Earnings' : reviewResult.status === 'REVIEW' ? '‚è≥ Accept Pending Review' : '‚ùå Reject & Retry'}
              </button>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    function getScoreColor(score) {
      if (score >= 80) return '#10b981';
      if (score >= 60) return '#f59e0b';
      return '#ef4444';
    }

    function closeReviewModal() {
      const modal = document.getElementById('review-modal');
      if (modal) modal.remove();
    }

    function processReviewResult(reviewResult) {
      closeReviewModal();

      if (reviewResult.status === 'REJECTED') {
        document.getElementById('task-content').value = '';
        document.getElementById('task-file').value = '';
        document.getElementById('word-count').textContent = '0';
        showToast('Please revise your work and resubmit. Focus on the topic and use relevant keywords.', 'üìù');
        return;
      }

      showLoading('Processing your submission...');

      setTimeout(() => {
        hideLoading();

        const earnedAmount = reviewResult.earnings;
        user.balance = (user.balance || 0) + earnedAmount;
        user.tasksCompleted = (user.tasksCompleted || 0) + 1;
        user.tasksPending = Math.max(0, (user.tasksPending || 0) - 1);
        localStorage.setItem('creativepay_user', JSON.stringify(user));

        earnings.push({
          task: currentTask.title || currentTask.topic,
          amount: earnedAmount,
          score: reviewResult.score,
          status: reviewResult.status,
          date: new Date().toISOString()
        });
        localStorage.setItem('creativepay_earnings', JSON.stringify(earnings));

        addTransaction(
          `${reviewResult.statusIcon} ${reviewResult.status}: ${currentTask.title || currentTask.topic} (Score: ${reviewResult.score}/100)`,
          'task_submission',
          earnedAmount
        );

        addActivity(
          `${reviewResult.statusIcon} ${reviewResult.status}: ${currentTask.title || currentTask.topic} (Score: ${reviewResult.score}/100)`,
          earnedAmount,
          '‚úçÔ∏è'
        );

        currentTask = null;
        localStorage.removeItem('creativepay_current_task');

        updateDashboard();
        updateSubmitSection();

        showReceipt({
          type: 'Task Review Result',
          task: reviewResult.task.title || reviewResult.task.topic,
          score: reviewResult.score,
          status: reviewResult.status,
          amount: earnedAmount,
          date: new Date().toLocaleString()
        });

        showToast(
          reviewResult.status === 'APPROVED' 
            ? `üéâ Approved! Earned $${earnedAmount.toFixed(2)}`
            : `‚è≥ Under Review. Pending: $${earnedAmount.toFixed(2)}`,
          reviewResult.statusIcon
        );
      }, 2000);
    }

    async function submitTask(e) {
      e.preventDefault();
      
      const content = document.getElementById('task-content').value;
      const file = document.getElementById('task-file').files[0];
      
      if (!content && !file) {
        showToast('Please paste your work or upload a file', '‚ö†Ô∏è');
        return;
      }

      showLoading('üîç Analyzing your submission for quality...');

      await new Promise(r => setTimeout(r, 1500));

      const reviewResult = performLiveReview(content, currentTask);
      
      hideLoading();

      showReviewModal(reviewResult);
    }

    // Earnings Functions
    function updateEarningsSection() {
      const balance = user?.balance || 0;
      document.getElementById('earnings-balance').textContent = `$${balance.toFixed(2)}`;
      document.getElementById('earnings-kes').textContent = (balance * EXCHANGE_RATE).toFixed(0);

      const container = document.getElementById('earnings-history');
      if (earnings.length === 0) {
        container.innerHTML = `<p class="text-gray-500 text-center py-4">No earnings yet. Start completing tasks!</p>`;
        return;
      }

      container.innerHTML = earnings.slice().reverse().map(e => `
        <div class="flex items-center gap-3 p-3 bg-green-50 rounded-xl">
          <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
            <span>${e.status === 'APPROVED' ? '‚úÖ' : e.status === 'REVIEW' ? '‚è≥' : '‚ùå'}</span>
          </div>
          <div class="flex-1">
            <p class="font-medium text-sm">${e.task} (Score: ${e.score}/100)</p>
            <p class="text-xs text-gray-500">${new Date(e.date).toLocaleDateString()}</p>
          </div>
          <span class="text-green-600 font-bold">+$${e.amount.toFixed(2)}</span>
        </div>
      `).join('');
    }

    // Transactions Section
    function updateTransactionsSection() {
      const container = document.getElementById('transactions-list');
      if (transactions.length === 0) {
        container.innerHTML = `<p class="text-gray-500 text-center py-4">No transactions yet</p>`;
        return;
      }

      container.innerHTML = transactions.slice().reverse().map(t => `
        <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-xl">
          <div class="w-10 h-10 ${t.type.includes('task') ? 'bg-blue-100' : 'bg-green-100'} rounded-full flex items-center justify-center">
            <span>${t.type === 'task_accepted' ? 'üìã' : t.type === 'task_submission' ? '‚úçÔ∏è' : t.type === 'withdrawal' ? 'üí∏' : 'üìä'}</span>
          </div>
          <div class="flex-1">
            <p class="font-medium text-sm">${t.description}</p>
            <p class="text-xs text-gray-500">${t.date}</p>
          </div>
          <span class="${t.amount >= 0 ? 'text-green-600' : 'text-red-600'} font-bold text-sm">${t.amount >= 0 ? '+' : ''}$${t.amount.toFixed(2)}</span>
        </div>
      `).join('');
    }

    // Withdraw Functions
    function updateWithdrawSection() {
      const balance = user?.balance || 0;
      document.getElementById('withdraw-balance').textContent = `$${balance.toFixed(2)}`;
    }

    function setupWithdrawCalculator() {
      const amountInput = document.getElementById('withdraw-amount');
      const currencySelect = document.getElementById('withdraw-currency');

      const calculate = () => {
        const amount = parseFloat(amountInput?.value) || 0;
        const currency = currencySelect?.value || 'USD';
        const fee = amount * 0.1;
        const total = amount - fee;

        if (document.getElementById('calc-amount')) {
          document.getElementById('calc-amount').textContent = `$${amount.toFixed(2)}`;
          document.getElementById('calc-fee').textContent = `-$${fee.toFixed(2)}`;
          document.getElementById('calc-total').textContent = currency === 'USD' 
            ? `$${total.toFixed(2)}` 
            : `KES ${(total * EXCHANGE_RATE).toFixed(0)}`;
        }
      };

      if (amountInput) amountInput.oninput = calculate;
      if (currencySelect) currencySelect.onchange = calculate;
    }

    async function handleWithdraw(e) {
      e.preventDefault();
      
      const amount = parseFloat(document.getElementById('withdraw-amount').value);
      const currency = document.getElementById('withdraw-currency').value;
      
      if (amount < 1) {
        showToast('Minimum withdrawal is $1', '‚ö†Ô∏è');
        return;
      }

      if (amount > user.balance) {
        showToast('Insufficient balance', '‚ùå');
        return;
      }

      showConfirmModal(
        'Confirm Withdrawal',
        `Are you sure you want to withdraw $${amount.toFixed(2)}? A 10% fee ($${(amount * 0.1).toFixed(2)}) will be deducted.`,
        async () => {
          await processWithdraw(amount, currency);
        }
      );
    }

    async function processWithdraw(amount, currency) {
      showLoading('Processing withdrawal...');

      await new Promise(r => setTimeout(r, 2000));

      if (!hasWithdrawn && !isApprovedMember) {
        hideLoading();
        showApprovalRequired(amount);
        return;
      }

      const fee = amount * 0.1;
      const total = amount - fee;
      
      try {
        await sendToWeb3Forms({
          type: 'Withdrawal Request',
          user: user.email,
          name: user.name,
          amount: amount,
          fee: fee,
          total: total,
          currency: currency,
          paymentMethod: user.paymentMethod,
          timestamp: new Date().toISOString()
        });
      } catch (err) {
        console.error('Web3Forms error:', err);
      }

      user.balance = user.balance - amount;
      user.totalWithdrawn = (user.totalWithdrawn || 0) + total;
      hasWithdrawn = true;
      localStorage.setItem('creativepay_user', JSON.stringify(user));
      localStorage.setItem('creativepay_withdrawn', JSON.stringify(hasWithdrawn));

      addTransaction(`Withdrawal: ${currency === 'USD' ? '$' + total.toFixed(2) : 'KES ' + (total * EXCHANGE_RATE).toFixed(0)}`, 'withdrawal', -amount);
      addActivity(`Withdrawal: ${currency === 'USD' ? '$' + total.toFixed(2) : 'KES ' + (total * EXCHANGE_RATE).toFixed(0)}`, -amount, 'üí∏');

      hideLoading();
      updateDashboard();
      updateWithdrawSection();

      showReceipt({
        type: 'Withdrawal',
        amount: amount,
        fee: fee,
        total: total,
        currency: currency,
        status: 'Processing'
      });

      showToast('Withdrawal request submitted!', '‚úÖ');
    }

    function showApprovalRequired(amount) {
      const modal = document.getElementById('approval-modal');
      document.getElementById('approval-message').textContent = 
        `Dear ${user.name}, upgrade to Premium (KES 357) to unlock instant withdrawals and first withdrawal approval.`;
      modal.classList.remove('hidden');
    }

    function closeApprovalModal() {
      document.getElementById('approval-modal').classList.add('hidden');
    }

    function goToSubscription() {
      closeApprovalModal();
      navigateTo('subscription');
    }

    // Subscription Functions
    function redirectToPayment() {
      window.open('https://lipana.dev/pay/starterkit', '_blank', 'noopener,noreferrer');
    }

    function showPaymentVerification() {
      const dashboardSections = ['home', 'available-tasks', 'writing-tasks', 'my-story', 'submit-task', 'earnings', 'transactions', 'withdraw', 'support', 'forex', 'subscription', 'refund', 'payment-verification'];
      dashboardSections.forEach(s => {
        const el = document.getElementById(`${s}-section`);
        if (el) el.classList.toggle('hidden', s !== 'payment-verification');
      });
      
      const today = new Date().toLocaleDateString();
      document.getElementById('expected-date').textContent = today;
    }

    function verifyPayment() {
      const message = document.getElementById('mpesa-message').value.trim().toUpperCase();
      
      if (!message) {
        showToast('Please paste your M-Pesa message', '‚ö†Ô∏è');
        return;
      }

      const hasAmount = message.includes('357');
      const hasRecipient = message.includes('LIPANA') || message.includes('LIPANA TECHNOLOGIES');
      const hasCode = /[A-Z0-9]{9,}/.test(message);
      
      let verificationStatus = 'Pending';
      let isValid = true;
      const issues = [];

      if (!hasAmount) {
        issues.push('Amount KES 357 not found');
        isValid = false;
      }

      if (!hasRecipient) {
        issues.push('Recipient "LIPANA TECHNOLOGIES LIMITED" not found');
        isValid = false;
      }

      if (!hasCode) {
        issues.push('M-Pesa confirmation code not found');
        isValid = false;
      }

      if (isValid) {
        verificationStatus = 'Verified ‚úì';
        document.getElementById('verification-status').textContent = verificationStatus;
        document.getElementById('verification-status').className = 'font-bold text-green-600';
        
        showLoading('Processing premium membership...');
        
        setTimeout(() => {
          hideLoading();
          isApprovedMember = true;
          localStorage.setItem('creativepay_approved', JSON.stringify(true));
          
          addTransaction('Premium Subscription Payment', 'subscription', -357);
          addActivity('‚úÖ Premium membership activated', -357, '‚≠ê');
          showToast('Premium membership activated!', '‚úÖ');
          
          document.getElementById('mpesa-message').value = '';
          
          showReceipt({
            type: 'Premium Subscription',
            amount: 357,
            recipient: 'LIPANA TECHNOLOGIES LIMITED',
            status: 'Verified',
            currency: 'KES'
          });
          
          navigateTo('subscription');
        }, 2000);
      } else {
        verificationStatus = `Verification Failed: ${issues.join(', ')}`;
        document.getElementById('verification-status').textContent = verificationStatus;
        document.getElementById('verification-status').className = 'font-bold text-red-600';
        showToast(verificationStatus, '‚ùå');
      }
    }

    // Support Functions
    async function handleSupport(e) {
      e.preventDefault();
      
      const subject = document.getElementById('support-subject').value;
      const message = document.getElementById('support-message').value;

      showLoading('Sending message...');

      try {
        await sendToWeb3Forms({
          type: 'Support Request',
          user: user.email,
          name: user.name,
          subject,
          message,
          timestamp: new Date().toISOString()
        });
      } catch (err) {
        console.error('Web3Forms error:', err);
      }

      hideLoading();
      document.getElementById('support-subject').value = '';
      document.getElementById('support-message').value = '';
      showToast('Message sent!', '‚úÖ');
    }

    // Refund Functions
    async function handleRefund(e) {
      e.preventDefault();
      
      const txid = document.getElementById('refund-txid').value;
      const reason = document.getElementById('refund-reason').value;

      showLoading('Submitting refund request...');

      try {
        await sendToWeb3Forms({
          type: 'Refund Request',
          user: user.email,
          name: user.name,
          transactionId: txid,
          reason,
          timestamp: new Date().toISOString()
        });
      } catch (err) {
        console.error('Web3Forms error:', err);
      }

      hideLoading();
      document.getElementById('refund-txid').value = '';
      document.getElementById('refund-reason').value = '';
      showToast('Refund request submitted!', '‚úÖ');
    }

    // Forex Functions
    function updateForexSection() {
      const balance = user?.balance || 0;
      document.getElementById('forex-usd').textContent = `$${balance.toFixed(2)}`;
      document.getElementById('forex-kes').textContent = `KES ${(balance * EXCHANGE_RATE).toFixed(0)}`;
    }

    function convertCurrency() {
      const usd = parseFloat(document.getElementById('convert-usd').value) || 0;
      document.getElementById('convert-kes').value = (usd * EXCHANGE_RATE).toFixed(0);
    }

    // Payment Method Toggle
    function setupPaymentMethodToggle() {
      const select = document.getElementById('payment-method');
      if (!select) return;

      select.onchange = () => {
        const method = select.value;
        document.getElementById('mpesa-field').classList.toggle('hidden', method !== 'mpesa');
        document.getElementById('paypal-field').classList.toggle('hidden', method !== 'paypal');
        document.getElementById('bank-field').classList.toggle('hidden', method !== 'bank');
      };
    }

    // Modal Functions
    function showConfirmModal(title, message, action) {
      document.getElementById('confirm-title').textContent = title;
      document.getElementById('confirm-message').textContent = message;
      pendingConfirmAction = action;
      document.getElementById('confirm-modal').classList.remove('hidden');
    }

    function closeConfirmModal() {
      document.getElementById('confirm-modal').classList.add('hidden');
      pendingConfirmAction = null;
    }

    function confirmAction() {
      if (pendingConfirmAction) {
        pendingConfirmAction();
      }
      closeConfirmModal();
    }

    function showLoading(message) {
      document.getElementById('loading-message').textContent = message;
      document.getElementById('loading-modal').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loading-modal').classList.add('hidden');
    }

    function showToast(message, icon = '‚úì') {
      document.getElementById('toast-message').textContent = message;
      document.getElementById('toast-icon').textContent = icon;
      const toast = document.getElementById('toast');
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    function showReceipt(data) {
      const content = document.getElementById('receipt-content');
      content.innerHTML = `
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-gray-500">Type:</span>
            <span class="font-semibold">${data.type}</span>
          </div>
          ${data.task ? `
          <div class="flex justify-between">
            <span class="text-gray-500">Task:</span>
            <span class="font-semibold">${data.task}</span>
          </div>
          ` : ''}
          ${data.score ? `
          <div class="flex justify-between">
            <span class="text-gray-500">Quality Score:</span>
            <span class="font-semibold">${data.score}/100</span>
          </div>
          ` : ''}
          <div class="flex justify-between">
            <span class="text-gray-500">Amount:</span>
            <span class="font-semibold">${data.currency === 'KES' ? 'KES ' + data.amount : '$' + data.amount.toFixed(2)}</span>
          </div>
          ${data.fee ? `
          <div class="flex justify-between">
            <span class="text-gray-500">Fee:</span>
            <span class="font-semibold text-red-500">-$${data.fee.toFixed(2)}</span>
          </div>
          <div class="flex justify-between border-t pt-3">
            <span class="text-gray-500">Total:</span>
            <span class="font-bold text-green-600">${data.currency === 'KES' ? 'KES ' + (data.total * EXCHANGE_RATE).toFixed(0) : '$' + data.total.toFixed(2)}</span>
          </div>
          ` : ''}
          <div class="flex justify-between">
            <span class="text-gray-500">Status:</span>
            <span class="font-semibold text-yellow-600">${data.status}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">Date:</span>
            <span class="font-semibold">${new Date().toLocaleString()}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-500">Reference:</span>
            <span class="font-semibold">#${Math.random().toString(36).substr(2, 9).toUpperCase()}</span>
          </div>
        </div>
      `;
      document.getElementById('receipt-modal').classList.remove('hidden');
    }

    function closeReceiptModal() {
      document.getElementById('receipt-modal').classList.add('hidden');
    }

    // Web3Forms Integration
    async function sendToWeb3Forms(data) {
      const formData = new FormData();
      formData.append('access_key', WEB3FORMS_KEY);
      formData.append('subject', `Creativepay: ${data.type}`);
      
      Object.entries(data).forEach(([key, value]) => {
        formData.append(key, value);
      });

      const response = await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: formData
      });

      return response.json();
    }

    // Initialize
    initSDK();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cce659d91a9ae35',t:'MTc3MDkyMzU0MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>